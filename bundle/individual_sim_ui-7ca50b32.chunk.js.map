{"version":3,"file":"individual_sim_ui-7ca50b32.chunk.js","sources":["../../../ui/core/launched_sims.ts","../../../ui/core/talents/talents_picker.tsx","../../../ui/core/talents/druid.ts","../../../ui/core/talents/hunter.ts","../../../ui/core/talents/mage.ts","../../../ui/core/talents/paladin.ts","../../../ui/core/talents/priest.ts","../../../ui/core/talents/rogue.ts","../../../ui/core/talents/shaman.ts","../../../ui/core/talents/warlock.ts","../../../ui/core/talents/warrior.ts","../../../ui/core/talents/deathknight.ts","../../../ui/core/talents/factory.ts","../../../ui/core/party.ts","../../../ui/core/player.ts","../../../ui/core/encounter.ts","../../../ui/core/raid.ts","../../../ui/core/worker_pool.ts","../../../ui/core/sim.ts","../../../ui/core/components/number_picker.ts","../../../ui/core/components/results_viewer.tsx","../../../ui/core/components/sim_title_dropdown.ts","../../../ui/core/components/boolean_picker.ts","../../../ui/core/components/enum_picker.ts","../../../ui/core/components/close_button.ts","../../../ui/core/components/base_modal.ts","../../../ui/core/components/settings_menu.ts","../../../ui/core/components/sim_header.tsx","../../../ui/core/sim_ui.ts","../../../ui/core/components/character_stats.tsx","../../../ui/core/components/stat_weights_action.ts","../../../ui/core/components/content_block.tsx","../../../ui/core/components/importers.ts","../../../ui/core/components/filters_menu.ts","../../../ui/core/components/other_inputs.ts","../../../ui/core/css_utils.ts","../../../ui/core/proto_utils/enchants.ts","../../../ui/core/components/virtual_scroll/clusterize.ts","../../../ui/core/components/gear_picker.tsx","../../../ui/core/components/sim_tab.ts","../../../ui/core/components/individual_sim_ui/bulk_tab.ts","../../../ui/core/components/saved_data_manager.ts","../../../ui/core/components/individual_sim_ui/gear_tab.ts","../../../ui/core/components/list_picker.tsx","../../../ui/core/components/encounter_picker.ts","../../../ui/core/components/icon_picker.tsx","../../../ui/core/components/multi_icon_picker.ts","../../../ui/core/components/icon_enum_picker.tsx","../../../ui/core/components/individual_sim_ui/custom_rotation_picker.ts","../../../ui/core/components/number_list_picker.ts","../../../ui/core/components/individual_sim_ui/cooldowns_picker.ts","../../../ui/core/components/input_helpers.ts","../../../ui/core/components/icon_inputs.ts","../../../ui/core/components/individual_sim_ui/consumes_picker.ts","../../../ui/core/constants/tooltips.ts","../../../ui/core/components/item_swap_picker.ts","../../../ui/core/components/individual_sim_ui/settings_tab.ts","../../../ui/core/components/string_picker.ts","../../../ui/core/components/individual_sim_ui/apl_helpers.ts","../../../ui/core/components/individual_sim_ui/apl_values.ts","../../../ui/core/components/individual_sim_ui/apl_actions.ts","../../../ui/core/components/individual_sim_ui/apl_rotation_picker.ts","../../../ui/core/components/individual_sim_ui/rotation_tab.ts","../../../ui/core/talents/glyphs_picker.ts","../../../ui/core/talents/hunter_pet.ts","../../../ui/core/components/individual_sim_ui/talents_tab.ts","../../../ui/core/components/exporters.ts","../../../ui/core/individual_sim_ui.ts"],"sourcesContent":["import { Class, Spec } from './proto/common';\r\nimport { specToClass } from './proto_utils/utils';\r\n\r\n// This file is for anything related to launching a new sim. DO NOT touch this\r\n// file until your sim is ready to launch!\r\n\r\nexport enum LaunchStatus {\r\n\tUnlaunched,\r\n\tAlpha,\r\n\tBeta,\r\n\tLaunched,\r\n}\r\n\r\nexport const raidSimStatus: LaunchStatus = LaunchStatus.Beta;\r\n\r\n// This list controls which links are shown in the top-left dropdown menu.\r\nexport const simLaunchStatuses: Record<Spec, LaunchStatus> = {\r\n\t[Spec.SpecBalanceDruid]: LaunchStatus.Launched,\r\n\t[Spec.SpecFeralDruid]: LaunchStatus.Launched,\r\n\t[Spec.SpecFeralTankDruid]: LaunchStatus.Launched,\r\n\t[Spec.SpecRestorationDruid]: LaunchStatus.Unlaunched,\r\n\t[Spec.SpecElementalShaman]: LaunchStatus.Launched,\r\n\t[Spec.SpecEnhancementShaman]: LaunchStatus.Launched,\r\n\t[Spec.SpecRestorationShaman]: LaunchStatus.Unlaunched,\r\n\t[Spec.SpecHunter]: LaunchStatus.Launched,\r\n\t[Spec.SpecMage]: LaunchStatus.Launched,\r\n\t[Spec.SpecRogue]: LaunchStatus.Launched,\r\n\t[Spec.SpecHolyPaladin]: LaunchStatus.Unlaunched,\r\n\t[Spec.SpecProtectionPaladin]: LaunchStatus.Launched,\r\n\t[Spec.SpecRetributionPaladin]: LaunchStatus.Launched,\r\n\t[Spec.SpecHealingPriest]: LaunchStatus.Alpha,\r\n\t[Spec.SpecShadowPriest]: LaunchStatus.Launched,\r\n\t[Spec.SpecSmitePriest]: LaunchStatus.Launched,\r\n\t[Spec.SpecWarlock]: LaunchStatus.Launched,\r\n\t[Spec.SpecWarrior]: LaunchStatus.Launched,\r\n\t[Spec.SpecProtectionWarrior]: LaunchStatus.Launched,\r\n\t[Spec.SpecDeathknight]: LaunchStatus.Unlaunched,\r\n\t[Spec.SpecTankDeathknight]: LaunchStatus.Unlaunched,\r\n};\r\n\r\n// Alpha and Beta show an info notice at the top of the page.\r\nexport const aplLaunchStatuses: Record<Spec, LaunchStatus> = {\r\n\t[Spec.SpecBalanceDruid]: LaunchStatus.Alpha,\r\n\t[Spec.SpecFeralDruid]: LaunchStatus.Alpha,\r\n\t[Spec.SpecFeralTankDruid]: LaunchStatus.Alpha,\r\n\t[Spec.SpecRestorationDruid]: LaunchStatus.Alpha,\r\n\t[Spec.SpecElementalShaman]: LaunchStatus.Alpha,\r\n\t[Spec.SpecEnhancementShaman]: LaunchStatus.Alpha,\r\n\t[Spec.SpecRestorationShaman]: LaunchStatus.Alpha,\r\n\t[Spec.SpecHunter]: LaunchStatus.Launched,\r\n\t[Spec.SpecMage]: LaunchStatus.Alpha,\r\n\t[Spec.SpecRogue]: LaunchStatus.Alpha,\r\n\t[Spec.SpecHolyPaladin]: LaunchStatus.Alpha,\r\n\t[Spec.SpecProtectionPaladin]: LaunchStatus.Alpha,\r\n\t[Spec.SpecRetributionPaladin]: LaunchStatus.Alpha,\r\n\t[Spec.SpecHealingPriest]: LaunchStatus.Alpha,\r\n\t[Spec.SpecShadowPriest]: LaunchStatus.Alpha,\r\n\t[Spec.SpecSmitePriest]: LaunchStatus.Alpha,\r\n\t[Spec.SpecWarlock]: LaunchStatus.Alpha,\r\n\t[Spec.SpecWarrior]: LaunchStatus.Alpha,\r\n\t[Spec.SpecProtectionWarrior]: LaunchStatus.Alpha,\r\n\t[Spec.SpecDeathknight]: LaunchStatus.Unlaunched,\r\n\t[Spec.SpecTankDeathknight]: LaunchStatus.Unlaunched,\r\n};\r\n\r\n// Meme specs are excluded from title drop-down menu.\r\nexport const memeSpecs: Array<Spec> = [\r\n\tSpec.SpecSmitePriest,\r\n];\r\n\r\nexport function getLaunchedSims(): Array<Spec> {\r\n\treturn Object.keys(simLaunchStatuses)\r\n\t\t.map(specStr => parseInt(specStr) as Spec)\r\n\t\t.filter(spec => simLaunchStatuses[spec] > LaunchStatus.Unlaunched);\r\n}\r\n\r\nexport function getLaunchedSimsForClass(klass: Class): Array<Spec> {\r\n\treturn Object.keys(specToClass)\r\n\t\t.map(specStr => parseInt(specStr) as Spec)\r\n\t\t.filter(spec => specToClass[spec] == klass && isSimLaunched(spec));\r\n}\r\n\r\nexport function isSimLaunched(specIndex: Spec): boolean {\r\n\treturn simLaunchStatuses[specIndex] > LaunchStatus.Unlaunched;\r\n}\r\n","import { Carousel, Tooltip } from 'bootstrap';\r\nimport { Component } from '../components/component.js';\r\nimport { Input, InputConfig } from '../components/input.js';\r\nimport { Class, Spec } from '../proto/common.js';\r\nimport { ActionId } from '../proto_utils/action_id.js';\r\nimport { getSpecIcon } from '../proto_utils/utils.js';\r\nimport { TypedEvent } from '../typed_event.js';\r\nimport { isRightClick } from '../utils.js';\r\nimport { sum } from '../utils.js';\r\nimport { Player } from '../player.js';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\nconst MAX_POINTS_PLAYER = 61;\r\nconst MAX_POINTS_HUNTER_PET = 13;\r\nconst MAX_POINTS_HUNTER_PET_BM = 17;\r\n\r\nexport interface TalentsPickerConfig<ModObject, TalentsProto> extends InputConfig<ModObject, string> {\r\n\tklass: Class,\r\n\ttrees: TalentsConfig<TalentsProto>,\r\n\tpointsPerRow: number,\r\n\tmaxPoints: number,\r\n}\r\n\r\nexport class TalentsPicker<ModObject, TalentsProto> extends Input<ModObject, string> {\r\n\tprivate readonly config: TalentsPickerConfig<ModObject, TalentsProto>;\r\n\r\n\treadonly numRows: number;\r\n\treadonly numCols: number;\r\n\treadonly pointsPerRow: number;\r\n\tmaxPoints: number;\r\n\r\n\treadonly trees: Array<TalentTreePicker<TalentsProto>>;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: TalentsPickerConfig<ModObject, TalentsProto>) {\r\n\t\tsuper(parent, 'talents-picker-root', modObject, { ...config, inline: true });\r\n\t\tthis.config = config;\r\n\t\tthis.pointsPerRow = config.pointsPerRow;\r\n\t\tthis.maxPoints = config.maxPoints;\r\n\t\tthis.numRows = Math.max(...config.trees.map(treeConfig => treeConfig.talents.map(talentConfig => talentConfig.location.rowIdx).flat()).flat()) + 1;\r\n\t\tthis.numCols = Math.max(...config.trees.map(treeConfig => treeConfig.talents.map(talentConfig => talentConfig.location.colIdx).flat()).flat()) + 1;\r\n\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<div id=\"talents-carousel\" className=\"carousel slide\">\r\n\t\t\t\t<div className=\"carousel-inner\">\r\n\t\t\t\t</div>\r\n\t\t\t\t<button className=\"carousel-control-prev\" type=\"button\">\r\n\t\t\t\t\t<span className=\"carousel-control-prev-icon\" attributes={{'aria-hidden':true}}></span>\r\n\t\t\t\t\t<span className=\"visually-hidden\">Previous</span>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button className=\"carousel-control-next\" type=\"button\">\r\n\t\t\t\t\t<span className=\"carousel-control-next-icon\" attributes={{'aria-hidden':true}}></span>\r\n\t\t\t\t\t<span className=\"visually-hidden\">Next</span>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tconst carouselContainer = this.rootElem.querySelector('.carousel-inner') as HTMLElement;\r\n\t\tconst carouselPrevBtn = this.rootElem.querySelector('.carousel-control-prev') as HTMLButtonElement;\r\n\t\tconst carouselNextBtn = this.rootElem.querySelector('.carousel-control-next') as HTMLButtonElement;\r\n\r\n\t\tthis.trees = config.trees.map((treeConfig, i) => {\r\n\t\t\tconst carouselItem = document.createElement('div');\r\n\t\t\tcarouselContainer.appendChild(carouselItem);\r\n\r\n\t\t\tcarouselItem.classList.add('carousel-item');\r\n\t\t\t// Set middle talents active by default for mobile slider\r\n\t\t\tif (i === 1) carouselItem.classList.add('active');\r\n\r\n\t\t\t// If using a hunter pet, add 3 to skip the hunter specs\r\n\t\t\tif (treeConfig.name === 'Ferocity') i += 3;\r\n\t\t\tif (treeConfig.name === 'Tenacity') i += 4;\r\n\t\t\tif (treeConfig.name === 'Cunning') i += 5;\r\n\r\n\t\t\treturn new TalentTreePicker(carouselItem, treeConfig, this, config.klass, i);\r\n\t\t});\r\n\t\tthis.trees.forEach(tree => tree.talents.forEach(talent => talent.setPoints(0, false)));\r\n\r\n\t\tlet carouselitemIdx = 0;\r\n\t\tconst slidePrev = () => {\r\n\t\t\tif (carouselitemIdx >= 1) return;\r\n\t\t\tcarouselitemIdx += 1;\r\n\t\t\tcarouselContainer.style.transform = `translateX(${33.3 * carouselitemIdx}%)`;\r\n\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx - 2) % 3]!.classList.remove('active');\r\n\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx - 1) % 3]!.classList.add('active')\r\n\t\t}\r\n\t\tconst slideNext = () => {\r\n\t\t\tif (carouselitemIdx <= -1) return;\r\n\t\t\tcarouselitemIdx -= 1;\r\n\t\t\tcarouselContainer.style.transform = `translateX(${33.3 * carouselitemIdx}%)`;\r\n\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx) % 3]!.classList.remove('active');\r\n\t\t\tcarouselContainer.children[Math.abs(carouselitemIdx) + 1 % 3]!.classList.add('active');\r\n\t\t}\r\n\r\n\t\tcarouselPrevBtn.addEventListener('click', slidePrev);\r\n\t\tcarouselNextBtn.addEventListener('click', slideNext);\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): string {\r\n\t\treturn this.trees.map(tree => tree.getTalentsString()).join('-').replace(/-+$/g, '');\r\n\t}\r\n\r\n\tsetInputValue(newValue: string) {\r\n\t\tconst parts = newValue.split('-');\r\n\t\tthis.trees.forEach((tree, idx) => tree.setTalentsString(parts[idx] || ''));\r\n\t\tthis.updateTrees();\r\n\t}\r\n\r\n\tupdateTrees() {\r\n\t\tif (this.isFull()) {\r\n\t\t\tthis.rootElem.classList.add('talents-full');\r\n\t\t} else {\r\n\t\t\tthis.rootElem.classList.remove('talents-full');\r\n\t\t}\r\n\t\tthis.trees.forEach(tree => tree.update());\r\n\t}\r\n\r\n\tget numPoints() {\r\n\t\treturn sum(this.trees.map(tree => tree.numPoints));\r\n\t}\r\n\r\n\tisFull() {\r\n\t\treturn this.numPoints >= this.maxPoints;\r\n\t}\r\n\r\n\tsetMaxPoints(newMaxPoints: number) {\r\n\t\tif (newMaxPoints != this.maxPoints) {\r\n\t\t\tthis.maxPoints = newMaxPoints;\r\n\t\t\tthis.updateTrees();\r\n\t\t}\r\n\t}\r\n\r\n\tisHunterPet(): boolean  {\r\n\t\treturn ['Cunning', 'Ferocity', 'Tenacity'].includes(this.config.trees[0].name)\r\n\t}\r\n}\r\n\r\nclass TalentTreePicker<TalentsProto> extends Component {\r\n\tprivate readonly config: TalentTreeConfig<TalentsProto>;\r\n\tprivate readonly title: HTMLElement;\r\n\tprivate readonly pointsElem: HTMLElement;\r\n\r\n\treadonly talents: Array<TalentPicker<TalentsProto>>;\r\n\treadonly picker: TalentsPicker<any, TalentsProto>;\r\n\r\n\t// The current number of points in this tree\r\n\tnumPoints: number;\r\n\r\n\tconstructor(parent: HTMLElement, config: TalentTreeConfig<TalentsProto>, picker: TalentsPicker<any, TalentsProto>, klass: Class, specNumber: number) {\r\n\t\tsuper(parent, 'talent-tree-picker-root');\r\n\t\tthis.config = config;\r\n\t\tthis.numPoints = 0;\r\n\t\tthis.picker = picker;\r\n\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"talent-tree-header\">\r\n\t\t\t\t\t<img src={getSpecIcon(klass, specNumber)} className=\"talent-tree-icon\" />\r\n\t\t\t\t\t<span className=\"talent-tree-title\"></span>\r\n\t\t\t\t\t<span className=\"talent-tree-points\"></span>\r\n\t\t\t\t\t<button className=\"talent-tree-reset btn btn-link link-danger\">\r\n\t\t\t\t\t\t<i className=\"fa fa-times\"></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"talent-tree-background\"></div>\r\n\t\t\t\t<div className=\"talent-tree-main\"></div>\r\n\t\t\t</>\r\n\t\t);\r\n\r\n\t\tthis.title = this.rootElem.getElementsByClassName('talent-tree-title')[0] as HTMLElement;\r\n\t\tthis.pointsElem = this.rootElem.querySelector('.talent-tree-points') as HTMLElement;\r\n\r\n\t\tconst background = this.rootElem.querySelector('.talent-tree-background') as HTMLElement;\r\n\t\tbackground.style.backgroundImage = `url('${config.backgroundUrl}')`;\r\n\r\n\t\tconst main = this.rootElem.querySelector('.talent-tree-main') as HTMLElement;\r\n\t\tmain.style.gridTemplateRows = `repeat(${this.picker.numRows}, 1fr)`;\r\n\t\t// Add 2 for spacing on the sides\r\n\t\tmain.style.gridTemplateColumns = `repeat(${this.picker.numCols}, 1fr)`;\r\n\r\n\t\tconst iconSize = '3.5rem'\r\n\t\tmain.style.height = `calc(${iconSize} * ${this.picker.numRows})`\r\n\t\tmain.style.maxWidth = `calc(${iconSize} * ${this.picker.numCols})`\r\n\t\tthis.rootElem.style.maxWidth = `calc(${iconSize} * ${this.picker.numCols + 2})`\r\n\r\n\t\tthis.talents = config.talents.map(talent => new TalentPicker(main, talent, this));\r\n\t\t// Process parent<->child mapping\r\n\t\tthis.talents.forEach(talent => {\r\n\t\t\tif (talent.config.prereqLocation) {\r\n\t\t\t\tthis.getTalent(talent.config.prereqLocation).config.childLocations!.push(talent.config.location);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Loop through all and have talent add in divs/items for child dependencies\r\n\t\t// It'd be nicer to have this in talent constructor but json would have to be updated\r\n\t\tconst recurseCalcIdx = (t: TalentPicker<TalentsProto>, z: number) => {\r\n\t\t\tt.initChildReqs();\r\n\t\t\tt.zIndex = z;\r\n\t\t\tfor (const cl of t.config.childLocations!) {\r\n\t\t\t\tconst c = this.getTalent(cl);\r\n\t\t\t\tc.parentReq = t.getChildReqArrow(cl);\r\n\t\t\t\trecurseCalcIdx(c, z-2);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Start at top of each heirachy chain and recurse down\r\n\t\tfor (const t of this.talents) {\r\n\t\t\tif (t.config.childLocations!.length == 0)\r\n\t\t\t\tcontinue;\r\n\t\t\tif (t.config.prereqLocation !== undefined)\r\n\t\t\t\tcontinue;\r\n\t\t\trecurseCalcIdx(t, 20);\r\n\t\t}\r\n\t\tconst resetBtn = this.rootElem.querySelector('.talent-tree-reset') as HTMLElement;\r\n\t\tnew Tooltip(resetBtn, {\r\n\t\t\ttitle: 'Reset talent points',\r\n\t\t});\r\n\t\tresetBtn.addEventListener('click', event => {\r\n\t\t\tthis.talents.forEach(talent => talent.setPoints(0, false));\r\n\t\t\tthis.picker.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.title.innerHTML = this.config.name\r\n\t\tthis.pointsElem.textContent = `${this.numPoints} / ${this.getMaxSpendablePoints()}`\r\n\t\tthis.talents.forEach(talent => talent.update());\r\n\t}\r\n\r\n\tgetTalent(location: TalentLocation): TalentPicker<TalentsProto> {\r\n\t\tconst talent = this.talents.find(talent => talent.getRow() == location.rowIdx && talent.getCol() == location.colIdx);\r\n\t\tif (!talent)\r\n\t\t\tthrow new Error('No talent found with location: ' + location);\r\n\t\treturn talent;\r\n\t}\r\n\r\n\tgetTalentsString(): string {\r\n\t\treturn this.talents.map(talent => String(talent.getPoints())).join('').replace(/0+$/g, '');\r\n\t}\r\n\r\n\tsetTalentsString(str: string) {\r\n\t\tthis.talents.forEach((talent, idx) => talent.setPoints(Number(str.charAt(idx)), false));\r\n\t}\r\n\r\n\tgetMaxSpendablePoints() {\r\n\t\tif (!this.picker.isHunterPet()) return MAX_POINTS_PLAYER;\r\n\t\tif ((this.picker.modObject as Player<Spec.SpecHunter>).getTalents().beastMastery) return MAX_POINTS_HUNTER_PET_BM;\r\n\t\treturn MAX_POINTS_HUNTER_PET;\r\n\t}\r\n}\r\n\r\n\r\ntype ReqDir = 'down' | 'right' | 'left' | 'rightdown' | 'leftdown';\r\nclass TalentReqArrow extends Component {\r\n\tprivate dir: ReqDir;\r\n\tprivate zIdx: number;\r\n\treadonly parentLoc: TalentLocation;\r\n\treadonly childLoc: TalentLocation;\r\n\r\n\tconstructor(parent: HTMLElement, parentLoc: TalentLocation, childLoc: TalentLocation) {\r\n\t\tsuper(parent, 'talent-picker-req-arrow', document.createElement('div'));\r\n\t\tthis.zIdx = 0;\r\n\t\tthis.parentLoc = parentLoc;\r\n\t\tthis.childLoc = childLoc;\r\n\t\r\n\t\tthis.rootElem.style.gridRow = String(parentLoc.rowIdx + 1);\r\n\t\tthis.rootElem.style.gridColumn = String(parentLoc.colIdx + 1);\r\n\r\n\t\tlet rowEnd = Math.max(parentLoc.rowIdx, childLoc.rowIdx) + 1;\r\n\t\tlet colEnd = Math.max(parentLoc.colIdx, childLoc.colIdx) + 1;\r\n\r\n\t\t// Calculate where we need to 'point'\r\n\t\tif (parentLoc.rowIdx == childLoc.rowIdx) {\r\n\t\t\tthis.dir = parentLoc.colIdx < childLoc.colIdx ? 'right' : 'left';\r\n\t\t\tthis.rootElem.dataset.reqArrowColSize = String(Math.abs(parentLoc.colIdx - childLoc.colIdx));\r\n\t\t\tcolEnd = this.dir == 'left' ? colEnd+1 : colEnd-1;\r\n\t\t} else {\r\n\t\t\tif (parentLoc.colIdx == childLoc.colIdx) {\r\n\t\t\t\tthis.dir = 'down';\r\n\t\t\t\tthis.rootElem.dataset.reqArrowRowSize = String(Math.abs(parentLoc.rowIdx - childLoc.rowIdx));\r\n\t\t\t\trowEnd += 1;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dir = parentLoc.colIdx < childLoc.colIdx ? 'rightdown' : 'leftdown';\r\n\t\t\t\tthis.rootElem.dataset.reqArrowColSize = String(Math.abs(parentLoc.colIdx - childLoc.colIdx));\r\n\t\t\t\tthis.rootElem.dataset.reqArrowRowSize = String(Math.abs(parentLoc.rowIdx - childLoc.rowIdx));\r\n\t\t\t\trowEnd += 1;\r\n\t\t\t\tcolEnd = this.dir == 'rightdown' ? colEnd+1 : colEnd-1;\r\n\t\t\t\tthis.rootElem.appendChild(<div></div>)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.rootElem.style.gridRowEnd = String(rowEnd);\r\n\t\tthis.rootElem.style.gridColumnEnd = String(colEnd);\r\n\t\tthis.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`);\r\n\t}\r\n\r\n\tget zIndex() {\r\n\t\treturn this.zIdx;\r\n\t}\r\n\r\n\tset zIndex(z: number) {\r\n\t\tthis.zIdx = z;\r\n\t\tthis.rootElem.style.zIndex = String(z);\r\n\t}\r\n\r\n\tsetReqFufilled(isFufilled: boolean) {\r\n\t\tif (isFufilled)\r\n\t\t\tthis.rootElem.dataset.reqActive = 'true';\r\n\t\telse\r\n\t\t\tdelete this.rootElem.dataset.reqActive;\r\n\t}\r\n}\r\n\r\nclass TalentPicker<TalentsProto> extends Component {\r\n\treadonly config: TalentConfig<TalentsProto>;\r\n\tprivate readonly tree: TalentTreePicker<TalentsProto>;\r\n\tprivate readonly pointsDisplay: HTMLElement;\r\n\r\n\tprivate longTouchTimer?: number;\r\n\tprivate childReqs: TalentReqArrow[];\r\n\tprivate zIdx: number;\r\n\tparentReq: TalentReqArrow | null;\r\n\r\n\tconstructor(parent: HTMLElement, config: TalentConfig<TalentsProto>, tree: TalentTreePicker<TalentsProto>) {\r\n\t\tsuper(parent, 'talent-picker-root', document.createElement('a'));\r\n\t\tthis.config = config;\r\n\t\tthis.tree = tree;\r\n\t\tthis.childReqs = [];\r\n\t\tthis.parentReq = null;\r\n\t\tthis.zIdx = 0;\r\n\r\n\t\tthis.rootElem.style.gridRow = String(this.config.location.rowIdx + 1);\r\n\t\tthis.rootElem.style.gridColumn = String(this.config.location.colIdx + 1);\r\n\r\n\t\tthis.rootElem.dataset.maxPoints = String(this.config.maxPoints);\r\n\t\tthis.rootElem.dataset.whtticon = 'false';\r\n\r\n\t\tthis.pointsDisplay = document.createElement('span');\r\n\t\tthis.pointsDisplay.classList.add('talent-picker-points');\r\n\t\tthis.rootElem.appendChild(this.pointsDisplay);\r\n\r\n\t\tthis.rootElem.addEventListener('click', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\tthis.rootElem.addEventListener('contextmenu', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\tthis.rootElem.addEventListener('touchmove', event => {\r\n\t\t\tif (this.longTouchTimer != undefined) {\r\n\t\t\t\tclearTimeout(this.longTouchTimer);\r\n\t\t\t\tthis.longTouchTimer = undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.rootElem.addEventListener('touchstart', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.longTouchTimer = window.setTimeout(() => {\r\n\t\t\t\tthis.setPoints(0, true);\r\n\t\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\r\n\t\t\t\tthis.longTouchTimer = undefined;\r\n\t\t\t}, 750);\r\n\t\t});\r\n\t\tthis.rootElem.addEventListener('touchend', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (this.longTouchTimer != undefined) {\r\n\t\t\t\tclearTimeout(this.longTouchTimer);\r\n\t\t\t\tthis.longTouchTimer = undefined;\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar newPoints = this.getPoints() + 1;\r\n\t\t\tif (this.config.maxPoints < newPoints) {\r\n\t\t\t\tnewPoints = 0;\r\n\t\t\t}\r\n\t\t\tthis.setPoints(newPoints, true);\r\n\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t\tthis.rootElem.addEventListener('mousedown', event => {\r\n\t\t\tconst rightClick = isRightClick(event);\r\n\t\t\tif (rightClick) {\r\n\t\t\t\tthis.setPoints(this.getPoints() - 1, true);\r\n\t\t\t} else {\r\n\t\t\t\tthis.setPoints(this.getPoints() + 1, true);\r\n\t\t\t}\r\n\t\t\tthis.tree.picker.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tinitChildReqs(): void {\r\n\t\tif (this.config.childLocations!.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tfor (const c of this.config.childLocations!) {\r\n\t\t\tthis.childReqs.push(new TalentReqArrow(this.rootElem.parentElement!, this.config.location, c));\r\n\t\t}\r\n\t}\r\n\r\n\tgetChildReqArrow(loc: TalentLocation): TalentReqArrow {\r\n\t\tfor (let c of this.childReqs) {\r\n\t\t\tif (c.childLoc === loc) {\r\n\t\t\t\treturn c;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow Error(\"missing child prereq?\");\r\n\t}\r\n\r\n\tget zIndex() {\r\n\t\treturn this.zIdx;\r\n\t}\r\n\r\n\tset zIndex(z: number) {\r\n\t\tthis.zIdx = z;\r\n\t\tthis.rootElem.style.zIndex = String(this.zIdx);\r\n\r\n\t\tfor (const c of this.childReqs) {\r\n\t\t\tc.zIndex = this.zIdx-1;\r\n\t\t}\r\n\t}\r\n\r\n\tgetRow(): number {\r\n\t\treturn this.config.location.rowIdx;\r\n\t}\r\n\r\n\tgetCol(): number {\r\n\t\treturn this.config.location.colIdx;\r\n\t}\r\n\r\n\tgetPoints(): number {\r\n\t\tconst pts = Number(this.rootElem.dataset.points);\r\n\t\treturn isNaN(pts) ? 0 : pts;\r\n\t}\r\n\r\n\tisFull(): boolean {\r\n\t\treturn this.getPoints() >= this.config.maxPoints;\r\n\t}\r\n\r\n\t// Returns whether setting the points to newPoints would be a valid talent tree.\r\n\tcanSetPoints(newPoints: number): boolean {\r\n\t\tconst oldPoints = this.getPoints();\r\n\r\n\t\tif (newPoints > oldPoints) {\r\n\t\t\tconst additionalPoints = newPoints - oldPoints;\r\n\r\n\t\t\tif (this.tree.picker.numPoints + additionalPoints > this.tree.picker.maxPoints) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.tree.numPoints < this.getRow() * this.tree.picker.pointsPerRow) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.config.prereqLocation) {\r\n\t\t\t\tif (!this.tree.getTalent(this.config.prereqLocation).isFull())\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst removedPoints = oldPoints - newPoints;\r\n\r\n\t\t\t// Figure out whether any lower talents would have the row requirement\r\n\t\t\t// broken by subtracting points.\r\n\t\t\tconst pointTotalsByRow = [...Array(this.tree.picker.numRows).keys()]\r\n\t\t\t\t.map(rowIdx => this.tree.talents.filter(talent => talent.getRow() == rowIdx))\r\n\t\t\t\t.map(talentsInRow => sum(talentsInRow.map(talent => talent.getPoints())));\r\n\t\t\tpointTotalsByRow[this.getRow()] -= removedPoints;\r\n\r\n\t\t\tconst cumulativeTotalsByRow = pointTotalsByRow.map((_, rowIdx) => sum(pointTotalsByRow.slice(0, rowIdx + 1)));\r\n\r\n\t\t\tif (!this.tree.talents.every(talent =>\r\n\t\t\t\ttalent.getPoints() == 0\r\n\t\t\t\t|| talent.getRow() == 0\r\n\t\t\t\t|| cumulativeTotalsByRow[talent.getRow() - 1] >= talent.getRow() * this.tree.picker.pointsPerRow)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tfor (const c of this.config.childLocations!) {\r\n\t\t\t\tif (this.tree.getTalent(c).getPoints() > 0)\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsetPoints(newPoints: number, checkValidity: boolean) {\r\n\t\tconst oldPoints = this.getPoints();\r\n\t\tnewPoints = Math.max(0, newPoints);\r\n\t\tnewPoints = Math.min(this.config.maxPoints, newPoints);\r\n\r\n\t\tif (checkValidity && !this.canSetPoints(newPoints))\r\n\t\t\treturn;\r\n\r\n\t\tthis.tree.numPoints += newPoints - oldPoints;\r\n\t\tthis.rootElem.dataset.points = String(newPoints);\r\n\r\n\t\tthis.pointsDisplay.textContent = newPoints + '/' + this.config.maxPoints;\r\n\r\n\t\tif (this.isFull()) {\r\n\t\t\tthis.rootElem.classList.add('talent-full');\r\n\t\t} else {\r\n\t\t\tthis.rootElem.classList.remove('talent-full');\r\n\t\t}\r\n\r\n\t\tconst spellId = this.getSpellIdForPoints(newPoints);\r\n\t\tActionId.fromSpellId(spellId).fill().then(actionId => {\r\n\t\t\tactionId.setWowheadHref(this.rootElem as HTMLAnchorElement);\r\n\t\t\tthis.rootElem.style.backgroundImage = `url('${actionId.iconUrl}')`;\r\n\t\t});\r\n\t}\r\n\r\n\tgetSpellIdForPoints(numPoints: number): number {\r\n\t\t// 0-indexed rank of talent\r\n\t\tconst rank = Math.max(0, numPoints - 1);\r\n\r\n\t\tif (this.config.spellIds[rank]) {\r\n\t\t\treturn this.config.spellIds[rank];\r\n\t\t} else {\r\n\t\t\tthrow new Error(`No rank ${numPoints} for talent ${String(this.config.fieldName)}`);\r\n\t\t}\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tlet canSetPoints = this.canSetPoints(this.getPoints() + 1);\r\n\t\tif (canSetPoints) {\r\n\t\t\tthis.rootElem.classList.add('talent-picker-can-add');\r\n\t\t} else {\r\n\t\t\tthis.rootElem.classList.remove('talent-picker-can-add');\r\n\t\t}\r\n\r\n\t\tif (this.parentReq) {\r\n\t\t\tthis.parentReq.setReqFufilled(canSetPoints || this.isFull());\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport type TalentsConfig<TalentsProto> = Array<TalentTreeConfig<TalentsProto>>;\r\n\r\nexport type TalentTreeConfig<TalentsProto> = {\r\n\tname: string;\r\n\tbackgroundUrl: string;\r\n\ttalents: Array<TalentConfig<TalentsProto>>;\r\n};\r\n\r\nexport type TalentLocation = {\r\n\t// 0-indexed row in the tree\r\n\trowIdx: number;\r\n\t// 0-indexed column in the tree\r\n\tcolIdx: number;\r\n};\r\n\r\nexport type TalentConfig<TalentsProto> = {\r\n\tfieldName?: keyof TalentsProto | string;\r\n\r\n\tlocation: TalentLocation;\r\n\r\n\t// Location of a prerequisite talent, if any\r\n\tprereqLocation?: TalentLocation;\r\n\r\n\t// Child talents depending on this talent. This is populated automatically.\r\n\tchildLocations?: TalentLocation[];\r\n\r\n\t// Spell ID for each rank of this talent.\r\n\t// Omitted ranks will be inferred by incrementing from the last provided rank.\r\n\tspellIds: Array<number>;\r\n\r\n\tmaxPoints: number;\r\n};\r\n\r\nexport function newTalentsConfig<TalentsProto>(talents: TalentsConfig<TalentsProto>): TalentsConfig<TalentsProto> {\r\n\ttalents.forEach(tree => {\r\n\t\ttree.talents.forEach((talent, i) => {\r\n\t\t\ttalent.childLocations = [];\r\n\t\t\t// Validate that talents are given in the correct order (left-to-right top-to-bottom).\r\n\t\t\tif (i != 0) {\r\n\t\t\t\tconst prevTalent = tree.talents[i - 1];\r\n\t\t\t\tif (talent.location.rowIdx < prevTalent.location.rowIdx || (talent.location.rowIdx == prevTalent.location.rowIdx && talent.location.colIdx <= prevTalent.location.colIdx)) {\r\n\t\t\t\t\tthrow new Error(`Out-of-order talent: ${String(talent.fieldName)}`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Infer omitted spell IDs.\r\n\t\t\tif (talent.spellIds.length < talent.maxPoints) {\r\n\t\t\t\tlet curSpellId = talent.spellIds[talent.spellIds.length - 1];\r\n\t\t\t\tfor (let pointIdx = talent.spellIds.length; pointIdx < talent.maxPoints; pointIdx++) {\r\n\t\t\t\t\tcurSpellId++;\r\n\t\t\t\t\ttalent.spellIds.push(curSpellId);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn talents;\r\n}\r\n","import { DruidTalents, DruidMajorGlyph, DruidMinorGlyph } from '../proto/druid.js';\r\n\r\nimport { GlyphsConfig, } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport DruidTalentsJson from './trees/druid.json';\r\n\r\nexport const druidTalentsConfig: TalentsConfig<DruidTalents> = newTalentsConfig(DruidTalentsJson);\r\n\r\nexport const druidGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[DruidMajorGlyph.GlyphOfBarkskin]: {\r\n\t\t\tname: 'Glyph of Barkskin',\r\n\t\t\tdescription: 'Reduces the chance you\\'ll be critically hit by 25% while Barkskin is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfBerserk]: {\r\n\t\t\tname: 'Glyph of Berserk',\r\n\t\t\tdescription: 'Increases the duration of Berserk by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_berserk.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfClaw]: {\r\n\t\t\tname: 'Glyph of Claw',\r\n\t\t\tdescription: 'Reduces the energy cost of your Claw ability by 5.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_rake.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfEntanglingRoots]: {\r\n\t\t\tname: 'Glyph of Entangling Roots',\r\n\t\t\tdescription: 'Increases the damage your Entangling Roots victims can take before the Entangling Roots automatically breaks by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stranglevines.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfFocus]: {\r\n\t\t\tname: 'Glyph of Focus',\r\n\t\t\tdescription: 'Increases the damage done by Starfall by 10%, but decreases its radius by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_starfall.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfFrenziedRegeneration]: {\r\n\t\t\tname: 'Glyph of Frenzied Regeneration',\r\n\t\t\tdescription: 'While Frenzied Regeneration is active, healing effects on you are 20% more powerful.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_bullrush.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfGrowling]: {\r\n\t\t\tname: 'Glyph of Growling',\r\n\t\t\tdescription: 'Increases the chance for your Growl ability to work successfully by 8%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_physical_taunt.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfHealingTouch]: {\r\n\t\t\tname: 'Glyph of Healing Touch',\r\n\t\t\tdescription: 'Decreases the cast time of Healing Touch by 1.5 sec, the mana cost by 25%, and the amount healed by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfHurricane]: {\r\n\t\t\tname: 'Glyph of Hurricane',\r\n\t\t\tdescription: 'Your Hurricane ability now also slows the movement speed of its victims by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfInnervate]: {\r\n\t\t\tname: 'Glyph of Innervate',\r\n\t\t\tdescription: 'Innervate now grants the caster 45% of <dfn title=\"her\">his</dfn> base mana pool over 10 sec in addition to the normal effects of Innervate.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfInsectSwarm]: {\r\n\t\t\tname: 'Glyph of Insect Swarm',\r\n\t\t\tdescription: 'Increases the damage of your Insect Swarm ability by 30%, but it no longer affects your victim\\'s chance to hit.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_insectswarm.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfLifebloom]: {\r\n\t\t\tname: 'Glyph of Lifebloom',\r\n\t\t\tdescription: 'Increases the duration of Lifebloom by 1 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_herb_felblossom.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfMangle]: {\r\n\t\t\tname: 'Glyph of Mangle',\r\n\t\t\tdescription: 'Increases the damage done by Mangle by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_mangle2.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfMaul]: {\r\n\t\t\tname: 'Glyph of Maul',\r\n\t\t\tdescription: 'Your Maul ability now hits 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_maul.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfMonsoon]: {\r\n\t\t\tname: 'Glyph of Monsoon',\r\n\t\t\tdescription: 'Reduces the cooldown of your Typhoon spell by 3 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_typhoon.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfMoonfire]: {\r\n\t\t\tname: 'Glyph of Moonfire',\r\n\t\t\tdescription: 'Increases the periodic damage of your Moonfire ability by 75%, but initial damage is decreased by 90%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfOmenOfClarity]: {\r\n\t\t\tname: 'Glyph of Omen of Clarity',\r\n\t\t\tdescription: 'Your Omen of Clarity talent has a 100% chance to be triggered by successfully casting Faerie Fire (Feral). Does not trigger on players or player-controlled pets.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfNourish]: {\r\n\t\t\tname: 'Glyph of Nourish',\r\n\t\t\tdescription: 'Your Nourish heals an additional 6% for each of your heal over time effects present on the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_nourish.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRake]: {\r\n\t\t\tname: 'Glyph of Rake',\r\n\t\t\tdescription: 'Your Rake ability prevents targets from fleeing.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_disembowel.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRapidRejuvenation]: {\r\n\t\t\tname: 'Glyph of Rapid Rejuvenation',\r\n\t\t\tdescription: 'Your haste now reduces the time between the periodic healing ticks of your Rejuvenation spell.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRebirth]: {\r\n\t\t\tname: 'Glyph of Rebirth',\r\n\t\t\tdescription: 'Players resurrected by Rebirth are returned to life with 100% health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRegrowth]: {\r\n\t\t\tname: 'Glyph of Regrowth',\r\n\t\t\tdescription: 'Increases the healing of your Regrowth spell by 20% if your Regrowth effect is still active on the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_resistnature.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRejuvenation]: {\r\n\t\t\tname: 'Glyph of Rejuvenation',\r\n\t\t\tdescription: 'While your Rejuvenation targets are below 50% health, you will heal them for an additional 50% health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfRip]: {\r\n\t\t\tname: 'Glyph of Rip',\r\n\t\t\tdescription: 'Increases the duration of your Rip ability by 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_ghoulfrenzy.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfSavageRoar]: {\r\n\t\t\tname: 'Glyph of Savage Roar',\r\n\t\t\tdescription: 'Your Savage Roar ability grants an additional 3% bonus damage done.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_skinteeth.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfShred]: {\r\n\t\t\tname: 'Glyph of Shred',\r\n\t\t\tdescription: 'Each time you Shred, the duration of your Rip on the target is extended 2 sec, up to a maximum of 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_vampiricaura.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfStarfall]: {\r\n\t\t\tname: 'Glyph of Starfall',\r\n\t\t\tdescription: 'Reduces the cooldown of Starfall by 30 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_starfall.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfStarfire]: {\r\n\t\t\tname: 'Glyph of Starfire',\r\n\t\t\tdescription: 'Your Starfire ability increases the duration of your Moonfire effect on the target by 3 sec, up to a maximum of 9 additional seconds.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_starfire.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfSurvivalInstincts]: {\r\n\t\t\tname: 'Glyph of Survival Instincts',\r\n\t\t\tdescription: 'Your Survival Instincts ability grants an additional 15% of your maximum health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_tigersroar.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfSwiftmend]: {\r\n\t\t\tname: 'Glyph of Swiftmend',\r\n\t\t\tdescription: 'Your Swiftmend ability no longer consumes a Rejuvenation or Regrowth effect from the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_relics_idolofrejuvenation.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfWildGrowth]: {\r\n\t\t\tname: 'Glyph of Wild Growth',\r\n\t\t\tdescription: 'Wild Growth can affect 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_flourish.jpg',\r\n\t\t},\r\n\t\t[DruidMajorGlyph.GlyphOfWrath]: {\r\n\t\t\tname: 'Glyph of Wrath',\r\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while casting your Wrath spell by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_abolishmagic.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[DruidMinorGlyph.GlyphOfAquaticForm]: {\r\n\t\t\tname: 'Glyph of Aquatic Form',\r\n\t\t\tdescription: 'Increases your swim speed by 50% while in Aquatic Form.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_aquaticform.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfChallengingRoar]: {\r\n\t\t\tname: 'Glyph of Challenging Roar',\r\n\t\t\tdescription: 'Reduces the cooldown of your Challenging Roar ability by 30 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_challangingroar.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfDash]: {\r\n\t\t\tname: 'Glyph of Dash',\r\n\t\t\tdescription: 'Reduces the cooldown of your Dash ability by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_dash.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfTheWild]: {\r\n\t\t\tname: 'Glyph of the Wild',\r\n\t\t\tdescription: 'Mana cost of your Mark of the Wild and Gift of the Wild spells reduced by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_regeneration.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfThorns]: {\r\n\t\t\tname: 'Glyph of Thorns',\r\n\t\t\tdescription: 'Increases the duration of your Thorns ability by 50 min when cast on yourself.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thorns.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfTyphoon]: {\r\n\t\t\tname: 'Glyph of Typhoon',\r\n\t\t\tdescription: 'Reduces the cost of your Typhoon spell by 8% and increases its radius by 10 yards, but it no longer knocks enemies back.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_typhoon.jpg',\r\n\t\t},\r\n\t\t[DruidMinorGlyph.GlyphOfUnburdenedRebirth]: {\r\n\t\t\tname: 'Glyph of Unburdened Rebirth',\r\n\t\t\tdescription: 'Your Rebirth spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { HunterTalents, HunterMajorGlyph, HunterMinorGlyph, HunterPetTalents } from '../proto/hunter.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport HunterTalentJson from './trees/hunter.json';\r\n\r\nexport const hunterTalentsConfig: TalentsConfig<HunterTalents> = newTalentsConfig(HunterTalentJson);\r\n\r\nexport const hunterGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[HunterMajorGlyph.GlyphOfAimedShot]: {\r\n\t\t\tname: 'Glyph of Aimed Shot',\r\n\t\t\tdescription: 'Reduces the cooldown of your Aimed Shot ability by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_07.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfArcaneShot]: {\r\n\t\t\tname: 'Glyph of Arcane Shot',\r\n\t\t\tdescription: 'Your Arcane Shot refunds 20% of its mana cost if the target has one of your Stings active on it.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_impalingbolt.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfAspectOfTheViper]: {\r\n\t\t\tname: 'Glyph of Aspect of the Viper',\r\n\t\t\tdescription: 'Increases the amount of mana gained from attacks while Aspect of the Viper is active by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectoftheviper.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfBestialWrath]: {\r\n\t\t\tname: 'Glyph of Bestial Wrath',\r\n\t\t\tdescription: 'Decreases the cooldown of Bestial Wrath by 20 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfChimeraShot]: {\r\n\t\t\tname: 'Glyph of Chimera Shot',\r\n\t\t\tdescription: 'Reduces the cooldown of Chimera Shot by 1 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_chimerashot2.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfDeterrence]: {\r\n\t\t\tname: 'Glyph of Deterrence',\r\n\t\t\tdescription: 'Decreases the cooldown of Deterrence by 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfDisengage]: {\r\n\t\t\tname: 'Glyph of Disengage',\r\n\t\t\tdescription: 'Decreases the cooldown of Disengage by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfExplosiveShot]: {\r\n\t\t\tname: 'Glyph of Explosive Shot',\r\n\t\t\tdescription: 'Increases the critical strike chance of Explosive Shot by 4%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_explosiveshot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfExplosiveTrap]: {\r\n\t\t\tname: 'Glyph of Explosive Trap',\r\n\t\t\tdescription: 'The periodic damage from your Explosive Trap can now be critical strikes.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_selfdestruct.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfFreezingTrap]: {\r\n\t\t\tname: 'Glyph of Freezing Trap',\r\n\t\t\tdescription: 'When your Freezing Trap breaks, the victim\\'s movement speed is reduced by 30% for 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfFrostTrap]: {\r\n\t\t\tname: 'Glyph of Frost Trap',\r\n\t\t\tdescription: 'Increases the radius of the effect from your Frost Trap by 2 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_freezingbreath.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfHuntersMark]: {\r\n\t\t\tname: 'Glyph of Hunter\\'s Mark',\r\n\t\t\tdescription: 'Increases the attack power bonus of your Hunter\\'s Mark by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snipershot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfImmolationTrap]: {\r\n\t\t\tname: 'Glyph of Immolation Trap',\r\n\t\t\tdescription: 'Decreases the duration of the effect from your Immolation Trap by 6 sec., but damage while active is increased by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg',\r\n\t\t},\r\n\t\t// [HunterMajorGlyph.GlyphOfKillShot]: {\r\n\t\t// \tname: 'Glyph of Kill Shot',\r\n\t\t// \tdescription: 'Reduces the cooldown of Kill Shot by 6 sec.',\r\n\t\t// \ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_assassinate2.jpg',\r\n\t\t// },\r\n\t\t[HunterMajorGlyph.GlyphOfMending]: {\r\n\t\t\tname: 'Glyph of Mending',\r\n\t\t\tdescription: 'Increases the healing done by your Mend Pet ability by 40%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfMultiShot]: {\r\n\t\t\tname: 'Glyph of Multi-Shot',\r\n\t\t\tdescription: 'Decreases the cooldown of Multi-Shot by 1 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_upgrademoonglaive.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfRapidFire]: {\r\n\t\t\tname: 'Glyph of Rapid Fire',\r\n\t\t\tdescription: 'Increases the haste from Rapid Fire by an additional 8%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_runningshot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfRaptorStrike]: {\r\n\t\t\tname: 'Glyph of Raptor Strike',\r\n\t\t\tdescription: 'Reduces damage taken by 20% for 3 sec after using Raptor Strike.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfScatterShot]: {\r\n\t\t\tname: 'Glyph of Scatter Shot',\r\n\t\t\tdescription: 'Increases the range of Scatter Shot by 3 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_golemstormbolt.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfSerpentSting]: {\r\n\t\t\tname: 'Glyph of Serpent Sting',\r\n\t\t\tdescription: 'Increases the duration of your Serpent Sting by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_quickshot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfSnakeTrap]: {\r\n\t\t\tname: 'Glyph of Snake Trap',\r\n\t\t\tdescription: 'Snakes from your Snake Trap take 90% reduced damage from area of effect spells.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snaketrap.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfSteadyShot]: {\r\n\t\t\tname: 'Glyph of Steady Shot',\r\n\t\t\tdescription: 'Increases the damage dealt by Steady Shot by 10% when your target is afflicted with Serpent Sting.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_steadyshot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfTheBeast]: {\r\n\t\t\tname: 'Glyph of the Beast',\r\n\t\t\tdescription: 'Increases the attack power bonus of Aspect of the Beast for you and your pet by an additional 2%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mount_pinktiger.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfTheHawk]: {\r\n\t\t\tname: 'Glyph of the Hawk',\r\n\t\t\tdescription: 'Increases the haste bonus of the Improved Aspect of the Hawk effect by an additional 6%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_ravenform.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfTrueshotAura]: {\r\n\t\t\tname: 'Glyph of Trueshot Aura',\r\n\t\t\tdescription: 'While your Trueshot Aura is active, you have 10% increased critical strike chance on your Aimed Shot.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_trueshot.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfVolley]: {\r\n\t\t\tname: 'Glyph of Volley',\r\n\t\t\tdescription: 'Decreases the mana cost of Volley by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_marksmanship.jpg',\r\n\t\t},\r\n\t\t[HunterMajorGlyph.GlyphOfWyvernSting]: {\r\n\t\t\tname: 'Glyph of Wyvern Sting',\r\n\t\t\tdescription: 'Decreases the cooldown of your Wyvern Sting by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_02.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[HunterMinorGlyph.GlyphOfFeignDeath]: {\r\n\t\t\tname: 'Glyph of Feign Death',\r\n\t\t\tdescription: 'Reduces the cooldown of your Feign Death spell by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feigndeath.jpg',\r\n\t\t},\r\n\t\t[HunterMinorGlyph.GlyphOfMendPet]: {\r\n\t\t\tname: 'Glyph of Mend Pet',\r\n\t\t\tdescription: 'Your Mend Pet spell increases your pet\\'s happiness slightly.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg',\r\n\t\t},\r\n\t\t[HunterMinorGlyph.GlyphOfPossessedStrength]: {\r\n\t\t\tname: 'Glyph of Possessed Strength',\r\n\t\t\tdescription: 'Increases the damage your pet inflicts while using Eyes of the Beast by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_eyeoftheowl.jpg',\r\n\t\t},\r\n\t\t[HunterMinorGlyph.GlyphOfRevivePet]: {\r\n\t\t\tname: 'Glyph of Revive Pet',\r\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while casting Revive Pet by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beastsoothe.jpg',\r\n\t\t},\r\n\t\t[HunterMinorGlyph.GlyphOfScareBeast]: {\r\n\t\t\tname: 'Glyph of Scare Beast',\r\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while casting Scare Beast by 75%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_druid_cower.jpg',\r\n\t\t},\r\n\t\t[HunterMinorGlyph.GlyphOfThePack]: {\r\n\t\t\tname: 'Glyph of the Pack',\r\n\t\t\tdescription: 'Increases the range of your Aspect of the Pack ability by 15 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mount_jungletiger.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { MageTalents, MageMajorGlyph, MageMinorGlyph } from '../proto/mage.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport MageTalentJson from './trees/mage.json';\r\n\r\nexport const mageTalentsConfig: TalentsConfig<MageTalents> = newTalentsConfig(MageTalentJson);\r\n\r\nexport const mageGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[MageMajorGlyph.GlyphOfArcaneBarrage]: {\r\n\t\t\tname: 'Glyph of Arcane Barrage',\r\n\t\t\tdescription: 'Reduces the mana cost of Arcane Barrage by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_arcanebarrage.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfArcaneBlast]: {\r\n\t\t\tname: 'Glyph of Arcane Blast',\r\n\t\t\tdescription: 'Increases the damage from your Arcane Blast buff by 3%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blast.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfArcaneExplosion]: {\r\n\t\t\tname: 'Glyph of Arcane Explosion',\r\n\t\t\tdescription: 'Reduces mana cost of Arcane Explosion by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispsplode.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfArcaneMissiles]: {\r\n\t\t\tname: 'Glyph of Arcane Missiles',\r\n\t\t\tdescription: 'Increases the critical strike damage bonus of Arcane Missiles by 25%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_starfall.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfArcanePower]: {\r\n\t\t\tname: 'Glyph of Arcane Power',\r\n\t\t\tdescription: 'Increases the duration of Arcane Power by 3 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfBlink]: {\r\n\t\t\tname: 'Glyph of Blink',\r\n\t\t\tdescription: 'Increases the distance you travel with the Blink spell by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfDeepFreeze]: {\r\n\t\t\tname: 'Glyph of Deep Freeze',\r\n\t\t\tdescription: 'Increases the range of Deep Freeze by 10 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_deepfreeze.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfEternalWater]: {\r\n\t\t\tname: 'Glyph of Eternal Water',\r\n\t\t\tdescription: 'Your Summon Water Elemental now lasts indefinitely, but your Water Elemental can no longer cast Freeze.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental_2.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfEvocation]: {\r\n\t\t\tname: 'Glyph of Evocation',\r\n\t\t\tdescription: 'Your Evocation ability also causes you to regain 60% of your health over its duration.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfFireBlast]: {\r\n\t\t\tname: 'Glyph of Fire Blast',\r\n\t\t\tdescription: 'Increases the critical strike chance of Fire Blast by 50% when the target is stunned or incapacitated.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfFireball]: {\r\n\t\t\tname: 'Glyph of Fireball',\r\n\t\t\tdescription: 'Reduces the casting time of your Fireball spell by 0.15 sec, but removes the damage over time effect.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flamebolt.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfFrostNova]: {\r\n\t\t\tname: 'Glyph of Frost Nova',\r\n\t\t\tdescription: 'Your Frost Nova targets can take an additional 20% damage before the Frost Nova effect automatically breaks.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfFrostbolt]: {\r\n\t\t\tname: 'Glyph of Frostbolt',\r\n\t\t\tdescription: 'Increases the damage dealt by Frostbolt by 5%, but removes the slowing effect.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostbolt02.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfFrostfire]: {\r\n\t\t\tname: 'Glyph of Frostfire',\r\n\t\t\tdescription: 'Increases the initial damage dealt by Frostfire Bolt by 2% and its critical strike chance by 2%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_frostfirebolt.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfIceArmor]: {\r\n\t\t\tname: 'Glyph of Ice Armor',\r\n\t\t\tdescription: 'Your Ice Armor and Frost Armor spells grant an additional 50% armor and resistance.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfIceBarrier]: {\r\n\t\t\tname: 'Glyph of Ice Barrier',\r\n\t\t\tdescription: 'Increases the amount of damage absorbed by your Ice Barrier by 30%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_ice_lament.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfIceBlock]: {\r\n\t\t\tname: 'Glyph of Ice Block',\r\n\t\t\tdescription: 'Your Frost Nova cooldown is now reset every time you use Ice Block.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frost.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfIceLance]: {\r\n\t\t\tname: 'Glyph of Ice Lance',\r\n\t\t\tdescription: 'Your Ice Lance now causes 4 times damage against frozen targets higher level than you instead of triple damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostblast.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfIcyVeins]: {\r\n\t\t\tname: 'Glyph of Icy Veins',\r\n\t\t\tdescription: 'Your Icy Veins ability also removes all movement slowing and cast time slowing effects.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_coldhearted.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfInvisibility]: {\r\n\t\t\tname: 'Glyph of Invisibility',\r\n\t\t\tdescription: 'Increases the duration of the Invisibility effect by 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_invisibility.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfLivingBomb]: {\r\n\t\t\tname: 'Glyph of Living Bomb',\r\n\t\t\tdescription: 'The periodic damage from your Living Bomb can now be critical strikes.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_livingbomb.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfMageArmor]: {\r\n\t\t\tname: 'Glyph of Mage Armor',\r\n\t\t\tdescription: 'Your Mage Armor spell grants an additional 20% mana regeneration while casting.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magearmor.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfManaGem]: {\r\n\t\t\tname: 'Glyph of Mana Gem',\r\n\t\t\tdescription: 'Increases the mana received from using a mana gem by 40%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_gem_stone_01.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfMirrorImage]: {\r\n\t\t\tname: 'Glyph of Mirror Image',\r\n\t\t\tdescription: 'Your Mirror Image spell now creates a 4th copy.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfMoltenArmor]: {\r\n\t\t\tname: 'Glyph of Molten Armor',\r\n\t\t\tdescription: 'Your Molten Armor grants an additional 20% of your spirit as critical strike rating.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_mage_moltenarmor.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfPolymorph]: {\r\n\t\t\tname: 'Glyph of Polymorph',\r\n\t\t\tdescription: 'Your Polymorph spell also removes all damage over time effects from the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_polymorph.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfRemoveCurse]: {\r\n\t\t\tname: 'Glyph of Remove Curse',\r\n\t\t\tdescription: 'Your Remove Curse spell also makes the target immune to all curses for 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_removecurse.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfScorch]: {\r\n\t\t\tname: 'Glyph of Scorch',\r\n\t\t\tdescription: 'Increases the damage of your Scorch spell by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_soulburn.jpg',\r\n\t\t},\r\n\t\t[MageMajorGlyph.GlyphOfWaterElemental]: {\r\n\t\t\tname: 'Glyph of Water Elemental',\r\n\t\t\tdescription: 'Reduces the cooldown of your Summon Water Elemental spell by 30 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental_2.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[MageMinorGlyph.GlyphOfArcaneIntellect]: {\r\n\t\t\tname: 'Glyph of Arcane Intellect',\r\n\t\t\tdescription: 'Reduces the mana cost of your Arcane Intellect and Arcane Brilliance spells by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_magicalsentry.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfBlastWave]: {\r\n\t\t\tname: 'Glyph of Blast Wave',\r\n\t\t\tdescription: 'The mana cost of your Blast Wave spell is reduced by 15%, but it no longer knocks enemies back.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfFireWard]: {\r\n\t\t\tname: 'Glyph of Fire Ward',\r\n\t\t\tdescription: 'You have an additional 5% chance to reflect Fire spells while your Fire Ward is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_firearmor.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfFrostArmor]: {\r\n\t\t\tname: 'Glyph of Frost Armor',\r\n\t\t\tdescription: 'Increases the duration of your Frost Armor and Ice Armor spells by 30 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfFrostWard]: {\r\n\t\t\tname: 'Glyph of Frost Ward',\r\n\t\t\tdescription: 'You have an additional 5% chance to reflect Frost spells while your Frost Ward is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostward.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfSlowFall]: {\r\n\t\t\tname: 'Glyph of Slow Fall',\r\n\t\t\tdescription: 'Your Slow Fall spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_featherfall.jpg',\r\n\t\t},\r\n\t\t[MageMinorGlyph.GlyphOfThePenguin]: {\r\n\t\t\tname: 'Glyph of the Penguin',\r\n\t\t\tdescription: 'Your Polymorph: Sheep spell polymorphs the target into a penguin instead.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_penguinpet.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { PaladinTalents, PaladinMajorGlyph, PaladinMinorGlyph } from '../proto/paladin.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport PaladinTalentJson from './trees/paladin.json';\r\n\r\nexport const paladinTalentsConfig: TalentsConfig<PaladinTalents> = newTalentsConfig(PaladinTalentJson);\r\n\r\nexport const paladinGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[PaladinMajorGlyph.GlyphOfAvengerSShield]: {\r\n\t\t\tname: 'Glyph of Avenger\\'s Shield',\r\n\t\t\tdescription: 'Your Avenger\\'s Shield hits 2 fewer targets, but for 100% more damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfAvengingWrath]: {\r\n\t\t\tname: 'Glyph of Avenging Wrath',\r\n\t\t\tdescription: 'Reduces the cooldown of your Hammer of Wrath spell by 50% while Avenging Wrath is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_avenginewrath.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfBeaconOfLight]: {\r\n\t\t\tname: 'Glyph of Beacon of Light',\r\n\t\t\tdescription: 'Increases the duration of Beacon of Light by 30 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_beaconoflight.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfCleansing]: {\r\n\t\t\tname: 'Glyph of Cleansing',\r\n\t\t\tdescription: 'Reduces the mana cost of your Cleanse and Purify spells by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_purify.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfConsecration]: {\r\n\t\t\tname: 'Glyph of Consecration',\r\n\t\t\tdescription: 'Increases the duration and cooldown of Consecration by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfCrusaderStrike]: {\r\n\t\t\tname: 'Glyph of Crusader Strike',\r\n\t\t\tdescription: 'Reduces the mana cost of your Crusader Strike ability by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderstrike.jpg',\r\n\t\t},\r\n\t\t// [PaladinMajorGlyph.GlyphOfDivinePlea]: {\r\n\t\t// \tname: 'Glyph of Divine Plea',\r\n\t\t// \tdescription: 'While Divine Plea is active, you take 3% reduced damage from all sources.',\r\n\t\t// \ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_aspiration.jpg',\r\n\t\t// },\r\n\t\t[PaladinMajorGlyph.GlyphOfDivineStorm]: {\r\n\t\t\tname: 'Glyph of Divine Storm',\r\n\t\t\tdescription: 'Your Divine Storm now heals for an additional 15% of the damage it causes.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_divinestorm.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfDivinity]: {\r\n\t\t\tname: 'Glyph of Divinity',\r\n\t\t\tdescription: 'Your Lay on Hands grants twice as much mana as normal and also grants you as much mana as it grants your target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfExorcism]: {\r\n\t\t\tname: 'Glyph of Exorcism',\r\n\t\t\tdescription: 'Increases damage done by Exorcism by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfFlashOfLight]: {\r\n\t\t\tname: 'Glyph of Flash of Light',\r\n\t\t\tdescription: 'Your Flash of Light has an additional 5% critical strike chance.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHammerOfJustice]: {\r\n\t\t\tname: 'Glyph of Hammer of Justice',\r\n\t\t\tdescription: 'Increases your Hammer of Justice range by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofmight.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHammerOfTheRighteous]: {\r\n\t\t\tname: 'Glyph of Hammer of the Righteous',\r\n\t\t\tdescription: 'Your Hammer of the Righteous hits 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_hammeroftherighteous.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHammerOfWrath]: {\r\n\t\t\tname: 'Glyph of Hammer of Wrath',\r\n\t\t\tdescription: 'Reduces the mana cost of Hammer of Wrath by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_thunderclap.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHolyLight]: {\r\n\t\t\tname: 'Glyph of Holy Light',\r\n\t\t\tdescription: 'Your Holy Light grants 10% of its heal amount to up to 5 friendly targets within 8 yards of the initial target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holybolt.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHolyShock]: {\r\n\t\t\tname: 'Glyph of Holy Shock',\r\n\t\t\tdescription: 'Reduces the cooldown of Holy Shock by 1 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfHolyWrath]: {\r\n\t\t\tname: 'Glyph of Holy Wrath',\r\n\t\t\tdescription: 'Reduces the cooldown of your Holy Wrath spell by 15 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfJudgement]: {\r\n\t\t\tname: 'Glyph of Judgement',\r\n\t\t\tdescription: 'Your Judgements deal 10% more damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_judgementred.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfRighteousDefense]: {\r\n\t\t\tname: 'Glyph of Righteous Defense',\r\n\t\t\tdescription: 'Increases the chance for your Righteous Defense and Hand of Reckoning abilities to work successfully by 8% on each target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_shoulder_37.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSalvation]: {\r\n\t\t\tname: 'Glyph of Salvation',\r\n\t\t\tdescription: 'When you cast Hand of Salvation on yourself, it also reduces damage taken by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsalvation.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSealOfCommand]: {\r\n\t\t\tname: 'Glyph of Seal of Command',\r\n\t\t\tdescription: 'You gain 8% of your base mana each time you use a Judgement with Seal of Command active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_innerrage.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSealOfLight]: {\r\n\t\t\tname: 'Glyph of Seal of Light',\r\n\t\t\tdescription: 'While Seal of Light is active, the effect of your healing spells is increased by 5%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSealOfRighteousness]: {\r\n\t\t\tname: 'Glyph of Seal of Righteousness',\r\n\t\t\tdescription: 'Increases the damage done by Seal of Righteousness by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_thunderbolt.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSealOfVengeance]: {\r\n\t\t\tname: 'Glyph of Seal of Vengeance',\r\n\t\t\tdescription: 'Your Seal of Vengeance or Seal of Corruption also grants 10 expertise while active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSealOfWisdom]: {\r\n\t\t\tname: 'Glyph of Seal of Wisdom',\r\n\t\t\tdescription: 'While Seal of Wisdom is active, the cost of your healing spells is reduced by 5%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfShieldOfRighteousness]: {\r\n\t\t\tname: 'Glyph of Shield of Righteousness',\r\n\t\t\tdescription: 'Reduces the mana cost of Shield of Righteousness by 80%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_paladin_shieldofvengeance.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfSpiritualAttunement]: {\r\n\t\t\tname: 'Glyph of Spiritual Attunement',\r\n\t\t\tdescription: 'Increases the amount of mana gained from your Spiritual Attunement spell by an additional 2%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_revivechampion.jpg',\r\n\t\t},\r\n\t\t[PaladinMajorGlyph.GlyphOfTurnEvil]: {\r\n\t\t\tname: 'Glyph of Turn Evil',\r\n\t\t\tdescription: 'Reduces the casting time of your Turn Evil spell by 100%, but increases the cooldown by 8 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_turnundead.jpg',\r\n\t\t},\r\n\t\t// [PaladinMajorGlyph.GlyphOfReckoning]: {\r\n\t\t// \tname: 'Glyph of Reckoning',\r\n\t\t// \tdescription: 'Your Hand of Reckoning spell no longer taunts the target and can deal damage to untauntable targets.',\r\n\t\t// \ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_unyieldingfaith.jpg',\r\n\t\t// },\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[PaladinMinorGlyph.GlyphOfBlessingOfKings]: {\r\n\t\t\tname: 'Glyph of Blessing of Kings',\r\n\t\t\tdescription: 'Reduces the mana cost of your Blessing of Kings and Greater Blessing of Kings spells by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_magearmor.jpg',\r\n\t\t},\r\n\t\t[PaladinMinorGlyph.GlyphOfBlessingOfMight]: {\r\n\t\t\tname: 'Glyph of Blessing of Might',\r\n\t\t\tdescription: 'Increases the duration of your Blessing of Might spell by 20 min when cast on yourself.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_fistofjustice.jpg',\r\n\t\t},\r\n\t\t[PaladinMinorGlyph.GlyphOfBlessingOfWisdom]: {\r\n\t\t\tname: 'Glyph of Blessing of Wisdom',\r\n\t\t\tdescription: 'Increases the duration of your Blessing of Wisdom spell by 20 min when cast on yourself.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofwisdom.jpg',\r\n\t\t},\r\n\t\t[PaladinMinorGlyph.GlyphOfLayOnHands]: {\r\n\t\t\tname: 'Glyph of Lay on Hands',\r\n\t\t\tdescription: 'Reduces the cooldown of your Lay on Hands spell by 5 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\r\n\t\t},\r\n\t\t[PaladinMinorGlyph.GlyphOfSenseUndead]: {\r\n\t\t\tname: 'Glyph of Sense Undead',\r\n\t\t\tdescription: 'Damage against Undead increased by 1% while your Sense Undead ability is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_senseundead.jpg',\r\n\t\t},\r\n\t\t[PaladinMinorGlyph.GlyphOfTheWise]: {\r\n\t\t\tname: 'Glyph of the Wise',\r\n\t\t\tdescription: 'Reduces the mana cost of your Seal of Wisdom spell by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { PriestTalents, PriestMajorGlyph, PriestMinorGlyph } from '../proto/priest.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport PriestTalentJson from './trees/priest.json';\r\n\r\nexport const priestTalentsConfig: TalentsConfig<PriestTalents> = newTalentsConfig(PriestTalentJson);\r\n\r\nexport const priestGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[PriestMajorGlyph.GlyphOfCircleOfHealing]: {\r\n\t\t\tname: 'Glyph of Circle of Healing',\r\n\t\t\tdescription: 'Your Circle of Healing spell heals 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_circleofrenewal.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfDispelMagic]: {\r\n\t\t\tname: 'Glyph of Dispel Magic',\r\n\t\t\tdescription: 'Your Dispel Magic spell also heals your target for 3% of maximum health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfDispersion]: {\r\n\t\t\tname: 'Glyph of Dispersion',\r\n\t\t\tdescription: 'Reduces the cooldown on Dispersion by 45 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_dispersion.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfFade]: {\r\n\t\t\tname: 'Glyph of Fade',\r\n\t\t\tdescription: 'Reduces the cooldown of your Fade spell by 9 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfFearWard]: {\r\n\t\t\tname: 'Glyph of Fear Ward',\r\n\t\t\tdescription: 'Reduces cooldown and duration of Fear Ward by 60 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfFlashHeal]: {\r\n\t\t\tname: 'Glyph of Flash Heal',\r\n\t\t\tdescription: 'Reduces the mana cost of your Flash Heal by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfGuardianSpirit]: {\r\n\t\t\tname: 'Glyph of Guardian Spirit',\r\n\t\t\tdescription: 'If your Guardian Spirit lasts its entire duration without being triggered, the cooldown is reset to 1 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfHolyNova]: {\r\n\t\t\tname: 'Glyph of Holy Nova',\r\n\t\t\tdescription: 'Increases the damage and healing of your Holy Nova spell by an additional 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holynova.jpg',\r\n\t\t},\r\n\t\t// [PriestMajorGlyph.GlyphOfHymnOfHope]: {\r\n\t\t// \tname: 'Glyph of Hymn of Hope',\r\n\t\t// \tdescription: 'Your Hymn of Hope lasts an additional 2 sec.',\r\n\t\t// \ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_symbolofhope.jpg',\r\n\t\t// },\r\n\t\t[PriestMajorGlyph.GlyphOfInnerFire]: {\r\n\t\t\tname: 'Glyph of Inner Fire',\r\n\t\t\tdescription: 'Increases the armor from your Inner Fire spell by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfLightwell]: {\r\n\t\t\tname: 'Glyph of Lightwell',\r\n\t\t\tdescription: 'Increases the amount healed by your Lightwell by 20%',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfMassDispel]: {\r\n\t\t\tname: 'Glyph of Mass Dispel',\r\n\t\t\tdescription: 'Reduces the mana cost of Mass Dispel by 35%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_arcane_massdispel.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfMindControl]: {\r\n\t\t\tname: 'Glyph of Mind Control',\r\n\t\t\tdescription: 'Reduces the chance targets will resist or break your Mind Control spell by an additional 17%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowworddominate.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfMindFlay]: {\r\n\t\t\tname: 'Glyph of Mind Flay',\r\n\t\t\tdescription: 'Increases the damage done by your Mind Flay spell by 10% when your target is afflicted with Shadow Word: Pain.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_siphonmana.jpg',\r\n\t\t},\r\n\t\t// [PriestMajorGlyph.GlyphOfMindSear]: {\r\n\t\t// \tname: 'Glyph of Mind Sear',\r\n\t\t// \tdescription: 'Increases the radius of effect on Mind Sear by 5 yards.',\r\n\t\t// \ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindshear.jpg',\r\n\t\t// },\r\n\t\t[PriestMajorGlyph.GlyphOfPainSuppression]: {\r\n\t\t\tname: 'Glyph of Pain Suppression',\r\n\t\t\tdescription: 'Allows Pain Suppression to be cast while stunned.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_painsupression.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfPenance]: {\r\n\t\t\tname: 'Glyph of Penance',\r\n\t\t\tdescription: 'Reduces the cooldown of Penance by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_penance.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfPowerWordShield]: {\r\n\t\t\tname: 'Glyph of Power Word: Shield',\r\n\t\t\tdescription: 'Your Power Word: Shield also heals the target for 20% of the absorption amount.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordshield.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfPrayerOfHealing]: {\r\n\t\t\tname: 'Glyph of Prayer of Healing',\r\n\t\t\tdescription: 'Your Prayer of Healing spell also heals an additional 20% of its initial heal over 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofhealing02.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfPsychicScream]: {\r\n\t\t\tname: 'Glyph of Psychic Scream',\r\n\t\t\tdescription: 'Increases the duration of your Psychic Scream by 2 sec. and increases its cooldown by 8 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychicscream.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfRenew]: {\r\n\t\t\tname: 'Glyph of Renew',\r\n\t\t\tdescription: 'Reduces the duration of your Renew by 3 sec. but increases the amount healed each tick by 25%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_renew.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfScourgeImprisonment]: {\r\n\t\t\tname: 'Glyph of Scourge Imprisonment',\r\n\t\t\tdescription: 'Reduces the cast time of your Shackle Undead by 1.0 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfShadow]: {\r\n\t\t\tname: 'Glyph of Shadow',\r\n\t\t\tdescription: 'While in Shadowform, your non-periodic spell critical strikes increase your spell power by 30% of your Spirit for 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_mindsooth.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfShadowWordDeath]: {\r\n\t\t\tname: 'Glyph of Shadow Word: Death',\r\n\t\t\tdescription: 'Targets below 35% health take an additional 10% damage from your Shadow Word: Death spell.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonicfortitude.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfShadowWordPain]: {\r\n\t\t\tname: 'Glyph of Shadow Word: Pain',\r\n\t\t\tdescription: 'The periodic damage ticks of your Shadow Word: Pain spell restore 1% of your base mana.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowwordpain.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfSmite]: {\r\n\t\t\tname: 'Glyph of Smite',\r\n\t\t\tdescription: 'Your Smite spell inflicts an additional 20% damage against targets afflicted by Holy Fire.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_holysmite.jpg',\r\n\t\t},\r\n\t\t[PriestMajorGlyph.GlyphOfSpiritOfRedemption]: {\r\n\t\t\tname: 'Glyph of Spirit of Redemption',\r\n\t\t\tdescription: 'Increases the duration of Spirit of Redemption by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essenceeternallarge.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[PriestMinorGlyph.GlyphOfFading]: {\r\n\t\t\tname: 'Glyph of Fading',\r\n\t\t\tdescription: 'Reduces the mana cost of your Fade spell by 30%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg',\r\n\t\t},\r\n\t\t[PriestMinorGlyph.GlyphOfFortitude]: {\r\n\t\t\tname: 'Glyph of Fortitude',\r\n\t\t\tdescription: 'Reduces the mana cost of your Power Word: Fortitude and Prayer of Fortitude spells by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_wordfortitude.jpg',\r\n\t\t},\r\n\t\t[PriestMinorGlyph.GlyphOfLevitate]: {\r\n\t\t\tname: 'Glyph of Levitate',\r\n\t\t\tdescription: 'Your Levitate spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg',\r\n\t\t},\r\n\t\t[PriestMinorGlyph.GlyphOfShackleUndead]: {\r\n\t\t\tname: 'Glyph of Shackle Undead',\r\n\t\t\tdescription: 'Increases the range of your Shackle Undead spell by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg',\r\n\t\t},\r\n\t\t[PriestMinorGlyph.GlyphOfShadowProtection]: {\r\n\t\t\tname: 'Glyph of Shadow Protection',\r\n\t\t\tdescription: 'Increases the duration of your Shadow Protection and Prayer of Shadow Protection spells by 10 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antishadow.jpg',\r\n\t\t},\r\n\t\t[PriestMinorGlyph.GlyphOfShadowfiend]: {\r\n\t\t\tname: 'Glyph of Shadowfiend',\r\n\t\t\tdescription: 'Receive 5% of your maximum mana if your Shadowfiend dies from damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowfiend.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { RogueTalents, RogueMajorGlyph, RogueMinorGlyph } from '../proto/rogue.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport RogueTalentJson from './trees/rogue.json';\r\n\r\nexport const rogueTalentsConfig: TalentsConfig<RogueTalents> = newTalentsConfig(RogueTalentJson);\r\n\r\nexport const rogueGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[RogueMajorGlyph.GlyphOfAdrenalineRush]: {\r\n\t\t\tname: 'Glyph of Adrenaline Rush',\r\n\t\t\tdescription: 'Increases the duration of Adrenaline Rush by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowworddominate.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfAmbush]: {\r\n\t\t\tname: 'Glyph of Ambush',\r\n\t\t\tdescription: 'Increases the range on Ambush by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfBackstab]: {\r\n\t\t\tname: 'Glyph of Backstab',\r\n\t\t\tdescription: 'Your Backstab increases the duration of your Rupture effect on the target by 2 sec, up to a maximum of 6 additional sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfBladeFlurry]: {\r\n\t\t\tname: 'Glyph of Blade Flurry',\r\n\t\t\tdescription: 'Reduces the energy cost of Blade Flurry by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfCloakOfShadows]: {\r\n\t\t\tname: 'Glyph of Cloak of Shadows',\r\n\t\t\tdescription: 'While Cloak of Shadows is active, you take 40% less physical damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_nethercloak.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfCripplingPoison]: {\r\n\t\t\tname: 'Glyph of Crippling Poison',\r\n\t\t\tdescription: 'Increases the chance to inflict your target with Crippling Poison by an additional 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_poisonsting.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfDeadlyThrow]: {\r\n\t\t\tname: 'Glyph of Deadly Throw',\r\n\t\t\tdescription: 'Increases the slowing effect on Deadly Throw by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_throwingknife_06.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfEvasion]: {\r\n\t\t\tname: 'Glyph of Evasion',\r\n\t\t\tdescription: 'Increases the duration of Evasion by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowward.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfEviscerate]: {\r\n\t\t\tname: 'Glyph of Eviscerate',\r\n\t\t\tdescription: 'Increases the critical strike chance of Eviscerate by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_eviscerate.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfExposeArmor]: {\r\n\t\t\tname: 'Glyph of Expose Armor',\r\n\t\t\tdescription: 'Increases the duration of Expose Armor by 12 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_riposte.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfFanOfKnives]: {\r\n\t\t\tname: 'Glyph of Fan of Knives',\r\n\t\t\tdescription: 'Increases the damage done by Fan of Knives by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_fanofknives.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfFeint]: {\r\n\t\t\tname: 'Glyph of Feint',\r\n\t\t\tdescription: 'Reduces the energy cost of Feint by 20.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfGarrote]: {\r\n\t\t\tname: 'Glyph of Garrote',\r\n\t\t\tdescription: 'Reduces the duration of your Garrote ability by 3 sec and increases the total damage it deals by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_garrote.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfGhostlyStrike]: {\r\n\t\t\tname: 'Glyph of Ghostly Strike',\r\n\t\t\tdescription: 'Increases the damage dealt by Ghostly Strike by 40% and the duration of its effect by 4 sec, but increases its cooldown by 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curse.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfGouge]: {\r\n\t\t\tname: 'Glyph of Gouge',\r\n\t\t\tdescription: 'Reduces the energy cost of Gouge by 15.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfHemorrhage]: {\r\n\t\t\tname: 'Glyph of Hemorrhage',\r\n\t\t\tdescription: 'Increases the damage bonus against targets afflicted by Hemorrhage by 40%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfHungerForBlood]: {\r\n\t\t\tname: 'Glyph of Hunger For Blood',\r\n\t\t\tdescription: 'Increases the bonus damage from Hunger For Blood by 3%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_hungerforblood.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfKillingSpree]: {\r\n\t\t\tname: 'Glyph of Killing Spree',\r\n\t\t\tdescription: 'Reduces the cooldown on Killing Spree by 45 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_murderspree.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfMutilate]: {\r\n\t\t\tname: 'Glyph of Mutilate',\r\n\t\t\tdescription: 'Reduces the cost of Mutilate by 5 energy.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowstrikes.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfPreparation]: {\r\n\t\t\tname: 'Glyph of Preparation',\r\n\t\t\tdescription: 'Your Preparation ability also instantly resets the cooldown of Blade Flurry, Dismantle, and Kick.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antishadow.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfRupture]: {\r\n\t\t\tname: 'Glyph of Rupture',\r\n\t\t\tdescription: 'Increases the duration of Rupture by 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_rupture.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfSap]: {\r\n\t\t\tname: 'Glyph of Sap',\r\n\t\t\tdescription: 'Increases the duration of Sap by 20 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_sap.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfShadowDance]: {\r\n\t\t\tname: 'Glyph of Shadow Dance',\r\n\t\t\tdescription: 'Increases the duration of Shadow Dance by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_shadowdance.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfSinisterStrike]: {\r\n\t\t\tname: 'Glyph of Sinister Strike',\r\n\t\t\tdescription: 'Your Sinister Strike critical strikes have a 50% chance to add an additional combo point.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_ritualofsacrifice.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfSliceAndDice]: {\r\n\t\t\tname: 'Glyph of Slice and Dice',\r\n\t\t\tdescription: 'Increases the duration of Slice and Dice by 3 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfSprint]: {\r\n\t\t\tname: 'Glyph of Sprint',\r\n\t\t\tdescription: 'Increases the movement speed of your Sprint ability by an additional 30%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfTricksOfTheTrade]: {\r\n\t\t\tname: 'Glyph of Tricks of the Trade',\r\n\t\t\tdescription: 'The bonus damage and threat redirection granted by your Tricks of the Trade ability lasts an additional 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg',\r\n\t\t},\r\n\t\t[RogueMajorGlyph.GlyphOfVigor]: {\r\n\t\t\tname: 'Glyph of Vigor',\r\n\t\t\tdescription: 'Vigor grants an additional 10 maximum energy.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthbindtotem.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[RogueMinorGlyph.GlyphOfBlurredSpeed]: {\r\n\t\t\tname: 'Glyph of Blurred Speed',\r\n\t\t\tdescription: 'Enables you to walk on water while your Sprint ability is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg',\r\n\t\t},\r\n\t\t[RogueMinorGlyph.GlyphOfDistract]: {\r\n\t\t\tname: 'Glyph of Distract',\r\n\t\t\tdescription: 'Increases the range of your Distract ability by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg',\r\n\t\t},\r\n\t\t[RogueMinorGlyph.GlyphOfPickLock]: {\r\n\t\t\tname: 'Glyph of Pick Lock',\r\n\t\t\tdescription: 'Reduces the cast time of your Pick Lock ability by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_moonkey.jpg',\r\n\t\t},\r\n\t\t[RogueMinorGlyph.GlyphOfPickPocket]: {\r\n\t\t\tname: 'Glyph of Pick Pocket',\r\n\t\t\tdescription: 'Increases the range of your Pick Pocket ability by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_bag_11.jpg',\r\n\t\t},\r\n\t\t[RogueMinorGlyph.GlyphOfSafeFall]: {\r\n\t\t\tname: 'Glyph of Safe Fall',\r\n\t\t\tdescription: 'Increases the distance your Safe Fall ability allows you to fall without taking damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg',\r\n\t\t},\r\n\t\t[RogueMinorGlyph.GlyphOfVanish]: {\r\n\t\t\tname: 'Glyph of Vanish',\r\n\t\t\tdescription: 'Increases your movement speed by 30% while the Vanish effect is active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { ShamanTalents, ShamanMajorGlyph, ShamanMinorGlyph } from '../proto/shaman.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport ShamanTalentJson from './trees/shaman.json';\r\n\r\nexport const shamanTalentsConfig: TalentsConfig<ShamanTalents> = newTalentsConfig(ShamanTalentJson);\r\n\r\nexport const shamanGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[ShamanMajorGlyph.GlyphOfChainHeal]: {\r\n\t\t\tname: 'Glyph of Chain Heal',\r\n\t\t\tdescription: 'Your Chain Heal heals 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfChainLightning]: {\r\n\t\t\tname: 'Glyph of Chain Lightning',\r\n\t\t\tdescription: 'Your Chain Lightning strikes 1 additional target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_chainlightning.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfEarthShield]: {\r\n\t\t\tname: 'Glyph of Earth Shield',\r\n\t\t\tdescription: 'Increases the amount healed by your Earth Shield by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_skinofearth.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfEarthlivingWeapon]: {\r\n\t\t\tname: 'Glyph of Earthliving Weapon',\r\n\t\t\tdescription: 'Increases the chance for your Earthliving weapon to trigger by 5%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_earthlivingweapon.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfElementalMastery]: {\r\n\t\t\tname: 'Glyph of Elemental Mastery',\r\n\t\t\tdescription: 'Reduces the cooldown of your Elemental Mastery ability by 30 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispheal.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFeralSpirit]: {\r\n\t\t\tname: 'Glyph of Feral Spirit',\r\n\t\t\tdescription: 'Your spirit wolves gain an additional 30% of your attack power.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_feralspirit.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFireElementalTotem]: {\r\n\t\t\tname: 'Glyph of Fire Elemental Totem',\r\n\t\t\tdescription: 'Reduces the cooldown of your Fire Elemental Totem by 5 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_elemental_totem.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFireNova]: {\r\n\t\t\tname: 'Glyph of Fire Nova',\r\n\t\t\tdescription: 'Reduces the cooldown of your Fire Nova spell by 3 seconds.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_sealoffire.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFlameShock]: {\r\n\t\t\tname: 'Glyph of Flame Shock',\r\n\t\t\tdescription: 'Increases the critical strike damage bonus of your Flame Shock damage by 60%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFlametongueWeapon]: {\r\n\t\t\tname: 'Glyph of Flametongue Weapon',\r\n\t\t\tdescription: 'Increases your spell critical strike chance by 2% on each of your weapons with Flametongue Weapon active.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_flametounge.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfFrostShock]: {\r\n\t\t\tname: 'Glyph of Frost Shock',\r\n\t\t\tdescription: 'Increases the duration of your Frost Shock by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfHealingStreamTotem]: {\r\n\t\t\tname: 'Glyph of Healing Stream Totem',\r\n\t\t\tdescription: 'Your Healing Stream Totem heals for an additional 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_spear_04.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfHealingWave]: {\r\n\t\t\tname: 'Glyph of Healing Wave',\r\n\t\t\tdescription: 'Your Healing Wave also heals you for 20% of the healing effect when you heal someone else.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_magicimmunity.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfHex]: {\r\n\t\t\tname: 'Glyph of Hex',\r\n\t\t\tdescription: 'Increases the damage your Hex target can take before the Hex effect is removed by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_hex.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfLava]: {\r\n\t\t\tname: 'Glyph of Lava',\r\n\t\t\tdescription: 'Your Lava Burst spell gains an additional 10% of your spellpower.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_lavaburst.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfLavaLash]: {\r\n\t\t\tname: 'Glyph of Lava Lash',\r\n\t\t\tdescription: 'Damage on your Lava Lash is increased by an additional 10% if your weapon is enchanted with Flametongue.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_lavalash.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfLesserHealingWave]: {\r\n\t\t\tname: 'Glyph of Lesser Healing Wave',\r\n\t\t\tdescription: 'Your Lesser Healing Wave heals for 20% more if the target is also affected by Earth Shield.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavelesser.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfLightningBolt]: {\r\n\t\t\tname: 'Glyph of Lightning Bolt',\r\n\t\t\tdescription: 'Increases the damage dealt by Lightning Bolt by 4%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfLightningShield]: {\r\n\t\t\tname: 'Glyph of Lightning Shield',\r\n\t\t\tdescription: 'Increases the damage from Lightning Shield by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightningshield.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfManaTide]: {\r\n\t\t\tname: 'Glyph of Mana Tide',\r\n\t\t\tdescription: 'Your Mana Tide Totem grants an additional 1% of each target\\'s maximum mana each time it pulses.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfRiptide]: {\r\n\t\t\tname: 'Glyph of Riptide',\r\n\t\t\tdescription: 'Increases the duration of Riptide by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfShocking]: {\r\n\t\t\tname: 'Glyph of Shocking',\r\n\t\t\tdescription: 'Reduces your global cooldown when casting your shock spells by 0.5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthshock.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfStoneclawTotem]: {\r\n\t\t\tname: 'Glyph of Stoneclaw Totem',\r\n\t\t\tdescription: 'Your Stoneclaw Totem also places a damage absorb shield on you, equal to 4 times the strength of the shield it places on your totems.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfStormstrike]: {\r\n\t\t\tname: 'Glyph of Stormstrike',\r\n\t\t\tdescription: 'Increases the Nature damage bonus from your Stormstrike ability by an additional 8%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_stormstrike.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfThunder]: {\r\n\t\t\tname: 'Glyph of Thunder',\r\n\t\t\tdescription: 'Reduces the cooldown on Thunderstorm by 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfTotemOfWrath]: {\r\n\t\t\tname: 'Glyph of Totem of Wrath',\r\n\t\t\tdescription: 'When you cast Totem of Wrath, you gain 30% of the totem\\'s bonus spell power for 5 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_totemofwrath.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfWaterMastery]: {\r\n\t\t\tname: 'Glyph of Water Mastery',\r\n\t\t\tdescription: 'Increases the passive mana regeneration of your Water Shield spell by 30%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg',\r\n\t\t},\r\n\t\t[ShamanMajorGlyph.GlyphOfWindfuryWeapon]: {\r\n\t\t\tname: 'Glyph of Windfury Weapon',\r\n\t\t\tdescription: 'Increases the chance per swing for Windfury Weapon to trigger by 2%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[ShamanMinorGlyph.GlyphOfAstralRecall]: {\r\n\t\t\tname: 'Glyph of Astral Recall',\r\n\t\t\tdescription: 'Cooldown of your Astral Recall spell reduced by 7.5 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecal.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfGhostWolf]: {\r\n\t\t\tname: 'Glyph of Ghost Wolf',\r\n\t\t\tdescription: 'Your Ghost Wolf form regenerates an additional 1% of your maximum health every 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfRenewedLife]: {\r\n\t\t\tname: 'Glyph of Renewed Life',\r\n\t\t\tdescription: 'Your Reincarnation spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfThunderstorm]: {\r\n\t\t\tname: 'Glyph of Thunderstorm',\r\n\t\t\tdescription: 'Increases the mana you receive from your Thunderstorm spell by 2%, but it no longer knocks enemies back.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfWaterBreathing]: {\r\n\t\t\tname: 'Glyph of Water Breathing',\r\n\t\t\tdescription: 'Your Water Breathing spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfWaterShield]: {\r\n\t\t\tname: 'Glyph of Water Shield',\r\n\t\t\tdescription: 'Increases the number of charges on your Water Shield spell by 1.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg',\r\n\t\t},\r\n\t\t[ShamanMinorGlyph.GlyphOfWaterWalking]: {\r\n\t\t\tname: 'Glyph of Water Walking',\r\n\t\t\tdescription: 'Your Water Walking spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_windwalkon.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { WarlockTalents, WarlockMajorGlyph, WarlockMinorGlyph } from '../proto/warlock.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport WarlockTalentJson from './trees/warlock.json';\r\n\r\nexport const warlockTalentsConfig: TalentsConfig<WarlockTalents> = newTalentsConfig(WarlockTalentJson);\r\n\r\nexport const warlockGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[WarlockMajorGlyph.GlyphOfChaosBolt]: {\r\n\t\t\tname: 'Glyph of Chaos Bolt',\r\n\t\t\tdescription: 'Reduces the cooldown on Chaos Bolt by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_chaosbolt.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfConflagrate]: {\r\n\t\t\tname: 'Glyph of Conflagrate',\r\n\t\t\tdescription: 'Your Conflagrate spell no longer consumes your Immolate or Shadowflame spell from the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfCorruption]: {\r\n\t\t\tname: 'Glyph of Corruption',\r\n\t\t\tdescription: 'Your Corruption spell has a 4% chance to cause you to enter a Shadow Trance state after damaging the opponent. The Shadow Trance state reduces the casting time of your next Shadow Bolt spell by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_abominationexplosion.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfCurseOfAgony]: {\r\n\t\t\tname: 'Glyph of Curse of Agony',\r\n\t\t\tdescription: 'Increases the duration of your Curse of Agony by 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_curseofsargeras.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfDeathCoil]: {\r\n\t\t\tname: 'Glyph of Death Coil',\r\n\t\t\tdescription: 'Increases the duration of your Death Coil by 0.5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfDemonicCircle]: {\r\n\t\t\tname: 'Glyph of Demonic Circle',\r\n\t\t\tdescription: 'Reduces the cooldown on Demonic Circle by 4 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demoniccirclesummon.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfFear]: {\r\n\t\t\tname: 'Glyph of Fear',\r\n\t\t\tdescription: 'Increases the damage your Fear target can take before the Fear effect is removed by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_possession.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfFelguard]: {\r\n\t\t\tname: 'Glyph of Felguard',\r\n\t\t\tdescription: 'Increases the Felguard\\'s total attack power by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelguard.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfFelhunter]: {\r\n\t\t\tname: 'Glyph of Felhunter',\r\n\t\t\tdescription: 'When your Felhunter uses Devour Magic, you will also be healed for that amount.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelhunter.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfHaunt]: {\r\n\t\t\tname: 'Glyph of Haunt',\r\n\t\t\tdescription: 'The bonus damage granted by your Haunt spell is increased by an additional 3%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_haunt.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfHealthFunnel]: {\r\n\t\t\tname: 'Glyph of Health Funnel',\r\n\t\t\tdescription: 'Reduces the pushback suffered from damaging attacks while channeling your Health Funnel spell by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfHealthstone]: {\r\n\t\t\tname: 'Glyph of Healthstone',\r\n\t\t\tdescription: 'You receive 30% more healing from using a healthstone.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_stone_04.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfHowlOfTerror]: {\r\n\t\t\tname: 'Glyph of Howl of Terror',\r\n\t\t\tdescription: 'Reduces the cooldown on your Howl of Terror spell by 8 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathscream.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfImmolate]: {\r\n\t\t\tname: 'Glyph of Immolate',\r\n\t\t\tdescription: 'Increases the periodic damage of your Immolate by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_immolation.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfImp]: {\r\n\t\t\tname: 'Glyph of Imp',\r\n\t\t\tdescription: 'Increases the damage done by your Imp\\'s Firebolt spell by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonimp.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfIncinerate]: {\r\n\t\t\tname: 'Glyph of Incinerate',\r\n\t\t\tdescription: 'Increases the damage done by Incinerate by 5%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_burnout.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfLifeTap]: {\r\n\t\t\tname: 'Glyph of Life Tap',\r\n\t\t\tdescription: 'When you use Life Tap or Dark Pact, you gain 20% of your Spirit as spell power for 40 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_burningspirit.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfMetamorphosis]: {\r\n\t\t\tname: 'Glyph of Metamorphosis',\r\n\t\t\tdescription: 'Increases the duration of your Metamorphosis by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonform.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfQuickDecay]: {\r\n\t\t\tname: 'Glyph of Quick Decay',\r\n\t\t\tdescription: 'Your haste now reduces the time between periodic damage ticks of your Corruption spell.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_abominationexplosion.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfSearingPain]: {\r\n\t\t\tname: 'Glyph of Searing Pain',\r\n\t\t\tdescription: 'Increases the critical strike bonus of your Searing Pain by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_fire_soulburn.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfShadowBolt]: {\r\n\t\t\tname: 'Glyph of Shadow Bolt',\r\n\t\t\tdescription: 'Reduces the mana cost of your Shadow Bolt by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowbolt.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfShadowburn]: {\r\n\t\t\tname: 'Glyph of Shadowburn',\r\n\t\t\tdescription: 'Increases the critical strike chance of Shadowburn by 20% when the target is below 35% health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_scourgebuild.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfShadowflame]: {\r\n\t\t\tname: 'Glyph of Shadowflame',\r\n\t\t\tdescription: 'Your Shadowflame also applies a 70% movement speed slow on its victims.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warlock_shadowflame.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfSiphonLife]: {\r\n\t\t\tname: 'Glyph of Siphon Life',\r\n\t\t\tdescription: 'Increases the healing you receive from your Siphon Life talent by 25%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_requiem.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfSoulLink]: {\r\n\t\t\tname: 'Glyph of Soul Link',\r\n\t\t\tdescription: 'Increases the percentage of damage shared via your Soul Link by an additional 5%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_gathershadows.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfSoulstone]: {\r\n\t\t\tname: 'Glyph of Soulstone',\r\n\t\t\tdescription: 'Increases the amount of health you gain from resurrecting via a Soulstone by 300%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulgem.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfSuccubus]: {\r\n\t\t\tname: 'Glyph of Succubus',\r\n\t\t\tdescription: 'Your Succubus\\'s Seduction ability also removes all damage over time effects from the target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonsuccubus.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfUnstableAffliction]: {\r\n\t\t\tname: 'Glyph of Unstable Affliction',\r\n\t\t\tdescription: 'Decreases the casting time of your Unstable Affliction by 0.2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unstableaffliction_3.jpg',\r\n\t\t},\r\n\t\t[WarlockMajorGlyph.GlyphOfVoidwalker]: {\r\n\t\t\tname: 'Glyph of Voidwalker',\r\n\t\t\tdescription: 'Increases your Voidwalker\\'s total Stamina by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonvoidwalker.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[WarlockMinorGlyph.GlyphOfCurseOfExhausion]: {\r\n\t\t\tname: 'Glyph of Curse of Exhausion',\r\n\t\t\tdescription: 'Increases the range of your Curse of Exhaustion spell by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_grimward.jpg',\r\n\t\t},\r\n\t\t[WarlockMinorGlyph.GlyphOfDrainSoul]: {\r\n\t\t\tname: 'Glyph of Drain Soul',\r\n\t\t\tdescription: 'Your Drain Soul ability occasionally creates an additional soul shard.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_haunting.jpg',\r\n\t\t},\r\n\t\t[WarlockMinorGlyph.GlyphOfSubjugateDemon]: {\r\n\t\t\tname: 'Glyph of Subjugate Demon',\r\n\t\t\tdescription: 'Reduces the cast time of your Subjugate Demon spell by 50%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_enslavedemon.jpg',\r\n\t\t},\r\n\t\t[WarlockMinorGlyph.GlyphOfKilrogg]: {\r\n\t\t\tname: 'Glyph of Kilrogg',\r\n\t\t\tdescription: 'Increases the movement speed of your Eye of Kilrogg by 50% and allows it to fly in areas where flying mounts are enabled.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_evileye.jpg',\r\n\t\t},\r\n\t\t[WarlockMinorGlyph.GlyphOfSouls]: {\r\n\t\t\tname: 'Glyph of Souls',\r\n\t\t\tdescription: 'Reduces the mana cost of your Ritual of Souls spell by 70%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadesofdarkness.jpg',\r\n\t\t},\r\n\t\t[WarlockMinorGlyph.GlyphOfUnendingBreath]: {\r\n\t\t\tname: 'Glyph of Unending Breath',\r\n\t\t\tdescription: 'Increases the swim speed of targets affected by your Unending Breath spell by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { WarriorTalents, WarriorMajorGlyph, WarriorMinorGlyph } from '../proto/warrior.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport WarriorTalentJson from './trees/warrior.json';\r\n\r\nexport const warriorTalentsConfig: TalentsConfig<WarriorTalents> = newTalentsConfig(WarriorTalentJson);\r\n\r\nexport const warriorGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[WarriorMajorGlyph.GlyphOfBarbaricInsults]: {\r\n\t\t\tname: 'Glyph of Barbaric Insults',\r\n\t\t\tdescription: 'Your Mocking Blow ability generates 100% additional threat.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfBladestorm]: {\r\n\t\t\tname: 'Glyph of Bladestorm',\r\n\t\t\tdescription: 'Reduces the cooldown on Bladestorm by 15 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_bladestorm.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfBlocking]: {\r\n\t\t\tname: 'Glyph of Blocking',\r\n\t\t\tdescription: 'Increases your block value by 10% for 10 sec after using your Shield Slam ability.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_shield_05.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfBloodthirst]: {\r\n\t\t\tname: 'Glyph of Bloodthirst',\r\n\t\t\tdescription: 'Increases the healing you receive from your Bloodthirst ability by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfCleaving]: {\r\n\t\t\tname: 'Glyph of Cleaving',\r\n\t\t\tdescription: 'Increases the number of targets your Cleave hits by 1.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_cleave.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfDevastate]: {\r\n\t\t\tname: 'Glyph of Devastate',\r\n\t\t\tdescription: 'Your Devastate ability now applies two stacks of Sunder Armor.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_11.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfEnragedRegeneration]: {\r\n\t\t\tname: 'Glyph of Enraged Regeneration',\r\n\t\t\tdescription: 'Your Enraged Regeneration ability heals for an additional 10% of your health over its duration.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_focusedrage.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfExecution]: {\r\n\t\t\tname: 'Glyph of Execution',\r\n\t\t\tdescription: 'Your Execute ability deals damage as if you had 10 additional rage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_48.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfHamstring]: {\r\n\t\t\tname: 'Glyph of Hamstring',\r\n\t\t\tdescription: 'Gives your Hamstring ability a 10% chance to immobilize the target for 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_shockwave.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfHeroicStrike]: {\r\n\t\t\tname: 'Glyph of Heroic Strike',\r\n\t\t\tdescription: 'You gain 10 rage when you critically strike with your Heroic Strike ability.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfIntervene]: {\r\n\t\t\tname: 'Glyph of Intervene',\r\n\t\t\tdescription: 'Increases the number attacks you intercept for your Intervene target by 1.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_victoryrush.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfLastStand]: {\r\n\t\t\tname: 'Glyph of Last Stand',\r\n\t\t\tdescription: 'Reduces the cooldown of your Last Stand ability by 1 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_ashestoashes.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfMortalStrike]: {\r\n\t\t\tname: 'Glyph of Mortal Strike',\r\n\t\t\tdescription: 'Increases the damage of your Mortal Strike ability by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_savageblow.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfOverpower]: {\r\n\t\t\tname: 'Glyph of Overpower',\r\n\t\t\tdescription: 'Adds a 100% chance to enable your Overpower when your attacks are parried.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_meleedamage.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfRapidCharge]: {\r\n\t\t\tname: 'Glyph of Rapid Charge',\r\n\t\t\tdescription: 'Reduces the cooldown of your Charge ability by 7%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfRending]: {\r\n\t\t\tname: 'Glyph of Rending',\r\n\t\t\tdescription: 'Increases the duration of your Rend ability by 6 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfResonatingPower]: {\r\n\t\t\tname: 'Glyph of Resonating Power',\r\n\t\t\tdescription: 'Reduces the rage cost of your Thunder Clap ability by 5.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfRevenge]: {\r\n\t\t\tname: 'Glyph of Revenge',\r\n\t\t\tdescription: 'After using Revenge, your next Heroic Strike costs no rage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_revenge.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfShieldWall]: {\r\n\t\t\tname: 'Glyph of Shield Wall',\r\n\t\t\tdescription: 'Reduces the cooldown on Shield Wall by 2 min, but Shield Wall now only reduces damage taken by 40%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldwall.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfShockwave]: {\r\n\t\t\tname: 'Glyph of Shockwave',\r\n\t\t\tdescription: 'Reduces the cooldown on Shockwave by 3 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shockwave.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfSpellReflection]: {\r\n\t\t\tname: 'Glyph of Spell Reflection',\r\n\t\t\tdescription: 'Reduces the cooldown on Spell Reflection by 1 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldreflection.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfSunderArmor]: {\r\n\t\t\tname: 'Glyph of Sunder Armor',\r\n\t\t\tdescription: 'Your Sunder Armor ability affects a second nearby target.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_sunder.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfSweepingStrikes]: {\r\n\t\t\tname: 'Glyph of Sweeping Strikes',\r\n\t\t\tdescription: 'Reduces the rage cost of your Sweeping Strikes ability by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfTaunt]: {\r\n\t\t\tname: 'Glyph of Taunt',\r\n\t\t\tdescription: 'Increases the chance for your Taunt ability to succeed by 8%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfVictoryRush]: {\r\n\t\t\tname: 'Glyph of Victory Rush',\r\n\t\t\tdescription: 'Your Victory Rush ability has a 30% increased critical strike chance.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfVigilance]: {\r\n\t\t\tname: 'Glyph of Vigilance',\r\n\t\t\tdescription: 'Your Vigilance ability transfers an additional 5% of your target\\'s threat to you.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_vigilance.jpg',\r\n\t\t},\r\n\t\t[WarriorMajorGlyph.GlyphOfWhirlwind]: {\r\n\t\t\tname: 'Glyph of Whirlwind',\r\n\t\t\tdescription: 'Reduces the cooldown of your Whirlwind by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[WarriorMinorGlyph.GlyphOfBattle]: {\r\n\t\t\tname: 'Glyph of Battle',\r\n\t\t\tdescription: 'Increases the duration of your Battle Shout ability by 2 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfBloodrage]: {\r\n\t\t\tname: 'Glyph of Bloodrage',\r\n\t\t\tdescription: 'Reduces the health cost of your Bloodrage ability by 100%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_racial_bloodrage.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfCharge]: {\r\n\t\t\tname: 'Glyph of Charge',\r\n\t\t\tdescription: 'Increases the range of your Charge ability by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfCommand]: {\r\n\t\t\tname: 'Glyph of Command',\r\n\t\t\tdescription: 'Increases the duration of your Commanding Shout ability by 2 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_rallyingcry.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfEnduringVictory]: {\r\n\t\t\tname: 'Glyph of Enduring Victory',\r\n\t\t\tdescription: 'Increases the window of opportunity in which you can use Victory Rush by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfMockingBlow]: {\r\n\t\t\tname: 'Glyph of Mocking Blow',\r\n\t\t\tdescription: 'Increases the damage of your Mocking Blow ability by 25%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfThunderClap]: {\r\n\t\t\tname: 'Glyph of Thunder Clap',\r\n\t\t\tdescription: 'Increases the radius of your Thunder Clap ability by 2 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg',\r\n\t\t},\r\n\t\t[WarriorMinorGlyph.GlyphOfShatteringThrow]: {\r\n\t\t\tname: 'Glyph of Shattering Throw',\r\n\t\t\tdescription: 'Your Shattering Throw is now instant and can be used in any stance, but it no longer removes invulnerabilities and cannot be used on players or player-controlled targets.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shatteringthrow.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { Spec } from '../proto/common.js';\r\nimport { DeathknightTalents, DeathknightMajorGlyph, DeathknightMinorGlyph } from '../proto/deathknight.js';\r\nimport { Player } from '../player.js';\r\n\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\nimport { TalentsConfig, newTalentsConfig } from './talents_picker.js';\r\n\r\nimport DkTalentsJson from './trees/deathknight.json';\r\n\r\nexport const deathknightTalentsConfig: TalentsConfig<DeathknightTalents> = newTalentsConfig(DkTalentsJson);\r\n\r\nexport const deathknightGlyphsConfig: GlyphsConfig = {\r\n\tmajorGlyphs: {\r\n\t\t[DeathknightMajorGlyph.GlyphOfAntiMagicShell]: {\r\n\t\t\tname: 'Glyph of Anti-Magic Shell',\r\n\t\t\tdescription: 'Increases the duration of your Anti-Magic Shell by 2 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfBloodStrike]: {\r\n\t\t\tname: 'Glyph of Blood Strike',\r\n\t\t\tdescription: 'Your Blood Strike causes an additional 20% damage to snared targets.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_deathstrike.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfBoneShield]: {\r\n\t\t\tname: 'Glyph of Bone Shield',\r\n\t\t\tdescription: 'Adds 1 additional charge to your Bone Shield.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_chest_leather_13.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfChainsOfIce]: {\r\n\t\t\tname: 'Glyph of Chains of Ice',\r\n\t\t\tdescription: 'Your Chains of Ice also causes 144 to 156 Frost damage, increased by your attack power.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDancingRuneWeapon]: {\r\n\t\t\tname: 'Glyph of Dancing Rune Weapon',\r\n\t\t\tdescription: 'Increases the duration of Dancing Rune Weapon by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_sword_07.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDarkCommand]: {\r\n\t\t\tname: 'Glyph of Dark Command',\r\n\t\t\tdescription: 'Increases the chance for your Dark Command ability to work successfully by 8%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_shamanrage.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDarkDeath]: {\r\n\t\t\tname: 'Glyph of Dark Death',\r\n\t\t\tdescription: 'Increases the damage or healing done by Death Coil by 15%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDeathAndDecay]: {\r\n\t\t\tname: 'Glyph of Death and Decay',\r\n\t\t\tdescription: 'Damage of your Death and Decay spell increased by 20%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathanddecay.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDeathGrip]: {\r\n\t\t\tname: 'Glyph of Death Grip',\r\n\t\t\tdescription: 'When you deal a killing blow that grants honor or experience, the cooldown of your Death Grip is refreshed.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDeathStrike]: {\r\n\t\t\tname: 'Glyph of Death Strike',\r\n\t\t\tdescription: 'Increases your Death Strike\\'s damage by 1% for every 1 runic power you currently have (up to a maximum of 25%). The runic power is not consumed by this effect.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfDisease]: {\r\n\t\t\tname: 'Glyph of Disease',\r\n\t\t\tdescription: 'Your Pestilence ability now refreshes disease durations and secondary effects of diseases on your primary target back to their maximum duration.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfFrostStrike]: {\r\n\t\t\tname: 'Glyph of Frost Strike',\r\n\t\t\tdescription: 'Reduces the cost of your Frost Strike by 8 Runic Power.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_empowerruneblade2.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfHeartStrike]: {\r\n\t\t\tname: 'Glyph of Heart Strike',\r\n\t\t\tdescription: 'Your Heart Strike also reduces the movement speed of your target by 50% for 10 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_weapon_shortblade_40.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfHowlingBlast]: {\r\n\t\t\tname: 'Glyph of Howling Blast',\r\n\t\t\tdescription: 'Your Howling Blast ability now infects your targets with Frost Fever.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_frost_arcticwinds.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfHungeringCold]: {\r\n\t\t\tname: 'Glyph of Hungering Cold',\r\n\t\t\tdescription: 'Reduces the cost of Hungering Cold by 40 runic power.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_staff_15.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfIceboundFortitude]: {\r\n\t\t\tname: 'Glyph of Icebound Fortitude',\r\n\t\t\tdescription: 'Your Icebound Fortitude now always grants at least 40% damage reduction, regardless of your defense skill.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_iceboundfortitude.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfIcyTouch]: {\r\n\t\t\tname: 'Glyph of Icy Touch',\r\n\t\t\tdescription: 'Your Frost Fever disease deals 20% additional damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_icetouch.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfObliterate]: {\r\n\t\t\tname: 'Glyph of Obliterate',\r\n\t\t\tdescription: 'Increases the damage of your Obliterate ability by 25%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_classicon.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfPlagueStrike]: {\r\n\t\t\tname: 'Glyph of Plague Strike',\r\n\t\t\tdescription: 'Your Plague Strike does 20% additional damage.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_empowerruneblade.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfRuneStrike]: {\r\n\t\t\tname: 'Glyph of Rune Strike',\r\n\t\t\tdescription: 'Increases the critical strike chance of your Rune Strike by 10%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_darkconviction.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfRuneTap]: {\r\n\t\t\tname: 'Glyph of Rune Tap',\r\n\t\t\tdescription: 'Your Rune Tap now heals you for an additional 1% of your maximum health, and also heals your party for 10% of their maximum health.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_runetap.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfScourgeStrike]: {\r\n\t\t\tname: 'Glyph of Scourge Strike',\r\n\t\t\tdescription: 'Your Scourge Strike increases the duration of your diseases on the target by 3 sec, up to a maximum of 9 additional seconds.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_scourgestrike.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfStrangulate]: {\r\n\t\t\tname: 'Glyph of Strangulate',\r\n\t\t\tdescription: 'Reduces the cooldown of your Strangulate by 20 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulleech_3.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfTheGhoul]: {\r\n\t\t\tname: 'Glyph of the Ghoul',\r\n\t\t\tdescription: 'Your Ghoul receives an additional 40% of your Strength and 40% of your Stamina.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfUnbreakableArmor]: {\r\n\t\t\tname: 'Glyph of Unbreakable Armor',\r\n\t\t\tdescription: 'Increases the total armor granted by Unbreakable Armor to 30%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_armor_helm_plate_naxxramas_raidwarrior_c_01.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfUnholyBlight]: {\r\n\t\t\tname: 'Glyph of Unholy Blight',\r\n\t\t\tdescription: 'Increases the damage done by Unholy Blight by 40%.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_contagion.jpg',\r\n\t\t},\r\n\t\t[DeathknightMajorGlyph.GlyphOfVampiricBlood]: {\r\n\t\t\tname: 'Glyph of Vampiric Blood',\r\n\t\t\tdescription: 'Increases the duration of your Vampiric Blood by 5 sec.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg',\r\n\t\t},\r\n\t},\r\n\tminorGlyphs: {\r\n\t\t[DeathknightMinorGlyph.GlyphOfBloodTap]: {\r\n\t\t\tname: 'Glyph of Blood Tap',\r\n\t\t\tdescription: 'Your Blood Tap no longer causes damage to you.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodtap.jpg',\r\n\t\t},\r\n\t\t[DeathknightMinorGlyph.GlyphOfCorpseExplosion]: {\r\n\t\t\tname: 'Glyph of Corpse Explosion',\r\n\t\t\tdescription: 'Increases the radius of effect on Corpse Explosion by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_creature_disease_02.jpg',\r\n\t\t},\r\n\t\t[DeathknightMinorGlyph.GlyphOfDeathSEmbrace]: {\r\n\t\t\tname: 'Glyph of Death\\'s Embrace',\r\n\t\t\tdescription: 'Your Death Coil refunds 20 runic power when used to heal.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg',\r\n\t\t},\r\n\t\t[DeathknightMinorGlyph.GlyphOfHornOfWinter]: {\r\n\t\t\tname: 'Glyph of Horn of Winter',\r\n\t\t\tdescription: 'Increases the duration of your Horn of Winter ability by 1 min.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_02.jpg',\r\n\t\t},\r\n\t\t[DeathknightMinorGlyph.GlyphOfPestilence]: {\r\n\t\t\tname: 'Glyph of Pestilence',\r\n\t\t\tdescription: 'Increases the radius of your Pestilence effect by 5 yards.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg',\r\n\t\t},\r\n\t\t[DeathknightMinorGlyph.GlyphOfRaiseDead]: {\r\n\t\t\tname: 'Glyph of Raise Dead',\r\n\t\t\tdescription: 'Your Raise Dead spell no longer requires a reagent.',\r\n\t\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg',\r\n\t\t},\r\n\t},\r\n};\r\n","import { Player } from '../player.js';\r\nimport { Class } from '../proto/common.js';\r\nimport { Spec } from '../proto/common.js';\r\nimport {\r\n\tSpecTalents,\r\n\tspecToClass,\r\n\tspecTypeFunctions,\r\n} from '../proto_utils/utils.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { druidTalentsConfig, druidGlyphsConfig } from './druid.js';\r\nimport { hunterTalentsConfig, hunterGlyphsConfig } from './hunter.js';\r\nimport { mageTalentsConfig, mageGlyphsConfig } from './mage.js';\r\nimport { paladinTalentsConfig, paladinGlyphsConfig } from './paladin.js';\r\nimport { priestTalentsConfig, priestGlyphsConfig } from './priest.js';\r\nimport { rogueTalentsConfig, rogueGlyphsConfig } from './rogue.js';\r\nimport { shamanTalentsConfig, shamanGlyphsConfig } from './shaman.js';\r\nimport { warlockTalentsConfig, warlockGlyphsConfig } from './warlock.js';\r\nimport { warriorTalentsConfig, warriorGlyphsConfig } from './warrior.js';\r\nimport { deathknightTalentsConfig, deathknightGlyphsConfig } from './deathknight.js';\r\nimport { TalentsConfig } from './talents_picker.js';\r\nimport { GlyphsConfig } from './glyphs_picker.js';\r\n\r\nexport const classTalentsConfig: Record<Class, TalentsConfig<any>> = {\r\n\t[Class.ClassUnknown]: [],\r\n\t[Class.ClassDeathknight]: deathknightTalentsConfig,\r\n\t[Class.ClassDruid]: druidTalentsConfig,\r\n\t[Class.ClassShaman]: shamanTalentsConfig,\r\n\t[Class.ClassHunter]: hunterTalentsConfig,\r\n\t[Class.ClassMage]: mageTalentsConfig,\r\n\t[Class.ClassRogue]: rogueTalentsConfig,\r\n\t[Class.ClassPaladin]: paladinTalentsConfig,\r\n\t[Class.ClassPriest]: priestTalentsConfig,\r\n\t[Class.ClassWarlock]: warlockTalentsConfig,\r\n\t[Class.ClassWarrior]: warriorTalentsConfig,\r\n};\r\n\r\nexport const classGlyphsConfig: Record<Class, GlyphsConfig> = {\r\n\t[Class.ClassUnknown]: { majorGlyphs: [], minorGlyphs: [] },\r\n\t[Class.ClassDeathknight]: deathknightGlyphsConfig,\r\n\t[Class.ClassDruid]: druidGlyphsConfig,\r\n\t[Class.ClassShaman]: shamanGlyphsConfig,\r\n\t[Class.ClassHunter]: hunterGlyphsConfig,\r\n\t[Class.ClassMage]: mageGlyphsConfig,\r\n\t[Class.ClassRogue]: rogueGlyphsConfig,\r\n\t[Class.ClassPaladin]: paladinGlyphsConfig,\r\n\t[Class.ClassPriest]: priestGlyphsConfig,\r\n\t[Class.ClassWarlock]: warlockGlyphsConfig,\r\n\t[Class.ClassWarrior]: warriorGlyphsConfig,\r\n};\r\n\r\nexport function talentSpellIdsToTalentString(playerClass: Class, talentIds: Array<number>): string {\r\n\tconst talentsConfig = classTalentsConfig[playerClass];\r\n\r\n\tconst talentsStr = talentsConfig.map(treeConfig => {\r\n\t\tconst treeStr = treeConfig.talents.map(talentConfig => {\r\n\t\t\tconst spellIdIndex = talentConfig.spellIds.findIndex(spellId => talentIds.includes(spellId));\r\n\t\t\tif (spellIdIndex == -1) {\r\n\t\t\t\treturn '0';\r\n\t\t\t} else {\r\n\t\t\t\treturn String(spellIdIndex + 1);\r\n\t\t\t}\r\n\t\t}).join('').replace(/0+$/g, '');\r\n\r\n\t\treturn treeStr;\r\n\t}).join('-').replace(/-+$/g, '');\r\n\r\n\treturn talentsStr\r\n}\r\n\r\nexport function playerTalentStringToProto<SpecType extends Spec>(spec: Spec, talentString: string): SpecTalents<SpecType> {\r\n\tconst specFunctions = specTypeFunctions[spec];\r\n\tconst proto = specFunctions.talentsCreate() as SpecTalents<SpecType>;\r\n\tconst talentsConfig = classTalentsConfig[specToClass[spec]] as TalentsConfig<SpecTalents<SpecType>>;\r\n\r\n\treturn talentStringToProto(proto, talentString, talentsConfig);\r\n}\r\n\r\nexport function talentStringToProto<TalentsProto>(proto: TalentsProto, talentString: string, talentsConfig: TalentsConfig<TalentsProto>): TalentsProto {\r\n\ttalentString.split('-').forEach((treeString, treeIdx) => {\r\n\t\tconst treeConfig = talentsConfig[treeIdx];\r\n\t\t[...treeString].forEach((talentString, i) => {\r\n\t\t\tconst talentConfig = treeConfig.talents[i];\r\n\t\t\tconst points = parseInt(talentString);\r\n\t\t\tif (talentConfig.fieldName) {\r\n\t\t\t\tif (talentConfig.maxPoints == 1) {\r\n\t\t\t\t\t(proto[talentConfig.fieldName as keyof TalentsProto] as unknown as boolean) = points == 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(proto[talentConfig.fieldName as keyof TalentsProto] as unknown as number) = points;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\treturn proto;\r\n}\r\n\r\n// Note that this function will fail if any of the talent names are not defined. TODO: Remove that condition\r\n// once all talents are migrated to wrath and use all fields.\r\nexport function protoToTalentString<TalentsProto>(proto: TalentsProto, talentsConfig: TalentsConfig<TalentsProto>): string {\r\n\treturn talentsConfig.map(treeConfig => {\r\n\t\treturn treeConfig.talents\r\n\t\t\t.map(talentConfig => String(Number(proto[(talentConfig.fieldName as keyof TalentsProto)!])))\r\n\t\t\t.join('').replace(/0+$/g, '');\r\n\t}).join('-').replace(/-+$/g, '');\r\n}\r\n","import { Party as PartyProto } from './proto/api.js';\r\nimport { PartyStats as PartyStatsProto } from './proto/api.js';\r\nimport { Player as PlayerProto } from './proto/api.js';\r\nimport { PartyBuffs } from './proto/common.js';\r\nimport { Class } from './proto/common.js';\r\nimport { Spec } from './proto/common.js';\r\nimport { playerToSpec } from './proto_utils/utils.js';\r\n\r\nimport { Raid } from './raid.js';\r\nimport { Player } from './player.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\nimport { Sim } from './sim.js';\r\n\r\nexport const MAX_PARTY_SIZE = 5;\r\n\r\n// Manages all the settings for a single Party.\r\nexport class Party {\r\n\treadonly sim: Sim;\r\n\treadonly raid: Raid;\r\n\r\n\tprivate buffs: PartyBuffs = PartyBuffs.create();\r\n\r\n\t// Emits when a party member is added/removed/moved.\r\n\treadonly compChangeEmitter = new TypedEvent<void>();\r\n\r\n\treadonly buffsChangeEmitter = new TypedEvent<void>();\r\n\r\n\t// Emits when anything in the party changes.\r\n\treadonly changeEmitter: TypedEvent<void>;\r\n\r\n\t// Should always hold exactly MAX_PARTY_SIZE elements.\r\n\tprivate players: Array<Player<any> | null>;\r\n\r\n\tprivate readonly playerChangeListener: (eventID: EventID) => void;\r\n\r\n\tconstructor(raid: Raid, sim: Sim) {\r\n\t\tthis.sim = sim;\r\n\t\tthis.raid = raid;\r\n\t\tthis.players = [...Array(MAX_PARTY_SIZE).keys()].map(i => null);\r\n\t\tthis.playerChangeListener = eventID => this.changeEmitter.emit(eventID);\r\n\r\n\t\tthis.changeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.compChangeEmitter,\r\n\t\t\tthis.buffsChangeEmitter,\r\n\t\t], 'PartyChange');\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this.players.filter(player => player != null).length;\r\n\t}\r\n\r\n\tisEmpty(): boolean {\r\n\t\treturn this.size() == 0;\r\n\t}\r\n\r\n\tclear(eventID: EventID) {\r\n\t\tthis.setBuffs(eventID, PartyBuffs.create());\r\n\t\tfor (let i = 0; i < MAX_PARTY_SIZE; i++) {\r\n\t\t\tthis.setPlayer(eventID, i, null);\r\n\t\t}\r\n\t}\r\n\r\n\t// Returns this party's index within the raid [0-4].\r\n\tgetIndex(): number {\r\n\t\treturn this.raid.getParties().indexOf(this);\r\n\t}\r\n\r\n\tgetPlayers(): Array<Player<any> | null> {\r\n\t\t// Make defensive copy.\r\n\t\treturn this.players.slice();\r\n\t}\r\n\r\n\tgetPlayer(playerIndex: number): Player<any> | null {\r\n\t\treturn this.players[playerIndex];\r\n\t}\r\n\r\n\tsetPlayer(eventID: EventID, playerIndex: number, newPlayer: Player<any> | null) {\r\n\t\tif (playerIndex < 0 || playerIndex >= MAX_PARTY_SIZE) {\r\n\t\t\tthrow new Error('Invalid player index: ' + playerIndex);\r\n\t\t}\r\n\r\n\t\tif (newPlayer == this.players[playerIndex]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tconst oldPlayer = this.players[playerIndex];\r\n\t\t\tif (oldPlayer != null) {\r\n\t\t\t\toldPlayer.changeEmitter.off(this.playerChangeListener);\r\n\t\t\t\toldPlayer.setParty(null);\r\n\t\t\t}\r\n\t\t\tif (newPlayer != null) {\r\n\t\t\t\tconst newPlayerOldParty = newPlayer.getParty();\r\n\t\t\t\tif (newPlayerOldParty) {\r\n\t\t\t\t\tnewPlayerOldParty.setPlayer(eventID, newPlayer.getPartyIndex(), null);\r\n\t\t\t\t}\r\n\t\t\t\tthis.players[playerIndex] = newPlayer;\r\n\t\t\t\tnewPlayer.changeEmitter.on(this.playerChangeListener);\r\n\t\t\t\tnewPlayer.setParty(this);\r\n\t\t\t} else {\r\n\t\t\t\tthis.players[playerIndex] = null;\r\n\t\t\t}\r\n\r\n\t\t\tthis.compChangeEmitter.emit(eventID);\r\n\t\t});\r\n\t}\r\n\r\n\tgetBuffs(): PartyBuffs {\r\n\t\t// Make a defensive copy\r\n\t\treturn PartyBuffs.clone(this.buffs);\r\n\t}\r\n\r\n\tsetBuffs(eventID: EventID, newBuffs: PartyBuffs) {\r\n\t\tif (PartyBuffs.equals(this.buffs, newBuffs))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.buffs = PartyBuffs.clone(newBuffs);\r\n\t\tthis.buffsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\ttoProto(forExport?: boolean, forSimming?: boolean): PartyProto {\r\n\t\treturn PartyProto.create({\r\n\t\t\tplayers: this.players.map(player => player == null ? PlayerProto.create() : player.toProto(forExport, forSimming)),\r\n\t\t\tbuffs: this.buffs,\r\n\t\t});\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, proto: PartyProto) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setBuffs(eventID, proto.buffs || PartyBuffs.create());\r\n\r\n\t\t\tfor (let i = 0; i < MAX_PARTY_SIZE; i++) {\r\n\t\t\t\tif (!proto.players[i] || proto.players[i].class == Class.ClassUnknown) {\r\n\t\t\t\t\tthis.setPlayer(eventID, i, null);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst playerProto = proto.players[i];\r\n\t\t\t\tconst spec = playerToSpec(playerProto);\r\n\t\t\t\tconst currentPlayer = this.players[i];\r\n\r\n\t\t\t\t// Reuse the current player if possible, so that event handlers are preserved.\r\n\t\t\t\tif (currentPlayer && spec == currentPlayer.spec) {\r\n\t\t\t\t\tcurrentPlayer.fromProto(eventID, playerProto);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst newPlayer = new Player(spec, this.sim);\r\n\t\t\t\t\tnewPlayer.fromProto(eventID, playerProto);\r\n\t\t\t\t\tthis.setPlayer(eventID, i, newPlayer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import {\r\n\tArmorType,\r\n\tClass,\r\n\tConsumes,\r\n\tCooldowns,\r\n\tFaction,\r\n\tGemColor,\r\n\tGlyphs,\r\n\tHandType,\r\n\tHealingModel,\r\n\tIndividualBuffs,\r\n\tItemSlot,\r\n\tProfession,\r\n\tPseudoStat,\r\n\tRace,\r\n\tUnitReference,\r\n\tShattrathFaction,\r\n\tSimDatabase,\r\n\tSpec,\r\n\tStat,\r\n\tUnitStats,\r\n\tUnitReference_Type,\r\n} from './proto/common.js';\r\nimport {\r\n\tAuraStats as AuraStatsProto,\r\n\tSpellStats as SpellStatsProto,\r\n\tUnitMetadata as UnitMetadataProto,\r\n} from './proto/api.js';\r\nimport {\r\n\tAPLRotation,\r\n\tAPLRotation_Type as APLRotationType,\r\n\tAPLValue,\r\n\tSimpleRotation,\r\n} from './proto/apl.js';\r\nimport {\r\n\tDungeonDifficulty,\r\n\tExpansion,\r\n\tRaidFilterOption,\r\n\tSourceFilterOption,\r\n\tUIEnchant as Enchant,\r\n\tUIGem as Gem,\r\n\tUIItem as Item,\r\n\tUIItem_FactionRestriction,\r\n} from './proto/ui.js';\r\n\r\nimport { PlayerStats } from './proto/api.js';\r\nimport { Player as PlayerProto } from './proto/api.js';\r\nimport { StatWeightsResult } from './proto/api.js';\r\nimport { ActionId } from './proto_utils/action_id.js';\r\nimport { EquippedItem, getWeaponDPS } from './proto_utils/equipped_item.js';\r\nimport { aplLaunchStatuses, LaunchStatus } from './launched_sims';\r\n\r\nimport { playerTalentStringToProto } from './talents/factory.js';\r\nimport { Gear, ItemSwapGear } from './proto_utils/gear.js';\r\nimport {\r\n\tisUnrestrictedGem,\r\n\tgemMatchesSocket,\r\n} from './proto_utils/gems.js';\r\nimport { Stats } from './proto_utils/stats.js';\r\n\r\nimport {\r\n\tAL_CATEGORY_HARD_MODE,\r\n\tClassSpecs,\r\n\tSpecRotation,\r\n\tSpecTalents,\r\n\tSpecTypeFunctions,\r\n\tSpecOptions,\r\n\tcanEquipEnchant,\r\n\tcanEquipItem,\r\n\tclassColors,\r\n\temptyUnitReference,\r\n\tenchantAppliesToItem,\r\n\tgetTalentTree,\r\n\tgetTalentTreeIcon,\r\n\tgetTalentTreePoints,\r\n\tgetMetaGemEffectEP,\r\n\tisTankSpec,\r\n\tnewUnitReference,\r\n\traceToFaction,\r\n\tspecToClass,\r\n\tspecToEligibleRaces,\r\n\tspecTypeFunctions,\r\n\twithSpecProto,\r\n\tShamanSpecs,\r\n} from './proto_utils/utils.js';\r\n\r\nimport * as Mechanics from './constants/mechanics.js';\r\nimport { getLanguageCode } from './constants/lang.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\nimport { Party, MAX_PARTY_SIZE } from './party.js';\r\nimport { Raid } from './raid.js';\r\nimport { Sim } from './sim.js';\r\nimport { stringComparator, sum } from './utils.js';\r\n\r\nexport interface AuraStats {\r\n\tdata: AuraStatsProto,\r\n\tid: ActionId,\r\n}\r\nexport interface SpellStats {\r\n\tdata: SpellStatsProto,\r\n\tid: ActionId,\r\n}\r\n\r\nexport class UnitMetadata {\r\n\tprivate name: string;\r\n\tprivate auras: Array<AuraStats>;\r\n\tprivate spells: Array<SpellStats>;\r\n\r\n\tconstructor() {\r\n\t\tthis.name = '';\r\n\t\tthis.auras = [];\r\n\t\tthis.spells = [];\r\n\t}\r\n\r\n\tgetName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\r\n\tgetAuras(): Array<AuraStats> {\r\n\t\treturn this.auras.slice();\r\n\t}\r\n\r\n\tgetSpells(): Array<SpellStats> {\r\n\t\treturn this.spells.slice();\r\n\t}\r\n\r\n\t// Returns whether any updates were made.\r\n\tasync update(metadata: UnitMetadataProto): Promise<boolean> {\r\n\t\tlet newSpells = metadata!.spells.map(spell => {\r\n\t\t\treturn {\r\n\t\t\t\tdata: spell,\r\n\t\t\t\tid: ActionId.fromProto(spell.id!),\r\n\t\t\t};\r\n\t\t});\r\n\t\tlet newAuras = metadata!.auras.map(aura => {\r\n\t\t\treturn {\r\n\t\t\t\tdata: aura,\r\n\t\t\t\tid: ActionId.fromProto(aura.id!),\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tawait Promise.all([...newSpells, ...newAuras].map(newSpell => newSpell.id.fill().then(newId => newSpell.id = newId)));\r\n\r\n\t\tnewSpells = newSpells.sort((a, b) => stringComparator(a.id.name, b.id.name))\r\n\t\tnewAuras = newAuras.sort((a, b) => stringComparator(a.id.name, b.id.name))\r\n\r\n\t\tlet anyUpdates = false;\r\n\t\tif (metadata.name != this.name) {\r\n\t\t\tthis.name = metadata.name;\r\n\t\t\tanyUpdates = true;\r\n\t\t}\r\n\t\tif (newSpells.length != this.spells.length || newSpells.some((newSpell, i) => !newSpell.id.equals(this.spells[i].id))) {\r\n\t\t\tthis.spells = newSpells;\r\n\t\t\tanyUpdates = true;\r\n\t\t}\r\n\t\tif (newAuras.length != this.auras.length || newAuras.some((newAura, i) => !newAura.id.equals(this.auras[i].id))) {\r\n\t\t\tthis.auras = newAuras;\r\n\t\t\tanyUpdates = true;\r\n\t\t}\r\n\r\n\t\treturn anyUpdates;\r\n\t}\r\n}\r\n\r\nexport class UnitMetadataList {\r\n\tprivate metadatas: Array<UnitMetadata>;\r\n\r\n\tconstructor() {\r\n\t\tthis.metadatas = [];\r\n\t}\r\n\r\n\tasync update(newMetadatas: Array<UnitMetadataProto>): Promise<boolean> {\r\n\t\tconst oldLen = this.metadatas.length;\r\n\r\n\t\tif (newMetadatas.length > oldLen) {\r\n\t\t\tfor (let i = oldLen; i < newMetadatas.length; i++) {\r\n\t\t\t\tthis.metadatas.push(new UnitMetadata());\r\n\t\t\t}\r\n\t\t} else if (newMetadatas.length < oldLen) {\r\n\t\t\tthis.metadatas = this.metadatas.slice(0, newMetadatas.length);\r\n\t\t}\r\n\r\n\t\tconst anyUpdates = await Promise.all(newMetadatas.map((metadata, i) => this.metadatas[i].update(metadata)));\r\n\r\n\t\treturn oldLen != this.metadatas.length || anyUpdates.some(v => v);\r\n\t}\r\n\r\n\tasList(): Array<UnitMetadata> {\r\n\t\treturn this.metadatas.slice();\r\n\t}\r\n}\r\n\r\nexport interface MeleeCritCapInfo {\r\n\tmeleeCrit: number,\r\n\tmeleeHit: number,\r\n\texpertise: number,\r\n\tsuppression: number,\r\n\tglancing: number,\r\n\tdebuffCrit: number,\r\n\thasOffhandWeapon: boolean,\r\n\tmeleeHitCap: number,\r\n\texpertiseCap: number,\r\n\tremainingMeleeHitCap: number,\r\n\tremainingExpertiseCap: number,\r\n\tbaseCritCap: number,\r\n\tspecSpecificOffset: number,\r\n\tplayerCritCapDelta: number\r\n}\r\n\r\nexport type AutoRotationGenerator<SpecType extends Spec> = (player: Player<SpecType>) => APLRotation;\r\nexport type SimpleRotationGenerator<SpecType extends Spec> = (player: Player<SpecType>, simpleRotation: SpecRotation<SpecType>, cooldowns: Cooldowns) => APLRotation;\r\n\r\n// Manages all the gear / consumes / other settings for a single Player.\r\nexport class Player<SpecType extends Spec> {\r\n\treadonly sim: Sim;\r\n\tprivate party: Party | null;\r\n\tprivate raid: Raid | null;\r\n\r\n\treadonly spec: Spec;\r\n\tprivate name: string = '';\r\n\tprivate buffs: IndividualBuffs = IndividualBuffs.create();\r\n\tprivate consumes: Consumes = Consumes.create();\r\n\tprivate bonusStats: Stats = new Stats();\r\n\tprivate gear: Gear = new Gear({});\r\n\t//private bulkEquipmentSpec: BulkEquipmentSpec = BulkEquipmentSpec.create();\r\n\tprivate itemSwapGear: ItemSwapGear = new ItemSwapGear();\r\n\tprivate race: Race;\r\n\tprivate shattFaction: ShattrathFaction;\r\n\tprivate profession1: Profession = 0;\r\n\tprivate profession2: Profession = 0;\r\n\tprivate rotation: SpecRotation<SpecType>;\r\n\taplRotation: APLRotation = APLRotation.create();\r\n\tprivate talentsString: string = '';\r\n\tprivate glyphs: Glyphs = Glyphs.create();\r\n\tprivate specOptions: SpecOptions<SpecType>;\r\n\tprivate cooldowns: Cooldowns = Cooldowns.create();\r\n\tprivate reactionTime: number = 0;\r\n\tprivate channelClipDelay: number = 0;\r\n\tprivate inFrontOfTarget: boolean = false;\r\n\tprivate distanceFromTarget: number = 0;\r\n\tprivate healingModel: HealingModel = HealingModel.create();\r\n\tprivate healingEnabled: boolean = false;\r\n\r\n\tprivate autoRotationGenerator: AutoRotationGenerator<SpecType> | null = null;\r\n\tprivate simpleRotationGenerator: SimpleRotationGenerator<SpecType> | null = null;\r\n\r\n\tprivate itemEPCache = new Array<Map<number, number>>();\r\n\tprivate gemEPCache = new Map<number, number>();\r\n\tprivate enchantEPCache = new Map<number, number>();\r\n\tprivate talents: SpecTalents<SpecType> | null = null;\r\n\r\n\treadonly specTypeFunctions: SpecTypeFunctions<SpecType>;\r\n\r\n\tprivate static readonly numEpRatios = 6;\r\n\tprivate epRatios: Array<number> = new Array<number>(Player.numEpRatios).fill(0);\r\n\tprivate epWeights: Stats = new Stats();\r\n\tprivate currentStats: PlayerStats = PlayerStats.create();\r\n\tprivate metadata: UnitMetadata = new UnitMetadata();\r\n\tprivate petMetadatas: UnitMetadataList = new UnitMetadataList();\r\n\r\n\treadonly nameChangeEmitter = new TypedEvent<void>('PlayerName');\r\n\treadonly buffsChangeEmitter = new TypedEvent<void>('PlayerBuffs');\r\n\treadonly consumesChangeEmitter = new TypedEvent<void>('PlayerConsumes');\r\n\treadonly bonusStatsChangeEmitter = new TypedEvent<void>('PlayerBonusStats');\r\n\treadonly gearChangeEmitter = new TypedEvent<void>('PlayerGear');\r\n\treadonly professionChangeEmitter = new TypedEvent<void>('PlayerProfession');\r\n\treadonly raceChangeEmitter = new TypedEvent<void>('PlayerRace');\r\n\treadonly rotationChangeEmitter = new TypedEvent<void>('PlayerRotation');\r\n\treadonly talentsChangeEmitter = new TypedEvent<void>('PlayerTalents');\r\n\treadonly glyphsChangeEmitter = new TypedEvent<void>('PlayerGlyphs');\r\n\treadonly specOptionsChangeEmitter = new TypedEvent<void>('PlayerSpecOptions');\r\n\treadonly cooldownsChangeEmitter = new TypedEvent<void>('PlayerCooldowns');\r\n\treadonly inFrontOfTargetChangeEmitter = new TypedEvent<void>('PlayerInFrontOfTarget');\r\n\treadonly distanceFromTargetChangeEmitter = new TypedEvent<void>('PlayerDistanceFromTarget');\r\n\treadonly healingModelChangeEmitter = new TypedEvent<void>('PlayerHealingModel');\r\n\treadonly epWeightsChangeEmitter = new TypedEvent<void>('PlayerEpWeights');\r\n\treadonly miscOptionsChangeEmitter = new TypedEvent<void>('PlayerMiscOptions');\r\n\r\n\treadonly currentStatsEmitter = new TypedEvent<void>('PlayerCurrentStats');\r\n\treadonly epRatiosChangeEmitter = new TypedEvent<void>('PlayerEpRatios');\r\n\treadonly epRefStatChangeEmitter = new TypedEvent<void>('PlayerEpRefStat');\r\n\r\n\t// Emits when any of the above emitters emit.\r\n\treadonly changeEmitter: TypedEvent<void>;\r\n\r\n\tconstructor(spec: Spec, sim: Sim) {\r\n\t\tthis.sim = sim;\r\n\t\tthis.party = null;\r\n\t\tthis.raid = null;\r\n\r\n\t\tthis.spec = spec;\r\n\t\tthis.race = specToEligibleRaces[this.spec][0];\r\n\t\tthis.shattFaction = 0;\r\n\t\tthis.specTypeFunctions = specTypeFunctions[this.spec] as SpecTypeFunctions<SpecType>;\r\n\t\tthis.rotation = this.specTypeFunctions.rotationCreate();\r\n\t\tthis.specOptions = this.specTypeFunctions.optionsCreate();\r\n\r\n\t\tfor(let i = 0; i < ItemSlot.ItemSlotRanged+1; ++i) {\r\n\t\t\tthis.itemEPCache[i] = new Map();\r\n\t\t}\r\n\r\n\t\tthis.changeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.nameChangeEmitter,\r\n\t\t\tthis.buffsChangeEmitter,\r\n\t\t\tthis.consumesChangeEmitter,\r\n\t\t\tthis.bonusStatsChangeEmitter,\r\n\t\t\tthis.gearChangeEmitter,\r\n\t\t\tthis.professionChangeEmitter,\r\n\t\t\tthis.raceChangeEmitter,\r\n\t\t\tthis.rotationChangeEmitter,\r\n\t\t\tthis.talentsChangeEmitter,\r\n\t\t\tthis.glyphsChangeEmitter,\r\n\t\t\tthis.specOptionsChangeEmitter,\r\n\t\t\tthis.cooldownsChangeEmitter,\r\n\t\t\tthis.miscOptionsChangeEmitter,\r\n\t\t\tthis.inFrontOfTargetChangeEmitter,\r\n\t\t\tthis.distanceFromTargetChangeEmitter,\r\n\t\t\tthis.healingModelChangeEmitter,\r\n\t\t\tthis.epWeightsChangeEmitter,\r\n\t\t\tthis.epRatiosChangeEmitter,\r\n\t\t\tthis.epRefStatChangeEmitter,\r\n\t\t], 'PlayerChange');\r\n\t}\r\n\r\n\tgetSpecIcon(): string {\r\n\t\treturn getTalentTreeIcon(this.spec, this.getTalentsString());\r\n\t}\r\n\r\n\tgetClass(): Class {\r\n\t\treturn specToClass[this.spec];\r\n\t}\r\n\r\n\tgetClassColor(): string {\r\n\t\treturn classColors[this.getClass()];\r\n\t}\r\n\r\n\tisSpec<T extends Spec>(spec: T): this is Player<T> {\r\n\t\treturn this.spec == spec;\r\n\t}\r\n\tisClass<T extends Class>(clazz: T): this is Player<ClassSpecs<T>> {\r\n\t\treturn this.getClass() == clazz;\r\n\t}\r\n\r\n\tgetParty(): Party | null {\r\n\t\treturn this.party;\r\n\t}\r\n\r\n\tgetRaid(): Raid | null {\r\n\t\treturn this.raid;\r\n\t}\r\n\r\n\t// Returns this player's index within its party [0-4].\r\n\tgetPartyIndex(): number {\r\n\t\tif (this.party == null) {\r\n\t\t\tthrow new Error('Can\\'t get party index for player without a party!');\r\n\t\t}\r\n\r\n\t\treturn this.party.getPlayers().indexOf(this);\r\n\t}\r\n\r\n\t// Returns this player's index within its raid [0-24].\r\n\tgetRaidIndex(): number {\r\n\t\tif (this.party == null) {\r\n\t\t\tthrow new Error('Can\\'t get raid index for player without a party!');\r\n\t\t}\r\n\r\n\t\treturn this.party.getIndex() * MAX_PARTY_SIZE + this.getPartyIndex();\r\n\t}\r\n\r\n\t// This should only ever be called from party.\r\n\tsetParty(newParty: Party | null) {\r\n\t\tif (newParty == null) {\r\n\t\t\tthis.party = null;\r\n\t\t\tthis.raid = null;\r\n\t\t} else {\r\n\t\t\tthis.party = newParty;\r\n\t\t\tthis.raid = newParty.raid;\r\n\t\t}\r\n\t}\r\n\r\n\tgetOtherPartyMembers(): Array<Player<any>> {\r\n\t\tif (this.party == null) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn this.party.getPlayers().filter(player => player != null && player != this) as Array<Player<any>>;\r\n\t}\r\n\r\n\t// Returns all items that this player can wear in the given slot.\r\n\tgetItems(slot: ItemSlot): Array<Item> {\r\n\t\treturn this.sim.db.getItems(slot).filter(item => canEquipItem(item, this.spec, slot));\r\n\t}\r\n\r\n\t// Returns all enchants that this player can wear in the given slot.\r\n\tgetEnchants(slot: ItemSlot): Array<Enchant> {\r\n\t\treturn this.sim.db.getEnchants(slot).filter(enchant => canEquipEnchant(enchant, this.spec));\r\n\t}\r\n\r\n\t// Returns all gems that this player can wear of the given color.\r\n\tgetGems(socketColor?: GemColor): Array<Gem> {\r\n\t\treturn this.sim.db.getGems(socketColor);\r\n\t}\r\n\r\n\tgetEpWeights(): Stats {\r\n\t\treturn this.epWeights;\r\n\t}\r\n\r\n\tsetEpWeights(eventID: EventID, newEpWeights: Stats) {\r\n\t\tthis.epWeights = newEpWeights;\r\n\t\tthis.epWeightsChangeEmitter.emit(eventID);\r\n\r\n\t\tthis.gemEPCache = new Map();\r\n\t\tthis.enchantEPCache = new Map();\r\n\t\tfor(let i = 0; i < ItemSlot.ItemSlotRanged+1; ++i) {\r\n\t\t\tthis.itemEPCache[i] = new Map();\r\n\t\t}\r\n\t}\r\n\r\n\tgetShattFaction(): ShattrathFaction {\r\n\t\treturn this.shattFaction;\r\n\t}\r\n\tsetShattFaction(eventID: EventID, newFaction: ShattrathFaction) {\r\n\t\tif (newFaction != this.shattFaction) {\r\n\t\t\tthis.shattFaction = newFaction;\r\n\t\t\tthis.raceChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetDefaultEpRatios(isTankSpec: boolean, isHealingSpec: boolean): Array<number> {\r\n\t\tconst defaultRatios = new Array(Player.numEpRatios).fill(0);\r\n\t\tif (isHealingSpec) {\r\n\t\t\t// By default only value HPS EP for healing spec\r\n\t\t\tdefaultRatios[1] = 1;\r\n\t\t} else if (isTankSpec) {\r\n\t\t\t// By default value TPS and DTPS EP equally for tanking spec\r\n\t\t\tdefaultRatios[2] = 1;\r\n\t\t\tdefaultRatios[3] = 1;\r\n\t\t} else {\r\n\t\t\t// By default only value DPS EP\r\n\t\t\tdefaultRatios[0] = 1;\r\n\t\t}\r\n\t\treturn defaultRatios;\r\n\t}\r\n\r\n\tgetEpRatios() {\r\n\t\treturn this.epRatios.slice();\r\n\t}\r\n\r\n\tsetEpRatios(eventID: EventID, newRatios: Array<number>) {\r\n\t\tthis.epRatios = newRatios;\r\n\t\tthis.epRatiosChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tasync computeStatWeights(eventID: EventID, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat>, epReferenceStat: Stat, onProgress: Function): Promise<StatWeightsResult> {\r\n\t\tconst result = await this.sim.statWeights(this, epStats, epPseudoStats, epReferenceStat, onProgress);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetCurrentStats(): PlayerStats {\r\n\t\treturn PlayerStats.clone(this.currentStats);\r\n\t}\r\n\r\n\tsetCurrentStats(eventID: EventID, newStats: PlayerStats) {\r\n\t\tthis.currentStats = newStats;\r\n\t\tthis.currentStatsEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetMetadata(): UnitMetadata {\r\n\t\treturn this.metadata;\r\n\t}\r\n\r\n\tgetPetMetadatas(): UnitMetadataList {\r\n\t\treturn this.petMetadatas;\r\n\t}\r\n\r\n\tasync updateMetadata(): Promise<boolean> {\r\n\t\tconst playerPromise = this.metadata.update(this.currentStats.metadata!);\r\n\t\tconst petsPromise = this.petMetadatas.update(this.currentStats.pets.map(p => p.metadata!));\r\n\t\tconst playerUpdated = await playerPromise;\r\n\t\tconst petsUpdated = await petsPromise;\r\n\t\treturn playerUpdated || petsUpdated;\r\n\t}\r\n\r\n\tgetName(): string {\r\n\t\treturn this.name;\r\n\t}\r\n\tsetName(eventID: EventID, newName: string) {\r\n\t\tif (newName != this.name) {\r\n\t\t\tthis.name = newName;\r\n\t\t\tthis.nameChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetLabel(): string {\r\n\t\tif (this.party) {\r\n\t\t\treturn `${this.name} (#${this.getRaidIndex() + 1})`;\r\n\t\t} else {\r\n\t\t\treturn this.name;\r\n\t\t}\r\n\t}\r\n\r\n\tgetRace(): Race {\r\n\t\treturn this.race;\r\n\t}\r\n\tsetRace(eventID: EventID, newRace: Race) {\r\n\t\tif (newRace != this.race) {\r\n\t\t\tthis.race = newRace;\r\n\t\t\tthis.raceChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetProfession1(): Profession {\r\n\t\treturn this.profession1;\r\n\t}\r\n\tsetProfession1(eventID: EventID, newProfession: Profession) {\r\n\t\tif (newProfession != this.profession1) {\r\n\t\t\tthis.profession1 = newProfession;\r\n\t\t\tthis.professionChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\tgetProfession2(): Profession {\r\n\t\treturn this.profession2;\r\n\t}\r\n\tsetProfession2(eventID: EventID, newProfession: Profession) {\r\n\t\tif (newProfession != this.profession2) {\r\n\t\t\tthis.profession2 = newProfession;\r\n\t\t\tthis.professionChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\tgetProfessions(): Array<Profession> {\r\n\t\treturn [this.profession1, this.profession2].filter(p => p != Profession.ProfessionUnknown);\r\n\t}\r\n\tsetProfessions(eventID: EventID, newProfessions: Array<Profession>) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setProfession1(eventID, newProfessions[0] || Profession.ProfessionUnknown);\r\n\t\t\tthis.setProfession2(eventID, newProfessions[1] || Profession.ProfessionUnknown);\r\n\t\t});\r\n\t}\r\n\thasProfession(prof: Profession): boolean {\r\n\t\treturn this.getProfessions().includes(prof);\r\n\t}\r\n\tisBlacksmithing(): boolean {\r\n\t\treturn false; //this.hasProfession(Profession.Blacksmithing);\r\n\t}\r\n\r\n\tgetFaction(): Faction {\r\n\t\treturn raceToFaction[this.getRace()];\r\n\t}\r\n\r\n\tgetBuffs(): IndividualBuffs {\r\n\t\t// Make a defensive copy\r\n\t\treturn IndividualBuffs.clone(this.buffs);\r\n\t}\r\n\r\n\tsetBuffs(eventID: EventID, newBuffs: IndividualBuffs) {\r\n\t\tif (IndividualBuffs.equals(this.buffs, newBuffs))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.buffs = IndividualBuffs.clone(newBuffs);\r\n\t\tthis.buffsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetConsumes(): Consumes {\r\n\t\t// Make a defensive copy\r\n\t\treturn Consumes.clone(this.consumes);\r\n\t}\r\n\r\n\tsetConsumes(eventID: EventID, newConsumes: Consumes) {\r\n\t\tif (Consumes.equals(this.consumes, newConsumes))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.consumes = Consumes.clone(newConsumes);\r\n\t\tthis.consumesChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetCooldowns(): Cooldowns {\r\n\t\t// Make a defensive copy\r\n\t\tif (aplLaunchStatuses[this.spec] == LaunchStatus.Launched) {\r\n\t\t\treturn Cooldowns.clone(this.aplRotation.simple?.cooldowns || Cooldowns.create());\r\n\t\t} else {\r\n\t\t\treturn Cooldowns.clone(this.cooldowns);\r\n\t\t}\r\n\t}\r\n\r\n\tsetCooldowns(eventID: EventID, newCooldowns: Cooldowns) {\r\n\t\tif (Cooldowns.equals(this.getCooldowns(), newCooldowns))\r\n\t\t\treturn;\r\n\r\n\t\tif (aplLaunchStatuses[this.spec] == LaunchStatus.Launched) {\r\n\t\t\tif (!this.aplRotation.simple) {\r\n\t\t\t\tthis.aplRotation.simple = SimpleRotation.create();\r\n\t\t\t}\r\n\t\t\tthis.aplRotation.simple.cooldowns = newCooldowns;\r\n\t\t\tthis.rotationChangeEmitter.emit(eventID);\r\n\t\t} else {\r\n\t\t\t// Make a defensive copy\r\n\t\t\tthis.cooldowns = Cooldowns.clone(newCooldowns);\r\n\t\t}\r\n\r\n\t\tthis.cooldownsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tcanDualWield2H(): boolean {\r\n\t\treturn this.getClass() == Class.ClassWarrior && (this.getTalents() as SpecTalents<Spec.SpecWarrior>).titansGrip;\r\n\t}\r\n\r\n\tequipItem(eventID: EventID, slot: ItemSlot, newItem: EquippedItem | null) {\r\n\t\tthis.setGear(eventID, this.gear.withEquippedItem(slot, newItem, this.canDualWield2H()));\r\n\t}\r\n\r\n\tgetEquippedItem(slot: ItemSlot): EquippedItem | null {\r\n\t\treturn this.gear.getEquippedItem(slot);\r\n\t}\r\n\r\n\tgetGear(): Gear {\r\n\t\treturn this.gear;\r\n\t}\r\n\r\n\tgetItemSwapGear(): ItemSwapGear {\r\n\t\treturn this.itemSwapGear;\r\n\t}\r\n\r\n\tsetGear(eventID: EventID, newGear: Gear) {\r\n\t\tif (newGear.equals(this.gear))\r\n\t\t\treturn;\r\n\r\n\t\t// Commented for now because the UI for this is weird.\r\n\t\t//// If trinkets have changed and there were cooldowns assigned for those trinkets,\r\n\t\t//// try to match them up and switch to the new trinkets.\r\n\t\t//const newCooldowns = this.getCooldowns();\r\n\t\t//const oldTrinketIds = this.gear.getTrinkets().map(trinket => trinket?.asActionIdProto() || ActionIdProto.create());\r\n\t\t//const newTrinketIds = newGear.getTrinkets().map(trinket => trinket?.asActionIdProto() || ActionIdProto.create());\r\n\r\n\t\t//for (let i = 0; i < 2; i++) {\r\n\t\t//\tconst oldTrinketId = oldTrinketIds[i];\r\n\t\t//\tconst newTrinketId = newTrinketIds[i];\r\n\t\t//\tif (ActionIdProto.equals(oldTrinketId, ActionIdProto.create())) {\r\n\t\t//\t\tcontinue;\r\n\t\t//\t}\r\n\t\t//\tif (ActionIdProto.equals(newTrinketId, ActionIdProto.create())) {\r\n\t\t//\t\tcontinue;\r\n\t\t//\t}\r\n\t\t//\tif (ActionIdProto.equals(oldTrinketId, newTrinketId)) {\r\n\t\t//\t\tcontinue;\r\n\t\t//\t}\r\n\t\t//\tnewCooldowns.cooldowns.forEach(cd => {\r\n\t\t//\t\tif (ActionIdProto.equals(cd.id, oldTrinketId)) {\r\n\t\t//\t\t\tcd.id = newTrinketId;\r\n\t\t//\t\t}\r\n\t\t//\t});\r\n\t\t//}\r\n\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.gear = newGear;\r\n\t\t\tthis.gearChangeEmitter.emit(eventID);\r\n\t\t\t//this.setCooldowns(eventID, newCooldowns);\r\n\t\t});\r\n\t}\r\n\r\n\t/*\r\n\tsetBulkEquipmentSpec(eventID: EventID, newBulkEquipmentSpec: BulkEquipmentSpec) {\r\n\t\tif (BulkEquipmentSpec.equals(this.bulkEquipmentSpec, newBulkEquipmentSpec))\r\n\t\t\treturn;\r\n\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.bulkEquipmentSpec = newBulkEquipmentSpec;\r\n\t\t\tthis.bulkGearChangeEmitter.emit(eventID);\r\n\t\t});\r\n\t}\r\n\r\n\tgetBulkEquipmentSpec(): BulkEquipmentSpec {\r\n\t\treturn BulkEquipmentSpec.clone(this.bulkEquipmentSpec);\r\n\t}\r\n\t*/\r\n\r\n\tgetMeleeCritCapInfo(): MeleeCritCapInfo {\r\n\t\tconst meleeCrit = (this.currentStats.finalStats?.stats[Stat.StatMeleeCrit] || 0.0) / Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE;\r\n\t\tconst meleeHit = (this.currentStats.finalStats?.stats[Stat.StatMeleeHit] || 0.0) / Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE;\r\n\t\tconst expertise = (this.currentStats.finalStats?.stats[Stat.StatExpertise] || 0.0) / Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION / 4;\r\n\t\tconst agility = (this.currentStats.finalStats?.stats[Stat.StatAgility] || 0.0) / this.getClass();\r\n\t\tconst suppression = 4.8;\r\n\t\tconst glancing = 24.0;\r\n\r\n\t\tconst hasOffhandWeapon = this.getGear().getEquippedItem(ItemSlot.ItemSlotOffHand)?.item.weaponSpeed !== undefined;\r\n\t\tconst meleeHitCap = hasOffhandWeapon && this.spec != Spec.SpecWarrior ? 27.0 : 8.0;\r\n\t\tconst expertiseCap = this.getInFrontOfTarget() ? 20.5 : 6.5;\r\n\r\n\t\tconst remainingMeleeHitCap = Math.max(meleeHitCap - meleeHit, 0.0);\r\n\t\tconst remainingExpertiseCap = Math.max(expertiseCap - expertise, 0.0)\r\n\r\n\t\tlet specSpecificOffset = 0.0;\r\n\r\n\t\tif(this.spec === Spec.SpecEnhancementShaman) {\r\n\t\t\t// Elemental Devastation uptime is near 100%\r\n\t\t\tconst ranks = (this as Player<Spec.SpecEnhancementShaman>).getTalents().elementalDevastation;\r\n\t\t\tspecSpecificOffset = 3.0 * ranks;\r\n\t\t}\r\n\r\n\t\tlet debuffCrit = 0.0;\r\n\r\n\t\tconst debuffs = this.sim.raid.getDebuffs();\r\n\t\tif (debuffs.totemOfWrath || debuffs.heartOfTheCrusader || debuffs.masterPoisoner) {\r\n\t\t\tdebuffCrit = 3.0;\r\n\t\t}\r\n\r\n\t\tconst baseCritCap = 100.0 - glancing + suppression - remainingMeleeHitCap - remainingExpertiseCap - specSpecificOffset;\r\n\t\tconst playerCritCapDelta = meleeCrit - baseCritCap + debuffCrit;\r\n\r\n\t\treturn {\r\n\t\t\tmeleeCrit,\r\n\t\t\tmeleeHit,\r\n\t\t\texpertise,\r\n\t\t\tsuppression,\r\n\t\t\tglancing,\r\n\t\t\tdebuffCrit,\r\n\t\t\thasOffhandWeapon,\r\n\t\t\tmeleeHitCap,\r\n\t\t\texpertiseCap,\r\n\t\t\tremainingMeleeHitCap,\r\n\t\t\tremainingExpertiseCap,\r\n\t\t\tbaseCritCap,\r\n\t\t\tspecSpecificOffset,\r\n\t\t\tplayerCritCapDelta\r\n\t\t};\r\n\t}\r\n\r\n\tgetMeleeCritCap() {\r\n\t\treturn this.getMeleeCritCapInfo().playerCritCapDelta\r\n\t}\r\n\r\n\tgetBonusStats(): Stats {\r\n\t\treturn this.bonusStats;\r\n\t}\r\n\r\n\tsetBonusStats(eventID: EventID, newBonusStats: Stats) {\r\n\t\tif (newBonusStats.equals(this.bonusStats))\r\n\t\t\treturn;\r\n\r\n\t\tthis.bonusStats = newBonusStats;\r\n\t\tthis.bonusStatsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetRotation(): SpecRotation<SpecType> {\r\n\t\tif (aplLaunchStatuses[this.spec] == LaunchStatus.Launched) {\r\n\t\t\tconst jsonStr = this.aplRotation.simple?.specRotationJson || '';\r\n\t\t\tif (!jsonStr) {\r\n\t\t\t\treturn this.specTypeFunctions.rotationCreate();\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst json = JSON.parse(jsonStr);\r\n\t\t\t\treturn this.specTypeFunctions.rotationFromJson(json);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.warn(`Error parsing rotation spec options: ${e}\\n\\nSpec options: '${jsonStr}'`);\r\n\t\t\t\treturn this.specTypeFunctions.rotationCreate();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn this.specTypeFunctions.rotationCopy(this.rotation);\r\n\t\t}\r\n\t}\r\n\r\n\tsetRotation(eventID: EventID, newRotation: SpecRotation<SpecType>) {\r\n\t\tif (this.specTypeFunctions.rotationEquals(newRotation, this.getRotation()))\r\n\t\t\treturn;\r\n\r\n\t\tif (aplLaunchStatuses[this.spec] == LaunchStatus.Launched) {\r\n\t\t\tif (!this.aplRotation.simple) {\r\n\t\t\t\tthis.aplRotation.simple = SimpleRotation.create();\r\n\t\t\t}\r\n\t\t\tthis.aplRotation.simple.specRotationJson = JSON.stringify(this.specTypeFunctions.rotationToJson(newRotation));\r\n\t\t} else {\r\n\t\t\tthis.rotation = this.specTypeFunctions.rotationCopy(newRotation);\r\n\t\t}\r\n\r\n\t\tthis.rotationChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tsetAplRotation(eventID: EventID, newRotation: APLRotation) {\r\n\t\tif (APLRotation.equals(newRotation, this.aplRotation))\r\n\t\t\treturn;\r\n\r\n\t\tthis.aplRotation = APLRotation.clone(newRotation);\r\n\t\tthis.rotationChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetRotationType(): APLRotationType {\r\n\t\tif (this.aplRotation.enabled) {\r\n\t\t\treturn APLRotationType.TypeAPL;\r\n\t\t} else if (this.aplRotation.type == APLRotationType.TypeUnknown) {\r\n\t\t\treturn APLRotationType.TypeLegacy;\r\n\t\t} else {\r\n\t\t\treturn this.aplRotation.type;\r\n\t\t}\r\n\t}\r\n\r\n\tsetAutoRotationGenerator(generator: AutoRotationGenerator<SpecType>) {\r\n\t\tthis.autoRotationGenerator = generator;\r\n\t}\r\n\r\n\tsetSimpleRotationGenerator(generator: SimpleRotationGenerator<SpecType>) {\r\n\t\tthis.simpleRotationGenerator = generator;\r\n\t}\r\n\r\n\thasSimpleRotationGenerator(): boolean {\r\n\t\treturn this.simpleRotationGenerator != null;\r\n\t}\r\n\r\n\tgetResolvedAplRotation(): APLRotation {\r\n\t\tconst type = this.getRotationType();\r\n\t\tif (type == APLRotationType.TypeAuto && this.autoRotationGenerator) {\r\n\t\t\t// Clone to avoid modifying preset rotations, which are often returned directly.\r\n\t\t\treturn APLRotation.clone(this.autoRotationGenerator(this));\r\n\t\t} else if (type == APLRotationType.TypeSimple && this.simpleRotationGenerator) {\r\n\t\t\t// Clone to avoid modifying preset rotations, which are often returned directly.\r\n\t\t\tconst rot = APLRotation.clone(this.simpleRotationGenerator(this, this.getRotation(), this.getCooldowns()));\r\n\t\t\trot.type = APLRotationType.TypeAPL; // Set this here for convenience, so the generator functions don't need to.\r\n\t\t\treturn rot;\r\n\t\t} else {\r\n\t\t\treturn this.aplRotation;\r\n\t\t}\r\n\t}\r\n\r\n\tgetTalents(): SpecTalents<SpecType> {\r\n\t\tif (this.talents == null) {\r\n\t\t\tthis.talents = playerTalentStringToProto(this.spec, this.talentsString) as SpecTalents<SpecType>;\r\n\t\t}\r\n\t\treturn this.talents!;\r\n\t}\r\n\r\n\tgetTalentsString(): string {\r\n\t\treturn this.talentsString;\r\n\t}\r\n\r\n\tsetTalentsString(eventID: EventID, newTalentsString: string) {\r\n\t\tif (newTalentsString == this.talentsString)\r\n\t\t\treturn;\r\n\r\n\t\tthis.talentsString = newTalentsString;\r\n\t\tthis.talents = null;\r\n\t\tthis.talentsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetTalentTree(): number {\r\n\t\treturn getTalentTree(this.getTalentsString());\r\n\t}\r\n\r\n\tgetTalentTreePoints(): Array<number> {\r\n\t\treturn getTalentTreePoints(this.getTalentsString())\r\n\t}\r\n\r\n\tgetTalentTreeIcon(): string {\r\n\t\treturn getTalentTreeIcon(this.spec, this.getTalentsString());\r\n\t}\r\n\r\n\tgetGlyphs(): Glyphs {\r\n\t\t// Make a defensive copy\r\n\t\treturn Glyphs.clone(this.glyphs);\r\n\t}\r\n\r\n\tsetGlyphs(eventID: EventID, newGlyphs: Glyphs) {\r\n\t\tif (Glyphs.equals(this.glyphs, newGlyphs))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.glyphs = Glyphs.clone(newGlyphs);\r\n\t\tthis.glyphsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetMajorGlyphs(): Array<number> {\r\n\t\treturn [\r\n\t\t\tthis.glyphs.major1,\r\n\t\t\tthis.glyphs.major2,\r\n\t\t\tthis.glyphs.major3,\r\n\t\t].filter(glyph => glyph != 0);\r\n\t}\r\n\r\n\tgetMinorGlyphs(): Array<number> {\r\n\t\treturn [\r\n\t\t\tthis.glyphs.minor1,\r\n\t\t\tthis.glyphs.minor2,\r\n\t\t\tthis.glyphs.minor3,\r\n\t\t].filter(glyph => glyph != 0);\r\n\t}\r\n\r\n\tgetAllGlyphs(): Array<number> {\r\n\t\treturn this.getMajorGlyphs().concat(this.getMinorGlyphs());\r\n\t}\r\n\r\n\tgetSpecOptions(): SpecOptions<SpecType> {\r\n\t\treturn this.specTypeFunctions.optionsCopy(this.specOptions);\r\n\t}\r\n\r\n\tsetSpecOptions(eventID: EventID, newSpecOptions: SpecOptions<SpecType>) {\r\n\t\tif (this.specTypeFunctions.optionsEquals(newSpecOptions, this.specOptions))\r\n\t\t\treturn;\r\n\r\n\t\tthis.specOptions = this.specTypeFunctions.optionsCopy(newSpecOptions);\r\n\t\tthis.specOptionsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetReactionTime(): number {\r\n\t\treturn this.reactionTime;\r\n\t}\r\n\r\n\tsetReactionTime(eventID: EventID, newReactionTime: number) {\r\n\t\tif (newReactionTime == this.reactionTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis.reactionTime = newReactionTime;\r\n\t\tthis.miscOptionsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetChannelClipDelay(): number {\r\n\t\treturn this.reactionTime;\r\n\t}\r\n\r\n\tsetChannelClipDelay(eventID: EventID, newChannelClipDelay: number) {\r\n\t\tif (newChannelClipDelay == this.reactionTime)\r\n\t\t\treturn;\r\n\r\n\t\tthis.channelClipDelay = newChannelClipDelay;\r\n\t\tthis.miscOptionsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetInFrontOfTarget(): boolean {\r\n\t\treturn this.inFrontOfTarget;\r\n\t}\r\n\r\n\tsetInFrontOfTarget(eventID: EventID, newInFrontOfTarget: boolean) {\r\n\t\tif (newInFrontOfTarget == this.inFrontOfTarget)\r\n\t\t\treturn;\r\n\r\n\t\tthis.inFrontOfTarget = newInFrontOfTarget;\r\n\t\tthis.inFrontOfTargetChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetDistanceFromTarget(): number {\r\n\t\treturn this.distanceFromTarget;\r\n\t}\r\n\r\n\tsetDistanceFromTarget(eventID: EventID, newDistanceFromTarget: number) {\r\n\t\tif (newDistanceFromTarget == this.distanceFromTarget)\r\n\t\t\treturn;\r\n\r\n\t\tthis.distanceFromTarget = newDistanceFromTarget;\r\n\t\tthis.distanceFromTargetChangeEmitter.emit(eventID);\r\n\t}\r\n\tsetDefaultHealingParams(hm: HealingModel) {\r\n\t\tvar boss = this.sim.encounter.primaryTarget;\r\n\t\tvar dualWield = boss.dualWield;\r\n\t\tif (hm.cadenceSeconds == 0) {\r\n\t\t\thm.cadenceSeconds = 1.5 * boss.swingSpeed;\r\n\t\t\tif (dualWield) {\r\n\t\t\t\thm.cadenceSeconds /= 2;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hm.hps == 0) {\r\n\t\t\thm.hps = 0.175 * boss.minBaseDamage / boss.swingSpeed;\r\n\t\t\tif (dualWield) {\r\n\t\t\t\thm.hps *= 1.5;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tenableHealing() {\r\n\t\tthis.healingEnabled = true;\r\n\t\tvar hm = this.getHealingModel();\r\n\t\tif (hm.cadenceSeconds == 0 || hm.hps == 0) {\r\n\t\t\tthis.setDefaultHealingParams(hm)\r\n\t\t\tthis.setHealingModel(0, hm)\r\n\t\t}\r\n\t}\r\n\r\n\tgetHealingModel(): HealingModel {\r\n\t\t// Make a defensive copy\r\n\t\treturn HealingModel.clone(this.healingModel);\r\n\t}\r\n\r\n\tsetHealingModel(eventID: EventID, newHealingModel: HealingModel) {\r\n\t\tif (HealingModel.equals(this.healingModel, newHealingModel))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.healingModel = HealingModel.clone(newHealingModel);\r\n\t\t// If we have enabled healing model and try to set 0s cadence or 0 incoming HPS, then set intelligent defaults instead based on boss parameters.\r\n\t\tif (this.healingEnabled) {\r\n\t\t\tthis.setDefaultHealingParams(this.healingModel)\r\n\t\t}\r\n\t\tthis.healingModelChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tcomputeStatsEP(stats?: Stats): number {\r\n\t\tif (stats == undefined) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn stats.computeEP(this.epWeights);\r\n\t}\r\n\r\n\tcomputeGemEP(gem: Gem): number {\r\n\t\tif (this.gemEPCache.has(gem.id)) {\r\n\t\t\treturn this.gemEPCache.get(gem.id)!;\r\n\t\t}\r\n\r\n\t\tconst epFromStats = this.computeStatsEP(new Stats(gem.stats));\r\n\t\tconst epFromEffect = getMetaGemEffectEP(this.spec, gem, Stats.fromProto(this.currentStats.finalStats));\r\n\t\tlet bonusEP = 0;\r\n\t\t// unique items are slightly worse than non-unique because you can have only one.\r\n\t\tif (gem.unique) {\r\n\t\t\tbonusEP -= 0.01;\r\n\t\t}\r\n\r\n\t\tlet ep = epFromStats + epFromEffect + bonusEP;\r\n\t\tthis.gemEPCache.set(gem.id, ep);\r\n\t\treturn ep;\r\n\t}\r\n\r\n\tcomputeEnchantEP(enchant: Enchant): number {\r\n\t\tif (this.enchantEPCache.has(enchant.effectId)) {\r\n\t\t\treturn this.enchantEPCache.get(enchant.effectId)!;\r\n\t\t}\r\n\r\n\t\tlet ep = this.computeStatsEP(new Stats(enchant.stats));\r\n\t\tthis.enchantEPCache.set(enchant.effectId, ep);\r\n\t\treturn ep\r\n\t}\r\n\r\n\tcomputeItemEP(item: Item, slot: ItemSlot): number {\r\n\t\tif (item == null)\r\n\t\t\treturn 0;\r\n\r\n\t\tlet cached = this.itemEPCache[slot].get(item.id);\r\n\t\tif (cached !== undefined)\r\n\t\t\treturn cached;\r\n\r\n\t\tlet itemStats = new Stats(item.stats);\r\n\t\tif (item.weaponSpeed > 0) {\r\n\t\t\tconst weaponDps = getWeaponDPS(item);\r\n\t\t\tif (slot == ItemSlot.ItemSlotMainHand) {\r\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatMainHandDps, weaponDps);\r\n\t\t\t} else if (slot == ItemSlot.ItemSlotOffHand) {\r\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatOffHandDps, weaponDps);\r\n\t\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\r\n\t\t\t\titemStats = itemStats.withPseudoStat(PseudoStat.PseudoStatRangedDps, weaponDps);\r\n\t\t\t}\r\n\t\t}\r\n\r\n \t\tlet epWeight = Stats.fromJson(this.epWeights.toJson());\r\n\r\n\t\tif (this.isSpec(Spec.SpecFeralTankDruid) && item.armorType != ArmorType.ArmorTypeCloth && item.armorType != ArmorType.ArmorTypeLeather) {\r\n\t\t\tepWeight = epWeight.withStat(Stat.StatArmor, epWeight.getStat(Stat.StatArmor) / 6.87561);\r\n\t\t}\r\n\r\n\t\tlet ep = itemStats.computeEP(epWeight);\r\n\r\n\r\n\r\n\t\t// unique items are slightly worse than non-unique because you can have only one.\r\n\t\tif (item.unique) {\r\n\t\t\tep -= 0.01;\r\n\t\t}\r\n\r\n\t\t// Compare whether its better to match sockets + get socket bonus, or just use best gems.\r\n\t\tconst bestGemEPNotMatchingSockets = sum(item.gemSockets.map(socketColor => {\r\n\t\t\tconst gems = this.sim.db.getGems(socketColor).filter(gem => isUnrestrictedGem(gem, this.sim.getPhase()));\r\n\t\t\tif (gems.length > 0) {\r\n\t\t\t\treturn Math.max(...gems.map(gem => this.computeGemEP(gem)));\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tconst bestGemEPMatchingSockets = sum(item.gemSockets.map(socketColor => {\r\n\t\t\tconst gems = this.sim.db.getGems(socketColor).filter(gem => isUnrestrictedGem(gem, this.sim.getPhase()) && gemMatchesSocket(gem, socketColor));\r\n\t\t\tif (gems.length > 0) {\r\n\t\t\t\treturn Math.max(...gems.map(gem => this.computeGemEP(gem)));\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t})) + this.computeStatsEP(new Stats(item.socketBonus));\r\n\r\n\t\tep += Math.max(bestGemEPMatchingSockets, bestGemEPNotMatchingSockets);\r\n\r\n\t\tthis.itemEPCache[slot].set(item.id, ep);\r\n\t\treturn ep;\r\n\t}\r\n\r\n\tsetWowheadData(equippedItem: EquippedItem, elem: HTMLElement) {\r\n\t\tconst parts = [];\r\n\r\n\t\tconst lang = getLanguageCode();\r\n\t\tconst langPrefix = lang ? lang + '.' : '';\r\n\t\tparts.push(`domain=${langPrefix}wotlk`);\r\n\r\n\t\tconst isBlacksmithing = this.hasProfession(Profession.Blacksmithing);\r\n\t\tif (equippedItem.gems.length > 0) {\r\n\t\t\tparts.push('gems=' + equippedItem.curGems(isBlacksmithing).map(gem => gem ? gem.id : 0).join(':'));\r\n\t\t}\r\n\t\tif (equippedItem.enchant != null) {\r\n\t\t\tparts.push('ench=' + equippedItem.enchant.effectId);\r\n\t\t}\r\n\t\tparts.push('pcs=' + this.gear.asArray().filter(ei => ei != null).map(ei => ei!.item.id).join(':'));\r\n\r\n\t\tif (equippedItem.hasExtraSocket(isBlacksmithing)) {\r\n\t\t\tparts.push('sock');\r\n\t\t}\r\n\r\n\t\telem.dataset.wowhead = parts.join('&');\r\n\t\telem.dataset.whtticon = 'false';\r\n\t}\r\n\r\n\tstatic ARMOR_SLOTS: Array<ItemSlot> = [\r\n\t\tItemSlot.ItemSlotHead,\r\n\t\tItemSlot.ItemSlotShoulder,\r\n\t\tItemSlot.ItemSlotChest,\r\n\t\tItemSlot.ItemSlotWrist,\r\n\t\tItemSlot.ItemSlotHands,\r\n\t\tItemSlot.ItemSlotLegs,\r\n\t\tItemSlot.ItemSlotWaist,\r\n\t\tItemSlot.ItemSlotFeet,\r\n\t];\r\n\r\n\tstatic WEAPON_SLOTS: Array<ItemSlot> = [\r\n\t\tItemSlot.ItemSlotMainHand,\r\n\t\tItemSlot.ItemSlotOffHand,\r\n\t];\r\n\r\n\tstatic readonly DIFFICULTY_SRCS: Partial<Record<SourceFilterOption, DungeonDifficulty>> = {\r\n\t\t[SourceFilterOption.SourceDungeon]: DungeonDifficulty.DifficultyNormal,\r\n\t\t[SourceFilterOption.SourceDungeonH]: DungeonDifficulty.DifficultyHeroic,\r\n\t\t[SourceFilterOption.SourceRaid10]: DungeonDifficulty.DifficultyRaid10,\r\n\t\t[SourceFilterOption.SourceRaid10H]: DungeonDifficulty.DifficultyRaid10H,\r\n\t\t[SourceFilterOption.SourceRaid25]: DungeonDifficulty.DifficultyRaid25,\r\n\t\t[SourceFilterOption.SourceRaid25H]: DungeonDifficulty.DifficultyRaid25H,\r\n\t};\r\n\r\n\tstatic readonly HEROIC_TO_NORMAL: Partial<Record<DungeonDifficulty, DungeonDifficulty>> = {\r\n\t\t[DungeonDifficulty.DifficultyHeroic]: DungeonDifficulty.DifficultyNormal,\r\n\t\t[DungeonDifficulty.DifficultyRaid10H]: DungeonDifficulty.DifficultyRaid10,\r\n\t\t[DungeonDifficulty.DifficultyRaid25H]: DungeonDifficulty.DifficultyRaid25,\r\n\t};\r\n\r\n\tstatic readonly RAID_IDS: Partial<Record<RaidFilterOption, number>> = {\r\n\t\t[RaidFilterOption.RaidKarazhan]: 3457,\r\n\t\t[RaidFilterOption.RaidGruul]: 3923,\r\n\t\t[RaidFilterOption.RaidMagtheridon]: 3836,\r\n\t\t[RaidFilterOption.RaidSerpentshrineCavern]: 3607,\r\n\t\t[RaidFilterOption.RaidTempestKeep]: 3845,\r\n\t\t[RaidFilterOption.RaidMountHyjal]: 3606,\r\n\t\t[RaidFilterOption.RaidBlackTemple]: 3959,\r\n\t\t[RaidFilterOption.RaidZulAman]: 3805,\r\n\t\t[RaidFilterOption.RaidSunwellPlateau]: 4075,\r\n\t};\r\n\r\n\tfilterItemData<T>(itemData: Array<T>, getItemFunc: (val: T) => Item, slot: ItemSlot): Array<T> {\r\n\t\tconst filters = this.sim.getFilters();\r\n\r\n\t\tconst filterItems = (itemData: Array<T>, filterFunc: (item: Item) => boolean) => {\r\n\t\t\treturn itemData.filter(itemElem => filterFunc(getItemFunc(itemElem)));\r\n\t\t};\r\n\r\n\t\tif (filters.factionRestriction != UIItem_FactionRestriction.UNSPECIFIED) {\r\n\t\t\titemData = filterItems(itemData, item => item.factionRestriction == filters.factionRestriction || item.factionRestriction == UIItem_FactionRestriction.UNSPECIFIED);\r\n\t\t}\r\n\r\n\t\tif (!filters.sources.includes(SourceFilterOption.SourceCrafting)) {\r\n\t\t\titemData = filterItems(itemData, item => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'crafted'));\r\n\t\t}\r\n\t\tif (!filters.sources.includes(SourceFilterOption.SourceQuest)) {\r\n\t\t\titemData = filterItems(itemData, item => !item.sources.some(itemSrc => itemSrc.source.oneofKind == 'quest'));\r\n\t\t}\r\n\r\n\t\tfor (const [srcOptionStr, difficulty] of Object.entries(Player.DIFFICULTY_SRCS)) {\r\n\t\t\tconst srcOption = parseInt(srcOptionStr) as SourceFilterOption;\r\n\t\t\tif (!filters.sources.includes(srcOption)) {\r\n\t\t\t\titemData = filterItems(itemData, item =>\r\n\t\t\t\t\t!item.sources.some(itemSrc =>\r\n\t\t\t\t\t\titemSrc.source.oneofKind == 'drop' && itemSrc.source.drop.difficulty == difficulty));\r\n\r\n\t\t\t\tif (difficulty == DungeonDifficulty.DifficultyRaid10H || difficulty == DungeonDifficulty.DifficultyRaid25H) {\r\n\t\t\t\t\tconst normalDifficulty = Player.HEROIC_TO_NORMAL[difficulty];\r\n\t\t\t\t\titemData = filterItems(itemData, item =>\r\n\t\t\t\t\t\t!item.sources.some(itemSrc =>\r\n\t\t\t\t\t\t\titemSrc.source.oneofKind == 'drop' && itemSrc.source.drop.difficulty == normalDifficulty && itemSrc.source.drop.category == AL_CATEGORY_HARD_MODE));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!filters.raids.includes(RaidFilterOption.RaidVanilla)) {\r\n\t\t\titemData = filterItems(itemData, item => item.expansion != Expansion.ExpansionVanilla);\r\n\t\t}\r\n\t\t// if (!filters.raids.includes(RaidFilterOption.RaidTbc)) {\r\n\t\t// \titemData = filterItems(itemData, item => item.expansion != Expansion.ExpansionTbc);\r\n\t\t// }\r\n\t\tfor (const [raidOptionStr, zoneId] of Object.entries(Player.RAID_IDS)) {\r\n\t\t\tconst raidOption = parseInt(raidOptionStr) as RaidFilterOption;\r\n\t\t\tif (!filters.raids.includes(raidOption)) {\r\n\t\t\t\titemData = filterItems(itemData, item =>\r\n\t\t\t\t\t!item.sources.some(itemSrc =>\r\n\t\t\t\t\t\titemSrc.source.oneofKind == 'drop' && itemSrc.source.drop.zoneId == zoneId));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (Player.ARMOR_SLOTS.includes(slot)) {\r\n\t\t\titemData = filterItems(itemData, item => {\r\n\t\t\t\tif (!filters.armorTypes.includes(item.armorType)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t} else if (Player.WEAPON_SLOTS.includes(slot)) {\r\n\t\t\titemData = filterItems(itemData, item => {\r\n\t\t\t\tif (!filters.weaponTypes.includes(item.weaponType)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!filters.oneHandedWeapons && item.handType != HandType.HandTypeTwoHand) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (!filters.twoHandedWeapons && item.handType == HandType.HandTypeTwoHand) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst minSpeed = slot == ItemSlot.ItemSlotMainHand ? filters.minMhWeaponSpeed : filters.minOhWeaponSpeed;\r\n\t\t\t\tconst maxSpeed = slot == ItemSlot.ItemSlotMainHand ? filters.maxMhWeaponSpeed : filters.maxOhWeaponSpeed;\r\n\t\t\t\tif (minSpeed > 0 && item.weaponSpeed < minSpeed) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (maxSpeed > 0 && item.weaponSpeed > maxSpeed) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\r\n\t\t\titemData = filterItems(itemData, item => {\r\n\t\t\t\tif (!filters.rangedWeaponTypes.includes(item.rangedWeaponType)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst minSpeed = filters.minRangedWeaponSpeed;\r\n\t\t\t\tconst maxSpeed = filters.maxRangedWeaponSpeed;\r\n\t\t\t\tif (minSpeed > 0 && item.weaponSpeed < minSpeed) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (maxSpeed > 0 && item.weaponSpeed > maxSpeed) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn itemData;\r\n\t}\r\n\r\n\tfilterEnchantData<T>(enchantData: Array<T>, getEnchantFunc: (val: T) => Enchant, slot: ItemSlot, currentEquippedItem: EquippedItem | null): Array<T> {\r\n\t\tif (!currentEquippedItem) {\r\n\t\t\treturn enchantData;\r\n\t\t}\r\n\r\n\t\t//const filters = this.sim.getFilters();\r\n\r\n\t\treturn enchantData.filter(enchantElem => {\r\n\t\t\tconst enchant = getEnchantFunc(enchantElem);\r\n\r\n\t\t\tif (!enchantAppliesToItem(enchant, currentEquippedItem.item)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tfilterGemData<T>(gemData: Array<T>, getGemFunc: (val: T) => Gem, slot: ItemSlot, socketColor: GemColor): Array<T> {\r\n\t\tconst filters = this.sim.getFilters();\r\n\r\n\t\treturn gemData.filter(gemElem => {\r\n\t\t\tconst gem = getGemFunc(gemElem);\r\n\r\n\t\t\tif (filters.matchingGemsOnly && !gemMatchesSocket(gem, socketColor)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tmakeUnitReference(): UnitReference {\r\n\t\tif (this.party == null) {\r\n\t\t\treturn emptyUnitReference();\r\n\t\t} else {\r\n\t\t\treturn newUnitReference(this.getRaidIndex());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate toDatabase(): SimDatabase {\r\n\t\tconst dbGear = this.getGear().toDatabase()\r\n\t\tconst dbItemSwapGear = this.getItemSwapGear().toDatabase();\r\n\t\treturn SimDatabase.create({\r\n\t\t\titems: dbGear.items.concat(dbItemSwapGear.items).filter(function(elem, index, self) {\r\n\t\t\t\treturn index === self.findIndex((t) => (\r\n\t\t\t\t\tt.id === elem.id\r\n\t\t\t\t));\r\n\t\t\t}),\r\n\t\t\tenchants: dbGear.enchants.concat(dbItemSwapGear.enchants).filter(function(elem, index, self) {\r\n\t\t\t\treturn index === self.findIndex((t) => (\r\n\t\t\t\t\tt.effectId === elem.effectId\r\n\t\t\t\t));\r\n\t\t\t}),\r\n\t\t\tgems: dbGear.gems.concat(dbItemSwapGear.gems).filter(function(elem, index, self) {\r\n\t\t\t\treturn index === self.findIndex((t) => (\r\n\t\t\t\t\tt.id === elem.id\r\n\t\t\t\t));\r\n\t\t\t}),\r\n\t\t})\r\n\t}\r\n\r\n\ttoProto(forExport?: boolean, forSimming?: boolean): PlayerProto {\r\n\t\tconst aplIsLaunched = aplLaunchStatuses[this.spec] == LaunchStatus.Launched;\r\n\t\tconst gear = this.getGear();\r\n\t\treturn withSpecProto(\r\n\t\t\tthis.spec,\r\n\t\t\tPlayerProto.create({\r\n\t\t\t\tname: this.getName(),\r\n\t\t\t\trace: this.getRace(),\r\n\t\t\t\tclass: this.getClass(),\r\n\t\t\t\tshattFaction: this.getShattFaction(),\r\n\t\t\t\tequipment: gear.asSpec(),\r\n\t\t\t\tconsumes: this.getConsumes(),\r\n\t\t\t\tbonusStats: this.getBonusStats().toProto(),\r\n\t\t\t\tbuffs: this.getBuffs(),\r\n\t\t\t\tcooldowns: aplIsLaunched ? Cooldowns.create({ hpPercentForDefensives: this.getCooldowns().hpPercentForDefensives }) : this.getCooldowns(),\r\n\t\t\t\ttalentsString: this.getTalentsString(),\r\n\t\t\t\tglyphs: this.getGlyphs(),\r\n\t\t\t\trotation: forSimming ? this.getResolvedAplRotation() : this.aplRotation,\r\n\t\t\t\tprofession1: this.getProfession1(),\r\n\t\t\t\tprofession2: this.getProfession2(),\r\n\t\t\t\treactionTimeMs: this.getReactionTime(),\r\n\t\t\t\tchannelClipDelayMs: this.getChannelClipDelay(),\r\n\t\t\t\tinFrontOfTarget: this.getInFrontOfTarget(),\r\n\t\t\t\tdistanceFromTarget: this.getDistanceFromTarget(),\r\n\t\t\t\thealingModel: this.getHealingModel(),\r\n\t\t\t\tdatabase: forExport ? SimDatabase.create() : this.toDatabase(),\r\n\t\t\t}),\r\n\t\t\taplIsLaunched ? this.specTypeFunctions.rotationCreate() : this.getRotation(),\r\n\t\t\tthis.getSpecOptions());\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, proto: PlayerProto) {\r\n\t\tif (proto.rotation) {\r\n\t\t\tproto.rotation.prepullActions.forEach(ppa => {\r\n\t\t\t\tif (ppa.doAt) {\r\n\t\t\t\t\tppa.doAtValue = APLValue.create({\r\n\t\t\t\t\t\tvalue: {oneofKind: 'const', const: { val: ppa.doAt }}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tppa.doAt = '';\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (proto.rotation.enabled) {\r\n\t\t\t\tproto.rotation.enabled = false;\r\n\t\t\t\tproto.rotation.type = APLRotationType.TypeAPL;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (aplLaunchStatuses[this.spec] == LaunchStatus.Launched) {\r\n\t\t\tconst rot = this.specTypeFunctions.rotationFromPlayer(proto);\r\n\t\t\tif (rot && !this.specTypeFunctions.rotationEquals(rot, this.specTypeFunctions.rotationCreate())) {\r\n\t\t\t\tif (proto.rotation?.type == APLRotationType.TypeAPL) {\r\n\t\t\t\t\t// Do nothing\r\n\t\t\t\t} else if (this.simpleRotationGenerator) {\r\n\t\t\t\t\tproto.rotation = APLRotation.create({\r\n\t\t\t\t\t\ttype: APLRotationType.TypeSimple,\r\n\t\t\t\t\t\tsimple: {\r\n\t\t\t\t\t\t\tspecRotationJson: JSON.stringify(this.specTypeFunctions.rotationToJson(rot)),\r\n\t\t\t\t\t\t\tcooldowns: proto.cooldowns,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tproto.rotation = APLRotation.create({\r\n\t\t\t\t\t\ttype: APLRotationType.TypeAuto,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setName(eventID, proto.name);\r\n\t\t\tthis.setRace(eventID, proto.race);\r\n\t\t\tthis.setGear(eventID, proto.equipment ? this.sim.db.lookupEquipmentSpec(proto.equipment) : new Gear({}));\r\n\t\t\t//this.setBulkEquipmentSpec(eventID, BulkEquipmentSpec.create()); // Do not persist the bulk equipment settings.\r\n\t\t\tthis.setConsumes(eventID, proto.consumes || Consumes.create());\r\n\t\t\tthis.setBonusStats(eventID, Stats.fromProto(proto.bonusStats || UnitStats.create()));\r\n\t\t\tthis.setBuffs(eventID, proto.buffs || IndividualBuffs.create());\r\n\t\t\tthis.setTalentsString(eventID, proto.talentsString);\r\n\t\t\tthis.setGlyphs(eventID, proto.glyphs || Glyphs.create());\r\n\t\t\tthis.setProfession1(eventID, proto.profession1);\r\n\t\t\tthis.setProfession2(eventID, proto.profession2);\r\n\t\t\tthis.setReactionTime(eventID, proto.reactionTimeMs);\r\n\t\t\tthis.setChannelClipDelay(eventID, proto.channelClipDelayMs);\r\n\t\t\tthis.setInFrontOfTarget(eventID, proto.inFrontOfTarget);\r\n\t\t\tthis.setDistanceFromTarget(eventID, proto.distanceFromTarget);\r\n\t\t\tthis.setHealingModel(eventID, proto.healingModel || HealingModel.create());\r\n\t\t\tif (aplLaunchStatuses[this.spec] != LaunchStatus.Launched) {\r\n\t\t\t\tthis.setCooldowns(eventID, proto.cooldowns || Cooldowns.create());\r\n\t\t\t\tthis.setRotation(eventID, this.specTypeFunctions.rotationFromPlayer(proto));\r\n\t\t\t}\r\n\t\t\tthis.setAplRotation(eventID, proto.rotation || APLRotation.create())\r\n\t\t\tthis.setSpecOptions(eventID, this.specTypeFunctions.optionsFromPlayer(proto));\r\n\r\n\t\t\tthis.aplRotation = proto.rotation || APLRotation.create();\r\n\t\t\tthis.rotationChangeEmitter.emit(eventID);\r\n\r\n\t\t\tconst options = this.getSpecOptions();\r\n\t\t\tfor (let key in options) {\r\n\t\t\t\tif ((options[key] as any)?.['targetIndex']) {\r\n\t\t\t\t\tconst targetIndex = (options[key] as any)['targetIndex'] as number;\r\n\t\t\t\t\tif (targetIndex == -1) {\r\n\t\t\t\t\t\t(options[key] as any) = UnitReference.create();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t(options[key] as any) = UnitReference.create({type: UnitReference_Type.Player, index: targetIndex});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setSpecOptions(eventID, options);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.spec == Spec.SpecHunter) {\r\n\t\t\t\tconst rot = this.getRotation() as SpecRotation<Spec.SpecHunter>;\r\n\t\t\t\tif (rot.timeToTrapWeaveMs) {\r\n\t\t\t\t\tconst options = this.getSpecOptions() as SpecOptions<Spec.SpecHunter>;\r\n\t\t\t\t\toptions.timeToTrapWeaveMs = rot.timeToTrapWeaveMs;\r\n\t\t\t\t\tthis.setSpecOptions(eventID, options as SpecOptions<SpecType>);\r\n\t\t\t\t\trot.timeToTrapWeaveMs = 0;\r\n\t\t\t\t\tthis.setRotation(eventID, rot as SpecRotation<SpecType>);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.spec == Spec.SpecShadowPriest) {\r\n\t\t\t\tconst options = this.getSpecOptions() as SpecOptions<Spec.SpecShadowPriest>;\r\n\t\t\t\tif (options.latency) {\r\n\t\t\t\t\tthis.setChannelClipDelay(eventID, options.latency);\r\n\t\t\t\t\toptions.latency = 0;\r\n\t\t\t\t\tthis.setSpecOptions(eventID, options as SpecOptions<SpecType>)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ([Spec.SpecEnhancementShaman, Spec.SpecRestorationShaman, Spec.SpecElementalShaman].includes(this.spec)) {\r\n\t\t\t\tconst rot = this.getRotation() as SpecRotation<ShamanSpecs>;\r\n\t\t\t\tif (rot.totems) {\r\n\t\t\t\t\tconst options = this.getSpecOptions() as SpecOptions<ShamanSpecs>;\r\n\t\t\t\t\toptions.totems = rot.totems;\r\n\t\t\t\t\tthis.setSpecOptions(eventID, options as SpecOptions<SpecType>);\r\n\t\t\t\t\trot.totems = undefined;\r\n\t\t\t\t\tthis.setRotation(eventID, rot as SpecRotation<SpecType>);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tclone(eventID: EventID): Player<SpecType> {\r\n\t\tconst newPlayer = new Player<SpecType>(this.spec, this.sim);\r\n\t\tnewPlayer.fromProto(eventID, this.toProto());\r\n\t\treturn newPlayer;\r\n\t}\r\n\r\n\tapplySharedDefaults(eventID: EventID) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setReactionTime(eventID, 200);\r\n\t\t\tthis.setChannelClipDelay(eventID, this.spec == Spec.SpecShadowPriest ? 100 : 0);\r\n\t\t\tthis.setInFrontOfTarget(eventID, isTankSpec(this.spec));\r\n\t\t\tthis.setHealingModel(eventID, HealingModel.create({\r\n\t\t\t\tburstWindow: isTankSpec(this.spec) ? 6 : 0,\r\n\t\t\t}));\r\n\t\t\tthis.setCooldowns(eventID, Cooldowns.create({\r\n\t\t\t\thpPercentForDefensives: isTankSpec(this.spec) ? 0.35 : 0,\r\n\t\t\t}));\r\n\t\t\tthis.setBonusStats(eventID, new Stats());\r\n\r\n\t\t\tif (aplLaunchStatuses[this.spec] >= LaunchStatus.Beta) {\r\n\t\t\t\tthis.setAplRotation(eventID, APLRotation.create({\r\n\t\t\t\t\ttype: APLRotationType.TypeAuto,\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import {\r\n\tEncounter as EncounterProto,\r\n\tMobType,\r\n\tSpellSchool,\r\n\tStat,\r\n\tTarget as TargetProto,\r\n\tTargetInput,\r\n\tPresetEncounter,\r\n\tPresetTarget,\r\n} from './proto/common.js';\r\nimport { Stats } from './proto_utils/stats.js';\r\nimport * as Mechanics from './constants/mechanics.js';\r\n\r\nimport { Sim } from './sim.js';\r\nimport { UnitMetadataList } from './player.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\n\r\n// Manages all the settings for an Encounter.\r\nexport class Encounter {\r\n\treadonly sim: Sim;\r\n\r\n\tprivate duration: number = 180;\r\n\tprivate durationVariation: number = 5;\r\n\tprivate executeProportion20: number = 0.2;\r\n\tprivate executeProportion25: number = 0.25;\r\n\tprivate executeProportion35: number = 0.35;\r\n\tprivate useHealth: boolean = false;\r\n\ttargets: Array<TargetProto>;\r\n\ttargetsMetadata: UnitMetadataList;\r\n\r\n\treadonly targetsChangeEmitter = new TypedEvent<void>();\r\n\treadonly durationChangeEmitter = new TypedEvent<void>();\r\n\treadonly executeProportionChangeEmitter = new TypedEvent<void>();\r\n\r\n\t// Emits when any of the above emitters emit.\r\n\treadonly changeEmitter = new TypedEvent<void>();\r\n\r\n\tconstructor(sim: Sim) {\r\n\t\tthis.sim = sim;\r\n\t\tthis.targets = [Encounter.defaultTargetProto()];\r\n\t\tthis.targetsMetadata = new UnitMetadataList();\r\n\r\n\t\t[\r\n\t\t\tthis.targetsChangeEmitter,\r\n\t\t\tthis.durationChangeEmitter,\r\n\t\t\tthis.executeProportionChangeEmitter,\r\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\r\n\t}\r\n\r\n\tget primaryTarget(): TargetProto {\r\n\t\treturn TargetProto.clone(this.targets[0]);\r\n\t}\r\n\r\n\tgetDurationVariation(): number {\r\n\t\treturn this.durationVariation;\r\n\t}\r\n\tsetDurationVariation(eventID: EventID, newDuration: number) {\r\n\t\tif (newDuration == this.durationVariation)\r\n\t\t\treturn;\r\n\r\n\t\tthis.durationVariation = newDuration;\r\n\t\tthis.durationChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetDuration(): number {\r\n\t\treturn this.duration;\r\n\t}\r\n\tsetDuration(eventID: EventID, newDuration: number) {\r\n\t\tif (newDuration == this.duration)\r\n\t\t\treturn;\r\n\r\n\t\tthis.duration = newDuration;\r\n\t\tthis.durationChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetExecuteProportion20(): number {\r\n\t\treturn this.executeProportion20;\r\n\t}\r\n\tsetExecuteProportion20(eventID: EventID, newExecuteProportion20: number) {\r\n\t\tif (newExecuteProportion20 == this.executeProportion20)\r\n\t\t\treturn;\r\n\r\n\t\tthis.executeProportion20 = newExecuteProportion20;\r\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\r\n\t}\r\n\tgetExecuteProportion25(): number {\r\n\t\treturn this.executeProportion25;\r\n\t}\r\n\tsetExecuteProportion25(eventID: EventID, newExecuteProportion25: number) {\r\n\t\tif (newExecuteProportion25 == this.executeProportion25)\r\n\t\t\treturn;\r\n\r\n\t\tthis.executeProportion25 = newExecuteProportion25;\r\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\r\n\t}\r\n\tgetExecuteProportion35(): number {\r\n\t\treturn this.executeProportion35;\r\n\t}\r\n\tsetExecuteProportion35(eventID: EventID, newExecuteProportion35: number) {\r\n\t\tif (newExecuteProportion35 == this.executeProportion35)\r\n\t\t\treturn;\r\n\r\n\t\tthis.executeProportion35 = newExecuteProportion35;\r\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetUseHealth(): boolean {\r\n\t\treturn this.useHealth;\r\n\t}\r\n\tsetUseHealth(eventID: EventID, newUseHealth: boolean) {\r\n\t\tif (newUseHealth == this.useHealth)\r\n\t\t\treturn;\r\n\r\n\t\tthis.useHealth = newUseHealth;\r\n\t\tthis.durationChangeEmitter.emit(eventID);\r\n\t\tthis.executeProportionChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tmatchesPreset(preset: PresetEncounter): boolean {\r\n\t\treturn preset.targets.length == this.targets.length && this.targets.every((t, i) => TargetProto.equals(t, preset.targets[i].target));\r\n\t}\r\n\r\n\tapplyPreset(eventID: EventID, preset: PresetEncounter) {\r\n\t\tthis.targets = preset.targets.map(presetTarget => presetTarget.target || TargetProto.create());\r\n\t\tthis.targetsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tapplyPresetTarget(eventID: EventID, preset: PresetTarget, index: number) {\r\n\t\tthis.targets[index] = preset.target || TargetProto.create();\r\n\t\tthis.targetsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\ttoProto(): EncounterProto {\r\n\t\treturn EncounterProto.create({\r\n\t\t\tduration: this.duration,\r\n\t\t\tdurationVariation: this.durationVariation,\r\n\t\t\texecuteProportion20: this.executeProportion20,\r\n\t\t\texecuteProportion25: this.executeProportion25,\r\n\t\t\texecuteProportion35: this.executeProportion35,\r\n\t\t\tuseHealth: this.useHealth,\r\n\t\t\ttargets: this.targets,\r\n\t\t});\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, proto: EncounterProto) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setDuration(eventID, proto.duration);\r\n\t\t\tthis.setDurationVariation(eventID, proto.durationVariation);\r\n\t\t\tthis.setExecuteProportion20(eventID, proto.executeProportion20);\r\n\t\t\tthis.setExecuteProportion25(eventID, proto.executeProportion25);\r\n\t\t\tthis.setExecuteProportion35(eventID, proto.executeProportion35);\r\n\t\t\tthis.setUseHealth(eventID, proto.useHealth);\r\n\t\t\tthis.targets = proto.targets;\r\n\t\t\tthis.targetsChangeEmitter.emit(eventID);\r\n\t\t});\r\n\t}\r\n\r\n\tapplyDefaults(eventID: EventID) {\r\n\t\tthis.fromProto(eventID, EncounterProto.create({\r\n\t\t\tduration: 180,\r\n\t\t\tdurationVariation: 5,\r\n\t\t\texecuteProportion20: 0.2,\r\n\t\t\texecuteProportion25: 0.25,\r\n\t\t\texecuteProportion35: 0.35,\r\n\t\t\ttargets: [Encounter.defaultTargetProto()],\r\n\t\t}));\r\n\t}\r\n\r\n\tstatic defaultTargetProto(): TargetProto {\r\n\t\treturn TargetProto.create({\r\n\t\t\tlevel: Mechanics.BOSS_LEVEL,\r\n\t\t\tmobType: MobType.MobTypeGiant,\r\n\t\t\ttankIndex: 0,\r\n\t\t\tswingSpeed: 1.5,\r\n\t\t\tminBaseDamage: 65000,\r\n\t\t\tdualWield: false,\r\n\t\t\tdualWieldPenalty: false,\r\n\t\t\tsuppressDodge: false,\r\n\t\t\tparryHaste: true,\r\n\t\t\tspellSchool: SpellSchool.SpellSchoolPhysical,\r\n\t\t\tstats: Stats.fromMap({\r\n\t\t\t\t[Stat.StatArmor]: 6300,\r\n\t\t\t\t[Stat.StatAttackPower]: 805,\r\n\t\t\t\t[Stat.StatBlockValue]: 76,\r\n\t\t\t}).asArray(),\r\n\t\t\ttargetInputs: new Array<TargetInput>(0),\r\n\t\t});\r\n\t}\r\n}\r\n","import {\r\n\tClass,\r\n\tDebuffs,\r\n\tRaidBuffs,\r\n\tUnitReference,\r\n\tUnitReference_Type as UnitType,\r\n} from './proto/common.js';\r\nimport { Raid as RaidProto } from './proto/api.js';\r\n\r\nimport { Party, MAX_PARTY_SIZE } from './party.js';\r\nimport { Player } from './player.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\nimport { Sim } from './sim.js';\r\nimport { sum } from './utils.js';\r\n\r\nexport const MAX_NUM_PARTIES = 8;\r\n\r\n// Manages all the settings for a single Raid.\r\nexport class Raid {\r\n\tprivate buffs: RaidBuffs = RaidBuffs.create();\r\n\tprivate debuffs: Debuffs = Debuffs.create();\r\n\tprivate tanks: Array<UnitReference> = [];\r\n\tprivate targetDummies: number = 0;\r\n\tprivate numActiveParties: number = 5;\r\n\r\n\t// Emits when a raid member is added/removed/moved.\r\n\treadonly compChangeEmitter = new TypedEvent<void>();\r\n\r\n\treadonly buffsChangeEmitter = new TypedEvent<void>();\r\n\treadonly debuffsChangeEmitter = new TypedEvent<void>();\r\n\treadonly tanksChangeEmitter = new TypedEvent<void>();\r\n\treadonly targetDummiesChangeEmitter = new TypedEvent<void>();\r\n\treadonly numActivePartiesChangeEmitter = new TypedEvent<void>();\r\n\r\n\t// Emits when anything in the raid changes.\r\n\treadonly changeEmitter: TypedEvent<void>;\r\n\r\n\t// Should always hold exactly MAX_NUM_PARTIES elements.\r\n\tprivate parties: Array<Party>;\r\n\r\n\t// Cached return value for getActivePlayers().\r\n\tprivate activePlayers: Array<Player<any>>;\r\n\r\n\treadonly sim: Sim;\r\n\r\n\tconstructor(sim: Sim) {\r\n\t\tthis.sim = sim;\r\n\r\n\t\tthis.parties = [...Array(MAX_NUM_PARTIES).keys()].map(i => {\r\n\t\t\tconst newParty = new Party(this, sim);\r\n\t\t\tnewParty.compChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\r\n\t\t\tnewParty.changeEmitter.on(eventID => this.changeEmitter.emit(eventID));\r\n\t\t\treturn newParty;\r\n\t\t});\r\n\t\tthis.activePlayers = [];\r\n\r\n\t\tthis.numActivePartiesChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\r\n\r\n\t\tthis.changeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.compChangeEmitter,\r\n\t\t\tthis.buffsChangeEmitter,\r\n\t\t\tthis.debuffsChangeEmitter,\r\n\t\t\tthis.tanksChangeEmitter,\r\n\t\t\tthis.targetDummiesChangeEmitter,\r\n\t\t], 'RaidChange');\r\n\r\n\t\tthis.changeEmitter.on(() => {\r\n\t\t\tthis.activePlayers = [];\r\n\t\t});\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn sum(this.parties.map(party => party.size()));\r\n\t}\r\n\r\n\tisEmpty(): boolean {\r\n\t\treturn this.size() == 0;\r\n\t}\r\n\r\n\tgetParties(): Array<Party> {\r\n\t\t// Make defensive copy.\r\n\t\treturn this.parties.slice();\r\n\t}\r\n\r\n\tgetParty(index: number): Party {\r\n\t\treturn this.parties[index];\r\n\t}\r\n\r\n\tgetPlayers(): Array<Player<any> | null> {\r\n\t\treturn this.parties.map(party => party.getPlayers()).flat();\r\n\t}\r\n\r\n\tgetPlayer(index: number): Player<any> | null {\r\n\t\tif (index === -1) return null;\r\n\r\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\r\n\t\treturn party.getPlayer(index % MAX_PARTY_SIZE);\r\n\t}\r\n\r\n\tgetPlayerFromUnitReference(raidTarget: UnitReference|undefined, contextPlayer?: Player<any>|null): Player<any> | null {\r\n\t\tif (!raidTarget || raidTarget.type == UnitType.Unknown) {\r\n\t\t\treturn null;\r\n\t\t} else if (raidTarget.type == UnitType.Player) {\r\n\t\t\treturn this.getPlayer(raidTarget.index);\r\n\t\t} else if (raidTarget.type == UnitType.Self) {\r\n\t\t\treturn contextPlayer || null;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsetPlayer(eventID: EventID, index: number, newPlayer: Player<any> | null) {\r\n\t\tconst party = this.parties[Math.floor(index / MAX_PARTY_SIZE)];\r\n\t\tparty.setPlayer(eventID, index % MAX_PARTY_SIZE, newPlayer);\r\n\t}\r\n\r\n\tgetClassCount(playerClass: Class) {\r\n\t\treturn this.getPlayers().filter(player => player != null && player.getClass() == playerClass).length;\r\n\t}\r\n\r\n\tgetBuffs(): RaidBuffs {\r\n\t\t// Make a defensive copy\r\n\t\treturn RaidBuffs.clone(this.buffs);\r\n\t}\r\n\r\n\tsetBuffs(eventID: EventID, newBuffs: RaidBuffs) {\r\n\t\tif (RaidBuffs.equals(this.buffs, newBuffs))\r\n\t\t\treturn;\r\n\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.buffs = RaidBuffs.clone(newBuffs);\r\n\r\n\t\tif (newBuffs.demonicPact > 0 && newBuffs.demonicPactSp == 0) {\r\n\t\t\tthis.buffs.demonicPactSp = this.buffs.demonicPact;\r\n\t\t\tif (this.buffs.demonicPactSp > 1000) {\r\n\t\t\t\tthis.buffs.demonicPactSp /= 10;\r\n\t\t\t}\r\n\t\t\tthis.buffs.demonicPact = 0;\r\n\t\t} else if (newBuffs.demonicPactOld > 0 && newBuffs.demonicPactSp == 0) {\r\n\t\t\tthis.buffs.demonicPactSp = this.buffs.demonicPactOld;\r\n\t\t\tif (this.buffs.demonicPactSp > 1000) {\r\n\t\t\t\tthis.buffs.demonicPactSp /= 10;\r\n\t\t\t}\r\n\t\t\tthis.buffs.demonicPactOld = 0;\r\n\t\t}\r\n\r\n\t\t// Special handle ToW since it crosses buffs/debuffs.\r\n\t\tif (this.debuffs.totemOfWrath != this.buffs.totemOfWrath) {\r\n\t\t\tvar newDebuff = Debuffs.clone(this.debuffs);\r\n\t\t\tnewDebuff.totemOfWrath = this.buffs.totemOfWrath;\r\n\t\t\tthis.setDebuffs(eventID, newDebuff);\r\n\t\t}\r\n\t\tthis.buffsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetDebuffs(): Debuffs {\r\n\t\t// Make a defensive copy\r\n\t\treturn Debuffs.clone(this.debuffs);\r\n\t}\r\n\r\n\tsetDebuffs(eventID: EventID, newDebuffs: Debuffs) {\r\n\t\tif (Debuffs.equals(this.debuffs, newDebuffs))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.debuffs = Debuffs.clone(newDebuffs);\r\n\r\n\t\t// Special handle ToW since it crosses buffs/debuffs.\r\n\t\tif (this.debuffs.totemOfWrath != this.buffs.totemOfWrath) {\r\n\t\t\tvar newBuffs = RaidBuffs.clone(this.buffs);\r\n\t\t\tnewBuffs.totemOfWrath = this.debuffs.totemOfWrath;\r\n\t\t\tthis.setBuffs(eventID, newBuffs);\r\n\t\t}\r\n\t\tthis.debuffsChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetTanks(): Array<UnitReference> {\r\n\t\t// Make a defensive copy\r\n\t\treturn this.tanks.map(tank => UnitReference.clone(tank));\r\n\t}\r\n\r\n\tsetTanks(eventID: EventID, newTanks: Array<UnitReference>) {\r\n\t\tif (this.tanks.length == newTanks.length && this.tanks.every((tank, i) => UnitReference.equals(tank, newTanks[i])))\r\n\t\t\treturn;\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.tanks = newTanks.map(tank => UnitReference.clone(tank));\r\n\t\tthis.tanksChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetTargetDummies(): number {\r\n\t\treturn this.targetDummies;\r\n\t}\r\n\r\n\tsetTargetDummies(eventID: EventID, newTargetDummies: number) {\r\n\t\tif (this.targetDummies == newTargetDummies)\r\n\t\t\treturn;\r\n\r\n\t\tthis.targetDummies = newTargetDummies;\r\n\t\tthis.targetDummiesChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetNumActiveParties(): number {\r\n\t\treturn this.numActiveParties;\r\n\t}\r\n\tsetNumActiveParties(eventID: EventID, newNumActiveParties: number) {\r\n\t\tif (newNumActiveParties != this.numActiveParties && newNumActiveParties > 0) {\r\n\t\t\tthis.numActiveParties = newNumActiveParties;\r\n\t\t\tthis.numActivePartiesChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\tgetActivePlayers(): Array<Player<any>> {\r\n\t\tif (this.activePlayers.length == 0) {\r\n\t\t\tconst activeParties = this.getParties().filter((party, i) => i < this.numActiveParties);\r\n\t\t\tthis.activePlayers = activeParties\r\n\t\t\t\t.map(party => party.getPlayers())\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(player => player != null) as Array<Player<any>>;\r\n\t\t}\r\n\t\treturn this.activePlayers;\r\n\t}\r\n\r\n\ttoProto(forExport?: boolean, forSimming?: boolean): RaidProto {\r\n\t\treturn RaidProto.create({\r\n\t\t\tparties: this.parties.map(party => party.toProto(forExport, forSimming)),\r\n\t\t\tbuffs: this.getBuffs(),\r\n\t\t\tdebuffs: this.getDebuffs(),\r\n\t\t\ttanks: this.getTanks(),\r\n\t\t\ttargetDummies: this.getTargetDummies(),\r\n\t\t\tnumActiveParties: this.getNumActiveParties(),\r\n\t\t});\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, proto: RaidProto) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tif (proto.tanks) {\r\n\t\t\t\tproto.tanks = proto.tanks.map(tank => (tank.type == 0 && tank.targetIndex != -1) ? UnitReference.create({type: UnitType.Player, index: tank.targetIndex}) : tank);\r\n\t\t\t}\r\n\r\n\t\t\tif (proto.buffs) {\r\n\t\t\t\tif (proto.buffs.demonicPact > 0 && proto.buffs.demonicPactSp == 0) {\r\n\t\t\t\t\tproto.buffs.demonicPactSp = proto.buffs.demonicPact;\r\n\t\t\t\t\tif (proto.buffs.demonicPactSp > 1000) {\r\n\t\t\t\t\t\tproto.buffs.demonicPactSp /= 10;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tproto.buffs.demonicPact = 0;\r\n\t\t\t\t} else if (proto.buffs.demonicPactOld > 0 && proto.buffs.demonicPactSp == 0) {\r\n\t\t\t\t\tproto.buffs.demonicPactSp = proto.buffs.demonicPactOld;\r\n\t\t\t\t\tif (proto.buffs.demonicPactSp > 1000) {\r\n\t\t\t\t\t\tproto.buffs.demonicPactSp /= 10;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tproto.buffs.demonicPactOld = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.setBuffs(eventID, proto.buffs || RaidBuffs.create());\r\n\t\t\tthis.setDebuffs(eventID, proto.debuffs || Debuffs.create());\r\n\t\t\tthis.setTanks(eventID, proto.tanks);\r\n\t\t\tthis.setTargetDummies(eventID, proto.targetDummies);\r\n\t\t\tthis.setNumActiveParties(eventID, proto.numActiveParties || 5);\r\n\r\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\r\n\t\t\t\tif (proto.parties[i]) {\r\n\t\t\t\t\tthis.parties[i].fromProto(eventID, proto.parties[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.parties[i].clear(eventID);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tclear(eventID: EventID) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tfor (let i = 0; i < MAX_NUM_PARTIES; i++) {\r\n\t\t\t\tthis.parties[i].clear(eventID);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { REPO_NAME } from './constants/other.js'\r\nimport { GemColor } from './proto/common.js';\r\nimport { ItemQuality } from './proto/common.js';\r\nimport { ItemSlot } from './proto/common.js';\r\nimport { ItemSpec } from './proto/common.js';\r\nimport { ItemType } from './proto/common.js';\r\nimport { Stat } from './proto/common.js';\r\n\r\nimport { ComputeStatsRequest, ComputeStatsResult } from './proto/api.js';\r\nimport { RaidSimRequest, RaidSimResult, ProgressMetrics } from './proto/api.js';\r\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\r\nimport { BulkSimRequest, BulkSimResult } from './proto/api.js';\r\n\r\nimport { wait } from './utils.js';\r\n\r\nconst SIM_WORKER_URL = `/${REPO_NAME}/sim_worker.js`;\r\n\r\nexport class WorkerPool {\r\n\tprivate workers: Array<SimWorker>;\r\n\r\n\tconstructor(numWorkers: number) {\r\n\t\tthis.workers = [];\r\n\t\tfor (let i = 0; i < numWorkers; i++) {\r\n\t\t\tthis.workers.push(new SimWorker());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getLeastBusyWorker(): SimWorker {\r\n\t\treturn this.workers.reduce(\r\n\t\t\t(curMinWorker, nextWorker) => curMinWorker.numTasksRunning < nextWorker.numTasksRunning ?\r\n\t\t\t\tcurMinWorker : nextWorker);\r\n\t}\r\n\r\n\tasync makeApiCall(requestName: string, request: Uint8Array): Promise<Uint8Array> {\r\n\t\treturn await this.getLeastBusyWorker().doApiCall(requestName, request, \"\");\r\n\t}\r\n\r\n\tasync computeStats(request: ComputeStatsRequest): Promise<ComputeStatsResult> {\r\n\t\tconst result = await this.makeApiCall('computeStats', ComputeStatsRequest.toBinary(request));\r\n\t\treturn ComputeStatsResult.fromBinary(result);\r\n\t}\r\n\r\n\tasync statWeightsAsync(request: StatWeightsRequest, onProgress: Function): Promise<StatWeightsResult> {\r\n\t\tconsole.log('Stat weights request: ' + StatWeightsRequest.toJsonString(request));\r\n\t\tconst worker = this.getLeastBusyWorker();\r\n\t\tconst id = worker.makeTaskId();\r\n\t\t// Add handler for the progress events\r\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\r\n\r\n\t\t// Now start the async sim\r\n\t\tconst resultData = await worker.doApiCall('statWeightsAsync', StatWeightsRequest.toBinary(request), id);\r\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\r\n\t\tconsole.log('Stat weights result: ' + StatWeightsResult.toJsonString(result.finalWeightResult!));\r\n\t\treturn result.finalWeightResult!;\r\n\t}\r\n\r\n\tasync bulkSimAsync(request: BulkSimRequest, onProgress: Function): Promise<BulkSimResult> {\r\n\t\tconsole.log('bulk sim request: ' + BulkSimRequest.toJsonString(request, { enumAsInteger: true }));\r\n\t\tconst worker = this.getLeastBusyWorker();\r\n\t\tconst id = worker.makeTaskId();\r\n\t\t// Add handler for the progress events\r\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\r\n\r\n\t\t// Now start the async sim\r\n\t\tconst resultData = await worker.doApiCall('bulkSimAsync', BulkSimRequest.toBinary(request), id);\r\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\r\n\t\tconst resultJson = BulkSimResult.toJson(result.finalBulkResult!) as any;\r\n\t\tconsole.log('bulk sim result: ' + JSON.stringify(resultJson));\r\n\t\treturn result.finalBulkResult!;\r\n\t}\r\n\r\n\tasync raidSimAsync(request: RaidSimRequest, onProgress: Function): Promise<RaidSimResult> {\r\n\t\tconsole.log('Raid sim request: ' + RaidSimRequest.toJsonString(request));\r\n\t\tconst worker = this.getLeastBusyWorker();\r\n\t\tconst id = worker.makeTaskId();\r\n\t\t// Add handler for the progress events\r\n\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { })\r\n\r\n\t\t// Now start the async sim\r\n\t\tconst resultData = await worker.doApiCall('raidSimAsync', RaidSimRequest.toBinary(request), id);\r\n\t\tconst result = ProgressMetrics.fromBinary(resultData)\r\n\r\n\t\t// Don't print the logs because it just clogs the console.\r\n\t\tconst resultJson = RaidSimResult.toJson(result.finalRaidResult!) as any;\r\n\t\tdelete resultJson!['logs'];\r\n\t\tconsole.log('Raid sim result: ' + JSON.stringify(resultJson));\r\n\t\treturn result.finalRaidResult!;\r\n\t}\r\n\r\n\tnewProgressHandler(id: string, worker: SimWorker, onProgress: Function): (progressData: any) => void {\r\n\t\treturn (progressData: any) => {\r\n\t\t\tvar progress = ProgressMetrics.fromBinary(progressData);\r\n\t\t\tonProgress(progress);\r\n\t\t\t// If we are done, stop adding the handler.\r\n\t\t\tif (progress.finalRaidResult != null || progress.finalWeightResult != null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tworker.addPromiseFunc(id + \"progress\", this.newProgressHandler(id, worker, onProgress), (err) => { });\r\n\t\t};\r\n\t}\r\n}\r\n\r\nclass SimWorker {\r\n\tnumTasksRunning: number;\r\n\tprivate taskIdsToPromiseFuncs: Record<string, [(result: any) => void, (error: any) => void]>;\r\n\tprivate worker: Worker;\r\n\tprivate onReady: Promise<void>;\r\n\r\n\tconstructor() {\r\n\t\tthis.numTasksRunning = 0;\r\n\t\tthis.taskIdsToPromiseFuncs = {};\r\n\t\tthis.worker = new window.Worker(SIM_WORKER_URL);\r\n\r\n\t\tlet resolveReady: (() => void) | null = null;\r\n\t\tthis.onReady = new Promise((_resolve, _reject) => {\r\n\t\t\tresolveReady = _resolve;\r\n\t\t});\r\n\r\n\t\tthis.worker.onmessage = event => {\r\n\t\t\tif (event.data.msg == 'ready') {\r\n\t\t\t\tthis.worker.postMessage({ msg: 'setID', id: '1' });\r\n\t\t\t\tresolveReady!();\r\n\t\t\t} else if (event.data.msg == 'idconfirm') {\r\n\t\t\t\t// Do nothing\r\n\t\t\t} else {\r\n\t\t\t\tconst id = event.data.id;\r\n\t\t\t\tif (!this.taskIdsToPromiseFuncs[id]) {\r\n\t\t\t\t\tconsole.warn('Unrecognized result id: ' + id);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst promiseFuncs = this.taskIdsToPromiseFuncs[id];\r\n\t\t\t\tdelete this.taskIdsToPromiseFuncs[id];\r\n\t\t\t\tthis.numTasksRunning--;\r\n\r\n\t\t\t\tpromiseFuncs[0](event.data.outputData);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\taddPromiseFunc(id: string, callback: (result: any) => void, onError: (error: any) => void) {\r\n\t\tthis.taskIdsToPromiseFuncs[id] = [callback, onError];\r\n\t}\r\n\r\n\tmakeTaskId(): string {\r\n\t\tlet id = '';\r\n\t\tconst characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\t\tfor (let i = 0; i < 16; i++) {\r\n\t\t\tid += characters.charAt(Math.floor(Math.random() * characters.length));\r\n\t\t}\r\n\t\treturn id;\r\n\t}\r\n\r\n\tasync doApiCall(requestName: string, request: Uint8Array, id: string): Promise<Uint8Array> {\r\n\t\tthis.numTasksRunning++;\r\n\t\tawait this.onReady;\r\n\r\n\t\tconst taskPromise = new Promise<Uint8Array>((resolve, reject) => {\r\n\t\t\tif (!id) {\r\n\t\t\t\tid = this.makeTaskId();\r\n\t\t\t}\r\n\t\t\tthis.taskIdsToPromiseFuncs[id] = [resolve, reject];\r\n\r\n\t\t\tthis.worker.postMessage({\r\n\t\t\t\tmsg: requestName,\r\n\t\t\t\tid: id,\r\n\t\t\t\tinputData: request,\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn await taskPromise;\r\n\t}\r\n}\r\n","import {\r\n\tArmorType,\r\n\tFaction,\r\n\tProfession,\r\n\tSimDatabase,\r\n\tStat, PseudoStat,\r\n\tRangedWeaponType,\r\n\tWeaponType,\r\n\tUnitReference,\r\n\tUnitReference_Type as UnitType,\r\n} from './proto/common.js';\r\nimport { BulkSimRequest, BulkSimResult, BulkSettings, Raid as RaidProto } from './proto/api.js';\r\nimport { ComputeStatsRequest } from './proto/api.js';\r\nimport { RaidSimRequest, RaidSimResult } from './proto/api.js';\r\nimport { SimOptions } from './proto/api.js';\r\nimport { StatWeightsRequest, StatWeightsResult } from './proto/api.js';\r\nimport {\r\n\tDatabaseFilters,\r\n\tSimSettings as SimSettingsProto,\r\n\tSourceFilterOption,\r\n\tRaidFilterOption,\r\n} from './proto/ui.js';\r\nimport { Database } from './proto_utils/database.js';\r\nimport { SimResult } from './proto_utils/sim_result.js';\r\nimport { getBrowserLanguageCode, setLanguageCode } from './constants/lang.js';\r\nimport { Encounter } from './encounter.js';\r\nimport { Player, UnitMetadata } from './player.js';\r\nimport { Raid } from './raid.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\nimport { getEnumValues } from './utils.js';\r\nimport { WorkerPool } from './worker_pool.js';\r\n\r\nimport * as OtherConstants from './constants/other.js';\r\n\r\nexport type RaidSimData = {\r\n\trequest: RaidSimRequest,\r\n\tresult: RaidSimResult,\r\n};\r\n\r\nexport type StatWeightsData = {\r\n\trequest: StatWeightsRequest,\r\n\tresult: StatWeightsResult,\r\n};\r\n\r\n// Core Sim module which deals only with api types, no UI-related stuff.\r\nexport class Sim {\r\n\tprivate readonly workerPool: WorkerPool;\r\n\r\n\tprivate iterations: number = 3000;\r\n\tprivate phase: number = OtherConstants.CURRENT_PHASE;\r\n\tprivate faction: Faction = Faction.Alliance;\r\n\tprivate fixedRngSeed: number = 0;\r\n\tprivate filters: DatabaseFilters = Sim.defaultFilters();\r\n\tprivate showDamageMetrics: boolean = true;\r\n\tprivate showThreatMetrics: boolean = false;\r\n\tprivate showHealingMetrics: boolean = false;\r\n\tprivate showExperimental: boolean = false;\r\n\tprivate showEPValues: boolean = false;\r\n\tprivate language: string = '';\r\n\r\n\treadonly raid: Raid;\r\n\treadonly encounter: Encounter;\r\n\r\n\tprivate db_: Database | null = null;\r\n\r\n\treadonly iterationsChangeEmitter = new TypedEvent<void>();\r\n\treadonly phaseChangeEmitter = new TypedEvent<void>();\r\n\treadonly factionChangeEmitter = new TypedEvent<void>();\r\n\treadonly fixedRngSeedChangeEmitter = new TypedEvent<void>();\r\n\treadonly lastUsedRngSeedChangeEmitter = new TypedEvent<void>();\r\n\treadonly filtersChangeEmitter = new TypedEvent<void>();\r\n\treadonly showDamageMetricsChangeEmitter = new TypedEvent<void>();\r\n\treadonly showThreatMetricsChangeEmitter = new TypedEvent<void>();\r\n\treadonly showHealingMetricsChangeEmitter = new TypedEvent<void>();\r\n\treadonly showExperimentalChangeEmitter = new TypedEvent<void>();\r\n\treadonly showEPValuesChangeEmitter = new TypedEvent<void>();\r\n\treadonly languageChangeEmitter = new TypedEvent<void>();\r\n\treadonly crashEmitter = new TypedEvent<SimError>();\r\n\r\n\t// Emits when any of the settings change (but not the raid / encounter).\r\n\treadonly settingsChangeEmitter: TypedEvent<void>;\r\n\r\n\t// Emits when any player, target, or pet has metadata changes (spells or auras).\r\n\treadonly unitMetadataEmitter = new TypedEvent<void>('UnitMetadata');\r\n\r\n\t// Emits when any of the above emitters emit.\r\n\treadonly changeEmitter: TypedEvent<void>;\r\n\r\n\t// Fires when a raid sim API call completes.\r\n\treadonly simResultEmitter = new TypedEvent<SimResult>();\r\n\r\n\t// Fires when a bulk sim API call starts.\r\n\treadonly bulkSimStartEmitter = new TypedEvent<BulkSimRequest>();\r\n\t// Fires when a bulk sim API call completes..\r\n\treadonly bulkSimResultEmitter = new TypedEvent<BulkSimResult>();\r\n\r\n\tprivate readonly _initPromise: Promise<any>;\r\n\tprivate lastUsedRngSeed: number = 0;\r\n\r\n\t// These callbacks are needed so we can apply BuffBot modifications automatically before sending requests.\r\n\tprivate modifyRaidProto: ((raidProto: RaidProto) => void) = () => { };\r\n\r\n\tconstructor() {\r\n\t\tthis.workerPool = new WorkerPool(1);\r\n\t\tthis._initPromise = Database.get().then(db => {\r\n\t\t\tthis.db_ = db;\r\n\t\t});\r\n\r\n\t\tthis.raid = new Raid(this);\r\n\t\tthis.encounter = new Encounter(this);\r\n\r\n\t\tthis.settingsChangeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.iterationsChangeEmitter,\r\n\t\t\tthis.phaseChangeEmitter,\r\n\t\t\tthis.fixedRngSeedChangeEmitter,\r\n\t\t\tthis.filtersChangeEmitter,\r\n\t\t\tthis.showDamageMetricsChangeEmitter,\r\n\t\t\tthis.showThreatMetricsChangeEmitter,\r\n\t\t\tthis.showHealingMetricsChangeEmitter,\r\n\t\t\tthis.showExperimentalChangeEmitter,\r\n\t\t\tthis.showEPValuesChangeEmitter,\r\n\t\t\tthis.languageChangeEmitter,\r\n\t\t]);\r\n\r\n\t\tthis.changeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.settingsChangeEmitter,\r\n\t\t\tthis.raid.changeEmitter,\r\n\t\t\tthis.encounter.changeEmitter,\r\n\t\t]);\r\n\r\n\t\tTypedEvent.onAny([this.raid.changeEmitter, this.encounter.changeEmitter]).on(eventID => this.updateCharacterStats(eventID));\r\n\t}\r\n\r\n\twaitForInit(): Promise<void> {\r\n\t\treturn this._initPromise;\r\n\t}\r\n\r\n\tget db(): Database {\r\n\t\treturn this.db_!;\r\n\t}\r\n\r\n\tsetModifyRaidProto(newModFn: (raidProto: RaidProto) => void) {\r\n\t\tthis.modifyRaidProto = newModFn;\r\n\t}\r\n\tgetModifiedRaidProto(): RaidProto {\r\n\t\tconst raidProto = this.raid.toProto(false, true);\r\n\t\tthis.modifyRaidProto(raidProto);\r\n\r\n\t\t// Remove any inactive meta gems, since the backend doesn't have its own validation.\r\n\t\traidProto.parties.forEach(party => {\r\n\t\t\tparty.players.forEach(player => {\r\n\t\t\t\tif (!player.equipment) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet gear = this.db.lookupEquipmentSpec(player.equipment);\r\n\t\t\t\tlet gearChanged = false;\r\n\r\n\t\t\t\tconst isBlacksmith = [player.profession1, player.profession2].includes(Profession.Blacksmithing);\r\n\r\n\t\t\t\t// Disable meta gem if inactive.\r\n\t\t\t\tif (gear.hasInactiveMetaGem(isBlacksmith)) {\r\n\t\t\t\t\tgear = gear.withoutMetaGem();\r\n\t\t\t\t\tgearChanged = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove bonus sockets if not blacksmith.\r\n\t\t\t\t// if (!isBlacksmith) {\r\n\t\t\t\t// \tgear = gear.withoutBlacksmithSockets();\r\n\t\t\t\t// \tgearChanged = true;\r\n\t\t\t\t// }\r\n\r\n\t\t\t\tif (gearChanged) {\r\n\t\t\t\t\tplayer.equipment = gear.asSpec();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn raidProto;\r\n\t}\r\n\r\n\tmakeRaidSimRequest(debug: boolean): RaidSimRequest {\r\n\t\tconst raid = this.getModifiedRaidProto();\r\n\t\tconst encounter = this.encounter.toProto();\r\n\r\n\t\t// TODO: remove any replenishment from sim request here? probably makes more sense to do it inside the sim to protect against accidents\r\n\r\n\t\treturn RaidSimRequest.create({\r\n\t\t\traid: raid,\r\n\t\t\tencounter: encounter,\r\n\t\t\tsimOptions: SimOptions.create({\r\n\t\t\t\titerations: debug ? 1 : this.getIterations(),\r\n\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\r\n\t\t\t\tdebugFirstIteration: true,\r\n\t\t\t}),\r\n\t\t});\r\n\t}\r\n\r\n\tasync runBulkSim(bulkSettings: BulkSettings, bulkItemsDb: SimDatabase, onProgress: Function): Promise<BulkSimResult> {\r\n\t\tif (this.raid.isEmpty()) {\r\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\r\n\t\t} else if (this.encounter.targets.length < 1) {\r\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\r\n\t\t}\r\n\r\n\t\tawait this.waitForInit();\r\n\r\n\t\tconst request = BulkSimRequest.create({\r\n\t\t\tbaseSettings: this.makeRaidSimRequest(false),\r\n\t\t\tbulkSettings: bulkSettings,\r\n\t\t});\r\n\r\n\t\tif (request.baseSettings != null && request.baseSettings.simOptions != null) {\r\n\t\t\trequest.baseSettings.simOptions.debugFirstIteration = false;\r\n\t\t}\r\n\r\n\t\tif (!request.baseSettings?.raid || request.baseSettings?.raid?.parties.length == 0 || request.baseSettings?.raid?.parties[0].players.length == 0) {\r\n\t\t\tthrow new Error('Raid must contain exactly 1 player for bulk sim.');\r\n\t\t}\r\n\r\n\t\t// Attach the extra database to the player.\r\n\t\tconst playerDatabase = request.baseSettings.raid.parties[0].players[0].database;\r\n\t\tplayerDatabase?.items.push(...bulkItemsDb.items);\r\n\t\tplayerDatabase?.enchants.push(...bulkItemsDb.enchants);\r\n\t\tplayerDatabase?.gems.push(...bulkItemsDb.gems);\r\n\r\n\t\tthis.bulkSimStartEmitter.emit(TypedEvent.nextEventID(), request);\r\n\r\n\t\tvar result = await this.workerPool.bulkSimAsync(request, onProgress);\r\n\t\tif (result.errorResult != \"\") {\r\n\t\t\tthrow new SimError(result.errorResult);\r\n\t\t}\r\n\r\n\t\tthis.bulkSimResultEmitter.emit(TypedEvent.nextEventID(), result);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tasync runRaidSim(eventID: EventID, onProgress: Function): Promise<SimResult> {\r\n\t\tif (this.raid.isEmpty()) {\r\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\r\n\t\t} else if (this.encounter.targets.length < 1) {\r\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\r\n\t\t}\r\n\r\n\t\tawait this.waitForInit();\r\n\r\n\t\tconst request = this.makeRaidSimRequest(false);\r\n\r\n\t\tvar result = await this.workerPool.raidSimAsync(request, onProgress);\r\n\t\tif (result.errorResult != \"\") {\r\n\t\t\tthrow new SimError(result.errorResult);\r\n\t\t}\r\n\t\tconst simResult = await SimResult.makeNew(request, result);\r\n\t\tthis.simResultEmitter.emit(eventID, simResult);\r\n\t\treturn simResult;\r\n\t}\r\n\r\n\tasync runRaidSimWithLogs(eventID: EventID): Promise<SimResult> {\r\n\t\tif (this.raid.isEmpty()) {\r\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\r\n\t\t} else if (this.encounter.targets.length < 1) {\r\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\r\n\t\t}\r\n\r\n\t\tawait this.waitForInit();\r\n\r\n\t\tconst request = this.makeRaidSimRequest(true);\r\n\t\tconst result = await this.workerPool.raidSimAsync(request, () => { });\r\n\t\tif (result.errorResult != \"\") {\r\n\t\t\tthrow new SimError(result.errorResult);\r\n\t\t}\r\n\t\tconst simResult = await SimResult.makeNew(request, result);\r\n\t\tthis.simResultEmitter.emit(eventID, simResult);\r\n\t\treturn simResult;\r\n\t}\r\n\r\n\t// This should be invoked internally whenever stats might have changed.\r\n\tasync updateCharacterStats(eventID: EventID) {\r\n\t\tif (eventID == 0) {\r\n\t\t\t// Skip the first event ID because it interferes with the loaded stats.\r\n\t\t\treturn;\r\n\t\t}\r\n\t\teventID = TypedEvent.nextEventID();\r\n\r\n\t\tawait this.waitForInit();\r\n\r\n\t\t// Capture the current players so we avoid issues if something changes while\r\n\t\t// request is in-flight.\r\n\t\tconst players = this.raid.getPlayers();\r\n\r\n\t\tconst req = ComputeStatsRequest.create({\r\n\t\t\traid: this.getModifiedRaidProto(),\r\n\t\t\tencounter: this.encounter.toProto(),\r\n\t\t});\r\n\t\tconst result = await this.workerPool.computeStats(req);\r\n\r\n\t\tif (result.errorResult != \"\") {\r\n\t\t\tthis.crashEmitter.emit(eventID, new SimError(result.errorResult));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tTypedEvent.freezeAllAndDo(async () => {\r\n\t\t\tconst playerUpdatePromises = result.raidStats!.parties\r\n\t\t\t\t.map((partyStats, partyIndex) =>\r\n\t\t\t\t\tpartyStats.players.map((playerStats, playerIndex) => {\r\n\t\t\t\t\t\tconst player = players[partyIndex * 5 + playerIndex];\r\n\t\t\t\t\t\tif (player) {\r\n\t\t\t\t\t\t\tplayer.setCurrentStats(eventID, playerStats);\r\n\t\t\t\t\t\t\treturn player.updateMetadata();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}))\r\n\t\t\t\t.flat()\r\n\t\t\t\t.filter(p => p != null) as Array<Promise<boolean>>;\r\n\t\t\t\r\n\t\t\tconst targetUpdatePromise = this.encounter.targetsMetadata.update(result.encounterStats!.targets.map(t => t.metadata!));\r\n\t\t\t\r\n\t\t\tconst anyUpdates = await Promise.all(playerUpdatePromises.concat([targetUpdatePromise]));\r\n\t\t\tif (anyUpdates.some(v => v)) {\r\n\t\t\t\tthis.unitMetadataEmitter.emit(eventID);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tasync statWeights(player: Player<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat>, epReferenceStat: Stat, onProgress: Function): Promise<StatWeightsResult> {\r\n\t\tif (this.raid.isEmpty()) {\r\n\t\t\tthrow new Error('Raid is empty! Try adding some players first.');\r\n\t\t} else if (this.encounter.targets.length < 1) {\r\n\t\t\tthrow new Error('Encounter has no targets! Try adding some targets first.');\r\n\t\t}\r\n\r\n\t\tawait this.waitForInit();\r\n\r\n\t\tif (player.getParty() == null) {\r\n\t\t\tconsole.warn('Trying to get stat weights without a party!');\r\n\t\t\treturn StatWeightsResult.create();\r\n\t\t} else {\r\n\t\t\tconst tanks = this.raid.getTanks().map(tank => tank.index).includes(player.getRaidIndex())\r\n\t\t\t\t? [UnitReference.create({ type: UnitType.Player, index: 0 })]\r\n\t\t\t\t: [];\r\n\t\t\tconst request = StatWeightsRequest.create({\r\n\t\t\t\tplayer: player.toProto(),\r\n\t\t\t\traidBuffs: this.raid.getBuffs(),\r\n\t\t\t\tpartyBuffs: player.getParty()!.getBuffs(),\r\n\t\t\t\tdebuffs: this.raid.getDebuffs(),\r\n\t\t\t\tencounter: this.encounter.toProto(),\r\n\t\t\t\tsimOptions: SimOptions.create({\r\n\t\t\t\t\titerations: this.getIterations(),\r\n\t\t\t\t\trandomSeed: BigInt(this.nextRngSeed()),\r\n\t\t\t\t\tdebug: false,\r\n\t\t\t\t}),\r\n\t\t\t\ttanks: tanks,\r\n\r\n\t\t\t\tstatsToWeigh: epStats,\r\n\t\t\t\tpseudoStatsToWeigh: epPseudoStats,\r\n\t\t\t\tepReferenceStat: epReferenceStat,\r\n\t\t\t});\r\n\t\t\tvar result = await this.workerPool.statWeightsAsync(request, onProgress);\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\tgetUnitMetadata(ref: UnitReference|undefined, contextPlayer: Player<any>|null, defaultRef: UnitReference): UnitMetadata|undefined {\r\n\t\tif (!ref || ref.type == UnitType.Unknown) {\r\n\t\t\treturn this.getUnitMetadata(defaultRef, contextPlayer, defaultRef);\r\n\t\t} else if (ref.type == UnitType.Player) {\r\n\t\t\treturn this.raid.getPlayerFromUnitReference(ref)?.getMetadata();\r\n\t\t} else if (ref.type == UnitType.Target) {\r\n\t\t\treturn this.encounter.targetsMetadata.asList()[ref.index];\r\n\t\t} else if (ref.type == UnitType.Pet) {\r\n\t\t\tconst owner = this.raid.getPlayerFromUnitReference(ref.owner, contextPlayer);\r\n\t\t\tif (owner) {\r\n\t\t\t\treturn owner.getPetMetadatas().asList()[ref.index];\r\n\t\t\t} else {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t} else if (ref.type == UnitType.Self) {\r\n\t\t\treturn contextPlayer?.getMetadata();\r\n\t\t} else if (ref.type == UnitType.CurrentTarget) {\r\n\t\t\treturn this.encounter.targetsMetadata.asList()[0];\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tgetPhase(): number {\r\n\t\treturn this.phase;\r\n\t}\r\n\tsetPhase(eventID: EventID, newPhase: number) {\r\n\t\tif (newPhase != this.phase && newPhase > 0) {\r\n\t\t\tthis.phase = newPhase;\r\n\t\t\tthis.phaseChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetFaction(): Faction {\r\n\t\treturn this.faction;\r\n\t}\r\n\tsetFaction(eventID: EventID, newFaction: Faction) {\r\n\t\tif (newFaction != this.faction && !!newFaction) {\r\n\t\t\tthis.faction = newFaction;\r\n\t\t\tthis.factionChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetFixedRngSeed(): number {\r\n\t\treturn this.fixedRngSeed;\r\n\t}\r\n\tsetFixedRngSeed(eventID: EventID, newFixedRngSeed: number) {\r\n\t\tif (newFixedRngSeed != this.fixedRngSeed) {\r\n\t\t\tthis.fixedRngSeed = newFixedRngSeed;\r\n\t\t\tthis.fixedRngSeedChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic MAX_RNG_SEED = Math.pow(2, 32) - 1;\r\n\tprivate nextRngSeed(): number {\r\n\t\tlet rngSeed = 0;\r\n\t\tif (this.fixedRngSeed) {\r\n\t\t\trngSeed = this.fixedRngSeed;\r\n\t\t} else {\r\n\t\t\trngSeed = Math.floor(Math.random() * Sim.MAX_RNG_SEED);\r\n\t\t}\r\n\r\n\t\tthis.lastUsedRngSeed = rngSeed;\r\n\t\tthis.lastUsedRngSeedChangeEmitter.emit(TypedEvent.nextEventID());\r\n\t\treturn rngSeed;\r\n\t}\r\n\tgetLastUsedRngSeed(): number {\r\n\t\treturn this.lastUsedRngSeed;\r\n\t}\r\n\r\n\tgetFilters(): DatabaseFilters {\r\n\t\t// Make a defensive copy\r\n\t\treturn DatabaseFilters.clone(this.filters);\r\n\t}\r\n\tsetFilters(eventID: EventID, newFilters: DatabaseFilters) {\r\n\t\tif (DatabaseFilters.equals(newFilters, this.filters)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Make a defensive copy\r\n\t\tthis.filters = DatabaseFilters.clone(newFilters);\r\n\t\tthis.filtersChangeEmitter.emit(eventID);\r\n\t}\r\n\r\n\tgetShowDamageMetrics(): boolean {\r\n\t\treturn this.showDamageMetrics;\r\n\t}\r\n\tsetShowDamageMetrics(eventID: EventID, newShowDamageMetrics: boolean) {\r\n\t\tif (newShowDamageMetrics != this.showDamageMetrics) {\r\n\t\t\tthis.showDamageMetrics = newShowDamageMetrics;\r\n\t\t\tthis.showDamageMetricsChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetShowThreatMetrics(): boolean {\r\n\t\treturn this.showThreatMetrics;\r\n\t}\r\n\tsetShowThreatMetrics(eventID: EventID, newShowThreatMetrics: boolean) {\r\n\t\tif (newShowThreatMetrics != this.showThreatMetrics) {\r\n\t\t\tthis.showThreatMetrics = newShowThreatMetrics;\r\n\t\t\tthis.showThreatMetricsChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetShowHealingMetrics(): boolean {\r\n\t\treturn this.showHealingMetrics;\r\n\t}\r\n\tsetShowHealingMetrics(eventID: EventID, newShowHealingMetrics: boolean) {\r\n\t\tif (newShowHealingMetrics != this.showHealingMetrics) {\r\n\t\t\tthis.showHealingMetrics = newShowHealingMetrics;\r\n\t\t\tthis.showHealingMetricsChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetShowExperimental(): boolean {\r\n\t\treturn this.showExperimental;\r\n\t}\r\n\tsetShowExperimental(eventID: EventID, newShowExperimental: boolean) {\r\n\t\tif (newShowExperimental != this.showExperimental) {\r\n\t\t\tthis.showExperimental = newShowExperimental;\r\n\t\t\tthis.showExperimentalChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetShowEPValues(): boolean {\r\n\t\treturn this.showEPValues;\r\n\t}\r\n\tsetShowEPValues(eventID: EventID, newShowEPValues: boolean) {\r\n\t\tif (newShowEPValues != this.showEPValues) {\r\n\t\t\tthis.showEPValues = newShowEPValues;\r\n\t\t\tthis.showEPValuesChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetLanguage(): string {\r\n\t\treturn this.language;\r\n\t}\r\n\tsetLanguage(eventID: EventID, newLanguage: string) {\r\n\t\tnewLanguage = newLanguage || getBrowserLanguageCode();\r\n\t\tif (newLanguage != this.language) {\r\n\t\t\tthis.language = newLanguage;\r\n\t\t\tsetLanguageCode(this.language);\r\n\t\t\tthis.languageChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tgetIterations(): number {\r\n\t\treturn this.iterations;\r\n\t}\r\n\tsetIterations(eventID: EventID, newIterations: number) {\r\n\t\tif (newIterations != this.iterations) {\r\n\t\t\tthis.iterations = newIterations;\r\n\t\t\tthis.iterationsChangeEmitter.emit(eventID);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic readonly ALL_ARMOR_TYPES = (getEnumValues(ArmorType) as Array<ArmorType>).filter(v => v != 0);\r\n\tstatic readonly ALL_WEAPON_TYPES = (getEnumValues(WeaponType) as Array<WeaponType>).filter(v => v != 0);\r\n\tstatic readonly ALL_RANGED_WEAPON_TYPES = (getEnumValues(RangedWeaponType) as Array<RangedWeaponType>).filter(v => v != 0);\r\n\tstatic readonly ALL_SOURCES = (getEnumValues(SourceFilterOption) as Array<SourceFilterOption>).filter(v => v != 0);\r\n\tstatic readonly ALL_RAIDS = (getEnumValues(RaidFilterOption) as Array<RaidFilterOption>).filter(v => v != 0);\r\n\r\n\ttoProto(): SimSettingsProto {\r\n\t\tconst filters = this.getFilters();\r\n\t\tif (filters.armorTypes.length == Sim.ALL_ARMOR_TYPES.length) {\r\n\t\t\tfilters.armorTypes = [];\r\n\t\t}\r\n\t\tif (filters.weaponTypes.length == Sim.ALL_WEAPON_TYPES.length) {\r\n\t\t\tfilters.weaponTypes = [];\r\n\t\t}\r\n\t\tif (filters.rangedWeaponTypes.length == Sim.ALL_RANGED_WEAPON_TYPES.length) {\r\n\t\t\tfilters.rangedWeaponTypes = [];\r\n\t\t}\r\n\t\tif (filters.sources.length == Sim.ALL_SOURCES.length) {\r\n\t\t\tfilters.sources = [];\r\n\t\t}\r\n\t\tif (filters.raids.length == Sim.ALL_RAIDS.length) {\r\n\t\t\tfilters.raids = [];\r\n\t\t}\r\n\r\n\t\treturn SimSettingsProto.create({\r\n\t\t\titerations: this.getIterations(),\r\n\t\t\tphase: this.getPhase(),\r\n\t\t\tfixedRngSeed: BigInt(this.getFixedRngSeed()),\r\n\t\t\tshowDamageMetrics: this.getShowDamageMetrics(),\r\n\t\t\tshowThreatMetrics: this.getShowThreatMetrics(),\r\n\t\t\tshowHealingMetrics: this.getShowHealingMetrics(),\r\n\t\t\tshowExperimental: this.getShowExperimental(),\r\n\t\t\tshowEpValues: this.getShowEPValues(),\r\n\t\t\tlanguage: this.getLanguage(),\r\n\t\t\tfaction: this.getFaction(),\r\n\t\t\tfilters: filters,\r\n\t\t});\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, proto: SimSettingsProto) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.setIterations(eventID, proto.iterations || 3000);\r\n\t\t\tthis.setPhase(eventID, proto.phase || OtherConstants.CURRENT_PHASE);\r\n\t\t\tthis.setFixedRngSeed(eventID, Number(proto.fixedRngSeed));\r\n\t\t\tthis.setShowDamageMetrics(eventID, proto.showDamageMetrics);\r\n\t\t\tthis.setShowThreatMetrics(eventID, proto.showThreatMetrics);\r\n\t\t\tthis.setShowHealingMetrics(eventID, proto.showHealingMetrics);\r\n\t\t\tthis.setShowExperimental(eventID, proto.showExperimental);\r\n\t\t\tthis.setShowEPValues(eventID, proto.showEpValues);\r\n\t\t\tthis.setLanguage(eventID, proto.language);\r\n\t\t\tthis.setFaction(eventID, proto.faction || Faction.Alliance)\r\n\r\n\t\t\tconst filters = proto.filters || Sim.defaultFilters();\r\n\t\t\tif (filters.armorTypes.length == 0) {\r\n\t\t\t\tfilters.armorTypes = Sim.ALL_ARMOR_TYPES.slice();\r\n\t\t\t}\r\n\t\t\tif (filters.weaponTypes.length == 0) {\r\n\t\t\t\tfilters.weaponTypes = Sim.ALL_WEAPON_TYPES.slice();\r\n\t\t\t}\r\n\t\t\tif (filters.rangedWeaponTypes.length == 0) {\r\n\t\t\t\tfilters.rangedWeaponTypes = Sim.ALL_RANGED_WEAPON_TYPES.slice();\r\n\t\t\t}\r\n\t\t\tif (filters.sources.length == 0) {\r\n\t\t\t\tfilters.sources = Sim.ALL_SOURCES.slice();\r\n\t\t\t}\r\n\t\t\tif (filters.raids.length == 0) {\r\n\t\t\t\tfilters.raids = Sim.ALL_RAIDS.slice();\r\n\t\t\t}\r\n\t\t\tthis.setFilters(eventID, filters);\r\n\t\t});\r\n\t}\r\n\r\n\tapplyDefaults(eventID: EventID, isTankSim: boolean, isHealingSim: boolean) {\r\n\t\tthis.fromProto(eventID, SimSettingsProto.create({\r\n\t\t\titerations: 3000,\r\n\t\t\tphase: OtherConstants.CURRENT_PHASE,\r\n\t\t\tfaction: Faction.Alliance,\r\n\t\t\tshowDamageMetrics: !isHealingSim,\r\n\t\t\tshowThreatMetrics: isTankSim,\r\n\t\t\tshowHealingMetrics: isHealingSim,\r\n\t\t\tlanguage: this.getLanguage(), // Don't change language.\r\n\t\t\tfilters: Sim.defaultFilters(),\r\n\t\t\tshowEpValues: false,\r\n\t\t}));\r\n\t}\r\n\r\n\tstatic defaultFilters(): DatabaseFilters {\r\n\t\treturn DatabaseFilters.create({\r\n\t\t\toneHandedWeapons: true,\r\n\t\t\ttwoHandedWeapons: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport class SimError extends Error {\r\n\treadonly errorStr: string;\r\n\r\n\tconstructor(errorStr: string) {\r\n\t\tsuper(errorStr);\r\n\t\tthis.errorStr = errorStr;\r\n\t}\r\n}\r\n","import { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\n/**\r\n * Data for creating a number picker.\r\n */\r\nexport interface NumberPickerConfig<ModObject> extends InputConfig<ModObject, number> {\r\n\tfloat?: boolean,\r\n\tpositive?: boolean,\r\n}\r\n\r\n// UI element for picking an arbitrary number field.\r\nexport class NumberPicker<ModObject> extends Input<ModObject, number> {\r\n\tprivate readonly inputElem: HTMLInputElement;\r\n\tprivate float: boolean;\r\n\tprivate positive: boolean;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: NumberPickerConfig<ModObject>) {\r\n\t\tsuper(parent, 'number-picker-root', modObject, config);\r\n\t\tthis.float = config.float || false;\r\n\t\tthis.positive = config.positive || false;\r\n\r\n\t\tthis.inputElem = document.createElement('input');\r\n\t\tthis.inputElem.type = 'text';\r\n\t\tthis.inputElem.classList.add('form-control', 'number-picker-input');\r\n\r\n\t\tif (this.positive) {\r\n\t\t\tthis.inputElem.onchange = e => {\r\n\t\t\t\tif (this.float) {\r\n\t\t\t\t\tthis.inputElem.value = Math.abs(parseFloat(this.inputElem.value)).toFixed(2);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.inputElem.value = Math.abs(parseInt(this.inputElem.value)).toString();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('change', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\r\n\t\tthis.inputElem.addEventListener('input', event => {\r\n\t\t\tthis.updateSize();\r\n\t\t});\r\n\t\tthis.updateSize();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): number {\r\n\t\tif (this.float) {\r\n\t\t\treturn parseFloat(this.inputElem.value || '') || 0;\r\n\t\t} else {\r\n\t\t\treturn parseInt(this.inputElem.value || '') || 0;\r\n\t\t}\r\n\t}\r\n\r\n\tsetInputValue(newValue: number) {\r\n\t\tif (this.float)\r\n\t\t\tthis.inputElem.value = newValue.toFixed(2);\r\n\t\telse\r\n\t\t\tthis.inputElem.value = String(newValue);\r\n\t}\r\n\r\n\tprivate updateSize() {\r\n\t\tconst newSize = Math.max(3, this.inputElem.value.length);\r\n\t\tif (this.inputElem.size != newSize)\r\n\t\t\tthis.inputElem.size = newSize;\r\n\t}\r\n}\r\n","import { Tooltip } from 'bootstrap';\r\nimport { Component } from '../components/component.js';\r\nimport { TypedEvent } from '../typed_event.js';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\n// Config for displaying a warning to the user whenever a condition is met.\r\ninterface SimWarning {\r\n\tupdateOn: TypedEvent<any>,\r\n\tgetContent: () => string | Array<string>,\r\n}\r\n\r\ninterface WarningLinkArgs {\r\n\tparent: HTMLElement,\r\n\thref?: string,\r\n\ttext?: string,\r\n\ticon?: string,\r\n\ttooltip?: string,\r\n\tclasses?: string,\r\n\tonclick?: Function\r\n}\r\n\r\nexport class ResultsViewer extends Component {\r\n\treadonly pendingElem: HTMLElement;\r\n\treadonly contentElem: HTMLElement;\r\n\treadonly warningElem: HTMLElement;\r\n\tprivate warningsLink: HTMLElement;\r\n\r\n\tprivate warnings: Array<SimWarning> = [];\r\n\r\n\tconstructor(parentElem: HTMLElement) {\r\n\t\tsuper(parentElem, 'results-viewer');\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<>\r\n\t\t\t\t<div className=\"results-pending\">\r\n\t\t\t\t<div className=\"loader\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"results-content\">\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"warning-zone\" style=\"text-align: center\">\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t);\r\n\t\tthis.pendingElem = this.rootElem.getElementsByClassName('results-pending')[0] as HTMLElement;\r\n\t\tthis.contentElem = this.rootElem.getElementsByClassName('results-content')[0] as HTMLElement;\r\n\t\tthis.warningElem = this.rootElem.getElementsByClassName('warning-zone')[0] as HTMLElement;\r\n\r\n\r\n\t\tthis.warningsLink = this.addWarningsLink();\r\n\t\tthis.updateWarnings();\r\n\r\n\t\tthis.hideAll();\r\n\t}\r\n\r\n\tprivate addWarningLink(args: WarningLinkArgs): HTMLElement {\r\n\t\tlet item = (\r\n\t\t\t<div className=\"sim-toolbar-item\">\r\n\t\t\t\t<a\r\n\t\t\t\t\thref={args.href ? args.href : 'javascript:void(0)'}\r\n\t\t\t\t\ttarget={args.href ? '_blank' : '_self'}\r\n\t\t\t\t\tclassName={args.classes}\r\n\t\t\t\t>\r\n\t\t\t\t\t{args.icon && <i className={args.icon}></i>}\r\n\t\t\t\t\t{args.text ? args.text : ''}\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tlet link = item.children[0] as HTMLElement;\r\n\r\n\t\tif (args.onclick) {\r\n\t\t\tlink.addEventListener('click', () => {\r\n\t\t\t\tif (args.onclick)\r\n\t\t\t\t\targs.onclick();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet cfg = {};\r\n\t\tif (args.tooltip) {\r\n\t\t\tcfg = {\r\n\t\t\t\ttitle: args.tooltip,\r\n\t\t\t\thtml: true,\r\n\t\t\t\tplacement: 'bottom',\r\n\t\t\t};\r\n\t\t\tlink.setAttribute('data-bs-title', args.tooltip);\r\n\t\t}\r\n\t\tnew Tooltip(link, cfg);\r\n\t\targs.parent.appendChild(item);\r\n\r\n\t\treturn item as HTMLElement;\r\n\t}\r\n\r\n\tprivate addWarningsLink(): HTMLElement {\r\n\t\treturn this.addWarningLink({\r\n\t\t\tparent: this.warningElem,\r\n\t\t\ticon: 'fas fa-exclamation-triangle fa-3x',\r\n\t\t\ttooltip: \"<ul class='text-start ps-3 mb-0'></ul>\",\r\n\t\t\tclasses: 'warning link-warning'\r\n\t\t}).children[0] as HTMLElement;\r\n\t}\r\n\r\n\taddWarning(warning: SimWarning) {\r\n\t\tthis.warnings.push(warning);\r\n\t\twarning.updateOn.on(() => this.updateWarnings());\r\n\t\tthis.updateWarnings();\r\n\t}\r\n\r\n\tprivate updateWarnings() {\r\n\t\tconst activeWarnings = this.warnings.map(warning => warning.getContent()).flat().filter(content => content != '');\r\n\t\tlet tooltipFragment = document.createElement('fragment');\r\n\t\ttooltipFragment.innerHTML = this.warningsLink.getAttribute('data-bs-title') as string;\r\n\t\tlet list = tooltipFragment.children[0] as HTMLElement;\r\n\t\tlist.innerHTML = '';\r\n\t\tif (activeWarnings.length == 0) {\r\n\t\t\tthis.warningsLink.parentElement?.classList?.add('hide');\r\n\t\t} else {\r\n\t\t\tthis.warningsLink.parentElement?.classList?.remove('hide');\r\n\t\t\tactiveWarnings.forEach(warning => {\r\n\t\t\t\tlet listItem = document.createElement('li');\r\n\t\t\t\tlistItem.innerHTML = warning;\r\n\t\t\t\tlist.appendChild(listItem);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.warningsLink.setAttribute('data-bs-title', list.outerHTML);\r\n\t\tnew Tooltip(this.warningsLink, {\r\n\t\t\ttitle: list.outerHTML,\r\n\t\t\thtml: true,\r\n\t\t\tplacement: 'bottom',\r\n\t\t});\r\n\t}\r\n\r\n\thideAll() {\r\n\t\tthis.contentElem.style.display = 'none';\r\n\t\tthis.pendingElem.style.display = 'none';\r\n\t}\r\n\r\n\tsetPending() {\r\n\t\tthis.contentElem.style.display = 'none';\r\n\t\tthis.pendingElem.style.display = 'block';\r\n\t}\r\n\r\n\tsetContent(innerHTML: string) {\r\n\t\tthis.contentElem.innerHTML = innerHTML;\r\n\t\tthis.contentElem.style.display = 'block';\r\n\t\tthis.pendingElem.style.display = 'none';\r\n\t}\r\n}\r\n","import { Component } from './component.js';\r\nimport {\r\n\tgetLaunchedSimsForClass,\r\n\tLaunchStatus,\r\n\traidSimStatus,\r\n\tsimLaunchStatuses\r\n} from '../launched_sims.js';\r\nimport { Class, Spec } from '../proto/common.js';\r\nimport {\r\n\tclassNames,\r\n\tgetSpecSiteUrl,\r\n\tnaturalClassOrder,\r\n\traidSimSiteUrl,\r\n\traidSimIcon,\r\n\traidSimLabel,\r\n\tspecNames,\r\n\tspecToClass,\r\n\ttextCssClassForClass,\r\n\ttextCssClassForSpec,\r\n\ttitleIcons,\r\n} from '../proto_utils/utils.js';\r\n\r\ninterface ClassOptions {\r\n\ttype: 'Class',\r\n\tindex: Class\r\n}\r\n\r\ninterface SpecOptions {\r\n\ttype: 'Spec'\r\n\tindex: Spec\r\n}\r\n\r\ninterface RaidOptions {\r\n\ttype: 'Raid'\r\n}\r\n\r\ntype SimTitleDropdownConfig = {\r\n\tnoDropdown?: boolean,\r\n}\r\n\r\n// Dropdown menu for selecting a player.\r\nexport class SimTitleDropdown extends Component {\r\n\tprivate readonly dropdownMenu: HTMLElement | undefined;\r\n\r\n\tprivate readonly specLabels: Record<Spec, string> = {\r\n\t\t[Spec.SpecBalanceDruid]: 'Balance',\r\n\t\t[Spec.SpecFeralDruid]: 'Feral DPS',\r\n\t\t[Spec.SpecFeralTankDruid]: 'Feral Tank',\r\n\t\t[Spec.SpecRestorationDruid]: 'Restoration',\r\n\t\t[Spec.SpecElementalShaman]: 'Elemental',\r\n\t\t[Spec.SpecEnhancementShaman]: 'Enhancement',\r\n\t\t[Spec.SpecRestorationShaman]: 'Restoration',\r\n\t\t[Spec.SpecHunter]: 'Hunter',\r\n\t\t[Spec.SpecMage]: 'Mage',\r\n\t\t[Spec.SpecRogue]: 'Rogue',\r\n\t\t[Spec.SpecHolyPaladin]: 'Holy',\r\n\t\t[Spec.SpecProtectionPaladin]: 'Protection',\r\n\t\t[Spec.SpecRetributionPaladin]: 'Retribution',\r\n\t\t[Spec.SpecHealingPriest]: 'Healing',\r\n\t\t[Spec.SpecShadowPriest]: 'Shadow',\r\n\t\t[Spec.SpecSmitePriest]: 'Smite',\r\n\t\t[Spec.SpecWarlock]: 'Warlock',\r\n\t\t[Spec.SpecWarrior]: 'DPS',\r\n\t\t[Spec.SpecProtectionWarrior]: 'Protection',\r\n\t\t[Spec.SpecDeathknight]: 'DPS',\r\n\t\t[Spec.SpecTankDeathknight]: 'Tank',\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, currentSpecIndex: Spec | null, config: SimTitleDropdownConfig = {}) {\r\n\t\tsuper(parent, 'sim-title-dropdown-root');\r\n\r\n\t\tlet rootLinkArgs: SpecOptions | RaidOptions = currentSpecIndex === null ? { type: 'Raid' } : { type: 'Spec', index: currentSpecIndex }\r\n\t\tlet rootLink = this.buildRootSimLink(rootLinkArgs);\r\n\r\n\t\tif (config.noDropdown) {\r\n\t\t\tthis.rootElem.innerHTML = rootLink.outerHTML;\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tthis.rootElem.innerHTML = `\r\n      <div class=\"dropdown sim-link-dropdown\">\r\n        ${rootLink.outerHTML}\r\n        <ul class=\"dropdown-menu\"></ul>\r\n      </div>\r\n    `;\r\n\r\n\t\tthis.dropdownMenu = this.rootElem.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\r\n\t\tthis.buildDropdown();\r\n\r\n\t\t// Prevent Bootstrap from closing the menu instead of opening class menus\r\n\t\tthis.dropdownMenu.addEventListener('click', (event) => {\r\n\t\t\tlet target = event.target as HTMLElement;\r\n\t\t\tlet link = target.closest('a:not([href=\"javascript:void(0)\"]');\r\n\r\n\t\t\tif (!link) {\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tprivate buildDropdown() {\r\n\t\tif (raidSimStatus >= LaunchStatus.Alpha) {\r\n\t\t\t// Add the raid sim to the top of the dropdown\r\n\t\t\tlet raidListItem = document.createElement('li');\r\n\t\t\traidListItem.appendChild(this.buildRaidLink());\r\n\t\t\tthis.dropdownMenu?.appendChild(raidListItem);\r\n\t\t}\r\n\r\n\t\tnaturalClassOrder.forEach(classIndex => {\r\n\t\t\tlet listItem = document.createElement('li');\r\n\t\t\tlet sims = getLaunchedSimsForClass(classIndex);\r\n\r\n\t\t\tif (sims.length == 1) {\r\n\t\t\t\t// The class only has one listed sim so make a direct link to the sim\r\n\t\t\t\tlistItem.appendChild(this.buildClassLink(classIndex));\r\n\t\t\t\tthis.dropdownMenu?.appendChild(listItem);\r\n\t\t\t} else if (sims.length > 1) {\r\n\t\t\t\t// Add the class to the dropdown with an additional spec dropdown\r\n\t\t\t\tlistItem.appendChild(this.buildClassDropdown(classIndex));\r\n\t\t\t\tthis.dropdownMenu?.appendChild(listItem);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildClassDropdown(classIndex: Class) {\r\n\t\tlet sims = getLaunchedSimsForClass(classIndex);\r\n\t\tlet dropdownFragment = document.createElement('fragment');\r\n\t\tlet dropdownMenu = document.createElement('ul');\r\n\t\tdropdownMenu.classList.add('dropdown-menu');\r\n\r\n\t\t// Generate the class link to act as a dropdown toggle for the spec dropdown\r\n\t\tlet classLink = this.buildClassLink(classIndex);\r\n\r\n\t\t// Generate links for a class's specs\r\n\t\tsims.forEach((specIndex) => {\r\n\t\t\tlet listItem = document.createElement('li');\r\n\t\t\tlet link = this.buildSpecLink(specIndex);\r\n\r\n\t\t\tlistItem.appendChild(link);\r\n\t\t\tdropdownMenu.appendChild(listItem);\r\n\t\t});\r\n\r\n\t\tdropdownFragment.innerHTML = `\r\n      <div class=\"dropend sim-link-dropdown\">\r\n        ${classLink.outerHTML}\r\n        ${dropdownMenu.outerHTML}\r\n      </div>\r\n    `;\r\n\r\n\t\treturn dropdownFragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprivate buildRootSimLink(data: SpecOptions | RaidOptions): HTMLElement {\r\n\t\tlet iconPath = this.getSimIconPath(data);;\r\n\t\tlet textKlass = this.getContextualKlass(data);\r\n\t\tlet label;\r\n\r\n\t\tif (data.type == 'Raid')\r\n\t\t\tlabel = raidSimLabel;\r\n\t\telse {\r\n\t\t\tlet classIndex = specToClass[data.index];\r\n\t\t\tif (getLaunchedSimsForClass(classIndex).length > 1)\r\n\t\t\t\t// If the class has multiple sims, use the spec name\r\n\t\t\t\tlabel = specNames[data.index];\r\n\t\t\telse\r\n\t\t\t\t// If the class has only 1 sim, use the class name\r\n\t\t\t\tlabel = classNames[classIndex];\r\n\t\t}\r\n\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <a href=\"javascript:void(0)\" class=\"sim-link ${textKlass}\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n        <div class=\"sim-link-content\">\r\n          <img src=\"${iconPath}\" class=\"sim-link-icon\">\r\n          <div class=\"d-flex flex-column\">\r\n            <span class=\"sim-link-label text-white\">WoWSims - WOTLK</span>\r\n            <span class=\"sim-link-title\">${label}</span>\r\n            ${this.launchStatusLabel(data)}\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n\t\treturn fragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprivate buildRaidLink(): HTMLElement {\r\n\t\tlet href = raidSimSiteUrl;\r\n\t\tlet textKlass = this.getContextualKlass({ type: 'Raid' });\r\n\t\tlet iconPath = this.getSimIconPath({ type: 'Raid' });\r\n\t\tlet label = raidSimLabel;\r\n\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <a href=\"${raidSimSiteUrl}\" class=\"sim-link ${textKlass}\">\r\n        <div class=\"sim-link-content\">\r\n          <img src=\"${iconPath}\" class=\"sim-link-icon\">\r\n          <div class=\"d-flex flex-column\">\r\n            <span class=\"sim-link-title\">${label}</span>\r\n            ${this.launchStatusLabel({ type: 'Raid' })}\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n\t\treturn fragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprivate buildClassLink(classIndex: Class): HTMLElement {\r\n\t\tlet specIndexes = getLaunchedSimsForClass(classIndex);\r\n\t\tlet href = specIndexes.length > 1 ? 'javascript:void(0)' : getSpecSiteUrl(specIndexes[0]);\r\n\t\tlet textKlass = this.getContextualKlass({ type: 'Class', index: classIndex });\r\n\t\tlet iconPath = this.getSimIconPath({ type: 'Class', index: classIndex });\r\n\t\tlet label = classNames[classIndex];\r\n\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <a href=\"${href}\" class=\"sim-link ${textKlass}\" ${specIndexes.length > 1 ? 'role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\"' : ''}>\r\n        <div class=\"sim-link-content\">\r\n          <img src=\"${iconPath}\" class=\"sim-link-icon\">\r\n          <div class=\"d-flex flex-column\">\r\n            <span class=\"sim-link-title\">${label}</span>\r\n            ${specIndexes.length == 1 ? this.launchStatusLabel({ type: 'Spec', index: specIndexes[0] }) : ''}\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n\t\treturn fragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprivate buildSpecLink(specIndex: Spec): HTMLElement {\r\n\t\tlet href = getSpecSiteUrl(specIndex);\r\n\t\tlet textKlass = this.getContextualKlass({ type: 'Spec', index: specIndex });\r\n\t\tlet iconPath = this.getSimIconPath({ type: 'Spec', index: specIndex });\r\n\t\tlet className = classNames[specToClass[specIndex]];\r\n\t\tlet specLabel = this.specLabels[specIndex];\r\n\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <a href=\"${href}\" class=\"sim-link ${textKlass}\" role=\"button\">\r\n        <div class=\"sim-link-content\">\r\n          <img src=\"${iconPath}\" class=\"sim-link-icon\">\r\n          <div class=\"d-flex flex-column\">\r\n            <span class=\"sim-link-label\">${className}</span>\r\n            <span class=\"sim-link-title\">${specLabel}</span>\r\n            ${this.launchStatusLabel({ type: 'Spec', index: specIndex })}\r\n          </div>\r\n        </div>\r\n      </a>\r\n    `;\r\n\r\n\t\treturn fragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprivate launchStatusLabel(data: SpecOptions | RaidOptions): string {\r\n\t\tif (\r\n\t\t\t(data.type == 'Raid' && raidSimStatus == LaunchStatus.Launched) ||\r\n\t\t\t(data.type == 'Spec' && simLaunchStatuses[data.index] == LaunchStatus.Launched)\r\n\t\t) return \"\";\r\n\r\n\t\tlet label = data.type == 'Raid' ? LaunchStatus[raidSimStatus] : LaunchStatus[simLaunchStatuses[data.index]];\r\n\t\tlet elem = document.createElement('span');\r\n\t\telem.classList.add('launch-status-label', 'text-brand');\r\n\t\telem.textContent = label;\r\n\r\n\t\treturn elem.outerHTML;\r\n\t}\r\n\r\n\tprivate getSimIconPath(data: ClassOptions | SpecOptions | RaidOptions): string {\r\n\t\tlet iconPath: string;\r\n\r\n\t\tif (data.type == 'Raid') {\r\n\t\t\ticonPath = raidSimIcon;\r\n\t\t} else if (data.type == 'Class') {\r\n\t\t\tlet className = classNames[data.index];\r\n\t\t\ticonPath = `/wotlk/assets/img/${className.toLowerCase().replace(/\\s/g, '_')}_icon.png`\r\n\t\t} else {\r\n\t\t\ticonPath = titleIcons[data.index];\r\n\t\t}\r\n\r\n\t\treturn iconPath;\r\n\t}\r\n\r\n\tprivate getContextualKlass(data: ClassOptions | SpecOptions | RaidOptions): string {\r\n\t\tif (data.type == 'Raid')\r\n\t\t\t// Raid link\r\n\t\t\treturn 'text-white';\r\n\t\telse if (data.type == 'Class')\r\n\t\t\t// Class links\r\n\t\t\treturn textCssClassForClass(data.index);\r\n\t\telse\r\n\t\t\treturn textCssClassForSpec(data.index);\r\n\t}\r\n}\r\n","import { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\n/**\r\n * Data for creating a boolean picker (checkbox).\r\n */\r\nexport interface BooleanPickerConfig<ModObject> extends InputConfig<ModObject, boolean> {\r\n\tcssScheme?: string;\r\n}\r\n\r\n// UI element for picking an arbitrary number field.\r\nexport class BooleanPicker<ModObject> extends Input<ModObject, boolean> {\r\n\tprivate readonly inputElem: HTMLInputElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: BooleanPickerConfig<ModObject>) {\r\n\t\tsuper(parent, 'boolean-picker-root', modObject, config);\r\n\r\n\t\tthis.rootElem.classList.add('form-check', 'form-check-reverse');\r\n\r\n\t\tthis.inputElem = document.createElement('input');\r\n\t\tthis.inputElem.type = 'checkbox';\r\n\t\tthis.inputElem.classList.add('boolean-picker-input', 'form-check-input');\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('change', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): boolean {\r\n\t\treturn Boolean(this.inputElem.checked);\r\n\t}\r\n\r\n\tsetInputValue(newValue: boolean) {\r\n\t\tthis.inputElem.checked = newValue;\r\n\t}\r\n}\r\n","import { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\nexport interface EnumValueConfig {\r\n\tname: string,\r\n\tvalue: number,\r\n\ttooltip?: string,\r\n}\r\n\r\nexport interface EnumPickerConfig<ModObject> extends InputConfig<ModObject, number> {\r\n\tvalues: Array<EnumValueConfig>;\r\n}\r\n\r\nexport class EnumPicker<ModObject> extends Input<ModObject, number> {\r\n\tprivate readonly selectElem: HTMLSelectElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: EnumPickerConfig<ModObject>) {\r\n\t\tsuper(parent, 'enum-picker-root', modObject, config);\r\n\r\n\t\tthis.selectElem = document.createElement('select');\r\n\t\tthis.selectElem.classList.add('enum-picker-selector', 'form-select');\r\n\r\n\t\tconfig.values.forEach((value) => {\r\n\t\t\tconst option = document.createElement('option');\r\n\t\t\toption.value = String(value.value);\r\n\t\t\toption.textContent = value.name;\r\n\t\t\tthis.selectElem.appendChild(option);\r\n\r\n\t\t\tif (value.tooltip) {\r\n\t\t\t\toption.title = value.tooltip;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.rootElem.appendChild(this.selectElem);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.selectElem.addEventListener('change', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.selectElem;\r\n\t}\r\n\r\n\tgetInputValue(): number {\r\n\t\treturn parseInt(this.selectElem.value);\r\n\t}\r\n\r\n\tsetInputValue(newValue: number) {\r\n\t\tthis.selectElem.value = String(newValue);\r\n\t}\r\n}\r\n","import { Component } from './component.js';\r\n\r\nexport type CloseButtonConfig = {\r\n\tfixed?: boolean,\r\n}\r\n\r\nconst DEFAULT_CONFIG = {\r\n\tfixed: false,\r\n}\r\n\r\nexport class CloseButton extends Component {\r\n\tprivate readonly config: CloseButtonConfig;\r\n\r\n\tconstructor(parent: HTMLElement, onClick: () => void, config: CloseButtonConfig = {}) {\r\n\t\tsuper(parent, 'close-button', document.createElement('a'));\r\n\t\tthis.config = { ...DEFAULT_CONFIG, ...config };\r\n\r\n\t\tif (this.config.fixed)\r\n\t\t\tthis.rootElem.classList.add('position-fixed');\r\n\r\n\t\tthis.rootElem.setAttribute('href', 'javascript:void(0)');\r\n\t\tthis.rootElem.setAttribute('role', 'button');\r\n\t\tthis.rootElem.addEventListener('click', () => onClick());\r\n\r\n\t\tthis.rootElem.insertAdjacentHTML('beforeend', '<i class=\"fas fa-times fa-2xl ms-1\"></i>');\r\n\t}\r\n}\r\n","import { CloseButton, CloseButtonConfig } from './close_button';\r\nimport { Component } from './component';\r\n\r\nimport { Modal } from 'bootstrap';\r\n\r\ntype ModalSize = 'sm' | 'md' | 'lg' | 'xl';\r\n\r\ntype BaseModalConfig = {\r\n\tcloseButton?: CloseButtonConfig,\r\n\t// Whether or not to add a modal-footer element\r\n\tfooter?: boolean,\r\n\t// Whether or not to add a modal-header element\r\n\theader?: boolean,\r\n\t// Whether or not to allow modal contents to extend past the screen height.\r\n\t// When true, the modal is fixed to the screen height and body contents will scroll.\r\n\tscrollContents?: boolean,\r\n\t// Specify the size of the modal\r\n\tsize?: ModalSize,\r\n\t// A title for the modal\r\n\ttitle?: string | null,\r\n};\r\n\r\nconst DEFAULT_CONFIG = {\r\n\tcloseButton: {},\r\n\tfooter: false,\r\n\theader: true,\r\n\tscrollContents: false,\r\n\tsize: 'lg' as ModalSize,\r\n\ttitle: null,\r\n}\r\n\r\nexport class BaseModal extends Component {\r\n\treadonly modalConfig: BaseModalConfig;\r\n\r\n\treadonly modal: Modal;\r\n\treadonly dialog: HTMLElement;\r\n\treadonly header: HTMLElement | undefined;\r\n\treadonly body: HTMLElement;\r\n\treadonly footer: HTMLElement | undefined;\r\n\r\n\tconstructor(parent: HTMLElement, cssClass: string, config: BaseModalConfig = {}) {\r\n\t\tsuper(parent, 'modal');\r\n\t\tthis.modalConfig = { ...DEFAULT_CONFIG, ...config };\r\n\r\n\t\tconst modalSizeKlass = this.modalConfig.size && this.modalConfig.size != 'md' ? `modal-${this.modalConfig.size}` : '';\r\n\r\n\t\tthis.rootElem.classList.add('fade');\r\n\t\tthis.rootElem.innerHTML = `\r\n\t\t\t<div class=\"modal-dialog ${cssClass} ${modalSizeKlass}\">\r\n\t\t\t\t<div class=\"modal-content\"></div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tthis.dialog = this.rootElem.querySelector('.modal-dialog') as HTMLElement;\r\n\r\n\t\tif (this.modalConfig.scrollContents) {\r\n\t\t\tthis.dialog.classList.add('modal-overflow-scroll');\r\n\t\t}\r\n\r\n\t\tconst container = this.rootElem.querySelector('.modal-content') as HTMLElement;\r\n\r\n\t\tif (this.modalConfig.header) {\r\n\t\t\tthis.header = document.createElement('div');\r\n\t\t\tthis.header.classList.add('modal-header');\r\n\t\t\tcontainer.appendChild(this.header);\r\n\r\n\t\t\tif (this.modalConfig.title) {\r\n\t\t\t\tthis.header.insertAdjacentHTML('afterbegin', `<h5 class=\"modal-title\">${this.modalConfig.title}</h5>`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.body = document.createElement('div');\r\n\t\tthis.body.classList.add('modal-body');\r\n\t\tcontainer.appendChild(this.body);\r\n\r\n\t\tthis.addCloseButton();\r\n\r\n\t\tif (this.modalConfig.footer) {\r\n\t\t\tthis.footer = document.createElement('div');\r\n\t\t\tthis.footer.classList.add('modal-footer');\r\n\t\t\tcontainer.appendChild(this.footer);\r\n\t\t}\r\n\r\n\t\tthis.modal = new Modal(this.rootElem);\r\n\t\tthis.open();\r\n\r\n\t\tthis.rootElem.addEventListener('hidden.bs.modal', (event) => {\r\n\t\t\tthis.rootElem.remove();\r\n\t\t\tthis.dispose();\r\n\t\t})\r\n\t}\r\n\r\n\tprivate addCloseButton() {\r\n\t\tnew CloseButton(this.header ? this.header : this.body, () => this.close(), this.modalConfig.closeButton);\r\n\t}\r\n\r\n\tprotected onShow(e: Event) {}\r\n\r\n\topen() {\r\n\t\t// Hacks for better looking multi modals\r\n\t\tthis.rootElem.addEventListener('show.bs.modal', async event => {\r\n\t\t\t// Prevent the event from bubbling up to parent modals\r\n\t\t\tevent.stopImmediatePropagation();\r\n\r\n\t\t\t// Wait for the backdrop to be injected into the DOM\r\n\t\t\tconst backdrop = await new Promise((resolve) => {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (this.modal._backdrop._element)\r\n\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\tresolve(this.modal._backdrop._element)\r\n\t\t\t\t}, 100);\r\n\t\t\t}) as HTMLElement;\r\n\t\t\t// Then move it from <body> to the parent element\r\n\t\t\tthis.rootElem.insertAdjacentElement('afterend', backdrop);\r\n\t\t\tthis.onShow(event);\r\n\t\t});\r\n\r\n\t\tthis.rootElem.addEventListener('hide.bs.modal', (event) => {\r\n\t\t\t// Prevent the event from bubbling up to parent modals\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\r\n\t\tthis.rootElem.addEventListener('hidden.bs.modal', (event) => {\r\n\t\t\t// Prevent the event from bubbling up to parent modals\r\n\t\t\t// Do not use stopImmediatePropagation here. It prevents Bootstrap from removing the modal,\r\n\t\t\t// leading to other issues\r\n\t\t\tevent.stopPropagation();\r\n\t\t})\r\n\r\n\t\tthis.modal.show();\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis.modal.hide();\r\n\t}\r\n}\r\n","import { SimUI } from '../sim_ui.js';\r\nimport { Sim } from '../sim.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { wowheadSupportedLanguages } from '../constants/lang.js';\r\nimport { BooleanPicker } from '../components/boolean_picker.js';\r\nimport { EnumPicker } from '../components/enum_picker.js';\r\nimport { NumberPicker } from '../components/number_picker.js';\r\nimport { BaseModal } from './base_modal.js';\r\nimport { Tooltip } from 'bootstrap';\r\n\r\nexport class SettingsMenu extends BaseModal {\r\n\tprivate readonly simUI: SimUI;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI) {\r\n\t\tsuper(parent, 'settings-menu', { title: \"Options\", footer: true });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"picker-group\">\r\n\t\t\t\t<div class=\"fixed-rng-seed-container\">\r\n\t\t\t\t\t<div class=\"fixed-rng-seed\"></div>\r\n\t\t\t\t\t<div class=\"form-text\">\r\n\t\t\t\t\t\t<span>Last used RNG seed:</span>&nbsp;<span class=\"last-used-rng-seed\">0</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"language-picker within-raid-sim-hide\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"show-threat-metrics-picker w-50 pe-2\"></div>\r\n\t\t\t<div class=\"show-experimental-picker w-50 pe-2\"></div>\r\n\t\t`;\r\n\t\tthis.footer!.innerHTML = `\r\n\t\t\t<button\r\n\t\t\t\tclass=\"restore-defaults-button btn btn-primary\"\r\n\t\t\t>Restore Defaults</button>\r\n\t\t`\r\n\r\n\t\tconst restoreDefaultsButton = this.rootElem.getElementsByClassName('restore-defaults-button')[0] as HTMLElement;\r\n\t\tTooltip.getOrCreateInstance(restoreDefaultsButton, {\r\n\t\t\ttitle: \"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved.\"\r\n\t\t});\r\n\t\trestoreDefaultsButton.addEventListener('click', event => {\r\n\t\t\tthis.simUI.applyDefaults(TypedEvent.nextEventID());\r\n\t\t});\r\n\r\n\t\tconst fixedRngSeed = this.rootElem.getElementsByClassName('fixed-rng-seed')[0] as HTMLElement;\r\n\t\tnew NumberPicker(fixedRngSeed, this.simUI.sim, {\r\n\t\t\tlabel: 'Fixed RNG Seed',\r\n\t\t\tlabelTooltip: 'Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.',\r\n\t\t\textraCssClasses: ['mb-0'],\r\n\t\t\tchangedEvent: (sim: Sim) => sim.fixedRngSeedChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => sim.getFixedRngSeed(),\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\tsim.setFixedRngSeed(eventID, newValue);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst lastUsedRngSeed = this.rootElem.getElementsByClassName('last-used-rng-seed')[0] as HTMLElement;\r\n\t\tlastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed());\r\n\t\tthis.simUI.sim.lastUsedRngSeedChangeEmitter.on(() => lastUsedRngSeed.textContent = String(this.simUI.sim.getLastUsedRngSeed()));\r\n\r\n\t\tconst language = this.rootElem.getElementsByClassName('language-picker')[0] as HTMLElement;\r\n\t\tconst langs = Object.keys(wowheadSupportedLanguages);\r\n\t\tconst defaultLang = langs.indexOf('en');\r\n\t\tconst languagePicker = new EnumPicker(language, this.simUI.sim, {\r\n\t\t\tlabel: 'Language',\r\n\t\t\tlabelTooltip: 'Controls the language for Wowhead tooltips.',\r\n\t\t\tvalues: langs.map((lang, i) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: wowheadSupportedLanguages[lang],\r\n\t\t\t\t\tvalue: i,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: (sim: Sim) => sim.languageChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => {\r\n\t\t\t\tconst idx = langs.indexOf(sim.getLanguage());\r\n\t\t\t\treturn idx == -1 ? defaultLang : idx;\r\n\t\t\t},\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\tsim.setLanguage(eventID, langs[newValue] || 'en');\r\n\t\t\t},\r\n\t\t});\r\n\t\t// Refresh page after language change, to apply the changes.\r\n\t\tlanguagePicker.changeEmitter.on(() => setTimeout(() => location.reload(), 100));\r\n\r\n\t\tconst showThreatMetrics = this.rootElem.getElementsByClassName('show-threat-metrics-picker')[0] as HTMLElement;\r\n\t\tnew BooleanPicker(showThreatMetrics, this.simUI.sim, {\r\n\t\t\tlabel: 'Show Threat/Tank Options',\r\n\t\t\tlabelTooltip: 'Shows all options and metrics relevant to tanks, like TPS/DTPS.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: (sim: Sim) => sim.showThreatMetricsChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => sim.getShowThreatMetrics(),\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\tsim.setShowThreatMetrics(eventID, newValue);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst showExperimental = this.rootElem.getElementsByClassName('show-experimental-picker')[0] as HTMLElement;\r\n\t\tnew BooleanPicker(showExperimental, this.simUI.sim, {\r\n\t\t\tlabel: 'Show Experimental',\r\n\t\t\tlabelTooltip: 'Shows experimental options, if there are any active experiments.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: (sim: Sim) => sim.showExperimentalChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => sim.getShowExperimental(),\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\tsim.setShowExperimental(eventID, newValue);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n","import { Component } from './component';\r\nimport { SettingsMenu } from './settings_menu';\r\nimport { SimUI } from '../sim_ui';\r\nimport { Tooltip } from 'bootstrap';\r\nimport { SimTab } from './sim_tab';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\ninterface ToolbarLinkArgs {\r\n\tparent: HTMLElement,\r\n\thref?: string,\r\n\ttext?: string,\r\n\ticon?: string,\r\n\ttooltip?: string | HTMLElement,\r\n\tclasses?: string,\r\n\tonclick?: Function\r\n}\r\n\r\nexport class SimHeader extends Component {\r\n\tprivate simUI: SimUI;\r\n\r\n\tprivate simTabsContainer: HTMLElement;\r\n\tprivate simToolbar: HTMLElement;\r\n\tprivate knownIssuesLink: HTMLElement;\r\n\tprivate knownIssuesContent: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: SimUI) {\r\n\t\tsuper(parentElem, 'sim-header');\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.simTabsContainer = this.rootElem.querySelector('.sim-tabs') as HTMLElement;\r\n\t\tthis.simToolbar = this.rootElem.querySelector('.sim-toolbar') as HTMLElement;\r\n\r\n\t\tthis.knownIssuesContent = <ul className='text-start ps-3 mb-0'></ul> as HTMLElement;\r\n\t\tthis.knownIssuesLink = this.addKnownIssuesLink();\r\n\t\tthis.addBugReportLink();\r\n\t\tthis.addDownloadBinaryLink();\r\n\t\tthis.addSimOptionsLink();\r\n\t\tthis.addSocialLinks();\r\n\r\n\t\t// Allow styling the sticky header\r\n\t\tnew IntersectionObserver(\r\n\t\t\t([e]) => e.target.classList.toggle('stuck', e.intersectionRatio < 1),\r\n\t\t\t{threshold: [1]}\r\n\t\t).observe(this.rootElem)\r\n\t}\r\n\r\n\tactivateTab(className: string) {\r\n\t\t(this.simTabsContainer.getElementsByClassName(className)[0] as HTMLElement).click();\r\n\t}\r\n\r\n\taddTab(title: string, contentId: string) {\r\n\t\tconst isFirstTab = this.simTabsContainer.children.length == 0;\r\n\r\n\t\tlet classes = `${contentId} nav-item`;\r\n\t\tlet tab = (\r\n\t\t\t<li className={classes} attributes={{role:\"presentation\"}}>\r\n\t\t\t\t<a className={`nav-link ${isFirstTab && 'active'}`}\r\n\t\t\t\t\tdataset={{\r\n\t\t\t\t\t\tbsToggle:'tab',\r\n\t\t\t\t\t\tbsTarget: `#${contentId}`,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tattributes={{\r\n\t\t\t\t\t\trole:'tab',\r\n\t\t\t\t\t\t'aria-selected':isFirstTab,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\ttype='button'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{title}\r\n\t\t\t\t</a>\r\n\t\t\t</li>\r\n\t\t);\r\n\t\ttab.setAttribute('aria-controls', contentId);\r\n\r\n\t\tthis.simTabsContainer.appendChild(tab);\r\n\t}\r\n\r\n\taddSimTabLink(tab: SimTab) {\r\n\t\tconst isFirstTab = this.simTabsContainer.children.length == 0;\r\n\r\n\t\ttab.navLink.setAttribute('aria-selected', isFirstTab.toString());\r\n\r\n\t\tif (isFirstTab) tab.navLink.classList.add('active', 'show');\r\n\r\n\t\tthis.simTabsContainer.appendChild(tab.navItem);\r\n\t}\r\n\r\n\taddImportLink(label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\r\n\t\tthis.addImportExportLink('import-dropdown', label, onClick, hideInRaidSim);\r\n\t}\r\n\taddExportLink(label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\r\n\t\tthis.addImportExportLink('export-dropdown', label, onClick, hideInRaidSim);\r\n\t}\r\n\tprivate addImportExportLink(cssClass: string, label: string, onClick: (parent: HTMLElement) => void, hideInRaidSim?: boolean) {\r\n\t\tconst dropdownElem = this.rootElem.getElementsByClassName(cssClass)[0] as HTMLElement;\r\n\t\tconst menuElem = dropdownElem.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\r\n\r\n\t\tconst itemElem = (\r\n\t\t\t<li>\r\n\t\t\t\t<a href=\"javascript:void(0)\"\r\n\t\t\t\t\tclassName='dropdown-item'\r\n\t\t\t\t\tattributes={{\r\n\t\t\t\t\t\trole: 'button'\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t{label}\r\n\t\t\t\t</a>\r\n\t\t\t</li>\r\n\t\t);\r\n\r\n\t\tconst linkElem = itemElem.children[0];\r\n\t\tlinkElem.addEventListener('click', () => onClick(menuElem));\r\n\t\tmenuElem.appendChild(itemElem);\r\n\t}\r\n\r\n\tprivate addToolbarLink(args: ToolbarLinkArgs): HTMLElement {\r\n\t\tlet item = (\r\n\t\t\t<div className=\"sim-toolbar-item\">\r\n\t\t\t\t<a \r\n\t\t\t\t\thref={args.href ? args.href : 'javascript:void(0)'}\r\n\t\t\t\t\tclassName={args.classes}\r\n\t\t\t\t\ttarget={args.href ? \"_blank\" : '_self'}\r\n\t\t\t\t>\r\n\t\t\t\t\t{args.icon && <i className={args.icon}></i>}\r\n\t\t\t\t\t{args.text ? ` ${args.text} ` : ''} \r\n\t\t\t\t</a>\r\n\t\t\t</div>);\r\n\r\n\t\tlet link = item.children[0];\r\n\r\n\t\tif (args.onclick) {\r\n\t\t\tlink.addEventListener('click', () => {\r\n\t\t\t\t// Typescript is requiring this even though the condition is being done already above\r\n\t\t\t\tif (args.onclick)\r\n\t\t\t\t\targs.onclick();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (args.tooltip) {\r\n\t\t\tnew Tooltip(link, {\r\n\t\t\t\tplacement: 'bottom',\r\n\t\t\t\ttitle: args.tooltip,\r\n\t\t\t\thtml: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn args.parent.appendChild(item) as HTMLElement;\r\n\t}\r\n\r\n\tprivate addKnownIssuesLink(): HTMLElement {\r\n\t\treturn this.addToolbarLink({\r\n\t\t\tparent: this.simToolbar,\r\n\t\t\ttext: \"Known Issues\",\r\n\t\t\ttooltip: this.knownIssuesContent,\r\n\t\t\tclasses: \"known-issues link-danger\"\r\n\t\t}).children[0] as HTMLElement;\r\n\t}\r\n\r\n\taddKnownIssue(issue: string) {\r\n\t\tthis.knownIssuesContent.appendChild(<li>{issue}</li>);\r\n\t\tTooltip.getInstance(this.knownIssuesLink)?.setContent({'.tooltip-inner': this.knownIssuesContent});\r\n\t}\r\n\r\n\tprivate addBugReportLink() {\r\n\t\tthis.addToolbarLink({\r\n\t\t\thref: \"https://github.com/Tereneckla/wotlk/issues/new/choose\",\r\n\t\t\tparent: this.simToolbar,\r\n\t\t\ticon: \"fas fa-bug fa-lg\",\r\n\t\t\ttooltip: \"Report a bug or<br>Request a feature\"\r\n\t\t})\r\n\t}\r\n\r\n\tprivate addDownloadBinaryLink() {\r\n\t\tlet href = \"https://github.com/Tereneckla/wotlk/releases\";\r\n\t\tlet icon = \"fas fa-gauge-high fa-lg\"\r\n\t\tlet parent = this.simToolbar;\r\n\r\n\t\tif (document.location.href.includes(\"localhost\")) {\r\n\t\t\tfetch(\"/version\").then(resp => {\r\n\t\t\t\tresp.json()\r\n\t\t\t\t\t.then((versionInfo) => {\r\n\t\t\t\t\t\tif (versionInfo.outdated == 2) {\r\n\t\t\t\t\t\t\tthis.addToolbarLink({\r\n\t\t\t\t\t\t\t\thref: href,\r\n\t\t\t\t\t\t\t\tparent: parent,\r\n\t\t\t\t\t\t\t\ticon: icon,\r\n\t\t\t\t\t\t\t\ttooltip: \"Newer version of simulator available for download\",\r\n\t\t\t\t\t\t\t\tclasses: \"downbin link-danger\",\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tconsole.warn('No version info found!');\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.addToolbarLink({\r\n\t\t\t\thref: href,\r\n\t\t\t\tparent: parent,\r\n\t\t\t\ticon: icon,\r\n\t\t\t\ttooltip: \"Download simulator for faster simulating\",\r\n\t\t\t\tclasses: \"downbin\",\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addSimOptionsLink() {\r\n\t\tthis.addToolbarLink({\r\n\t\t\tparent: this.simToolbar,\r\n\t\t\ticon: \"fas fa-cog fa-lg\",\r\n\t\t\ttooltip: \"Show Sim Options\",\r\n\t\t\tclasses: 'sim-options',\r\n\t\t\tonclick: () => new SettingsMenu(this.simUI.rootElem, this.simUI)\r\n\t\t})\r\n\t}\r\n\r\n\tprivate addSocialLinks() {\r\n\t\tlet container = document.createElement('div');\r\n\t\tcontainer.classList.add('sim-toolbar-socials')\r\n\t\tthis.simToolbar.appendChild(container);\r\n\r\n\t\tthis.addGitHubLink(container);\r\n\t}\r\n\r\n\tprivate addGitHubLink(container: HTMLElement) {\r\n\t\tthis.addToolbarLink({\r\n\t\t\thref: \"https://github.com/Tereneckla/wotlk\",\r\n\t\t\tparent: container,\r\n\t\t\ticon: \"fab fa-github fa-lg\",\r\n\t\t\ttooltip: \"Contribute on GitHub\",\r\n\t\t\tclasses: \"github-link link-alt\"\r\n\t\t})\r\n\t}\r\n\r\n\tprotected customRootElement(): HTMLElement {\r\n\t\treturn (\r\n\t\t\t<header className=\"sim-header\">\r\n\t\t\t\t<div className=\"sim-header-container\">\r\n\t\t\t\t\t<ul className=\"sim-tabs nav nav-tabs\" attributes={{role:\"tablist\"}}></ul>\r\n\t\t\t\t\t<div className=\"import-export within-raid-sim-hide\">\r\n\t\t\t\t\t\t<div className=\"dropdown sim-dropdown-menu import-dropdown\">\r\n\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" className=\"import-link\" attributes={{role:\"button\", 'aria-expanded':\"false\"}} dataset={{bsToggle:'dropdown', bsDisplay:'dynamic'}}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-download\"></i>\r\n\t\t\t\t\t\t\t\t{' Import '}\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<ul className=\"dropdown-menu\"></ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"dropdown sim-dropdown-menu export-dropdown\">\r\n\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" className=\"export-link\" attributes={{role:\"button\", 'aria-expanded':\"false\"}} dataset={{bsToggle:'dropdown', bsDisplay:'dynamic'}}>\r\n\t\t\t\t\t\t\t\t<i className=\"fa fa-right-from-bracket\"></i>\r\n\t\t\t\t\t\t\t\t{' Export '}\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t<ul className=\"dropdown-menu\"></ul>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"sim-toolbar\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</header>\r\n\t\t) as HTMLElement;\r\n\t}\r\n}\r\n","import { Component } from './components/component.js';\r\nimport { NumberPicker } from './components/number_picker.js';\r\nimport { ResultsViewer } from './components/results_viewer.js';\r\nimport { SimTitleDropdown } from './components/sim_title_dropdown.js';\r\nimport { SimHeader } from './components/sim_header';\r\nimport { Spec } from './proto/common.js';\r\nimport { ActionId } from './proto_utils/action_id.js';\r\nimport { LaunchStatus } from './launched_sims.js';\r\n\r\nimport { Sim, SimError } from './sim.js';\r\nimport { EventID, TypedEvent } from './typed_event.js';\r\n\r\nimport { SimTab } from './components/sim_tab.js';\r\nimport { BaseModal } from './components/base_modal.js';\r\n\r\nconst URLMAXLEN = 2048;\r\nconst globalKnownIssues = [\r\n\t'Wowhead tooltips may not correctly display Tier 8 set bonuses when combining 10 and 25 player tier pieces.'\r\n]\r\n\r\n// Config for displaying a warning to the user whenever a condition is met.\r\nexport interface SimWarning {\r\n\tupdateOn: TypedEvent<any>,\r\n\tgetContent: () => string | Array<string>,\r\n}\r\n\r\nexport interface SimUIConfig {\r\n\t// Additional css class to add to the root element.\r\n\tcssClass: string;\r\n\t// Scheme used for themeing on a per-class Basis or for other sims\r\n\tcssScheme: string;\r\n\t// The spec, if an individual sim, or null if the raid sim.\r\n\tspec: Spec | null,\r\n\tlaunchStatus: LaunchStatus,\r\n\tknownIssues?: Array<string>,\r\n\tnoticeText?: string,\r\n}\r\n\r\n// Shared UI for all individual sims and the raid sim.\r\nexport abstract class SimUI extends Component {\r\n\treadonly sim: Sim;\r\n\treadonly cssClass: string;\r\n\treadonly cssScheme: string;\r\n\treadonly isWithinRaidSim: boolean;\r\n\r\n\t// Emits when anything from the sim, raid, or encounter changes.\r\n\treadonly changeEmitter;\r\n\r\n\treadonly resultsViewer: ResultsViewer\r\n\treadonly simHeader: SimHeader;\r\n\r\n\treadonly simContentContainer: HTMLElement;\r\n\treadonly simMain: HTMLElement;\r\n\treadonly simActionsContainer: HTMLElement;\r\n\treadonly iterationsPicker: HTMLElement;\r\n\treadonly simTabContentsContainer: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, sim: Sim, config: SimUIConfig) {\r\n\t\tsuper(parentElem, 'sim-ui');\r\n\t\tthis.sim = sim;\r\n\t\tthis.cssClass = config.cssClass;\r\n\t\tthis.cssScheme = config.cssScheme;\r\n\t\tthis.isWithinRaidSim = this.rootElem.closest('.within-raid-sim') != null;\r\n\t\tthis.rootElem.innerHTML = `\r\n\t\t\t<div class=\"sim-root\">\r\n\t\t\t\t<div class=\"sim-bg\"></div>\r\n\t\t\t\t${config.noticeText ? `<div class=\"notices-banner alert border-bottom mb-0 text-center\">${config.noticeText}</div>` : ''}\r\n\t\t\t\t<div class=\"sim-container\">\r\n\t\t\t\t\t<aside class=\"sim-sidebar\">\r\n\t\t\t\t\t\t<div class=\"sim-title\"></div>\r\n\t\t\t\t\t\t<div class=\"sim-sidebar-content\">\r\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-actions within-raid-sim-hide\"></div>\r\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-results within-raid-sim-hide\"></div>\r\n\t\t\t\t\t\t\t<div class=\"sim-sidebar-footer\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</aside>\r\n\t\t\t\t\t<div class=\"sim-content container-fluid\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\tthis.simContentContainer = this.rootElem.querySelector('.sim-content') as HTMLElement;\r\n\t\tthis.simHeader = new SimHeader(this.simContentContainer, this);\r\n\t\tthis.simMain = document.createElement('main');\r\n\t\tthis.simMain.classList.add('sim-main', 'tab-content');\r\n\t\tthis.simContentContainer.appendChild(this.simMain);\r\n\r\n\t\tthis.rootElem.classList.add(this.cssClass);\r\n\r\n\t\tif (!this.isWithinRaidSim) {\r\n\t\t\tthis.rootElem.classList.add('not-within-raid-sim');\r\n\t\t}\r\n\r\n\t\tthis.changeEmitter = TypedEvent.onAny([\r\n\t\t\tthis.sim.changeEmitter,\r\n\t\t], 'SimUIChange');\r\n\r\n\t\tthis.sim.crashEmitter.on((eventID: EventID, error: SimError) => this.handleCrash(error));\r\n\r\n\t\tconst updateShowDamageMetrics = () => {\r\n\t\t\tif (this.sim.getShowDamageMetrics())\r\n\t\t\t\tthis.rootElem.classList.remove('hide-damage-metrics');\r\n\t\t\telse\r\n\t\t\t\tthis.rootElem.classList.add('hide-damage-metrics');\r\n\t\t};\r\n\t\tupdateShowDamageMetrics();\r\n\t\tthis.sim.showDamageMetricsChangeEmitter.on(updateShowDamageMetrics);\r\n\r\n\t\tconst updateShowThreatMetrics = () => {\r\n\t\t\tif (this.sim.getShowThreatMetrics())\r\n\t\t\t\tthis.rootElem.classList.remove('hide-threat-metrics');\r\n\t\t\telse\r\n\t\t\t\tthis.rootElem.classList.add('hide-threat-metrics');\r\n\t\t};\r\n\t\tupdateShowThreatMetrics();\r\n\t\tthis.sim.showThreatMetricsChangeEmitter.on(updateShowThreatMetrics);\r\n\r\n\t\tconst updateShowHealingMetrics = () => {\r\n\t\t\tif (this.sim.getShowHealingMetrics())\r\n\t\t\t\tthis.rootElem.classList.remove('hide-healing-metrics');\r\n\t\t\telse\r\n\t\t\t\tthis.rootElem.classList.add('hide-healing-metrics');\r\n\t\t};\r\n\t\tupdateShowHealingMetrics();\r\n\t\tthis.sim.showHealingMetricsChangeEmitter.on(updateShowHealingMetrics);\r\n\r\n\t\tconst updateShowEpRatios = () => {\r\n\t\t\t// Threat metrics *always* shows multiple columns, so\r\n\t\t\t// always show ratios when they are shown\r\n\t\t\tif (this.sim.getShowThreatMetrics()) {\r\n\t\t\t\tthis.rootElem.classList.remove('hide-ep-ratios');\r\n\t\t\t\t// This case doesn't currently happen, but who knows\r\n\t\t\t\t// what the future holds...\r\n\t\t\t} else if (this.sim.getShowDamageMetrics() && this.sim.getShowHealingMetrics()) {\r\n\t\t\t\tthis.rootElem.classList.remove('hide-ep-ratios');\r\n\t\t\t} else {\r\n\t\t\t\tthis.rootElem.classList.add('hide-ep-ratios');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tupdateShowEpRatios();\r\n\t\tthis.sim.showDamageMetricsChangeEmitter.on(updateShowEpRatios);\r\n\t\tthis.sim.showHealingMetricsChangeEmitter.on(updateShowEpRatios);\r\n\t\tthis.sim.showThreatMetricsChangeEmitter.on(updateShowEpRatios);\r\n\r\n\t\tconst updateShowExperimental = () => {\r\n\t\t\tif (this.sim.getShowExperimental())\r\n\t\t\t\tthis.rootElem.classList.remove('hide-experimental');\r\n\t\t\telse\r\n\t\t\t\tthis.rootElem.classList.add('hide-experimental');\r\n\t\t};\r\n\t\tupdateShowExperimental();\r\n\t\tthis.sim.showExperimentalChangeEmitter.on(updateShowExperimental);\r\n\r\n\t\tthis.addKnownIssues(config);\r\n\r\n\t\tconst titleElem = this.rootElem.querySelector('.sim-title') as HTMLElement;\r\n\t\tnew SimTitleDropdown(titleElem, config.spec, { noDropdown: this.isWithinRaidSim });\r\n\r\n\t\tconst resultsViewerElem = this.rootElem.getElementsByClassName('sim-sidebar-results')[0] as HTMLElement;\r\n\t\tthis.resultsViewer = new ResultsViewer(resultsViewerElem);\r\n\r\n\t\tthis.simActionsContainer = this.rootElem.getElementsByClassName('sim-sidebar-actions')[0] as HTMLElement;\r\n\r\n\t\tnew NumberPicker(this.simActionsContainer, this.sim, {\r\n\t\t\tlabel: 'Iterations',\r\n\t\t\textraCssClasses: [\r\n\t\t\t\t'iterations-picker',\r\n\t\t\t\t'within-raid-sim-hide',\r\n\t\t\t],\r\n\t\t\tchangedEvent: (sim: Sim) => sim.iterationsChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => sim.getIterations(),\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\tsim.setIterations(eventID, newValue);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.iterationsPicker = this.rootElem.getElementsByClassName('iterations-picker')[0] as HTMLElement;\r\n\t\tthis.simTabContentsContainer = this.rootElem.querySelector('.sim-main.tab-content') as HTMLElement;\r\n\r\n\t\tif (!this.isWithinRaidSim) {\r\n\t\t\twindow.addEventListener('message', async event => {\r\n\t\t\t\tif (event.data == 'runOnce') {\r\n\t\t\t\t\tthis.runSimOnce();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\taddAction(name: string, cssClass: string, actFn: () => void) {\r\n\t\tconst button = document.createElement('button');\r\n\t\tbutton.classList.add('btn', 'btn-primary', 'w-100', cssClass);\r\n\t\tbutton.textContent = name;\r\n\t\tbutton.addEventListener('click', actFn);\r\n\t\tthis.simActionsContainer.appendChild(button);\r\n\t}\r\n\r\n\taddTab(title: string, cssClass: string, innerHTML: string) {\r\n\t\tconst contentId = cssClass.replace(/\\s+/g, '-') + '-tab';\r\n\t\tconst isFirstTab = this.simTabContentsContainer.children.length == 0;\r\n\r\n\t\tthis.simHeader.addTab(title, contentId);\r\n\r\n\t\tconst tabContentFragment = document.createElement('fragment');\r\n\t\ttabContentFragment.innerHTML = `\r\n\t\t\t<div\r\n\t\t\t\tid=\"${contentId}\"\r\n\t\t\t\tclass=\"tab-pane fade ${isFirstTab ? 'active show' : ''}\"\r\n\t\t\t>${innerHTML}</div>\r\n\t\t`;\r\n\t\tthis.simTabContentsContainer.appendChild(tabContentFragment.children[0] as HTMLElement);\r\n\t}\r\n\r\n\taddSimTab(tab: SimTab) {\r\n\t\tthis.simHeader.addSimTabLink(tab);\r\n\t}\r\n\r\n\taddWarning(warning: SimWarning) {\r\n\t\tthis.resultsViewer.addWarning(warning);\r\n\t}\r\n\r\n\tprivate addKnownIssues(config: SimUIConfig) {\r\n\t\tlet statusStr = '';\r\n\t\tif (config.launchStatus == LaunchStatus.Unlaunched) {\r\n\t\t\tstatusStr = 'This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.';\r\n\t\t} else if (config.launchStatus == LaunchStatus.Alpha) {\r\n\t\t\tstatusStr = 'This sim is in ALPHA. Bugs are expected; please let us know if you find one!';\r\n\t\t} else if (config.launchStatus == LaunchStatus.Beta) {\r\n\t\t\tstatusStr = 'This sim is in BETA. There may still be a few bugs; please let us know if you find one!';\r\n\t\t}\r\n\t\tif (statusStr) {\r\n\t\t\tconfig.knownIssues = [statusStr].concat(config.knownIssues || []);\r\n\t\t}\r\n\t\tif (config.knownIssues && config.knownIssues.length) {\r\n\t\t\tconfig.knownIssues.forEach(issue => this.simHeader.addKnownIssue(issue));\r\n\t\t}\r\n\t\tglobalKnownIssues.forEach(issue => this.simHeader.addKnownIssue(issue));\r\n\t}\r\n\r\n\t// Returns a key suitable for the browser's localStorage feature.\r\n\tabstract getStorageKey(postfix: string): string;\r\n\r\n\tgetSettingsStorageKey(): string {\r\n\t\treturn this.getStorageKey('__currentSettings__');\r\n\t}\r\n\r\n\tgetSavedEncounterStorageKey(): string {\r\n\t\t// By skipping the call to this.getStorageKey(), saved encounters will be\r\n\t\t// shared across all sims.\r\n\t\treturn 'sharedData__savedEncounter__';\r\n\t}\r\n\r\n\tisIndividualSim(): boolean {\r\n\t\treturn this.rootElem.classList.contains('individual-sim-ui');\r\n\t}\r\n\r\n\tasync runSim(onProgress: Function) {\r\n\t\tthis.resultsViewer.setPending();\r\n\t\ttry {\r\n\t\t\tawait this.sim.runRaidSim(TypedEvent.nextEventID(), onProgress);\r\n\t\t} catch (e) {\r\n\t\t\tthis.resultsViewer.hideAll();\r\n\t\t\tthis.handleCrash(e);\r\n\t\t}\r\n\t}\r\n\r\n\tasync runSimOnce() {\r\n\t\tthis.resultsViewer.setPending();\r\n\t\ttry {\r\n\t\t\tawait this.sim.runRaidSimWithLogs(TypedEvent.nextEventID());\r\n\t\t} catch (e) {\r\n\t\t\tthis.resultsViewer.hideAll();\r\n\t\t\tthis.handleCrash(e);\r\n\t\t}\r\n\t}\r\n\r\n\tasync handleCrash(error: any): Promise<void> {\r\n\t\tif (!(error instanceof SimError)) {\r\n\t\t\talert(error);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst errorStr = (error as SimError).errorStr;\r\n\t\tif (errorStr.startsWith('[USER_ERROR] ')) {\r\n\t\t\tlet alertStr = errorStr.substring('[USER_ERROR] '.length);\r\n\t\t\talertStr = await ActionId.replaceAllInString(alertStr);\r\n\t\t\talert(alertStr);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.confirm('Simulation Failure:\\n' + errorStr + '\\nPress Ok to file crash report')) {\r\n\t\t\t// Splice out just the line numbers\r\n\t\t\tconst hash = this.hashCode(errorStr);\r\n\t\t\tconst link = this.toLink();\r\n\t\t\tconst rngSeed = this.sim.getLastUsedRngSeed();\r\n\t\t\tfetch('https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/wotlk+' + hash).then(resp => {\r\n\t\t\t\tresp.json().then((issues) => {\r\n\t\t\t\t\tif (issues.total_count > 0) {\r\n\t\t\t\t\t\twindow.open(issues.items[0].html_url, '_blank');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst base_url = 'https://github.com/Tereneckla/wotlk/issues/new?assignees=&labels=&title=Crash%20Report%20'\r\n\t\t\t\t\t\tconst base = `${base_url}${hash}&body=`;\r\n\t\t\t\t\t\tconst maxBodyLength = URLMAXLEN - base.length;\r\n\t\t\t\t\t\tlet issueBody = encodeURIComponent(`Link:\\n${link}\\n\\nRNG Seed: ${rngSeed}\\n\\n${errorStr}`);\r\n\t\t\t\t\t\tif (link.includes('/raid/')) {\r\n\t\t\t\t\t\t\t// Move the actual error before the link, as it will likely get truncated.\r\n\t\t\t\t\t\t\tissueBody = encodeURIComponent(`${errorStr}\\nRNG Seed: ${rngSeed}\\nLink:\\n${link}`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet truncated = false;\r\n\t\t\t\t\t\twhile (issueBody.length > maxBodyLength - (truncated ? 3 : 0)) {\r\n\t\t\t\t\t\t\tissueBody = issueBody.slice(0, issueBody.lastIndexOf('%')) // Avoid truncating in the middle of a URLencoded segment.\r\n\t\t\t\t\t\t\ttruncated = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (truncated) {\r\n\t\t\t\t\t\t\tissueBody += \"...\";\r\n\t\t\t\t\t\t\t// The raid links are too large and will always cause truncation.\r\n\t\t\t\t\t\t\t// Prompt the user to add more information to the issue.\r\n\t\t\t\t\t\t\tnew CrashModal(this.rootElem, link);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twindow.open(base + issueBody, '_blank');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}).catch(fetchErr => {\r\n\t\t\t\talert('Failed to file report... try again another time:' + fetchErr);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\thashCode(str: string): number {\r\n\t\tlet hash = 0;\r\n\t\tfor (let i = 0, len = str.length; i < len; i++) {\r\n\t\t\tlet chr = str.charCodeAt(i);\r\n\t\t\thash = (hash << 5) - hash + chr;\r\n\t\t\thash |= 0; // Convert to 32bit integer\r\n\t\t}\r\n\t\treturn hash;\r\n\t}\r\n\r\n\tabstract applyDefaults(eventID: EventID): void;\r\n\tabstract toLink(): string;\r\n}\r\n\r\nclass CrashModal extends BaseModal {\r\n\tconstructor(parent: HTMLElement, link: string) {\r\n\t\tsuper(parent, 'crash', { title: 'Extra Crash Information' });\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"sim-crash-report\">\r\n\t\t\t\t<h3 class=\"sim-crash-report-header\">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\r\n\t\t\t\t<textarea class=\"sim-crash-report-text form-control\"></textarea>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\tlet text = document.createTextNode(link);\r\n\t\tthis.body.querySelector('textarea')?.appendChild(text);\r\n\t}\r\n}\r\n","import { Stat, Class, PseudoStat, Spec } from '..//proto/common.js';\r\nimport { TristateEffect } from '..//proto/common.js'\r\nimport { getClassStatName, statOrder } from '..//proto_utils/names.js';\r\nimport { Stats } from '..//proto_utils/stats.js';\r\nimport { Player } from '..//player.js';\r\nimport { EventID, TypedEvent } from '..//typed_event.js';\r\n\r\nimport * as Mechanics from '../constants/mechanics.js';\r\n\r\nimport { NumberPicker } from './number_picker';\r\nimport { Component } from './component.js';\r\n\r\nimport { Popover, Tooltip } from 'bootstrap';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\nexport type StatMods = { talents: Stats };\r\n\r\nexport class CharacterStats extends Component {\r\n\treadonly stats: Array<Stat>;\r\n\treadonly valueElems: Array<HTMLTableCellElement>;\r\n\treadonly meleeCritCapValueElem: HTMLTableCellElement | undefined;\r\n\r\n\tprivate readonly player: Player<any>;\r\n\tprivate readonly modifyDisplayStats?: (player: Player<any>) => StatMods;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, stats: Array<Stat>, modifyDisplayStats?: (player: Player<any>) => StatMods) {\r\n\t\tsuper(parent, 'character-stats-root');\r\n\t\tthis.stats = statOrder.filter(stat => stats.includes(stat));\r\n\t\tthis.player = player;\r\n\t\tthis.modifyDisplayStats = modifyDisplayStats;\r\n\r\n\t\tconst label = document.createElement('label');\r\n\t\tlabel.classList.add('character-stats-label');\r\n\t\tlabel.textContent = 'Stats';\r\n\t\tthis.rootElem.appendChild(label);\r\n\r\n\t\tconst table = document.createElement('table');\r\n\t\ttable.classList.add('character-stats-table');\r\n\t\tthis.rootElem.appendChild(table);\r\n\r\n\t\tthis.valueElems = [];\r\n\t\tthis.stats.forEach(stat => {\r\n\t\t\tlet statName = getClassStatName(stat, player.getClass());\r\n\r\n\t\t\tconst row = (\r\n\t\t\t<tr\r\n\t\t\t\tclassName='character-stats-table-row'\r\n\t\t\t>\t\r\n\t\t\t\t<td className=\"character-stats-table-label\">{statName}</td>\r\n\t\t\t\t<td className=\"character-stats-table-value\">\r\n\t\t\t\t\t{this.bonusStatsLink(stat)}\r\n\t\t\t\t</td>\r\n\t\t\t</tr>);\r\n\r\n\t\t\ttable.appendChild(row);\r\n\r\n\t\t\tconst valueElem = row.getElementsByClassName('character-stats-table-value')[0] as HTMLTableCellElement;\r\n\t\t\tthis.valueElems.push(valueElem);\r\n\t\t});\r\n\r\n\t\tif(this.shouldShowMeleeCritCap(player)) {\r\n\t\t\tconst row = (\r\n\t\t\t<tr\r\n\t\t\t\tclassName='character-stats-table-row'\r\n\t\t\t>\r\n\t\t\t\t<td className=\"character-stats-table-label\">Melee Crit Cap</td>\r\n\t\t\t\t<td className=\"character-stats-table-value\"></td>\r\n\t\t\t</tr>);\r\n\r\n\t\t\ttable.appendChild(row);\r\n\t\t\tthis.meleeCritCapValueElem = row.getElementsByClassName('character-stats-table-value')[0] as HTMLTableCellElement;\r\n\t\t} else {\r\n\t\t\tthis.meleeCritCapValueElem = undefined;\r\n\t\t}\r\n\r\n\t\tthis.updateStats(player);\r\n\t\tTypedEvent.onAny([player.currentStatsEmitter, player.sim.changeEmitter, player.talentsChangeEmitter]).on(() => {\r\n\t\t\tthis.updateStats(player);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate updateStats(player: Player<any>) {\r\n\t\tconst playerStats = player.getCurrentStats();\r\n\r\n\t\tconst statMods = this.modifyDisplayStats ? this.modifyDisplayStats(this.player) : {\r\n\t\t\ttalents: new Stats(),\r\n\t\t};\r\n\r\n\t\tconst baseStats = Stats.fromProto(playerStats.baseStats);\r\n\t\tconst gearStats = Stats.fromProto(playerStats.gearStats);\r\n\t\tconst talentsStats = Stats.fromProto(playerStats.talentsStats);\r\n\t\tconst buffsStats = Stats.fromProto(playerStats.buffsStats);\r\n\t\tconst consumesStats = Stats.fromProto(playerStats.consumesStats);\r\n\t\tconst debuffStats = this.getDebuffStats();\r\n\t\tconst bonusStats = player.getBonusStats();\r\n\r\n\t\tconst baseDelta = baseStats;\r\n\t\tconst gearDelta = gearStats.subtract(baseStats).subtract(bonusStats);\r\n\t\tconst talentsDelta = talentsStats.subtract(gearStats).add(statMods.talents);\r\n\t\tconst buffsDelta = buffsStats.subtract(talentsStats);\r\n\t\tconst consumesDelta = consumesStats.subtract(buffsStats);\r\n\r\n\t\tconst finalStats = Stats.fromProto(playerStats.finalStats).add(statMods.talents).add(debuffStats);\r\n\r\n\t\tthis.stats.forEach((stat, idx) => {\r\n\t\t\tlet valueElem = (\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"javascript:void(0)\" \r\n\t\t\t\t\tclassName=\"stat-value-link\"\r\n\t\t\t\t\tattributes={{role:\"button\"}}>\r\n\t\t\t\t\t{`${this.statDisplayString(finalStats, finalStats, stat)} `}\r\n\t\t\t\t</a>\r\n\t\t\t)\r\n\r\n\t\t\tthis.valueElems[idx].querySelector('.stat-value-link')?.remove();\r\n\t\t\tthis.valueElems[idx].prepend(valueElem);\r\n\r\n\t\t\tlet bonusStatValue = bonusStats.getStat(stat);\r\n\r\n\t\t\tif (bonusStatValue == 0) {\r\n\t\t\t\tvalueElem.classList.remove('text-success', 'text-danger');\r\n\t\t\t\tvalueElem.classList.add('text-white');\r\n\t\t\t} else if (bonusStatValue > 0) {\r\n\t\t\t\tvalueElem.classList.remove('text-white', 'text-danger');\r\n\t\t\t\tvalueElem.classList.add('text-success');\r\n\t\t\t} else if (bonusStatValue < 0) {\r\n\t\t\t\tvalueElem.classList.remove('text-white', 'text-success');\r\n\t\t\t\tvalueElem.classList.add('text-danger');\r\n\t\t\t}\r\n\r\n\t\t\tlet tooltipContent = \r\n\t\t\t<div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Base:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(baseStats, baseDelta, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Gear:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(gearStats, gearDelta, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Talents:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(talentsStats, talentsDelta, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Buffs:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(buffsStats, buffsDelta, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Consumes:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(consumesStats, consumesDelta, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t{debuffStats.getStat(stat) != 0 &&\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Debuffs:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(debuffStats, debuffStats, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t{bonusStatValue != 0 &&\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Bonus:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(bonusStats, bonusStats, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Total:</span>\r\n\t\t\t\t\t<span>{this.statDisplayString(finalStats, finalStats, stat)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t\tTooltip.getOrCreateInstance(valueElem, {\r\n\t\t\t\ttitle: tooltipContent,\r\n\t\t\t\thtml: true,\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif(this.meleeCritCapValueElem) {\r\n\t\t\tconst meleeCritCapInfo = player.getMeleeCritCapInfo();\r\n\r\n\t\t\tconst valueElem = (\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\t\tclassName=\"stat-value-link\"\r\n\t\t\t\t\tattributes={{role:\"button\"}}>\r\n\t\t\t\t\t{`${this.meleeCritCapDisplayString(player, finalStats)} `}\r\n\t\t\t\t</a>\r\n\t\t\t)\r\n\r\n\t\t\tconst capDelta = meleeCritCapInfo.playerCritCapDelta;\r\n\t\t\tif (capDelta == 0) {\r\n\t\t\t\tvalueElem.classList.add('text-white');\r\n\t\t\t} else if (capDelta > 0) {\r\n\t\t\t\tvalueElem.classList.add('text-danger');\r\n\t\t\t} else if (capDelta < 0) {\r\n\t\t\t\tvalueElem.classList.add('text-success');\r\n\t\t\t}\r\n\r\n\t\t\tthis.meleeCritCapValueElem.querySelector('.stat-value-link')?.remove();\r\n\t\t\tthis.meleeCritCapValueElem.prepend(valueElem);\r\n\r\n\t\t\tconst tooltipContent = (\r\n\t\t\t<div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Glancing:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.glancing.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Suppression:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.suppression.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>To Hit Cap:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.remainingMeleeHitCap.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>To Exp Cap:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.remainingExpertiseCap.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Debuffs:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.debuffCrit.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t{meleeCritCapInfo.specSpecificOffset != 0 &&\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Spec Offsets:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.specSpecificOffset.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Final Crit Cap:</span>\r\n\t\t\t\t\t<span>{`${meleeCritCapInfo.baseCritCap.toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<hr/>\r\n\t\t\t\t<div className=\"character-stats-tooltip-row\">\r\n\t\t\t\t\t<span>Can Raise By:</span>\r\n\t\t\t\t\t<span>{`${(meleeCritCapInfo.remainingExpertiseCap + meleeCritCapInfo.remainingMeleeHitCap).toFixed(2)}%`}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t);\r\n\r\n\t\t\tTooltip.getOrCreateInstance(valueElem, {\r\n\t\t\t\ttitle: tooltipContent,\r\n\t\t\t\thtml: true,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate statDisplayString(stats: Stats, deltaStats: Stats, stat: Stat): string {\r\n\t\tlet rawValue = deltaStats.getStat(stat);\r\n\r\n\t\tif (stat == Stat.StatBlockValue) {\r\n\t\t\trawValue *= stats.getPseudoStat(PseudoStat.PseudoStatBlockValueMultiplier) || 1;\r\n\t\t}\r\n\r\n\t\tlet displayStr = String(Math.round(rawValue));\r\n\r\n\t\tif (stat == Stat.StatMeleeHit) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatSpellHit) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatMeleeCrit || stat == Stat.StatSpellCrit) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatMeleeHaste) {\r\n\t\t\tif ([Class.ClassDruid, Class.ClassShaman, Class.ClassPaladin, Class.ClassDeathknight].includes(this.player.getClass())) {\r\n\t\t\t\tdisplayStr += ` (${(rawValue / Mechanics.SPECIAL_MELEE_HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\r\n\t\t\t} else {\r\n\t\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\r\n\t\t\t}\r\n\t\t} else if (stat == Stat.StatSpellHaste) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.HASTE_RATING_PER_HASTE_PERCENT).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatArmorPenetration) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.ARMOR_PEN_PER_PERCENT_ARMOR).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatExpertise) {\r\n\t\t\t// As of 06/20, Blizzard has changed Expertise to no longer truncate at quarter percent intervals. Note that\r\n\t\t\t// in-game character sheet tooltips will still display the truncated values, but it has been tested to behave\r\n\t\t\t// continuously in reality since the patch.\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION / 4).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatDefense) {\r\n\t\t\tdisplayStr += ` (${(Mechanics.CHARACTER_LEVEL * 5 + Math.floor(rawValue / Mechanics.DEFENSE_RATING_PER_DEFENSE)).toFixed(0)})`;\r\n\t\t} else if (stat == Stat.StatBlock) {\r\n\t\t\t// TODO: Figure out how to display these differently for the components than the final value\r\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE).toFixed(2)}%)`;\r\n\t\t\tdisplayStr += ` (${((rawValue / Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE) + (Mechanics.MISS_DODGE_PARRY_BLOCK_CRIT_CHANCE_PER_DEFENSE * Math.floor(stats.getStat(Stat.StatDefense) / Mechanics.DEFENSE_RATING_PER_DEFENSE)) + 5.00).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatDodge) {\r\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.DODGE_RATING_PER_DODGE_CHANCE).toFixed(2)}%)`;\r\n\t\t\tdisplayStr += ` (${(stats.getPseudoStat(PseudoStat.PseudoStatDodge) * 100).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatParry) {\r\n\t\t\t//displayStr += ` (${(rawValue / Mechanics.PARRY_RATING_PER_PARRY_CHANCE).toFixed(2)}%)`;\r\n\t\t\tdisplayStr += ` (${(stats.getPseudoStat(PseudoStat.PseudoStatParry) * 100).toFixed(2)}%)`;\r\n\t\t} else if (stat == Stat.StatResilience) {\r\n\t\t\tdisplayStr += ` (${(rawValue / Mechanics.RESILIENCE_RATING_PER_CRIT_REDUCTION_CHANCE).toFixed(2)}%)`;\r\n\t\t}\r\n\r\n\t\treturn displayStr;\r\n\t}\r\n\r\n\tprivate getDebuffStats(): Stats {\r\n\t\tlet debuffStats = new Stats();\r\n\r\n\t\tconst debuffs = this.player.sim.raid.getDebuffs();\r\n\t\tif (debuffs.misery || debuffs.faerieFire == TristateEffect.TristateEffectImproved) {\r\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellHit, 3 * Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE);\r\n\t\t}\r\n\t\tif (debuffs.totemOfWrath || debuffs.heartOfTheCrusader || debuffs.masterPoisoner) {\r\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellCrit, 3 * Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE);\r\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatMeleeCrit, 3 * Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE);\r\n\t\t}\r\n\t\tif (debuffs.improvedScorch || debuffs.wintersChill || debuffs.shadowMastery) {\r\n\t\t\tdebuffStats = debuffStats.addStat(Stat.StatSpellCrit, 5 * Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE);\r\n\t\t}\r\n\r\n\t\treturn debuffStats;\r\n\t}\r\n\r\n\tprivate bonusStatsLink(stat: Stat): HTMLElement {\r\n\t\tlet statName = getClassStatName(stat, this.player.getClass());\r\n\r\n\t\tlet link = (\r\n\t\t\t<a\r\n\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\tclassName='add-bonus-stats text-white ms-2'\r\n\t\t\t\tdataset={{bsToggle: 'popover'}}\r\n\t\t\t\tattributes={{role:'button'}}\r\n\t\t\t>\r\n\t\t\t\t<i className=\"fas fa-plus-minus\"></i>\r\n\t\t\t</a>\r\n\t\t);\r\n\r\n\t\tlet popover = Popover.getOrCreateInstance(link, {\r\n\t\t\tcustomClass: 'bonus-stats-popover',\r\n\t\t\tplacement: 'right',\r\n\t\t\tfallbackPlacement: ['left'],\r\n\t\t\tsanitize: false,\r\n\t\t\tcontent: \r\n\t\t\t\t<div className='input-root number-picker-root mb-0'>\r\n\t\t\t\t\t<label className='form-label'>Bonus Health</label>\r\n\t\t\t\t\t<input type='text' className='form-control number-picker-input' value={this.player.getBonusStats().getStat(stat)} />\r\n\t\t\t\t</div>,\r\n\t\t});\r\n\r\n\t\tlink.addEventListener('shown.bs.popover', (event) => {\r\n\t\t\tlet popoverBody = document.querySelector('.popover.bonus-stats-popover .popover-body') as HTMLElement;\r\n\t\t\tpopoverBody.innerHTML = '';\r\n\t\t\tlet picker = new NumberPicker(popoverBody, this.player, {\r\n\t\t\t\tlabel: `Bonus ${statName}`,\r\n\t\t\t\textraCssClasses: ['mb-0'],\r\n\t\t\t\tchangedEvent: (player: Player<any>) => player.bonusStatsChangeEmitter,\r\n\t\t\t\tgetValue: (player: Player<any>) => player.getBonusStats().getStat(stat),\r\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\t\tconst bonusStats = player.getBonusStats().withStat(stat, newValue);\r\n\t\t\t\t\tplayer.setBonusStats(eventID, bonusStats);\r\n\t\t\t\t\tpopover.hide();\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn link as HTMLElement;\r\n\t}\r\n\r\n\tprivate shouldShowMeleeCritCap(player: Player<any>): boolean {\r\n\t\treturn [\r\n\t\t\tSpec.SpecDeathknight,\r\n\t\t\tSpec.SpecEnhancementShaman,\r\n\t\t\tSpec.SpecFeralDruid,\r\n\t\t\tSpec.SpecRetributionPaladin,\r\n\t\t\tSpec.SpecRogue,\r\n\t\t\tSpec.SpecWarrior\r\n\t\t].includes(player.spec);\r\n\t}\r\n\r\n\tprivate meleeCritCapDisplayString(player: Player<any>, finalStats: Stats): string {\r\n\t\tconst playerCritCapDelta = player.getMeleeCritCap();\r\n\r\n\t\tif(playerCritCapDelta === 0.0) {\r\n\t\t\treturn 'Exact';\r\n\t\t}\r\n\r\n\t\tconst prefix = playerCritCapDelta > 0 ? 'Over by ' : 'Under by ';\r\n\t\treturn `${prefix} ${Math.abs(playerCritCapDelta).toFixed(2)}%`;\r\n\t}\r\n}\r\n","import { StatWeightsResult, StatWeightValues, ProgressMetrics } from '../proto/api.js';\r\nimport { ItemSlot } from '../proto/common.js';\r\nimport { GemColor } from '../proto/common.js';\r\nimport { Profession } from '../proto/common.js';\r\nimport { Stat, PseudoStat, UnitStats } from '../proto/common.js';\r\nimport { Stats, UnitStat } from '../proto_utils/stats.js';\r\nimport { Gear } from '../proto_utils/gear.js';\r\nimport { getClassStatName } from '../proto_utils/names.js';\r\nimport { IndividualSimUI } from '../individual_sim_ui.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { Player } from '../player.js';\r\nimport { formatDeltaTextElem, stDevToConf90 } from '../utils.js';\r\nimport { BooleanPicker } from '../components/boolean_picker.js';\r\nimport { NumberPicker } from '../components/number_picker.js';\r\nimport { combinationsWithDups, permutations, sum } from '../utils.js';\r\nimport { UIGem as Gem } from '../proto/ui.js';\r\n\r\nimport * as Gems from '../proto_utils/gems.js';\r\n\r\nimport { BaseModal } from './base_modal.js';\r\nimport { Tooltip } from 'bootstrap';\r\nimport { ResultsViewer } from './results_viewer.js';\r\n\r\nexport function addStatWeightsAction(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat> | undefined, epReferenceStat: Stat) {\r\n\tsimUI.addAction('Stat Weights', 'ep-weights-action', () => {\r\n\t\tnew EpWeightsMenu(simUI, epStats, epPseudoStats || [], epReferenceStat);\r\n\t});\r\n}\r\n\r\n// Create the config for modal in separate function, as constructor cannot\r\n// contain any logic before `super' call. Use modal-xl to accommodate the extra\r\n// TMI & p(death) EP in the UI.\r\nfunction getModalConfig(simUI: IndividualSimUI<any>) {\r\n\tconst baseConfig = { footer: true, scrollContents: true };\r\n\tif (simUI.sim.getShowThreatMetrics() && simUI.sim.getShowExperimental()) {\r\n\t\treturn { size: 'xl' as const, ...baseConfig };\r\n\t}\r\n\treturn baseConfig;\r\n}\r\n\r\nfunction scaledEpValue(stat: UnitStat, epRatios: number[], result: StatWeightsResult|null): number {\r\n\tif (!result) return 0;\r\n\r\n\treturn (epRatios[0] * stat.getProtoValue(result.dps?.epValues!))\r\n\t\t+ (epRatios[1] * stat.getProtoValue(result.hps?.epValues!))\r\n\t\t+ (epRatios[2] * stat.getProtoValue(result.tps?.epValues!))\r\n\t\t+ (epRatios[3] * stat.getProtoValue(result.dtps?.epValues!))\r\n\t\t+ (epRatios[4] * stat.getProtoValue(result.tmi?.epValues!))\r\n\t\t+ (epRatios[5] * stat.getProtoValue(result.pDeath?.epValues!))\r\n}\r\n\r\nclass EpWeightsMenu extends BaseModal {\r\n\tprivate readonly simUI: IndividualSimUI<any>;\r\n\tprivate readonly container: HTMLElement;\r\n\tprivate readonly table: HTMLElement;\r\n\tprivate readonly tableBody: HTMLElement;\r\n\tprivate readonly resultsViewer: ResultsViewer;\r\n\r\n\tprivate statsType: string;\r\n\tprivate epStats: Array<Stat>;\r\n\tprivate epPseudoStats: Array<PseudoStat>;\r\n\tprivate epReferenceStat: Stat;\r\n\tprivate showAllStats: boolean = false;\r\n\r\n\tconstructor(simUI: IndividualSimUI<any>, epStats: Array<Stat>, epPseudoStats: Array<PseudoStat>, epReferenceStat: Stat) {\r\n\t\tsuper(simUI.rootElem, 'ep-weights-menu', getModalConfig(simUI));\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.statsType = 'ep';\r\n\t\tthis.epStats = epStats;\r\n\t\tthis.epPseudoStats = epPseudoStats;\r\n\t\tthis.epReferenceStat = epReferenceStat;\r\n\r\n\t\tthis.header?.insertAdjacentHTML('afterbegin', '<h5 class=\"modal-title\">Calculate Stat Weights</h5>');\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"ep-weights-options row\">\r\n\t\t\t\t<div class=\"col col-sm-3\">\r\n\t\t\t\t\t<select class=\"ep-type-select form-select\">\r\n\t\t\t\t\t\t<option value=\"ep\">EP</option>\r\n\t\t\t\t\t\t<option value=\"weight\">Weights</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"show-all-stats-container col col-sm-3\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ep-reference-options row experimental\">\r\n\t\t\t\t<div class=\"col col-sm-4 damage-metrics\">\r\n\t\t\t\t\t<span>DPS/TPS reference:</span>\r\n\t\t\t\t\t<select class=\"ref-stat-select form-select damage-metrics\">\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col col-sm-4 healing-metrics\">\r\n\t\t\t\t\t<span>Healing reference:</span>\r\n\t\t\t\t\t<select class=\"ref-stat-select form-select healing-metrics\">\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"col col-sm-4 threat-metrics\">\r\n\t\t\t\t\t<span>Mitigation reference:</span>\r\n\t\t\t\t\t<select class=\"ref-stat-select form-select threat-metrics\">\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\r\n\t\t\t</div>\r\n\t\t\t<p>The 'Current EP' column displays the values currently used by the item pickers to sort items.</br>\r\n\t\t\tUse the <a href='javascript:void(0)' class=\"fa fa-copy\"></a> icon above the EPs to use newly calculated EPs.</p>\r\n\t\t\t<div class=\"results-ep-table-container modal-scroll-table\">\r\n\t\t\t\t<div class=\"results-pending-overlay\"></div>\r\n\t\t\t\t<table class=\"results-ep-table\">\r\n\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<th>Stat</th>\r\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-weight\">\r\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"damage-metrics type-ep\">\r\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-weight\">\r\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"healing-metrics type-ep\">\r\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\">\r\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\">\r\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight\">\r\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep\">\r\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight experimental\">\r\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep experimental\">\r\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-weight experimental\">\r\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th class=\"threat-metrics type-ep experimental\">\r\n\t\t\t\t\t\t\t\t<span>Death EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-copy\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t\t<th style=\"text-align: center\">\r\n\t\t\t\t\t\t\t\t<span>Current EP</span>\r\n\t\t\t\t\t\t\t\t<a href=\"javascript:void(0)\" role=\"button\" class=\"col-action\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fas fa-arrows-rotate\"></i>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t</th>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t\t<tr class=\"ep-ratios\">\r\n\t\t\t\t\t\t\t<td>EP Ratio</td>\r\n\t\t\t\t\t\t\t<td class=\"damage-metrics type-ratio type-weight\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"damage-metrics type-ratio type-ep\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"healing-metrics type-ratio type-weight\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"healing-metrics type-ratio type-ep\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight experimental\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep experimental\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-weight experimental\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td class=\"threat-metrics type-ratio type-ep experimental\">\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t\t<td style=\"text-align: center; vertical-align: middle;\">\r\n\t\t\t\t\t\t\t\t<button class=\"btn btn-primary compute-ep\">\r\n\t\t\t\t\t\t\t\t\t<i class=\"fas fa-calculator\"></i>\r\n\t\t\t\t\t\t\t\t\t<span class=\"not-tiny\">Update </span>EP\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</td>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</thead>\r\n\t\t\t\t\t<tbody></tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t\tthis.footer!.innerHTML = `\r\n\t\t\t<button class=\"btn btn-primary optimize-gems experimental me-2\">\r\n\t\t\t\tOptimize Gems\r\n\t\t\t</button>\r\n\t\t\t<button class=\"btn btn-primary calc-weights\">\r\n\t\t\t\t<i class=\"fas fa-calculator\"></i>\r\n\t\t\t\tCalculate\r\n\t\t\t</button>\r\n\t\t`;\r\n\r\n\t\tthis.container = this.rootElem.querySelector('.results-ep-table-container') as HTMLElement;\r\n\t\tthis.table = this.rootElem.querySelector('.results-ep-table') as HTMLElement;\r\n\t\tthis.tableBody = this.rootElem.querySelector('.results-ep-table tbody') as HTMLElement;\r\n\r\n\t\tconst resultsElem = this.rootElem.querySelector('.results-pending-overlay') as HTMLElement;\r\n\t\tthis.resultsViewer = new ResultsViewer(resultsElem);\r\n\r\n\t\tconst updateType = () => {\r\n\t\t\tif (this.statsType == 'ep') {\r\n\t\t\t\tthis.table.classList.remove('stats-type-weight');\r\n\t\t\t\tthis.table.classList.add('stats-type-ep');\r\n\t\t\t} else {\r\n\t\t\t\tthis.table.classList.add('stats-type-weight');\r\n\t\t\t\tthis.table.classList.remove('stats-type-ep');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tconst selectElem = this.rootElem.getElementsByClassName('ep-type-select')[0] as HTMLSelectElement;\r\n\t\tselectElem.addEventListener('input', event => {\r\n\t\t\tthis.statsType = selectElem.value;\r\n\t\t\tupdateType();\r\n\t\t});\r\n\t\tselectElem.value = this.statsType;\r\n\t\tupdateType();\r\n\r\n\t\tconst getNameFromStat = (stat: Stat | undefined) => {\r\n\t\t\treturn stat !== undefined ? getClassStatName(stat, this.simUI.player.getClass()) : '??';\r\n\t\t};\r\n\r\n\t\tconst getStatFromName = (value: string) => {\r\n\t\t\tfor (let stat of this.epStats) {\r\n\t\t\t\tif (getNameFromStat(stat) == value) {\r\n\t\t\t\t\treturn stat;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\t\t};\r\n\r\n\t\tconst updateEpRefStat = () => {\r\n\t\t\tthis.simUI.player.epRefStatChangeEmitter.emit(TypedEvent.nextEventID())\r\n\t\t\tthis.simUI.prevEpSimResult = this.calculateEp(this.getPrevSimResult());\r\n\t\t\tthis.updateTable();\r\n\t\t};\r\n\r\n\t\tconst epRefSelects = this.rootElem.querySelectorAll('.ref-stat-select') as NodeListOf<HTMLSelectElement>;\r\n\t\tepRefSelects.forEach((epSelect: HTMLSelectElement, idx: number) => {\r\n\t\t\tthis.epStats.forEach((stat) => {\r\n\t\t\t\tepSelect.options[epSelect.options.length] = new Option(getNameFromStat(stat));\r\n\t\t\t});\r\n\t\t\tif (epSelect.classList.contains('damage-metrics')) {\r\n\t\t\t\tepSelect.addEventListener('input', event => {\r\n\t\t\t\t\tthis.simUI.dpsRefStat = getStatFromName(epSelect.value);\r\n\t\t\t\t\tupdateEpRefStat();\r\n\t\t\t\t});\r\n\t\t\t\tepSelect.value = getNameFromStat(this.getDpsEpRefStat());\r\n\t\t\t} else if (epSelect.classList.contains('healing-metrics')) {\r\n\t\t\t\tepSelect.addEventListener('input', event => {\r\n\t\t\t\t\tthis.simUI.healRefStat = getStatFromName(epSelect.value);\r\n\t\t\t\t\tupdateEpRefStat();\r\n\t\t\t\t});\r\n\t\t\t\tepSelect.value = getNameFromStat(this.getHealEpRefStat());\r\n\t\t\t} else if (epSelect.classList.contains('threat-metrics')) {\r\n\t\t\t\tepSelect.addEventListener('input', event => {\r\n\t\t\t\t\tthis.simUI.tankRefStat = getStatFromName(epSelect.value);\r\n\t\t\t\t\tupdateEpRefStat();\r\n\t\t\t\t});\r\n\t\t\t\tepSelect.value = getNameFromStat(this.getTankEpRefStat());\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst optimizeGemsButton = this.rootElem.getElementsByClassName('optimize-gems')[0] as HTMLElement;\r\n\t\tTooltip.getOrCreateInstance(optimizeGemsButton, {\r\n\t\t\thtml: true,\r\n\t\t\ttitle: `<p><span class='warning link-warning'><i class='fa fa-exclamation-triangle'></i> WARNING</span> This feature is experimental, and will not always produce the most optimal gems especially when interacting with soft/hard stat caps.</p>\r\n\t\t\t<p>Optimizes equipped gems to maximize EP, based on the values in <b>Current EP</b>.</p>\r\n\t\t\t<p class='mb-0'>Does not change the meta gem, but ensures that its condition is met. Uses JC gems if Jewelcrafting is a selected profession.</p>`\r\n\t\t});\r\n\t\toptimizeGemsButton.addEventListener('click', async event => {\r\n\t\t\tconst previousContents = optimizeGemsButton.innerHTML;\r\n\t\t\toptimizeGemsButton.classList.add('disabled');\r\n\t\t\toptimizeGemsButton.style.width = `${optimizeGemsButton.getBoundingClientRect().width.toFixed(3)}px`;\r\n\t\t\toptimizeGemsButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\r\n\t\t\tawait this.optimizeGems(TypedEvent.nextEventID());\r\n\t\t\toptimizeGemsButton.innerHTML = previousContents;\r\n\t\t\toptimizeGemsButton.classList.remove('disabled');\r\n\t\t});\r\n\r\n\t\tconst calcButton = this.rootElem.getElementsByClassName('calc-weights')[0] as HTMLElement;\r\n\t\tcalcButton.addEventListener('click', async event => {\r\n\t\t\tconst previousContents = calcButton.innerHTML;\r\n\t\t\tcalcButton.classList.add('disabled');\r\n\t\t\tcalcButton.style.width = `${calcButton.getBoundingClientRect().width.toFixed(3)}px`;\r\n\t\t\tcalcButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\r\n\t\t\tthis.container.scrollTo({ top: 0 });\r\n\t\t\tthis.container.classList.add('pending');\r\n\t\t\tthis.resultsViewer.setPending();\r\n\t\t\tconst iterations = this.simUI.sim.getIterations();\r\n\t\t\tconst result = await this.simUI.player.computeStatWeights(TypedEvent.nextEventID(), this.epStats, this.epPseudoStats, this.epReferenceStat, (progress: ProgressMetrics) => {\r\n\t\t\t\tthis.setSimProgress(progress);\r\n\t\t\t});\r\n\t\t\tthis.container.classList.remove('pending');\r\n\t\t\tthis.resultsViewer.hideAll();\r\n\t\t\tcalcButton.innerHTML = previousContents;\r\n\t\t\tcalcButton.classList.remove('disabled');\r\n\t\t\tthis.simUI.prevEpIterations = iterations;\r\n\t\t\tthis.simUI.prevEpSimResult = this.calculateEp(result);\r\n\t\t\tthis.updateTable();\r\n\t\t});\r\n\r\n\t\tconst colActionButtons = Array.from(this.rootElem.getElementsByClassName('col-action')) as Array<HTMLSelectElement>;\r\n\t\tconst makeUpdateWeights = (button: HTMLElement, labelTooltip: string, tooltip: string, weightsFunc: () => UnitStats | undefined, epRefStat?: () => Stat) => {\r\n\t\t\tconst label = button.previousElementSibling as HTMLElement;\r\n\t\t\tconst title = () => {\r\n\t\t\t\tif (!epRefStat) return labelTooltip;\r\n\r\n\t\t\t\tconst refStatName = getNameFromStat(epRefStat());\r\n\t\t\t\treturn labelTooltip + ` Normalized by ${refStatName}.`;\r\n\t\t\t};\r\n\t\t\tconst labelTooltipConfig = {\r\n\t\t\t\ttoggle: 'tooltip',\r\n\t\t\t\thtml: true,\r\n\t\t\t\ttitle: title\r\n\t\t\t};\r\n\r\n\t\t\tnew Tooltip(label, labelTooltipConfig);\r\n\t\t\tTooltip.getOrCreateInstance(button, {\r\n\t\t\t\ttitle: tooltip,\r\n\t\t\t\thtml: true,\r\n\t\t\t});\r\n\r\n\t\t\tbutton.addEventListener('click', event => {\r\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), Stats.fromProto(weightsFunc()));\r\n\t\t\t\tthis.updateTable();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tmakeUpdateWeights(colActionButtons[0], 'Per-point increase in DPS (Damage Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dps!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[1], 'EP (Equivalency Points) for DPS (Damage Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dps!.epValues, () => this.getDpsEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[2], 'Per-point increase in HPS (Healing Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().hps!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[3], 'EP (Equivalency Points) for HPS (Healing Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().hps!.epValues, () => this.getHealEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[4], 'Per-point increase in TPS (Threat Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().tps!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[5], 'EP (Equivalency Points) for TPS (Threat Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().tps!.epValues, () => this.getDpsEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[6], 'Per-point increase in DTPS (Damage Taken Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dtps!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[7], 'EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().dtps!.epValues, () => this.getTankEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[8], 'Per-point decrease in TMI (Theck-Meloree Index) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().tmi!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[9], 'EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().tmi!.epValues, () => this.getTankEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[10], 'Per-point decrease in p(death) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().pDeath!.weights);\r\n\t\tmakeUpdateWeights(colActionButtons[11], 'EP (Equivalency Points) for p(death) for each stat.', 'Copy to Current EP', () => this.getPrevSimResult().pDeath!.epValues, () => this.getTankEpRefStat());\r\n\t\tmakeUpdateWeights(colActionButtons[12], 'Current EP Weights. Used to sort the gear selector menus.', 'Restore Default EP', () => this.simUI.individualConfig.defaults.epWeights.toProto());\r\n\r\n\t\tconst showAllStatsContainer = this.rootElem.getElementsByClassName('show-all-stats-container')[0] as HTMLElement;\r\n\t\tnew BooleanPicker(showAllStatsContainer, this, {\r\n\t\t\tlabel: 'Show All Stats',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: () => new TypedEvent(),\r\n\t\t\tgetValue: () => this.showAllStats,\r\n\t\t\tsetValue: (eventID: EventID, menu: EpWeightsMenu, newValue: boolean) => {\r\n\t\t\t\tthis.showAllStats = newValue;\r\n\t\t\t\tthis.updateTable();\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.updateTable();\r\n\r\n\t\tconst makeEpRatioCell = (cell: HTMLElement, idx: number) => {\r\n\t\t\tnew NumberPicker(cell, this.simUI.player, {\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tchangedEvent: (player: Player<any>) => player.epRatiosChangeEmitter,\r\n\t\t\t\tgetValue: (player: Player<any>) => this.simUI.player.getEpRatios()[idx],\r\n\t\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\t\tconst epRatios = player.getEpRatios();\r\n\t\t\t\t\tepRatios[idx] = newValue;\r\n\t\t\t\t\tplayer.setEpRatios(eventID, epRatios);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t};\r\n\t\tconst epRatioCells = this.body.querySelectorAll('.type-ratio.type-ep') as NodeListOf<HTMLElement>;\r\n\t\tepRatioCells.forEach(makeEpRatioCell);\r\n\t\tthis.simUI.player.epRatiosChangeEmitter.on(_eventID => this.updateTable());\r\n\r\n\t\tconst weightRatioCells = this.body.querySelectorAll('.type-ratio.type-weight') as NodeListOf<HTMLElement>;\r\n\t\tweightRatioCells.forEach(makeEpRatioCell);\r\n\r\n\t\tconst updateButton = this.rootElem.getElementsByClassName('compute-ep')[0] as HTMLElement;\r\n\t\tTooltip.getOrCreateInstance(updateButton, {\r\n\t\t\ttitle: \"Compute Weighted EP\"\r\n\t\t});\r\n\r\n\t\tupdateButton.addEventListener('click', event => {\r\n\t\t\tconst results = this.getPrevSimResult();\r\n\t\t\tconst epRatios = this.simUI.player.getEpRatios();\r\n\t\t\tif (this.statsType == 'ep') {\r\n\t\t\t\tconst scaledDpsEp = Stats.fromProto(results.dps!.epValues).scale(epRatios[0]);\r\n\t\t\t\tconst scaledHpsEp = Stats.fromProto(results.hps!.epValues).scale(epRatios[1]);\r\n\t\t\t\tconst scaledTpsEp = Stats.fromProto(results.tps!.epValues).scale(epRatios[2]);\r\n\t\t\t\tconst scaledDtpsEp = Stats.fromProto(results.dtps!.epValues).scale(epRatios[3]);\r\n\t\t\t\tconst scaledTmiEp = Stats.fromProto(results.tmi!.epValues).scale(epRatios[4]);\r\n\t\t\t\tconst scaledPDeathEp = Stats.fromProto(results.pDeath!.epValues).scale(epRatios[5]);\r\n\t\t\t\tconst newEp = scaledDpsEp.add(scaledHpsEp).add(scaledTpsEp).add(scaledDtpsEp).add(scaledTmiEp).add(scaledPDeathEp);\r\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), newEp);\r\n\t\t\t} else {\r\n\t\t\t\tconst scaledDpsWeights = Stats.fromProto(results.dps!.weights).scale(epRatios[0]);\r\n\t\t\t\tconst scaledHpsWeights = Stats.fromProto(results.hps!.weights).scale(epRatios[1]);\r\n\t\t\t\tconst scaledTpsWeights = Stats.fromProto(results.tps!.weights).scale(epRatios[2]);\r\n\t\t\t\tconst scaledDtpsWeights = Stats.fromProto(results.dtps!.weights).scale(epRatios[3]);\r\n\t\t\t\tconst scaledTmiWeights = Stats.fromProto(results.tmi!.weights).scale(epRatios[4]);\r\n\t\t\t\tconst scaledPDeathWeights = Stats.fromProto(results.pDeath!.weights).scale(epRatios[5]);\r\n\t\t\t\tconst newWeights = scaledDpsWeights.add(scaledHpsWeights).add(scaledTpsWeights).add(scaledDtpsWeights).add(scaledTmiWeights).add(scaledPDeathWeights);\r\n\t\t\t\tthis.simUI.player.setEpWeights(TypedEvent.nextEventID(), newWeights);\r\n\t\t\t}\r\n\t\t\tthis.updateTable();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setSimProgress(progress: ProgressMetrics) {\r\n\t\tthis.resultsViewer.setContent(`\r\n\t\t\t<div class=\"results-sim\">\r\n\t\t\t\t<div class=\"\"> ${progress.completedSims} / ${progress.totalSims}<br>simulations complete</div>\r\n\t\t\t\t<div class=\"\">\r\n\t\t\t\t\t${progress.completedIterations} / ${progress.totalIterations}<br>iterations complete\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`);\r\n\t}\r\n\r\n\tprivate updateTable() {\r\n\t\tthis.tableBody.innerHTML = ``;\r\n\r\n\t\tEpWeightsMenu.epUnitStats.forEach(stat => {\r\n\t\t\t// Don't show extra stats when 'Show all stats' is not selected\r\n\t\t\tif ((!this.showAllStats && (\r\n\t\t\t\tstat.isStat() && !this.epStats.includes(stat.getStat())) ||\r\n\t\t\t\t(stat.isPseudoStat() && !this.epPseudoStats.includes(stat.getPseudoStat()))\r\n\t\t\t)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst row = this.makeTableRow(stat);\r\n\t\t\tthis.tableBody.appendChild(row);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate makeTableRow(stat: UnitStat): HTMLElement {\r\n\t\tconst row = document.createElement('tr');\r\n\t\tconst result = this.simUI.prevEpSimResult;\r\n\t\tconst epRatios = this.simUI.player.getEpRatios();\r\n\t\tconst rowTotalEp = scaledEpValue(stat, epRatios, result);\r\n\t\trow.innerHTML = `\r\n\t\t\t<td>${stat.getName(this.simUI.player.getClass())}</td>\r\n\t\t\t${this.makeTableRowCells(stat, result?.dps, 'damage-metrics', rowTotalEp, epRatios[0])}\r\n\t\t\t${this.makeTableRowCells(stat, result?.hps, 'healing-metrics', rowTotalEp, epRatios[1])}\r\n\t\t\t${this.makeTableRowCells(stat, result?.tps, 'threat-metrics', rowTotalEp, epRatios[2])}\r\n\t\t\t${this.makeTableRowCells(stat, result?.dtps, 'threat-metrics', rowTotalEp, epRatios[3])}\r\n\t\t\t${this.makeTableRowCells(stat, result?.tmi, 'threat-metrics experimental', rowTotalEp, epRatios[4])}\r\n\t\t\t${this.makeTableRowCells(stat, result?.pDeath, 'threat-metrics experimental', rowTotalEp, epRatios[5])}\r\n\t\t\t<td class=\"current-ep\"></td>\r\n\t\t`;\r\n\r\n\t\tconst currentEpCell = row.querySelector('.current-ep') as HTMLElement;\r\n\t\tnew NumberPicker(currentEpCell, this.simUI.player, {\r\n\t\t\tfloat: true,\r\n\t\t\tchangedEvent: (player: Player<any>) => player.epWeightsChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => this.simUI.player.getEpWeights().getUnitStat(stat),\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\tconst epWeights = player.getEpWeights().withUnitStat(stat, newValue);\r\n\t\t\t\tplayer.setEpWeights(eventID, epWeights);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\treturn row;\r\n\t}\r\n\r\n\tprivate makeTableRowCells(stat: UnitStat, statWeights: StatWeightValues|undefined, className: string, epTotal: number, epRatio: number): string {\r\n\t\tvar weightCell, epCell;\r\n\t\tif (statWeights) {\r\n\t\t\tconst weightAvg = stat.getProtoValue(statWeights.weights!);\r\n\t\t\tconst weightStdev = stat.getProtoValue(statWeights.weightsStdev!)\r\n\t\t\tweightCell = this.makeTableCellContents(weightAvg, weightStdev)\r\n\r\n\t\t\tconst epAvg = stat.getProtoValue(statWeights.epValues!);\r\n\t\t\tconst epStdev = stat.getProtoValue(statWeights.epValuesStdev!)\r\n\t\t\tepCell = this.makeTableCellContents(epAvg, epStdev);\r\n\t\t} else {\r\n\t\t\tweightCell = `<span class=\"results-avg notapplicable\">N/A</span>`;\r\n\t\t\tepCell = weightCell\r\n\t\t}\r\n\r\n\t\tlet template = document.createElement('template');\r\n\t\ttemplate.innerHTML = `\r\n\t\t\t<td class=\"stdev-cell ${className} type-weight\">\r\n\t\t\t\t${weightCell}\r\n\t\t\t</td>\r\n\t\t\t<td class=\"stdev-cell ${className} type-ep\">\r\n\t\t\t\t${epCell}\r\n\t\t\t</td>\r\n\t\t`;\r\n\r\n\t\tif (!statWeights) return template.innerHTML;\r\n\r\n\t\tif (epRatio == 0) {\r\n\t\t\tconst cells = template.content.querySelectorAll('.stdev-cell')\r\n\t\t\tcells.forEach((cell) => cell.classList.add('unused-ep'));\r\n\t\t\treturn template.innerHTML;\r\n\t\t}\r\n\r\n\t\tconst epCurrent = this.simUI.player.getEpWeights().getUnitStat(stat);\r\n\t\tconst epDelta = epTotal - epCurrent;\r\n\r\n\t\tconst epAvgElem = template.content.querySelector('.type-ep .results-avg') as HTMLElement;\r\n\t\tif (epDelta.toFixed(2) == \"0.00\")\r\n\t\t\tepAvgElem // no-op\r\n\t\telse if (epDelta > 0)\r\n\t\t\tepAvgElem.classList.add('positive');\r\n\t\telse if (epDelta < 0)\r\n\t\t\tepAvgElem.classList.add('negative');\r\n\r\n\t\treturn template.innerHTML;\r\n\t};\r\n\r\n\tprivate makeTableCellContents(value: number, stdev: number): string {\r\n\t\tconst iterations = this.simUI.prevEpIterations || 1\r\n\t\treturn `\r\n\t\t\t<span class=\"results-avg\">${value.toFixed(2)}</span>\r\n\t\t\t<span class=\"results-stdev\">\r\n\t\t\t\t(<i class=\"fas fa-plus-minus fa-xs\"></i>${stDevToConf90(stdev, iterations).toFixed(2)})\r\n\t\t\t</span>\r\n\t\t`;\r\n\t}\r\n\r\n\tprivate calculateEp(weights: StatWeightsResult) {\r\n\t\tvar result = StatWeightsResult.clone(weights);\r\n\t\tconst normaliseValue = (refStat: Stat, values: StatWeightValues) => {\r\n\t\t\tconst refUnitStat = UnitStat.fromStat(refStat);\r\n\t\t\tconst refWeight = refUnitStat.getProtoValue(values.weights!);\r\n\t\t\tconst refStdev = refUnitStat.getProtoValue(values.weightsStdev!);\r\n\t\t\tEpWeightsMenu.epUnitStats.forEach(stat => {\r\n\t\t\t\tconst value = stat.getProtoValue(values.weights!);\r\n\t\t\t\tstat.setProtoValue(values.epValues!, refWeight == 0 ? 0 : value / refWeight);\r\n\r\n\t\t\t\tconst valueStdev = stat.getProtoValue(values.weightsStdev!);\r\n\t\t\t\tstat.setProtoValue(values.epValuesStdev!, refStdev == 0 ? 0 : valueStdev / refStdev);\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tif (this.simUI.dpsRefStat !== undefined) {\r\n\t\t\tnormaliseValue(this.simUI.dpsRefStat, result.dps!);\r\n\t\t\tnormaliseValue(this.simUI.dpsRefStat, result.tps!);\r\n\t\t}\r\n\t\tif (this.simUI.healRefStat !== undefined) normaliseValue(this.simUI.healRefStat, result.hps!);\r\n\t\tif (this.simUI.tankRefStat !== undefined) {\r\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.dtps!);\r\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.tmi!);\r\n\t\t\tnormaliseValue(this.simUI.tankRefStat, result.pDeath!);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprivate getDpsEpRefStat(): Stat {\r\n\t\treturn this.simUI.dpsRefStat !== undefined ? this.simUI.dpsRefStat : this.epReferenceStat;\r\n\t}\r\n\r\n\tprivate getHealEpRefStat(): Stat {\r\n\t\treturn this.simUI.healRefStat !== undefined ? this.simUI.healRefStat : this.epReferenceStat;\r\n\t}\r\n\r\n\tprivate getTankEpRefStat(): Stat {\r\n\t\treturn this.simUI.tankRefStat !== undefined ? this.simUI.tankRefStat : Stat.StatArmor;\r\n\t}\r\n\r\n\tprivate getPrevSimResult(): StatWeightsResult {\r\n\t\treturn this.simUI.prevEpSimResult || StatWeightsResult.create({\r\n\t\t\tdps: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t\thps: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t\ttps: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t\tdtps: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t\ttmi: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t\tpDeath: {\r\n\t\t\t\tweights: new Stats().toProto(),\r\n\t\t\t\tweightsStdev: new Stats().toProto(),\r\n\t\t\t\tepValues: new Stats().toProto(),\r\n\t\t\t\tepValuesStdev: new Stats().toProto(),\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async optimizeGems(eventID: EventID) {\r\n\t\t// Replace 0 weights with a very tiny value, so we always prefer to take free stats even if the user gave a 0 weight.\r\n\t\tlet epWeights = this.simUI.player.getEpWeights();\r\n\t\tepWeights = new Stats(epWeights.asArray().map(w => w == 0 ? 1e-8 : w));\r\n\r\n\t\tconst gear = this.simUI.player.getGear();\r\n\t\tconst allGems = this.simUI.sim.db.getGems();\r\n\t\tconst phase = this.simUI.sim.getPhase();\r\n\t\tconst isBlacksmithing = this.simUI.player.isBlacksmithing();\r\n\t\tconst isJewelcrafting = this.simUI.player.hasProfession(Profession.Jewelcrafting);\r\n\r\n\t\tconst optimizedGear = EpWeightsMenu.optimizeGemsForWeights(epWeights, gear, allGems, phase, isBlacksmithing, isJewelcrafting);\r\n\t\tthis.simUI.player.setGear(eventID, optimizedGear);\r\n\t}\r\n\r\n\tprivate static optimizeGemsForWeights(epWeights: Stats, gear: Gear, allGems: Array<Gem>, phase: number, isBlacksmithing: boolean, isJewelcrafting: boolean): Gear {\r\n\t\tconst unrestrictedGems = allGems.filter(gem => Gems.isUnrestrictedGem(gem, phase));\r\n\r\n\t\tconst {\r\n\t\t\tbestGemForColor: bestGemForColor,\r\n\t\t\tbestGemForColorEP: bestGemForColorEP,\r\n\t\t\tbestGemForSocket: bestGemForSocket,\r\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\r\n\t\t\tbestGem: bestGem,\r\n\t\t\tbestGemEP: bestGemEP,\r\n\t\t} = EpWeightsMenu.findBestGems(unrestrictedGems, epWeights);\r\n\r\n\t\tconst items = gear.asMap();\r\n\t\tconst socketBonusEPs = Object.values(items).map(item => item != null ? new Stats(item.item.socketBonus).computeEP(epWeights) : 0);\r\n\r\n\t\t// Start by optimally filling all items, ignoring meta condition.\r\n\t\tObject.entries(items).forEach(([itemSlot, equippedItem], i) => {\r\n\t\t\tif (equippedItem == null) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst item = equippedItem.item;\r\n\t\t\tconst socketColors = equippedItem.curSocketColors(isBlacksmithing);\r\n\r\n\t\t\t// Compare whether its better to match sockets + get socket bonus, or just use best gems.\r\n\t\t\tconst bestGemEPNotMatchingSockets = sum(socketColors.map(socketColor => socketColor == GemColor.GemColorMeta ? 0 : bestGemEP));\r\n\t\t\tconst bestGemEPMatchingSockets = socketBonusEPs[i] + sum(socketColors.map(socketColor => socketColor == GemColor.GemColorMeta ? 0 : bestGemForSocketEP[socketColor]));\r\n\r\n\t\t\tif (bestGemEPNotMatchingSockets > bestGemEPMatchingSockets) {\r\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\r\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\r\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGem, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tsocketColors.forEach((socketColor, i) => {\r\n\t\t\t\t\tif (socketColor != GemColor.GemColorMeta) {\r\n\t\t\t\t\t\tequippedItem = equippedItem!.withGem(bestGemForSocket[socketColor], i);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\titems[Number(itemSlot) as ItemSlot] = equippedItem;\r\n\t\t});\r\n\t\tgear = new Gear(items);\r\n\r\n\t\tconst allSockets: Array<{ itemSlot: ItemSlot, socketIdx: number }> = Object.keys(items).map((itemSlotStr) => {\r\n\t\t\tconst itemSlot = parseInt(itemSlotStr) as ItemSlot;\r\n\t\t\tconst item = items[itemSlot];\r\n\t\t\tif (!item) {\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\r\n\t\t\tconst numSockets = item.numSockets(isBlacksmithing);\r\n\t\t\treturn [...Array(numSockets).keys()]\r\n\t\t\t\t.filter(socketIdx => item.item.gemSockets[socketIdx] != GemColor.GemColorMeta)\r\n\t\t\t\t.map(socketIdx => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\titemSlot: itemSlot,\r\n\t\t\t\t\t\tsocketIdx: socketIdx,\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\t\t}).flat();\r\n\t\tconst threeSocketCombos = permutations(allSockets, 3);\r\n\t\tconst calculateGearGemsEP = (gear: Gear): number => gear.statsFromGems(isBlacksmithing).computeEP(epWeights);\r\n\r\n\t\t// Now make adjustments to satisfy meta condition.\r\n\t\t// Use a wrapper function so we can return for readability.\r\n\t\tgear = ((gear: Gear): Gear => {\r\n\t\t\tconst metaGem = gear.getMetaGem();\r\n\t\t\tif (!metaGem) {\r\n\t\t\t\treturn gear;\r\n\t\t\t}\r\n\r\n\t\t\tconst condition = Gems.getMetaGemCondition(metaGem.id);\r\n\t\t\t// Only TBC gems use compare color conditions, so just ignore them.\r\n\t\t\tif (!condition || condition.isCompareColorCondition()) {\r\n\t\t\t\treturn gear;\r\n\t\t\t}\r\n\r\n\t\t\t// If there are very few non-meta gem slots, just skip because it's annoying to deal with.\r\n\t\t\tif (gear.getAllGems(isBlacksmithing).length - 1 < 3) {\r\n\t\t\t\treturn gear;\r\n\t\t\t}\r\n\r\n\t\t\t// In wrath, all meta gems use min colors condition (numRed >= r && numYellow >= y && numBlue >= b)\r\n\t\t\t// All conditions require 3 gems, e.g. 3 of a single color, 2 of one color and 1 of another, or 1 of each.\r\n\t\t\t// So the maximum number of gems that ever need to change is 3.\r\n\r\n\t\t\tconst colorCombos = EpWeightsMenu.getColorCombosToSatisfyCondition(condition);\r\n\r\n\t\t\tlet bestGear = gear;\r\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\r\n\r\n\t\t\t// Use brute-force to try every possibility.\r\n\t\t\tcolorCombos.forEach(colorCombo => {\r\n\t\t\t\tthreeSocketCombos.forEach(socketCombo => {\r\n\t\t\t\t\tconst curItems = gear.asMap();\r\n\t\t\t\t\tfor (let i = 0; i < colorCombo.length; i++) {\r\n\t\t\t\t\t\tconst gemColor = colorCombo[i];\r\n\t\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\r\n\t\t\t\t\t\tcurItems[itemSlot] = curItems[itemSlot]!.withGem(bestGemForColor[gemColor], socketIdx);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst curGear = new Gear(curItems);\r\n\t\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\r\n\t\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\r\n\t\t\t\t\t\tif (curGearEP > bestGearEP) {\r\n\t\t\t\t\t\t\tbestGear = curGear;\r\n\t\t\t\t\t\t\tbestGearEP = curGearEP;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn bestGear;\r\n\t\t})(gear);\r\n\r\n\t\t// Now insert 3 JC gems, if Jewelcrafting is selected.\r\n\t\t// Use a wrapper function so we can return for readability.\r\n\t\tgear = ((gear: Gear): Gear => {\r\n\t\t\tif (!isJewelcrafting) {\r\n\t\t\t\treturn gear;\r\n\t\t\t}\r\n\r\n\t\t\tconst jcGems = allGems.filter(gem => gem.requiredProfession == Profession.Jewelcrafting);\r\n\r\n\t\t\tconst {\r\n\t\t\t\tbestGemForColor: bestJcGemForColor,\r\n\t\t\t\tbestGemForColorEP: bestJcGemForColorEP,\r\n\t\t\t\tbestGemForSocket: bestJcGemForSocket,\r\n\t\t\t\tbestGemForSocketEP: bestJcGemForSocketEP,\r\n\t\t\t\tbestGem: bestJcGem,\r\n\t\t\t\tbestGemEP: bestJcGemEP,\r\n\t\t\t} = EpWeightsMenu.findBestGems(jcGems, epWeights);\r\n\r\n\t\t\tlet bestGear = gear;\r\n\t\t\tlet bestGearEP = calculateGearGemsEP(gear);\r\n\r\n\t\t\tthreeSocketCombos.forEach(socketCombo => {\r\n\t\t\t\tconst curItems = gear.asMap();\r\n\t\t\t\tfor (let i = 0; i < socketCombo.length; i++) {\r\n\t\t\t\t\tconst { itemSlot, socketIdx } = socketCombo[i];\r\n\t\t\t\t\tconst ei = curItems[itemSlot]!;\r\n\t\t\t\t\tconst gemColor = ei.gems[socketIdx]!.color;\r\n\t\t\t\t\tcurItems[itemSlot] = ei.withGem(bestJcGemForColor[gemColor], socketIdx);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst curGear = new Gear(curItems);\r\n\t\t\t\tif (curGear.hasActiveMetaGem(isBlacksmithing)) {\r\n\t\t\t\t\tconst curGearEP = calculateGearGemsEP(curGear);\r\n\t\t\t\t\tif (curGearEP > bestGearEP) {\r\n\t\t\t\t\t\tbestGear = curGear;\r\n\t\t\t\t\t\tbestGearEP = curGearEP;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn bestGear;\r\n\t\t})(gear);\r\n\r\n\t\treturn gear;\r\n\t}\r\n\r\n\t// Returns every possible way we could satisfy the gem condition.\r\n\tprivate static getColorCombosToSatisfyCondition(condition: Gems.MetaGemCondition): Array<Array<GemColor>> {\r\n\t\tif (condition.isOneOfEach()) {\r\n\t\t\treturn [\r\n\t\t\t\tGems.PRIMARY_COLORS,\r\n\t\t\t\t[GemColor.GemColorPrismatic],\r\n\t\t\t].concat(\r\n\t\t\t\tGems.SECONDARY_COLORS.map((secondaryColor, i) => {\r\n\t\t\t\t\tconst remainingColor = Gems.PRIMARY_COLORS[i];\r\n\t\t\t\t\treturn Gems.socketToMatchingColors.get(remainingColor)!.map(matchingColor => [matchingColor, secondaryColor]);\r\n\t\t\t\t}).flat()\r\n\t\t\t);\r\n\t\t} else if (condition.isTwoAndOne()) {\r\n\t\t\tconst oneColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(1)];\r\n\t\t\tconst twoColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(2)];\r\n\t\t\tconst secondaryColor = Gems.SECONDARY_COLORS.find(color => Gems.gemColorMatchesSocket(color, oneColor) && Gems.gemColorMatchesSocket(color, twoColor))!;\r\n\r\n\t\t\treturn [\r\n\t\t\t\t// All the ways to get 1 point in both colors. These are partial combos,\r\n\t\t\t\t// which still need 1 more gem in the 2-color.\r\n\t\t\t\t[GemColor.GemColorPrismatic],\r\n\t\t\t\t[secondaryColor],\r\n\t\t\t\t[oneColor, twoColor],\r\n\t\t\t].map(partialCombo => {\r\n\t\t\t\treturn Gems.socketToMatchingColors.get(twoColor)!.map(matchingColor => partialCombo.concat([matchingColor]));\r\n\t\t\t}).flat();\r\n\t\t} else if (condition.isThreeOfAColor()) {\r\n\t\t\tconst threeColor = Gems.PRIMARY_COLORS[[condition.minRed, condition.minYellow, condition.minBlue].indexOf(3)];\r\n\t\t\tconst matchingColors = Gems.socketToMatchingColors.get(threeColor)!;\r\n\t\t\treturn combinationsWithDups(matchingColors, 3);\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate static findBestGems(gemList: Array<Gem>, epWeights: Stats): BestGemsResult {\r\n\t\t// Best gem when we need a gem of a specific color.\r\n\t\tconst bestGemForColor: Array<Gem> = Gems.GEM_COLORS.map(color => null as unknown as Gem);\r\n\t\tconst bestGemForColorEP: Array<number> = Gems.GEM_COLORS.map(color => 0);\r\n\t\t// Best gem when we need to match a socket to activate a bonus.\r\n\t\tconst bestGemForSocket: Array<Gem> = bestGemForColor.slice();\r\n\t\tconst bestGemForSocketEP: Array<number> = bestGemForColorEP.slice();\r\n\t\t// The single best gem, when color doesn't matter.\r\n\t\tlet bestGem = gemList[0];\r\n\t\tlet bestGemEP = 0;\r\n\t\tgemList.forEach(gem => {\r\n\t\t\tconst gemEP = new Stats(gem.stats).computeEP(epWeights);\r\n\t\t\tif (gemEP > bestGemForColorEP[gem.color]) {\r\n\t\t\t\tbestGemForColorEP[gem.color] = gemEP;\r\n\t\t\t\tbestGemForColor[gem.color] = gem;\r\n\r\n\t\t\t\tif (gem.color != GemColor.GemColorMeta && gemEP > bestGemEP) {\r\n\t\t\t\t\tbestGemEP = gemEP;\r\n\t\t\t\t\tbestGem = gem;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tGems.GEM_COLORS.forEach(socketColor => {\r\n\t\t\t\tif (Gems.gemMatchesSocket(gem, socketColor) && gemEP > bestGemForSocketEP[socketColor]) {\r\n\t\t\t\t\tbestGemForSocketEP[socketColor] = gemEP;\r\n\t\t\t\t\tbestGemForSocket[socketColor] = gem;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tbestGemForColor: bestGemForColor,\r\n\t\t\tbestGemForColorEP: bestGemForColorEP,\r\n\t\t\tbestGemForSocket: bestGemForSocket,\r\n\t\t\tbestGemForSocketEP: bestGemForSocketEP,\r\n\t\t\tbestGem: bestGem,\r\n\t\t\tbestGemEP: bestGemEP,\r\n\t\t};\r\n\t}\r\n\r\n\tprivate static epUnitStats: Array<UnitStat> = UnitStat.getAll().filter(stat => {\r\n\t\tif (stat.isStat()) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn [\r\n\t\t\t\tPseudoStat.PseudoStatMainHandDps,\r\n\t\t\t\tPseudoStat.PseudoStatOffHandDps,\r\n\t\t\t\tPseudoStat.PseudoStatRangedDps,\r\n\t\t\t].includes(stat.getPseudoStat());\r\n\t\t}\r\n\t});\r\n}\r\n\r\ninterface BestGemsResult {\r\n\tbestGemForColor: Array<Gem>,\r\n\tbestGemForColorEP: Array<number>,\r\n\tbestGemForSocket: Array<Gem>,\r\n\tbestGemForSocketEP: Array<number>,\r\n\tbestGem: Gem,\r\n\tbestGemEP: number,\r\n}\r\n","import { Tooltip } from 'bootstrap';\r\nimport { Component } from './component.js';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\nexport interface ContentBlockHeaderConfig {\r\n\ttitle: string,\r\n\textraCssClasses?: Array<string>,\r\n\ttitleTag?: string,\r\n\ttooltip?: string,\r\n}\r\n\r\nexport interface ContentBlockConfig {\r\n\tbodyClasses?: Array<string>,\r\n\textraCssClasses?: Array<string>,\r\n\trootElem?: HTMLElement,\r\n\theader?: ContentBlockHeaderConfig,\r\n}\r\n\r\nexport class ContentBlock extends Component {\r\n\treadonly headerElement: HTMLElement | null;\r\n\treadonly bodyElement: HTMLElement;\r\n\r\n\treadonly config: ContentBlockConfig;\r\n\r\n\tconstructor(parent: HTMLElement, cssClass: string, config: ContentBlockConfig) {\r\n\t\tsuper(parent, 'content-block', config.rootElem);\r\n\t\tthis.config = config;\r\n\t\tthis.rootElem.classList.add(cssClass);\r\n\r\n\t\tif (config.extraCssClasses) {\r\n\t\t\tthis.rootElem.classList.add(...config.extraCssClasses);\r\n\t\t}\r\n\r\n\t\tthis.headerElement = this.buildHeader();\r\n\t\tthis.bodyElement = this.buildBody();\r\n\t\tconfig.bodyClasses?.forEach((cl) => {\r\n\t\t\tthis.bodyElement.classList.add(cl);\r\n\t\t})\r\n\t}\r\n\r\n\tprivate buildHeader(): HTMLElement | null {\r\n\t\tif (this.config.header && Object.keys(this.config.header).length) {\r\n\t\t\tlet TitleTag = this.config.header.titleTag || 'h6';\r\n\t\t\tlet header =(\r\n\t\t\t\t<div className=\"content-block-header\">\r\n\t\t\t\t\t<TitleTag className=\"content-block-title\">\r\n\t\t\t\t\t\t{this.config.header.title}\r\n\t\t\t\t\t</TitleTag>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\r\n\t\t\tif (this.config.header.extraCssClasses) {\r\n\t\t\t\theader.classList.add(...this.config.header.extraCssClasses);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.config.header.tooltip)\r\n\t\t\t\tTooltip.getOrCreateInstance(header.querySelector('.content-block-title') as HTMLElement,  {\r\n\t\t\t\t\thtml: true,\r\n\t\t\t\t\ttitle: this.config.header.tooltip\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.rootElem.appendChild(header);\r\n\r\n\t\t\treturn header as HTMLElement;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildBody(): HTMLElement {\r\n\t\tlet bodyElem = document.createElement('div');\r\n\t\tbodyElem.classList.add('content-block-body');\r\n\r\n\t\tthis.rootElem.appendChild(bodyElem);\r\n\r\n\t\treturn bodyElem;\r\n\t}\r\n}\r\n","import { IndividualSimUI } from '../individual_sim_ui';\r\nimport { SimUI } from '../sim_ui';\r\nimport { TypedEvent } from '../typed_event';\r\nimport {\r\n\tClass,\r\n\tEquipmentSpec,\r\n\tItemSlot,\r\n\tGlyphs,\r\n\tItemSpec,\r\n\tProfession,\r\n\tRace,\r\n\tSpec,\r\n} from '../proto/common';\r\nimport { IndividualSimSettings } from '../proto/ui';\r\nimport { Database } from '../proto_utils/database';\r\nimport { classNames, nameToClass, nameToRace, nameToProfession } from '../proto_utils/names';\r\nimport { classGlyphsConfig, talentSpellIdsToTalentString } from '../talents/factory';\r\nimport { GlyphConfig } from '../talents/glyphs_picker';\r\nimport { BaseModal } from './base_modal';\r\nimport { buf2hex } from '../utils';\r\nimport { JsonObject } from '@protobuf-ts/runtime';\r\n\r\nexport abstract class Importer extends BaseModal {\r\n\tprotected readonly textElem: HTMLTextAreaElement;\r\n\tprotected readonly descriptionElem: HTMLElement;\r\n\tprotected readonly importButton: HTMLButtonElement;\r\n\tprivate readonly includeFile: boolean;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, title: string, includeFile: boolean) {\r\n\t\tsuper(parent, 'importer', { title: title, footer: true });\r\n\t\tthis.includeFile = includeFile;\r\n\t\tconst uploadInputId = 'upload-input-' + title.toLowerCase().replaceAll(' ', '-');\r\n\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"import-description\"></div>\r\n\t\t\t<textarea class=\"importer-textarea form-control\"></textarea>\r\n\t\t`;\r\n\t\tthis.footer!.innerHTML = `\r\n\t\t\t${this.includeFile ? `\r\n\t\t\t\t<label for=\"${uploadInputId}\" class=\"importer-button btn btn-primary upload-button me-2\">\r\n\t\t\t\t\t<i class=\"fas fa-file-arrow-up\"></i>\r\n\t\t\t\t\tUpload File\r\n\t\t\t\t</label>\r\n\t\t\t\t<input type=\"file\" id=\"${uploadInputId}\" class=\"importer-upload-input d-none\" hidden>\r\n\t\t\t` : ''\r\n\t\t\t}\r\n\t\t\t<button class=\"importer-button btn btn-primary import-button\">\r\n\t\t\t\t<i class=\"fa fa-download\"></i>\r\n\t\t\t\tImport\r\n\t\t\t</button>\r\n\t\t`;\r\n\r\n\t\tthis.textElem = this.rootElem.getElementsByClassName('importer-textarea')[0] as HTMLTextAreaElement;\r\n\t\tthis.descriptionElem = this.rootElem.getElementsByClassName('import-description')[0] as HTMLElement;\r\n\r\n\t\tif (this.includeFile) {\r\n\t\t\tconst uploadInput = this.rootElem.getElementsByClassName('importer-upload-input')[0] as HTMLButtonElement;\r\n\t\t\tuploadInput.addEventListener('change', async event => {\r\n\t\t\t\tconst data: string = await (event as any).target.files[0].text();\r\n\t\t\t\tthis.textElem.textContent = data;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.importButton = this.rootElem.getElementsByClassName('import-button')[0] as HTMLButtonElement;\r\n\t\tthis.importButton.addEventListener('click', event => {\r\n\t\t\ttry {\r\n\t\t\t\tthis.onImport(this.textElem.value || '');\r\n\t\t\t} catch (error) {\r\n\t\t\t\talert('Import error: ' + error);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tabstract onImport(data: string): void\r\n\r\n\tprotected async finishIndividualImport<SpecType extends Spec>(simUI: IndividualSimUI<SpecType>, charClass: Class, race: Race, equipmentSpec: EquipmentSpec, talentsStr: string, glyphs: Glyphs | null, professions: Array<Profession>): Promise<void> {\r\n\t\tconst playerClass = simUI.player.getClass();\r\n\t\tif (charClass != playerClass) {\r\n\t\t\tthrow new Error(`Wrong Class! Expected ${classNames[playerClass]} but found ${classNames[charClass]}!`);\r\n\t\t}\r\n\r\n\t\tawait Database.loadLeftoversIfNecessary(equipmentSpec);\r\n\r\n\t\tconst gear = simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\r\n\r\n\t\tconst expectedEnchantIds = equipmentSpec.items.map(item => item.enchant);\r\n\t\tconst foundEnchantIds = gear.asSpec().items.map(item => item.enchant);\r\n\t\tconst missingEnchants = expectedEnchantIds.filter(expectedId => expectedId != 0 && !foundEnchantIds.includes(expectedId));\r\n\r\n\t\tconst expectedItemIds = equipmentSpec.items.map(item => item.id);\r\n\t\tconst foundItemIds = gear.asSpec().items.map(item => item.id);\r\n\t\tconst missingItems = expectedItemIds.filter(expectedId => !foundItemIds.includes(expectedId));\r\n\r\n\t\t// Now update settings using the parsed values.\r\n\t\tconst eventID = TypedEvent.nextEventID();\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tsimUI.player.setRace(eventID, race);\r\n\t\t\tsimUI.player.setGear(eventID, gear);\r\n\t\t\tif (talentsStr && talentsStr != '--') {\r\n\t\t\t\tsimUI.player.setTalentsString(eventID, talentsStr);\r\n\t\t\t}\r\n\t\t\tif (glyphs) {\r\n\t\t\t\tsimUI.player.setGlyphs(eventID, glyphs)\r\n\t\t\t}\r\n\t\t\tif (professions.length > 0) {\r\n\t\t\t\tsimUI.player.setProfessions(eventID, professions)\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.close();\r\n\r\n\t\tif (missingItems.length == 0 && missingEnchants.length == 0) {\r\n\t\t\talert('Import successful!');\r\n\t\t} else {\r\n\t\t\talert('Import successful, but the following IDs were not found in the sim database:' +\r\n\t\t\t\t(missingItems.length == 0 ? '' : '\\n\\nItems: ' + missingItems.join(', ')) +\r\n\t\t\t\t(missingEnchants.length == 0 ? '' : '\\n\\nEnchants: ' + missingEnchants.join(', ')));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class IndividualJsonImporter<SpecType extends Spec> extends Importer {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'JSON Import', true);\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.descriptionElem.innerHTML = `\r\n\t\t\t<p>Import settings from a JSON file, which can be created using the JSON Export feature.</p>\r\n\t\t\t<p>To import, upload the file or paste the text below, then click, 'Import'.</p>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync onImport(data: string) {\r\n\t\tconst proto = IndividualSimSettings.fromJsonString(data, { ignoreUnknownFields: true });\r\n\t\tif (proto.player?.equipment) {\r\n\t\t\tawait Database.loadLeftoversIfNecessary(proto.player.equipment);\r\n\t\t}\r\n\t\tif (this.simUI.isWithinRaidSim) {\r\n\t\t\tif (proto.player) {\r\n\t\t\t\tthis.simUI.player.fromProto(TypedEvent.nextEventID(), proto.player);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), proto);\r\n\t\t}\r\n\t\tthis.close();\r\n\t}\r\n}\r\n\r\nexport class Individual80UImporter<SpecType extends Spec> extends Importer {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, '80 Upgrades Import', true);\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.descriptionElem.innerHTML = `\r\n\t\t\t<p>\r\n\t\t\t\tImport settings from <a href=\"https://eightyupgrades.com\" target=\"_blank\">Eighty Upgrades</a>.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tTo import, paste the output from the site's export option below and click, 'Import'.\r\n\t\t\t</p>\r\n\t\t`;\r\n\t}\r\n\r\n\tonImport(data: string) {\r\n\t\tconst importJson = JSON.parse(data);\r\n\r\n\t\t// Parse all the settings.\r\n\t\tconst charClass = nameToClass((importJson?.character?.gameClass as string) || '');\r\n\t\tif (charClass == Class.ClassUnknown) {\r\n\t\t\tthrow new Error('Could not parse Class!');\r\n\t\t}\r\n\r\n\t\tconst race = nameToRace((importJson?.character?.race as string) || '');\r\n\t\tif (race == Race.RaceUnknown) {\r\n\t\t\tthrow new Error('Could not parse Race!');\r\n\t\t}\r\n\r\n\t\tlet talentsStr = '';\r\n\t\tif (importJson?.talents?.length > 0) {\r\n\t\t\tconst talentIds = (importJson.talents as Array<any>).map(talentJson => talentJson.spellId);\r\n\t\t\ttalentsStr = talentSpellIdsToTalentString(charClass, talentIds);\r\n\t\t}\r\n\r\n\t\tlet equipmentSpec = EquipmentSpec.create();\r\n\t\t(importJson.items as Array<any>).forEach(itemJson => {\r\n\t\t\tlet itemSpec = ItemSpec.create();\r\n\t\t\titemSpec.id = itemJson.id;\r\n\t\t\tif (itemJson.enchant?.id) {\r\n\t\t\t\titemSpec.enchant = itemJson.enchant.id;\r\n\t\t\t}\r\n\t\t\tif (itemJson.gems) {\r\n\t\t\t\titemSpec.gems = (itemJson.gems as Array<any>).filter(gemJson => gemJson?.id).map(gemJson => gemJson.id);\r\n\t\t\t}\r\n\t\t\tequipmentSpec.items.push(itemSpec);\r\n\t\t});\r\n\r\n\t\tconst gear = this.simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\r\n\r\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, null, []);\r\n\t}\r\n}\r\n\r\nexport class IndividualWowheadGearPlannerImporter<SpecType extends Spec> extends Importer {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'Wowhead Import', true);\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.descriptionElem.innerHTML = `\r\n\t\t\t<p>\r\n\t\t\t\tImport settings from <a href=\"https://www.wowhead.com/wotlk/gear-planner\" target=\"_blank\">Wowhead Gear Planner</a>.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tThis feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tTo import, paste the gear planner link below and click, 'Import'.\r\n\t\t\t</p>\r\n\t\t`;\r\n\t}\r\n\r\n\tonImport(url: string) {\r\n\t\tconst match = url.match(/www\\.wowhead\\.com\\/wotlk\\/gear-planner\\/([a-z\\-]+)\\/([a-z\\-]+)\\/([a-zA-Z0-9_\\-]+)/);\r\n\t\tif (!match) {\r\n\t\t\tthrow new Error(`Invalid WCL URL ${url}, must look like \"https://www.wowhead.com/wotlk/gear-planner/CLASS/RACE/XXXX\"`);\r\n\t\t}\r\n\r\n\t\t// Parse all the settings.\r\n\t\tconst charClass = nameToClass(match[1].replaceAll('-', ' '));\r\n\t\tif (charClass == Class.ClassUnknown) {\r\n\t\t\tthrow new Error('Could not parse Class: ' + match[1]);\r\n\t\t}\r\n\r\n\t\tconst race = nameToRace(match[2].replaceAll('-', ' '));\r\n\t\tif (race == Race.RaceUnknown) {\r\n\t\t\tthrow new Error('Could not parse Race: ' + match[2]);\r\n\t\t}\r\n\r\n\t\tconst base64Data = match[3].replaceAll('_', '/').replaceAll('-', '+');\r\n\t\t//console.log('Base64: ' + base64Data);\r\n\t\tconst data = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0))\r\n\t\t//console.log('Hex: ' + buf2hex(data));\r\n\r\n\t\t// Binary schema\r\n\t\t// Byte 00: ??\r\n\t\t// Byte 01: ?? Seems related to aesthetics (e.g. body type)\r\n\t\t// Byte 02: 8-bit Player Level\r\n\t\t// Byte 03: 8-bit length of talents bytes\r\n\t\t// Next N Bytes: Talents in hex string format\r\n\r\n\t\t// Talent hex string looks like '230005232100330150323102505321f03f023203001f'\r\n\t\t// Just like regular wowhead talents string except 'f' instead of '-'.\r\n\t\tconst numTalentBytes = data[3];\r\n\t\tconst talentBytes = data.subarray(4, 4 + numTalentBytes);\r\n\t\tconst talentsHexStr = buf2hex(talentBytes);\r\n\t\t//console.log('Talents hex: ' + talentsHexStr);\r\n\t\tconst talentsStr = talentsHexStr.split('f').slice(0, 3).join('-');\r\n\t\t//console.log('Talents: ' + talentsStr);\r\n\r\n\t\tlet cur = 4 + numTalentBytes;\r\n\t\tconst numGlyphBytes = data[cur];\r\n\t\tcur++;\r\n\t\tconst glyphBytes = data.subarray(cur, cur + numGlyphBytes);\r\n\t\tconst gearBytes = data.subarray(cur + numGlyphBytes);\r\n\t\t//console.log(`Glyphs have ${numGlyphBytes} bytes: ${buf2hex(glyphBytes)}`);\r\n\t\t//console.log(`Remaining ${gearBytes.length} bytes: ${buf2hex(gearBytes)}`);\r\n\r\n\t\t// First byte in glyphs section seems to always be 0x30\r\n\t\tcur = 1;\r\n\t\tlet hasGlyphs = false;\r\n\t\tconst d = \"0123456789abcdefghjkmnpqrstvwxyz\";\r\n\t\tconst glyphStr = String.fromCharCode(...glyphBytes);\r\n\t\tconst glyphIds = [0, 0, 0, 0, 0, 0];\r\n\t\twhile (cur < glyphBytes.length) {\r\n\r\n\t\t\t// First byte for each glyph is 0x3z, where z is the glyph position.\r\n\t\t\t// 0, 1, 2 are major glyphs, 3, 4, 5 are minor glyphs.\r\n\t\t\tconst glyphPosition = d.indexOf(glyphStr[cur]);\r\n\t\t\tcur++;\r\n\r\n\t\t\t// For some reason, wowhead uses the spell IDs for the glyphs and\r\n\t\t\t// applies a ridiculous hashing scheme.\r\n\t\t\tconst spellId = 0 +\r\n\t\t\t\t(d.indexOf(glyphStr[cur + 0]) << 15) +\r\n\t\t\t\t(d.indexOf(glyphStr[cur + 1]) << 10) +\r\n\t\t\t\t(d.indexOf(glyphStr[cur + 2]) << 5) +\r\n\t\t\t\t(d.indexOf(glyphStr[cur + 3]) << 0);\r\n\t\t\tconst itemId = this.simUI.sim.db.glyphSpellToItemId(spellId);\r\n\t\t\t//console.log(`Glyph position: ${glyphPosition}, spellID: ${spellId}`);\r\n\r\n\t\t\thasGlyphs = true;\r\n\t\t\tglyphIds[glyphPosition] = itemId;\r\n\t\t\tcur += 4;\r\n\t\t}\r\n\t\tconst glyphs = Glyphs.create({\r\n\t\t\tmajor1: glyphIds[0],\r\n\t\t\tmajor2: glyphIds[1],\r\n\t\t\tmajor3: glyphIds[2],\r\n\t\t\tminor1: glyphIds[3],\r\n\t\t\tminor2: glyphIds[4],\r\n\t\t\tminor3: glyphIds[5],\r\n\t\t});\r\n\r\n\t\t// Binary schema for each item:\r\n\t\t// 8-bit slotNumber, high bit = is enchanted\r\n\t\t// 8-bit upper 3 bits for gem count\r\n\t\t// 16-bit item id\r\n\t\t// if enchant bit is set:\r\n\t\t//   8-bit ??, possibly enchant position for multiple enchants?\r\n\t\t//   16-bit enchant id\r\n\t\t// for each gem:\r\n\t\t//   8-bit upper 3 bits for gem position\r\n\t\t//   16-bit gem item id\r\n\t\tconst equipmentSpec = EquipmentSpec.create();\r\n\t\tcur = 0;\r\n\t\twhile (cur < gearBytes.length) {\r\n\t\t\tconst itemSpec = ItemSpec.create();\r\n\t\t\tconst slotId = gearBytes[cur] & 0b00111111;\r\n\t\t\tconst isEnchanted = Boolean(gearBytes[cur] & 0b10000000);\r\n\t\t\tconst randomEnchant = Boolean(gearBytes[cur] & 0b01000000);\r\n\t\t\tcur++;\r\n\r\n\t\t\tconst numGems = (gearBytes[cur] & 0b11100000) >> 5;\r\n\t\t\tconst highid = (gearBytes[cur] & 0b00011111);\r\n\t\t\tcur++;\r\n\r\n\t\t\titemSpec.id = (highid << 16) + (gearBytes[cur] << 8) + gearBytes[cur + 1];\r\n\t\t\tcur += 2;\r\n\t\t\t//console.log(`Slot ID: ${slotId}, isEnchanted: ${isEnchanted}, numGems: ${numGems}, itemID: ${itemSpec.id}`);\r\n\r\n\t\t\tif (isEnchanted) {\r\n\t\t\t\t// Note: this is the enchant SPELL id, not the effect ID.\r\n\t\t\t\tconst enchantSpellId = (gearBytes[cur] << 16) + (gearBytes[cur + 1] << 8) + gearBytes[cur + 2];\r\n\t\t\t\titemSpec.enchant = this.simUI.sim.db.enchantSpellIdToEffectId(enchantSpellId);\r\n\t\t\t\tcur += 3;\r\n\t\t\t\t//console.log(`Enchant ID: ${itemSpec.enchant}. Spellid: ${enchantSpellId}`);\r\n\t\t\t}\r\n\r\n\t\t\tfor (let gemIdx = 0; gemIdx < numGems; gemIdx++) {\r\n\t\t\t\tconst gemPosition = (gearBytes[cur] & 0b11100000) >> 5;\r\n\t\t\t\tconst highgemid = (gearBytes[cur] & 0b00011111);\r\n\t\t\t\tcur++;\r\n\r\n\t\t\t\tconst gemId = (highgemid << 16) + (gearBytes[cur] << 8) + gearBytes[cur + 1];\r\n\t\t\t\tcur += 2;\r\n\t\t\t\t//console.log(`Gem position: ${gemPosition}, gemID: ${gemId}`);\r\n\r\n\t\t\t\tif (!itemSpec.gems) {\r\n\t\t\t\t\titemSpec.gems = [];\r\n\t\t\t\t}\r\n\t\t\t\twhile (itemSpec.gems.length < gemPosition) {\r\n\t\t\t\t\titemSpec.gems.push(0);\r\n\t\t\t\t}\r\n\t\t\t\titemSpec.gems[gemPosition] = gemId;\r\n\t\t\t}\r\n\r\n\t\t\t// Ignore tabard / shirt slots\r\n\t\t\tconst itemSlotEntry = Object.entries(IndividualWowheadGearPlannerImporter.slotIDs).find(e => e[1] == slotId);\r\n\t\t\tif (itemSlotEntry != null) {\r\n\t\t\t\tequipmentSpec.items.push(itemSpec);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst gear = this.simUI.sim.db.lookupEquipmentSpec(equipmentSpec);\r\n\r\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, hasGlyphs ? glyphs : null, []);\r\n\t}\r\n\r\n\tstatic slotIDs: Record<ItemSlot, number> = {\r\n\t\t[ItemSlot.ItemSlotHead]: 1,\r\n\t\t[ItemSlot.ItemSlotNeck]: 2,\r\n\t\t[ItemSlot.ItemSlotShoulder]: 3,\r\n\t\t[ItemSlot.ItemSlotBack]: 15,\r\n\t\t[ItemSlot.ItemSlotChest]: 5,\r\n\t\t[ItemSlot.ItemSlotWrist]: 9,\r\n\t\t[ItemSlot.ItemSlotHands]: 10,\r\n\t\t[ItemSlot.ItemSlotWaist]: 6,\r\n\t\t[ItemSlot.ItemSlotLegs]: 7,\r\n\t\t[ItemSlot.ItemSlotFeet]: 8,\r\n\t\t[ItemSlot.ItemSlotFinger1]: 11,\r\n\t\t[ItemSlot.ItemSlotFinger2]: 12,\r\n\t\t[ItemSlot.ItemSlotTrinket1]: 13,\r\n\t\t[ItemSlot.ItemSlotTrinket2]: 14,\r\n\t\t[ItemSlot.ItemSlotMainHand]: 16,\r\n\t\t[ItemSlot.ItemSlotOffHand]: 17,\r\n\t\t[ItemSlot.ItemSlotRanged]: 18,\r\n\t};\r\n}\r\n\r\nexport class IndividualAddonImporter<SpecType extends Spec> extends Importer {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'Addon Import', true);\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.descriptionElem.innerHTML = `\r\n\t\t\t<p>\r\n\t\t\t\tImport settings from the <a href=\"https://www.curseforge.com/wow/addons/wowsimsexporter\" target=\"_blank\">WoWSims Importer In-Game Addon</a>.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tThis feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats.\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\tTo import, paste the output from the addon below and click, 'Import'.\r\n\t\t\t</p>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync onImport(data: string) {\r\n\t\tconst importJson = JSON.parse(data);\r\n\r\n\t\t// Parse all the settings.\r\n\t\tconst charClass = nameToClass((importJson['class'] as string) || '');\r\n\t\tif (charClass == Class.ClassUnknown) {\r\n\t\t\tthrow new Error('Could not parse Class!');\r\n\t\t}\r\n\r\n\t\tconst race = nameToRace((importJson['race'] as string) || '');\r\n\t\tif (race == Race.RaceUnknown) {\r\n\t\t\tthrow new Error('Could not parse Race!');\r\n\t\t}\r\n\r\n\t\tconst professions = (importJson['professions'] as Array<{ name: string, level: number }>).map(profData => nameToProfession(profData.name));\r\n\t\tprofessions.forEach((prof, i) => {\r\n\t\t\tif (prof == Profession.ProfessionUnknown) {\r\n\t\t\t\tthrow new Error(`Could not parse profession '${importJson['professions'][i]}'`);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst talentsStr = (importJson['talents'] as string) || '';\r\n\t\tconst glyphsConfig = classGlyphsConfig[charClass];\r\n\r\n\t\tconst db = await Database.get();\r\n\t\tconst majorGlyphIDs = (importJson['glyphs']['major'] as Array<string | JsonObject>).map(g => glyphToID(g, db, glyphsConfig.majorGlyphs));\r\n\t\tconst minorGlyphIDs = (importJson['glyphs']['minor'] as Array<string | JsonObject>).map(g => glyphToID(g, db, glyphsConfig.minorGlyphs));\r\n\r\n\t\tconst glyphs = Glyphs.create({\r\n\t\t\tmajor1: majorGlyphIDs[0] || 0,\r\n\t\t\tmajor2: majorGlyphIDs[1] || 0,\r\n\t\t\tmajor3: majorGlyphIDs[2] || 0,\r\n\t\t\tminor1: minorGlyphIDs[0] || 0,\r\n\t\t\tminor2: minorGlyphIDs[1] || 0,\r\n\t\t\tminor3: minorGlyphIDs[2] || 0,\r\n\t\t});\r\n\r\n\t\tconst gearJson = importJson['gear'];\r\n\t\tgearJson.items = (gearJson.items as Array<any>).filter(item => item != null);\r\n\t\t(gearJson.items as Array<any>).forEach(item => {\r\n\t\t\tif (item.gems) {\r\n\t\t\t\titem.gems = (item.gems as Array<any>).map(gem => gem || 0);\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst equipmentSpec = EquipmentSpec.fromJson(gearJson);\r\n\r\n\t\tthis.finishIndividualImport(this.simUI, charClass, race, equipmentSpec, talentsStr, glyphs, professions);\r\n\t}\r\n}\r\n\r\nfunction glyphNameToID(glyphName: string, glyphsConfig: Record<number, GlyphConfig>): number {\r\n\tif (!glyphName) {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tfor (let glyphIDStr in glyphsConfig) {\r\n\t\tif (glyphsConfig[glyphIDStr].name == glyphName) {\r\n\t\t\treturn parseInt(glyphIDStr);\r\n\t\t}\r\n\t}\r\n\tthrow new Error(`Unknown glyph name '${glyphName}'`);\r\n}\r\n\r\nfunction glyphToID(glyph: string | JsonObject, db: Database, glyphsConfig: Record<number, GlyphConfig>): number {\r\n\tif (typeof glyph === 'string') {\r\n\t\t// Legacy version: AddOn exports Glyphs by name (string) only. Names must be in English.\r\n\t\treturn glyphNameToID(glyph, glyphsConfig);\r\n\t}\r\n\t// New version exports glyph information in a table that includes the name and the glyph spell ID.\r\n\treturn db.glyphSpellToItemId(glyph['spellID'] as number);\r\n}\r\n","import {\r\n\tArmorType,\r\n\tItemSlot,\r\n} from '../proto/common.js';\r\nimport {\r\n\tRaidFilterOption,\r\n\tSourceFilterOption,\r\n\tUIItem_FactionRestriction,\r\n} from '../proto/ui.js';\r\nimport {\r\n\tarmorTypeNames,\r\n\traidNames,\r\n\trangedWeaponTypeNames,\r\n\tsourceNames,\r\n\tweaponTypeNames,\r\n} from '../proto_utils/names.js';\r\nimport {\r\n\tclassToEligibleRangedWeaponTypes,\r\n\tclassToEligibleWeaponTypes,\r\n\tclassToMaxArmorType,\r\n\tisDualWieldSpec,\r\n} from '../proto_utils/utils.js';\r\nimport { Player } from '../player.js';\r\nimport { Sim } from '../sim.js';\r\nimport { EventID } from '../typed_event.js';\r\nimport { getEnumValues } from '../utils.js';\r\n\r\nimport { BooleanPicker } from './boolean_picker.js';\r\nimport { NumberPicker } from './number_picker.js';\r\nimport { BaseModal } from './base_modal.js';\r\nimport { EnumPicker } from './enum_picker.js';\r\n\r\nconst factionRestrictionsToLabels: Record<UIItem_FactionRestriction, string> = {\r\n\t[UIItem_FactionRestriction.UNSPECIFIED]: 'None',\r\n\t[UIItem_FactionRestriction.ALLIANCE_ONLY]: 'Alliance only',\r\n\t[UIItem_FactionRestriction.HORDE_ONLY]: 'Horde only',\r\n};\r\n\r\nexport class FiltersMenu extends BaseModal {\r\n\tconstructor(rootElem: HTMLElement, player: Player<any>, slot: ItemSlot) {\r\n\t\tsuper(rootElem, 'filters-menu', { size: 'md', title: 'Filters' });\r\n\r\n\t\tlet section = this.newSection('Factions');\r\n\r\n\t\tnew EnumPicker(section, player.sim, {\r\n\t\t\tlabel: 'Faction Restrictions',\r\n\t\t\tvalues: [\r\n\t\t\t\tUIItem_FactionRestriction.UNSPECIFIED,\r\n\t\t\t\tUIItem_FactionRestriction.ALLIANCE_ONLY,\r\n\t\t\t\tUIItem_FactionRestriction.HORDE_ONLY\r\n\t\t\t].map((restriction) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: factionRestrictionsToLabels[restriction],\r\n\t\t\t\t\tvalue: restriction,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: sim => sim.filtersChangeEmitter,\r\n\t\t\tgetValue: (sim: Sim) => sim.getFilters().factionRestriction,\r\n\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: UIItem_FactionRestriction) => {\r\n\t\t\t\tconst newFilters = sim.getFilters();\r\n\t\t\t\tnewFilters.factionRestriction = newValue;\r\n\t\t\t\tsim.setFilters(eventID, newFilters);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tsection = this.newSection('Source');\r\n\t\tsection.classList.add('filters-menu-section-bool-list');\r\n\t\tconst sources = Sim.ALL_SOURCES.filter(s => s != SourceFilterOption.SourceUnknown);\r\n\t\tsources.forEach(source => {\r\n\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\r\n\t\t\t\tlabel: sourceNames[source],\r\n\t\t\t\tinline: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().sources.includes(source),\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\tfilters.sources.push(source);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfilters.sources = filters.sources.filter(v => v != source);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsection = this.newSection('Raids');\r\n\t\tsection.classList.add('filters-menu-section-bool-list');\r\n\t\tconst raids = Sim.ALL_RAIDS.filter(s => s != RaidFilterOption.RaidUnknown);\r\n\t\traids.forEach(raid => {\r\n\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\r\n\t\t\t\tlabel: raidNames[raid],\r\n\t\t\t\tinline: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().raids.includes(raid),\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\tfilters.raids.push(raid);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfilters.raids = filters.raids.filter(v => v != raid);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (Player.ARMOR_SLOTS.includes(slot)) {\r\n\t\t\tconst maxArmorType = classToMaxArmorType[player.getClass()];\r\n\t\t\tif (maxArmorType >= ArmorType.ArmorTypeLeather) {\r\n\t\t\t\tconst section = this.newSection('Armor Type');\r\n\t\t\t\tsection.classList.add('filters-menu-section-bool-list');\r\n\t\t\t\tconst armorTypes = (getEnumValues(ArmorType) as Array<ArmorType>)\r\n\t\t\t\t\t.filter(at => at != ArmorType.ArmorTypeUnknown)\r\n\t\t\t\t\t.filter(at => at <= maxArmorType);\r\n\r\n\t\t\t\tarmorTypes.forEach(armorType => {\r\n\t\t\t\t\tnew BooleanPicker<Sim>(section, player.sim, {\r\n\t\t\t\t\t\tlabel: armorTypeNames[armorType],\r\n\t\t\t\t\t\tinline: true,\r\n\t\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().armorTypes.includes(armorType),\r\n\t\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\t\t\tfilters.armorTypes.push(armorType);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tfilters.armorTypes = filters.armorTypes.filter(at => at != armorType);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else if (Player.WEAPON_SLOTS.includes(slot)) {\r\n\t\t\tconst weaponTypeSection = this.newSection('Weapon Type');\r\n\t\t\tweaponTypeSection.classList.add('filters-menu-section-bool-list');\r\n\t\t\tconst weaponTypes = classToEligibleWeaponTypes[player.getClass()].map(ewt => ewt.weaponType);\r\n\r\n\t\t\tweaponTypes.forEach(weaponType => {\r\n\t\t\t\tnew BooleanPicker<Sim>(weaponTypeSection, player.sim, {\r\n\t\t\t\t\tlabel: weaponTypeNames[weaponType],\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().weaponTypes.includes(weaponType),\r\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\t\tfilters.weaponTypes.push(weaponType);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfilters.weaponTypes = filters.weaponTypes.filter(at => at != weaponType);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tconst weaponSpeedSection = this.newSection('Weapon Speed');\r\n\t\t\tweaponSpeedSection.classList.add('filters-menu-section-number-list');\r\n\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\r\n\t\t\t\tlabel: 'Min MH Speed',\r\n\t\t\t\t//labelTooltip: 'Maximum speed for the mainhand weapon. If 0, no maximum value is applied.',\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tpositive: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minMhWeaponSpeed,\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tfilters.minMhWeaponSpeed = newValue;\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\r\n\t\t\t\tlabel: 'Max MH Speed',\r\n\t\t\t\t//labelTooltip: 'Maximum speed for the mainhand weapon. If 0, no maximum value is applied.',\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tpositive: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxMhWeaponSpeed,\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tfilters.maxMhWeaponSpeed = newValue;\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tif (isDualWieldSpec(player.spec)) {\r\n\t\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\r\n\t\t\t\t\tlabel: 'Min OH Speed',\r\n\t\t\t\t\t//labelTooltip: 'Minimum speed for the offhand weapon. If 0, no minimum value is applied.',\r\n\t\t\t\t\tfloat: true,\r\n\t\t\t\t\tpositive: true,\r\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minOhWeaponSpeed,\r\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\t\tfilters.minOhWeaponSpeed = newValue;\r\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t\tnew NumberPicker<Sim>(weaponSpeedSection, player.sim, {\r\n\t\t\t\t\tlabel: 'Max OH Speed',\r\n\t\t\t\t\t//labelTooltip: 'Maximum speed for the offhand weapon. If 0, no maximum value is applied.',\r\n\t\t\t\t\tfloat: true,\r\n\t\t\t\t\tpositive: true,\r\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxOhWeaponSpeed,\r\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\t\tfilters.maxOhWeaponSpeed = newValue;\r\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else if (slot == ItemSlot.ItemSlotRanged) {\r\n\t\t\tconst rangedWeaponTypes = classToEligibleRangedWeaponTypes[player.getClass()];\r\n\t\t\tif (rangedWeaponTypes.length <= 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst rangedWeaponTypeSection = this.newSection('Ranged Weapon Type');\r\n\t\t\trangedWeaponTypeSection.classList.add('filters-menu-section-bool-list');\r\n\r\n\t\t\trangedWeaponTypes.forEach(rangedWeaponType => {\r\n\t\t\t\tnew BooleanPicker<Sim>(rangedWeaponTypeSection, player.sim, {\r\n\t\t\t\t\tlabel: rangedWeaponTypeNames[rangedWeaponType],\r\n\t\t\t\t\tinline: true,\r\n\t\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().rangedWeaponTypes.includes(rangedWeaponType),\r\n\t\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\t\tif (newValue) {\r\n\t\t\t\t\t\t\tfilters.rangedWeaponTypes.push(rangedWeaponType);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tfilters.rangedWeaponTypes = filters.rangedWeaponTypes.filter(at => at != rangedWeaponType);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tconst rangedWeaponSpeedSection = this.newSection('Ranged Weapon Speed');\r\n\t\t\trangedWeaponSpeedSection.classList.add('filters-menu-section-number-list');\r\n\t\t\tnew NumberPicker<Sim>(rangedWeaponSpeedSection, player.sim, {\r\n\t\t\t\tlabel: 'Min Ranged Speed',\r\n\t\t\t\t//labelTooltip: 'Maximum speed for the ranged weapon. If 0, no maximum value is applied.',\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tpositive: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().minRangedWeaponSpeed,\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tfilters.minRangedWeaponSpeed = newValue;\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tnew NumberPicker<Sim>(rangedWeaponSpeedSection, player.sim, {\r\n\t\t\t\tlabel: 'Max Ranged Speed',\r\n\t\t\t\t//labelTooltip: 'Maximum speed for the ranged weapon. If 0, no maximum value is applied.',\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tpositive: true,\r\n\t\t\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\t\t\tgetValue: (sim: Sim) => sim.getFilters().maxRangedWeaponSpeed,\r\n\t\t\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\t\t\tconst filters = sim.getFilters();\r\n\t\t\t\t\tfilters.maxRangedWeaponSpeed = newValue;\r\n\t\t\t\t\tsim.setFilters(eventID, filters);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprivate newSection(name: string): HTMLElement {\r\n\t\tconst section = document.createElement('div');\r\n\t\tsection.classList.add('menu-section');\r\n\t\tthis.body.appendChild(section);\r\n\t\tsection.innerHTML = `\r\n\t\t\t<div class=\"menu-section-header\">\r\n\t\t\t\t<h6 class=\"menu-section-title\">${name}</h6>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"menu-section-content\"></div>\r\n\t\t`;\r\n\t\treturn section.getElementsByClassName('menu-section-content')[0] as HTMLElement;\r\n\t}\r\n}\r\n","import { BooleanPicker } from '../components/boolean_picker.js';\r\nimport { EnumPicker } from '../components/enum_picker.js';\r\nimport { UnitReference } from '../proto/common.js';\r\nimport { Player } from '../player.js';\r\nimport { Sim } from '../sim.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { emptyUnitReference } from '../proto_utils/utils.js';\r\nimport { APLRotation_Type } from '../proto/apl.js';\r\n\r\nexport function makeShow1hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\r\n\treturn new BooleanPicker<Sim>(parent, sim, {\r\n\t\textraCssClasses: ['show-1h-weapons-selector', 'mb-0'],\r\n\t\tlabel: '1H',\r\n\t\tinline: true,\r\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\tgetValue: (sim: Sim) => sim.getFilters().oneHandedWeapons,\r\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\tconst filters = sim.getFilters();\r\n\t\t\tfilters.oneHandedWeapons = newValue;\r\n\t\t\tsim.setFilters(eventID, filters);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport function makeShow2hWeaponsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\r\n\treturn new BooleanPicker<Sim>(parent, sim, {\r\n\t\textraCssClasses: ['show-2h-weapons-selector', 'mb-0'],\r\n\t\tlabel: '2H',\r\n\t\tinline: true,\r\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\tgetValue: (sim: Sim) => sim.getFilters().twoHandedWeapons,\r\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\tconst filters = sim.getFilters();\r\n\t\t\tfilters.twoHandedWeapons = newValue;\r\n\t\t\tsim.setFilters(eventID, filters);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport function makeShowMatchingGemsSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\r\n\treturn new BooleanPicker<Sim>(parent, sim, {\r\n\t\textraCssClasses: ['show-matching-gems-selector', 'input-inline', 'mb-0'],\r\n\t\tlabel: 'Match Socket',\r\n\t\tinline: true,\r\n\t\tchangedEvent: (sim: Sim) => sim.filtersChangeEmitter,\r\n\t\tgetValue: (sim: Sim) => sim.getFilters().matchingGemsOnly,\r\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\tconst filters = sim.getFilters();\r\n\t\t\tfilters.matchingGemsOnly = newValue;\r\n\t\t\tsim.setFilters(eventID, filters);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport function makeShowEPValuesSelector(parent: HTMLElement, sim: Sim): BooleanPicker<Sim> {\r\n\treturn new BooleanPicker<Sim>(parent, sim, {\r\n\t\textraCssClasses: ['show-ep-values-selector', 'input-inline', 'mb-0'],\r\n\t\tlabel: 'Show EP',\r\n\t\tinline: true,\r\n\t\tchangedEvent: (sim: Sim) => sim.showEPValuesChangeEmitter,\r\n\t\tgetValue: (sim: Sim) => sim.getShowEPValues(),\r\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: boolean) => {\r\n\t\t\tsim.setShowEPValues(eventID, newValue);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport function makePhaseSelector(parent: HTMLElement, sim: Sim): EnumPicker<Sim> {\r\n\treturn new EnumPicker<Sim>(parent, sim, {\r\n\t\textraCssClasses: ['phase-selector'],\r\n\t\tvalues: [\r\n\t\t\t{ name: 'Pre-Raid', value: 1 },\r\n\t\t\t{ name: 'Phase 1', value: 2 },\r\n\t\t\t{ name: 'Phase 2', value: 3 },\r\n\t\t\t{ name: 'Phase 3', value: 4 },\r\n\t\t\t{ name: 'Phase 4', value: 5 },\r\n\t\t\t{ name: 'Phase 5', value: 6 },\r\n\t\t],\r\n\t\tchangedEvent: (sim: Sim) => sim.phaseChangeEmitter,\r\n\t\tgetValue: (sim: Sim) => sim.getPhase(),\r\n\t\tsetValue: (eventID: EventID, sim: Sim, newValue: number) => {\r\n\t\t\tsim.setPhase(eventID, newValue);\r\n\t\t},\r\n\t});\r\n}\r\n\r\nexport const ReactionTime = {\r\n\ttype: 'number' as const,\r\n\tlabel: 'Reaction Time',\r\n\tlabelTooltip: 'Reaction time of the player, in milliseconds. Used with certain APL values (such as \\'Aura Is Active With Reaction Time\\').',\r\n\tchangedEvent: (player: Player<any>) => player.miscOptionsChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getReactionTime(),\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tplayer.setReactionTime(eventID, newValue);\r\n\t},\r\n};\r\n\r\nexport const ChannelClipDelay = {\r\n\ttype: 'number' as const,\r\n\tlabel: 'Channel Clip Delay',\r\n\tlabelTooltip: 'Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.',\r\n\tchangedEvent: (player: Player<any>) => player.miscOptionsChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getChannelClipDelay(),\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tplayer.setChannelClipDelay(eventID, newValue);\r\n\t},\r\n};\r\n\r\nexport const InFrontOfTarget = {\r\n\ttype: 'boolean' as const,\r\n\tlabel: 'In Front of Target',\r\n\tlabelTooltip: 'Stand in front of the target, causing Blocks and Parries to be included in the attack table.',\r\n\tchangedEvent: (player: Player<any>) => player.inFrontOfTargetChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getInFrontOfTarget(),\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\r\n\t\tplayer.setInFrontOfTarget(eventID, newValue);\r\n\t},\r\n};\r\n\r\nexport const DistanceFromTarget = {\r\n\ttype: 'number' as const,\r\n\tlabel: 'Distance From Target',\r\n\tlabelTooltip: 'Distance from targets, in yards. Used to calculate travel time for certain spells.',\r\n\tchangedEvent: (player: Player<any>) => player.distanceFromTargetChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getDistanceFromTarget(),\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tplayer.setDistanceFromTarget(eventID, newValue);\r\n\t},\r\n};\r\n\r\nexport const TankAssignment = {\r\n\ttype: 'enum' as const,\r\n\textraCssClasses: [\r\n\t\t'tank-selector',\r\n\t\t'threat-metrics',\r\n\t\t'within-raid-sim-hide',\r\n\t],\r\n\tlabel: 'Tank Assignment',\r\n\tlabelTooltip: 'Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.',\r\n\tvalues: [\r\n\t\t{ name: 'None', value: -1 },\r\n\t\t{ name: 'Main Tank', value: 0 },\r\n\t\t{ name: 'Tank 2', value: 1 },\r\n\t\t{ name: 'Tank 3', value: 2 },\r\n\t\t{ name: 'Tank 4', value: 3 },\r\n\t],\r\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.tanksChangeEmitter,\r\n\tgetValue: (player: Player<any>) => (player.getRaid()?.getTanks() || []).findIndex(tank => UnitReference.equals(tank, player.makeUnitReference())),\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst newTanks = [];\r\n\t\tif (newValue != -1) {\r\n\t\t\tfor (let i = 0; i < newValue; i++) {\r\n\t\t\t\tnewTanks.push(emptyUnitReference());\r\n\t\t\t}\r\n\t\t\tnewTanks.push(player.makeUnitReference());\r\n\t\t}\r\n\t\tplayer.getRaid()!.setTanks(eventID, newTanks);\r\n\t},\r\n};\r\n\r\nexport const IncomingHps = {\r\n\ttype: 'number' as const,\r\n\tlabel: 'Incoming HPS',\r\n\tlabelTooltip: `\r\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\r\n\t\t<p>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getHealingModel().hps,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst healingModel = player.getHealingModel();\r\n\t\thealingModel.hps = newValue;\r\n\t\tplayer.setHealingModel(eventID, healingModel);\r\n\t},\r\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\r\n};\r\n\r\nexport const HealingCadence = {\r\n\ttype: 'number' as const,\r\n\tfloat: true,\r\n\tlabel: 'Healing Cadence',\r\n\tlabelTooltip: `\r\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\r\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\r\n\t\t<p>If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getHealingModel().cadenceSeconds,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst healingModel = player.getHealingModel();\r\n\t\thealingModel.cadenceSeconds = newValue;\r\n\t\tplayer.setHealingModel(eventID, healingModel);\r\n\t},\r\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\r\n};\r\n\r\nexport const HealingCadenceVariation = {\r\n\ttype: 'number' as const,\r\n\tfloat: true,\r\n\tlabel: 'Cadence +/-',\r\n\tlabelTooltip: `\r\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\r\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\r\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getHealingModel().cadenceVariation,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst healingModel = player.getHealingModel();\r\n\t\thealingModel.cadenceVariation = newValue;\r\n\t\tplayer.setHealingModel(eventID, healingModel);\r\n\t},\r\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\r\n};\r\n\r\nexport const BurstWindow = {\r\n\ttype: 'number' as const,\r\n\tfloat: false,\r\n\tlabel: 'TMI Burst Window',\r\n\tlabelTooltip: `\r\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\r\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.getRaid()!.changeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getHealingModel().burstWindow,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst healingModel = player.getHealingModel();\r\n\t\thealingModel.burstWindow = newValue;\r\n\t\tplayer.setHealingModel(eventID, healingModel);\r\n\t},\r\n\tenableWhen: (player: Player<any>) => (player.getRaid()?.getTanks() || []).find(tank => UnitReference.equals(tank, player.makeUnitReference())) != null,\r\n};\r\n\r\nexport const HpPercentForDefensives = {\r\n\ttype: 'number' as const,\r\n\tfloat: true,\r\n\tlabel: 'HP % for Defensive CDs',\r\n\tlabelTooltip: `\r\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\r\n\t\t<p>If set to 0, this restriction is disabled.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getCooldowns().hpPercentForDefensives * 100,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst cooldowns = player.getCooldowns();\r\n\t\tcooldowns.hpPercentForDefensives = newValue / 100;\r\n\t\tplayer.setCooldowns(eventID, cooldowns);\r\n\t},\r\n};\r\n\r\nexport const InspirationUptime = {\r\n\ttype: 'number' as const,\r\n\tfloat: true,\r\n\tlabel: 'Inspiration % Uptime',\r\n\tlabelTooltip: `\r\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\r\n\t\t<p>If set to 0, the buff isn't applied.</p>\r\n\t`,\r\n\tchangedEvent: (player: Player<any>) => player.healingModelChangeEmitter,\r\n\tgetValue: (player: Player<any>) => player.getHealingModel().inspirationUptime * 100,\r\n\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\tconst healingModel = player.getHealingModel();\r\n\t\thealingModel.inspirationUptime = newValue / 100;\r\n\t\tplayer.setHealingModel(eventID, healingModel);\r\n\t},\r\n};\r\n","import { ItemQuality } from './proto/common.js';\r\n\r\nconst itemQualityCssClasses: Record<ItemQuality, string> = {\r\n\t[ItemQuality.ItemQualityJunk]: 'item-quality-junk',\r\n\t[ItemQuality.ItemQualityCommon]: 'item-quality-common',\r\n\t[ItemQuality.ItemQualityUncommon]: 'item-quality-uncommon',\r\n\t[ItemQuality.ItemQualityRare]: 'item-quality-rare',\r\n\t[ItemQuality.ItemQualityEpic]: 'item-quality-epic',\r\n\t[ItemQuality.ItemQualityLegendary]: 'item-quality-legendary',\r\n\t[ItemQuality.ItemQualityArtifact]: 'item-quality-artifact',\r\n\t[ItemQuality.ItemQualityHeirloom]: 'item-quality-heirloom'\r\n};\r\nexport function setItemQualityCssClass(elem: HTMLElement, quality: ItemQuality | null) {\r\n\tObject.values(itemQualityCssClasses).forEach(cssClass => elem.classList.remove(cssClass));\r\n\r\n\tif (quality) {\r\n\t\telem.classList.add(itemQualityCssClasses[quality]);\r\n\t}\r\n}\r\n","import {\r\n\tUIEnchant as Enchant,\r\n} from '../proto/ui.js';\r\n\r\nlet descriptionsPromise: Promise<Record<number, string>> | null = null;\r\nfunction fetchEnchantDescriptions(): Promise<Record<number, string>> {\r\n\tif (descriptionsPromise == null) {\r\n\t\tdescriptionsPromise = fetch('/wotlk/assets/enchants/descriptions.json')\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(json => {\r\n\t\t\t\tconst descriptionsMap: Record<number, string> = {};\r\n\t\t\t\tfor (let idStr in json) {\r\n\t\t\t\t\tdescriptionsMap[parseInt(idStr)] = json[idStr];\r\n\t\t\t\t}\r\n\t\t\t\treturn descriptionsMap;\r\n\t\t\t});\r\n\t}\r\n\treturn descriptionsPromise;\r\n}\r\n\r\nexport async function getEnchantDescription(enchant: Enchant): Promise<string> {\r\n\tconst descriptionsMap = await fetchEnchantDescriptions();\r\n\treturn descriptionsMap[enchant.effectId] || enchant.name;\r\n}\r\n\r\n// Returns a string uniquely identifying the enchant.\r\nexport function getUniqueEnchantString(enchant: Enchant): string {\r\n\treturn enchant.effectId + '-' + enchant.type;\r\n}\r\n","// Based on clusterize\r\n/* Clusterize.js - v1.0.0 - 2023-01-22\r\n http://NeXTs.github.com/Clusterize.js/\r\n Copyright (c) 2015 Denis Lukov; Licensed MIT */\r\n\r\ninterface ClusterizeCallbacks {\r\n    clusterWillChange?: () => void;\r\n    clusterChanged?: () => void;\r\n    scrollingProgress?: (n:number) => void;\r\n}\r\n\r\ninterface ClusterizeParams {\r\n    rows: Element[];\r\n    scroll_elem: HTMLElement;\r\n    content_elem: HTMLElement;\r\n\r\n    rows_in_block?: number;\r\n    blocks_in_cluster?: number;\r\n    show_no_data_row?: boolean;\r\n    no_data_class?:string;\r\n    no_data_text?:string;\r\n    keep_parity?:boolean;\r\n    tag?:keyof HTMLElementTagNameMap;\r\n    callbacks?: ClusterizeCallbacks;\r\n    item_height?:number;\r\n}\r\n\r\nlet defaults = {\r\n    rows_in_block: 50,\r\n    blocks_in_cluster: 4,\r\n    tag: null,\r\n    show_no_data_row: true,\r\n    no_data_class: 'clusterize-no-data',\r\n    no_data_text: 'No data',\r\n    keep_parity: true,\r\n    callbacks: {}\r\n}\r\n\r\nfunction getStyle(prop:string, elem:HTMLElement) {\r\n    return window.getComputedStyle(elem)[prop as any]\r\n}\r\n\r\ninterface ClusterizeOptions {\r\n    rows_in_block: number;\r\n    blocks_in_cluster: number;\r\n    show_no_data_row: boolean;\r\n    no_data_class:string;\r\n    no_data_text:string;\r\n    keep_parity:boolean;\r\n    tag:keyof HTMLElementTagNameMap | null;\r\n    callbacks: ClusterizeCallbacks;\r\n\r\n    cluster_height: number;\r\n    item_height: number;\r\n    content_tag: string;\r\n\r\n    block_height: number;\r\n    scroll_top: number;\r\n    rows_in_cluster: number;\r\n}\r\n\r\ninterface ClusterizeDatasource {\r\n    getNumberOfRows: () => number;\r\n    generateRows: (startIdx: number, endIdx: number) => Element[];\r\n}\r\n\r\nexport class Clusterize {\r\n    private options: ClusterizeOptions;\r\n    private scroll_elem: Element;\r\n    private content_elem: HTMLElement;\r\n    private displayedRows: Element[];\r\n\r\n    private last_cluster = 0;\r\n    private scroll_debounce = 0;\r\n    private pointer_events_set = false;\r\n    private resize_debounce = 0;\r\n\r\n    private ds: ClusterizeDatasource;\r\n    private cache = {};\r\n\r\n    constructor(ds: ClusterizeDatasource, params: ClusterizeParams) {\r\n        this.options = {\r\n            rows_in_block: params.rows_in_block !== undefined ? params.rows_in_block : defaults.rows_in_block,\r\n            blocks_in_cluster: params.blocks_in_cluster !== undefined ? params.blocks_in_cluster : defaults.blocks_in_cluster,\r\n            show_no_data_row: params.show_no_data_row !== undefined ? params.show_no_data_row : defaults.show_no_data_row,\r\n            no_data_class: params.no_data_class !== undefined ? params.no_data_class : defaults.no_data_class,\r\n            no_data_text: params.no_data_text !== undefined ? params.no_data_text : defaults.no_data_text,\r\n            keep_parity: params.keep_parity !== undefined ? params.keep_parity : defaults.keep_parity,\r\n            tag: params.tag !== undefined ? params.tag : defaults.tag,\r\n            callbacks: params.callbacks !== undefined ? params.callbacks : defaults.callbacks,\r\n            cluster_height: 0,\r\n            item_height: params.item_height !== undefined ? params.item_height : 0,\r\n            content_tag: '',\r\n            block_height: 0,\r\n            scroll_top: 0,\r\n            rows_in_cluster: 0,\r\n        }\r\n\r\n        this.ds = ds;\r\n        this.displayedRows = params.rows;\r\n        this.scroll_elem = params.scroll_elem;\r\n        this.content_elem = params.content_elem;\r\n\r\n        // tabindex forces the browser to keep focus on the scrolling list, fixes #11\r\n        if(!this.content_elem.hasAttribute('tabindex'))\r\n            this.content_elem.setAttribute('tabindex', '0');\r\n  \r\n        let scroll_top = this.scroll_elem.scrollTop;\r\n  \r\n        // append initial data\r\n        this.getRowsHeight(params.rows);\r\n        this.insertToDom(params.rows, this.cache);\r\n  \r\n        // restore the scroll position\r\n        this.scroll_elem.scrollTop = scroll_top;\r\n    \r\n        // adding scroll handler\r\n        this.scroll_elem.addEventListener('scroll', this.scrollEv.bind(this));\r\n        window.addEventListener('resize', this.resizeEv.bind(this));\r\n    }\r\n\r\n    destroy(clean? : boolean) {\r\n        this.scroll_elem.removeEventListener('scroll', this.scrollEv.bind(this));\r\n        window.removeEventListener('resize', this.resizeEv.bind(this));\r\n        if (clean)\r\n            this.setContentElemRows(this.generateEmptyRow());\r\n    }\r\n\r\n    dispose() {\r\n        this.destroy();\r\n    }\r\n\r\n    refresh(force?: boolean) {\r\n        if(this.getRowsHeight(this.displayedRows) || force)\r\n            this.update();\r\n    }\r\n\r\n    update() {\r\n        let scroll_top = this.scroll_elem.scrollTop;\r\n        if(this.ds.getNumberOfRows() * this.options.item_height < scroll_top) {\r\n            this.scroll_elem.scrollTop = 0;\r\n            this.last_cluster = 0;\r\n        }\r\n        this.insertToDom(this.displayedRows, this.cache);\r\n        this.scroll_elem.scrollTop = scroll_top;\r\n    }\r\n\r\n    elementUpdate(cb: (e: Element) => void) {\r\n        for (let r of this.displayedRows) {\r\n            cb(r);\r\n        }\r\n    }\r\n\r\n    getScrollProgress() {\r\n        return this.options.scroll_top / (this.ds.getNumberOfRows() * this.options.item_height) * 100 || 0;\r\n    }\r\n\r\n    private scrollEv() {\r\n        // fixes scrolling issue on Mac #3\r\n        let is_mac = navigator.platform.toLowerCase().indexOf('mac') + 1;\r\n        if (is_mac) {\r\n            if (!this.pointer_events_set) \r\n                this.content_elem.style.pointerEvents = 'none';\r\n            this.pointer_events_set = true;\r\n            clearTimeout(this.scroll_debounce);\r\n            this.scroll_debounce = window.setTimeout(() => {\r\n                this.content_elem.style.pointerEvents = 'auto';\r\n                this.pointer_events_set = false;\r\n            }, 50);\r\n        }\r\n        if (this.last_cluster != (this.last_cluster = this.getClusterNum(this.ds.getNumberOfRows())))\r\n            this.insertToDom(this.displayedRows, this.cache);\r\n        if (this.options.callbacks.scrollingProgress)\r\n            this.options.callbacks.scrollingProgress(this.getScrollProgress());\r\n    };\r\n\r\n    private resizeEv() {\r\n        clearTimeout(this.resize_debounce);\r\n        this.resize_debounce = window.setTimeout(this.refresh.bind(this), 100);\r\n    }\r\n\r\n    private insertToDom(rows: Element[], cache: any) {\r\n        // explore row's height\r\n        if(!this.options.cluster_height) {\r\n            this.exploreEnvironment(rows, cache);\r\n        }\r\n        let data = this.generate();\r\n        let this_cluster_rows = data.rows;\r\n        this.displayedRows = data.rows;\r\n        let this_cluster_content_changed = this.checkChanges('data', this_cluster_rows, cache);\r\n        let top_offset_changed = this.checkChanges('top', data.top_offset, cache);\r\n        let only_bottom_offset_changed = this.checkChanges('bottom', data.bottom_offset, cache);\r\n        let callbacks = this.options.callbacks;\r\n        let layout: Element[] = [];\r\n\r\n        if(this_cluster_content_changed || top_offset_changed) {\r\n            if(data.top_offset) {\r\n                if (this.options.keep_parity) {\r\n                    let parity = this.renderExtraTag('keep-parity');\r\n                    parity.hidden = true;\r\n                    layout.push(parity);\r\n                }\r\n                layout.push(this.renderExtraTag('top-space', data.top_offset));\r\n            }\r\n            layout.push(...this_cluster_rows);\r\n            data.bottom_offset && layout.push(this.renderExtraTag('bottom-space', data.bottom_offset));\r\n            callbacks.clusterWillChange && callbacks.clusterWillChange();\r\n            this.setContentElemRows(layout);\r\n            this.options.content_tag == 'ol' && this.content_elem.setAttribute('start', data.rows_above.toString());\r\n            this.content_elem.style.counterIncrement = 'clusterize-counter ' + (data.rows_above-1);\r\n            callbacks.clusterChanged && callbacks.clusterChanged();\r\n        } else if(only_bottom_offset_changed) {\r\n            (this.content_elem.lastChild as HTMLElement).style.height = data.bottom_offset + 'px';\r\n        }\r\n    }\r\n\r\n    // get tag name, content tag name, tag height, calc cluster height\r\n    private exploreEnvironment(rows: Element[], cache: any) {\r\n        let opts = this.options;\r\n        opts.content_tag = this.content_elem.tagName.toLowerCase();\r\n        if (!rows.length)\r\n            return;\r\n        if (this.content_elem.children.length <= 1)\r\n            this.setContentElemRows([rows[0], rows[0], rows[0]]);\r\n        if (!opts.tag)\r\n            opts.tag = this.content_elem.children[0].tagName.toLowerCase() as keyof HTMLElementTagNameMap;\r\n            this.getRowsHeight(rows);\r\n    }\r\n\r\n    private setContentElemRows(rows: Element[]) {\r\n        this.content_elem.innerHTML = ``;\r\n        this.content_elem.append(...rows);\r\n    }\r\n\r\n    private getRowsHeight(rows: Element[]) {\r\n        let opts = this.options;\r\n        let prev_item_height = opts.item_height;\r\n        opts.cluster_height = 0;\r\n        let nodes = this.content_elem.children;\r\n        if (rows.length && nodes.length) {\r\n            let node = nodes[Math.floor(nodes.length / 2)] as HTMLElement;\r\n            opts.item_height = node.offsetHeight;\r\n            // consider table's border-spacing\r\n            if(opts.tag == 'tr' && getStyle('borderCollapse', this.content_elem) != 'collapse')\r\n                opts.item_height += parseInt(getStyle('borderSpacing', this.content_elem), 10) || 0;\r\n            // consider margins (and margins collapsing)\r\n            if(opts.tag != 'tr') {\r\n                let marginTop = parseInt(getStyle('marginTop', node), 10) || 0;\r\n                let marginBottom = parseInt(getStyle('marginBottom', node), 10) || 0;\r\n                opts.item_height += Math.max(marginTop, marginBottom);\r\n            }\r\n        }\r\n        opts.block_height = opts.item_height * opts.rows_in_block;\r\n        opts.rows_in_cluster = opts.blocks_in_cluster * opts.rows_in_block;\r\n        opts.cluster_height = opts.blocks_in_cluster * opts.block_height;\r\n        return prev_item_height != opts.item_height;\r\n    }\r\n\r\n    // generate cluster for current scroll position\r\n    private generate() {\r\n        let opts = this.options;\r\n        let rows_len = this.ds.getNumberOfRows();\r\n        if (rows_len < opts.rows_in_block) {\r\n            let rows = this.ds.generateRows(0, rows_len);\r\n            return {\r\n                top_offset: 0,\r\n                bottom_offset: 0,\r\n                rows_above: 0,\r\n                rows: rows_len ? rows : this.generateEmptyRow()\r\n            }\r\n        }\r\n        let items_start = Math.max((opts.rows_in_cluster - opts.rows_in_block) * this.getClusterNum(rows_len), 0),\r\n          items_end = items_start + opts.rows_in_cluster,\r\n          top_offset = Math.max(items_start * opts.item_height, 0),\r\n          bottom_offset = Math.max((rows_len - items_end) * opts.item_height, 0),\r\n          this_cluster_rows = [],\r\n          rows_above = items_start;\r\n        if(top_offset < 1) {\r\n            rows_above++;\r\n        }\r\n        this_cluster_rows = this.ds.generateRows(items_start, items_end);\r\n        return {\r\n            top_offset: top_offset,\r\n            bottom_offset: bottom_offset,\r\n            rows_above: rows_above,\r\n            rows: this_cluster_rows\r\n        }\r\n    }\r\n\r\n    // generate empty row if no data provided\r\n    private generateEmptyRow() : Element[] {\r\n        let opts = this.options;\r\n        if(!opts.tag || !opts.show_no_data_row) \r\n            return [];\r\n        let empty_row = document.createElement(opts.tag);\r\n        let no_data_content = document.createTextNode(opts.no_data_text), td;\r\n        empty_row.className = opts.no_data_class;\r\n        if(opts.tag == 'tr') {\r\n            td = document.createElement('td');\r\n            // fixes #53\r\n            td.colSpan = 100;\r\n            td.appendChild(no_data_content);\r\n        }\r\n        empty_row.appendChild(td || no_data_content);\r\n        return [empty_row];\r\n    }\r\n\r\n    // get current cluster number\r\n    private getClusterNum(num_rows: number) {\r\n        let opts = this.options;\r\n        opts.scroll_top = this.scroll_elem.scrollTop;\r\n        let cluster_divider = Math.max(opts.cluster_height - opts.block_height, 1);\r\n        let current_cluster = Math.floor(opts.scroll_top / cluster_divider);\r\n        let max_cluster = Math.floor((num_rows * opts.item_height) / cluster_divider);\r\n        return Math.min(current_cluster, max_cluster);\r\n    }\r\n\r\n    private renderExtraTag(class_name: string, height?: number) {\r\n        let tag = document.createElement(this.options.tag!);\r\n        let clusterize_prefix = 'clusterize-';\r\n\r\n        tag.className = [clusterize_prefix + 'extra-row', clusterize_prefix + class_name].join(' ');\r\n        tag.style.marginTop = '0';\r\n        tag.style.marginBottom = '0';\r\n        height && (tag.style.height = height + 'px');\r\n        return tag;\r\n    }\r\n\r\n    private checkChanges(type: string, value: any, cache: any) {\r\n        var changed = value != cache[type];\r\n        cache[type] = value;\r\n        return changed;\r\n    }\r\n}","import { classNames, difficultyNames, professionNames, slotNames } from '../proto_utils/names.js';\r\nimport { BaseModal } from './base_modal';\r\nimport { Component } from './component';\r\nimport { FiltersMenu } from './filters_menu';\r\nimport { Input, InputConfig } from './input';\r\nimport {\r\n\tmakePhaseSelector,\r\n\tmakeShow1hWeaponsSelector,\r\n\tmakeShow2hWeaponsSelector,\r\n\tmakeShowEPValuesSelector,\r\n\tmakeShowMatchingGemsSelector,\r\n} from './other_inputs';\r\n\r\nimport { setItemQualityCssClass } from '../css_utils';\r\nimport { Player } from '../player';\r\nimport { Sim } from '../sim.js';\r\nimport { SimUI } from '../sim_ui';\r\nimport { EventID, TypedEvent } from '../typed_event';\r\nimport { formatDeltaTextElem } from '../utils';\r\n\r\nimport { ActionId } from '../proto_utils/action_id';\r\nimport { getEnchantDescription, getUniqueEnchantString } from '../proto_utils/enchants';\r\nimport { EquippedItem } from '../proto_utils/equipped_item';\r\nimport { ItemSwapGear } from '../proto_utils/gear'\r\nimport { getEmptyGemSocketIconUrl, gemMatchesSocket } from '../proto_utils/gems';\r\nimport { Stats } from '../proto_utils/stats';\r\n\r\nimport {\r\n\tClass,\r\n\tSpec,\r\n\tGemColor,\r\n\tItemQuality,\r\n\tItemSlot,\r\n\tItemSpec,\r\n\tItemSwap,\r\n\tItemType,\r\n} from '../proto/common';\r\nimport {\r\n\tDatabaseFilters,\r\n\tUIEnchant as Enchant,\r\n\tUIGem as Gem,\r\n\tUIItem as Item,\r\n} from '../proto/ui.js';\r\nimport { IndividualSimUI } from '../individual_sim_ui.js';\r\nimport { Tooltip } from 'bootstrap';\r\nimport { element, fragment, ref } from 'tsx-vanilla';\r\n\r\nimport { Clusterize } from './virtual_scroll/clusterize.js';\r\n\r\nconst EP_TOOLTIP = `\r\n\tEP (Equivalence Points) is way of comparing items by multiplying the raw stats of an item with your current stat weights.\r\n\tMore EP does not necessarily mean more DPS, as EP doesn't take into account stat caps and non-linear stat calculations.\r\n`\r\n\r\nconst createHeroicLabel = () => {\r\n\treturn (<span className='heroic-label'>[H]</span>);\r\n}\r\n\r\nconst createGemContainer = (socketColor: GemColor ,gem : Gem|null) => {\r\n\tconst gemIconElem = ref<HTMLImageElement>();\r\n\t\r\n\tlet gemContainer = (\r\n\t\t<div className=\"gem-socket-container\">\r\n\t\t\t<img ref={gemIconElem} className={`gem-icon ${gem == null ? 'hide' : ''}`} />\r\n\t\t\t<img className=\"socket-icon\" src={getEmptyGemSocketIconUrl(socketColor)}/>\r\n\t\t</div>\r\n\t);\r\n\r\n\tif (gem != null) {\r\n\t\tActionId.fromItemId(gem.id).fill().then(filledId => {\r\n\t\t\tgemIconElem.value!.src = filledId.iconUrl;\r\n\t\t});\r\n\t}\r\n\treturn gemContainer;\r\n}\r\n\r\nexport class GearPicker extends Component {\r\n\t// ItemSlot is used as the index\r\n\treadonly itemPickers: Array<ItemPicker>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>) {\r\n\t\tsuper(parent, 'gear-picker-root');\r\n\r\n\t\tconst leftSide = document.createElement('div');\r\n\t\tleftSide.classList.add('gear-picker-left', 'tab-panel-col');\r\n\t\tthis.rootElem.appendChild(leftSide);\r\n\r\n\t\tconst rightSide = document.createElement('div');\r\n\t\trightSide.classList.add('gear-picker-right', 'tab-panel-col');\r\n\t\tthis.rootElem.appendChild(rightSide);\r\n\r\n\t\tconst leftItemPickers = [\r\n\t\t\tItemSlot.ItemSlotHead,\r\n\t\t\tItemSlot.ItemSlotNeck,\r\n\t\t\tItemSlot.ItemSlotShoulder,\r\n\t\t\tItemSlot.ItemSlotBack,\r\n\t\t\tItemSlot.ItemSlotChest,\r\n\t\t\tItemSlot.ItemSlotWrist,\r\n\t\t\tItemSlot.ItemSlotMainHand,\r\n\t\t\tItemSlot.ItemSlotOffHand,\r\n\t\t\tItemSlot.ItemSlotRanged,\r\n\t\t].map(slot => new ItemPicker(leftSide, simUI, player, slot));\r\n\r\n\t\tconst rightItemPickers = [\r\n\t\t\tItemSlot.ItemSlotHands,\r\n\t\t\tItemSlot.ItemSlotWaist,\r\n\t\t\tItemSlot.ItemSlotLegs,\r\n\t\t\tItemSlot.ItemSlotFeet,\r\n\t\t\tItemSlot.ItemSlotFinger1,\r\n\t\t\tItemSlot.ItemSlotFinger2,\r\n\t\t\tItemSlot.ItemSlotTrinket1,\r\n\t\t\tItemSlot.ItemSlotTrinket2,\r\n\t\t].map(slot => new ItemPicker(rightSide, simUI, player, slot));\r\n\r\n\t\tthis.itemPickers = leftItemPickers.concat(rightItemPickers).sort((a, b) => a.slot - b.slot);\r\n\t}\r\n}\r\n\r\nexport class ItemRenderer extends Component {\r\n\tprivate readonly player: Player<any>;\r\n\r\n\treadonly iconElem: HTMLAnchorElement;\r\n\treadonly nameElem: HTMLAnchorElement;\r\n\treadonly enchantElem: HTMLAnchorElement;\r\n\treadonly socketsContainerElem: HTMLElement;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>) {\r\n\t\tsuper(parent, 'item-picker-root');\r\n\t\tthis.player = player;\r\n\r\n\t\tlet iconElem = ref<HTMLAnchorElement>();\r\n\t\tlet nameElem = ref<HTMLAnchorElement>();\r\n\t\tlet enchantElem = ref<HTMLAnchorElement>();\r\n\t\tlet sce = ref<HTMLDivElement>();\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<>\r\n\t\t\t\t<a ref={iconElem} className=\"item-picker-icon\" href=\"javascript:void(0)\" attributes={{role:\"button\"}}>\r\n\t\t\t\t\t<div ref={sce} className=\"item-picker-sockets-container\"></div>\r\n\t\t\t\t</a>\r\n\t\t\t\t<div className=\"item-picker-labels-container\">\r\n\t\t\t\t\t<a ref={nameElem} className=\"item-picker-name\" href=\"javascript:void(0)\" attributes={{role:\"button\"}}></a>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t<a ref={enchantElem} className=\"item-picker-enchant\" href=\"javascript:void(0)\" attributes={{role:\"button\"}}></a>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t);\r\n\r\n\t\tthis.iconElem = iconElem.value!;\r\n\t\tthis.nameElem = nameElem.value!;\r\n\t\tthis.enchantElem = enchantElem.value!;\r\n\t\tthis.socketsContainerElem = sce.value!;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.nameElem.removeAttribute('data-wowhead');\r\n\t\tthis.nameElem.removeAttribute('href');\r\n\t\tthis.iconElem.removeAttribute('data-wowhead');\r\n\t\tthis.iconElem.removeAttribute('href');\r\n\t\tthis.enchantElem.removeAttribute('data-wowhead');\r\n\t\tthis.enchantElem.removeAttribute('href');\r\n\t\tthis.iconElem.removeAttribute('href');\r\n\r\n\t\tthis.iconElem.style.backgroundImage = '';\r\n\t\tthis.enchantElem.innerText = '';\r\n\t\tthis.socketsContainerElem.innerText = '';\r\n\t\tthis.nameElem.textContent = '';\r\n\t}\r\n\r\n\tupdate(newItem: EquippedItem) {\r\n\t\tthis.nameElem.textContent = newItem.item.name;\r\n\t\tif (newItem.item.heroic) {\r\n\t\t\tthis.nameElem.insertAdjacentElement('beforeend', createHeroicLabel());\r\n\t\t} else {\r\n\t\t\tthis.nameElem.querySelector('.heroic-label')?.remove();\r\n\t\t}\r\n\r\n\t\tsetItemQualityCssClass(this.nameElem, newItem.item.quality);\r\n\r\n\t\tthis.player.setWowheadData(newItem, this.iconElem);\r\n\t\tthis.player.setWowheadData(newItem, this.nameElem);\r\n\t\tnewItem.asActionId().fill().then(filledId => {\r\n\t\t\tfilledId.setBackgroundAndHref(this.iconElem);\r\n\t\t\tfilledId.setWowheadHref(this.nameElem);\r\n\t\t});\r\n\r\n\t\tif (newItem.enchant) {\r\n\t\t\tgetEnchantDescription(newItem.enchant).then(description => {\r\n\t\t\t\tthis.enchantElem.textContent = description;\r\n\t\t\t});\r\n\t\t\t// Make enchant text hover have a tooltip.\r\n\t\t\tif (newItem.enchant.spellId) {\r\n\t\t\t\tthis.enchantElem.href = ActionId.makeSpellUrl(newItem.enchant.spellId);\r\n\t\t\t\tthis.enchantElem.dataset.wowhead = `domain=wotlk&spell=${newItem.enchant.spellId}`;\r\n\t\t\t} else {\r\n\t\t\t\tthis.enchantElem.href = ActionId.makeItemUrl(newItem.enchant.itemId);\r\n\t\t\t\tthis.enchantElem.dataset.wowhead = `domain=wotlk&item=${newItem.enchant.itemId}`;\r\n\t\t\t}\r\n\t\t\tthis.enchantElem.dataset.whtticon = 'false';\r\n\t\t}\r\n\r\n\t\tnewItem.allSocketColors().forEach((socketColor, gemIdx) => {\r\n\t\t\tlet gemContainer = createGemContainer(socketColor, newItem.gems[gemIdx]);\r\n\t\t\tthis.socketsContainerElem.appendChild(gemContainer);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport class ItemPicker extends Component {\r\n\treadonly slot: ItemSlot;\r\n\r\n\tprivate readonly simUI: SimUI;\r\n\tprivate readonly player: Player<any>;\r\n\r\n\tprivate readonly itemElem: ItemRenderer;\r\n\r\n\t// All items and enchants that are eligible for this slot\r\n\tprivate _items: Array<Item> = [];\r\n\tprivate _enchants: Array<Enchant> = [];\r\n\tprivate _equippedItem: EquippedItem | null = null;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>, slot: ItemSlot) {\r\n\t\tsuper(parent, 'item-picker-root');\r\n\t\tthis.slot = slot;\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.player = player;\r\n\t\tthis.itemElem = new ItemRenderer(this.rootElem, player);\r\n\r\n\t\tthis.item = player.getEquippedItem(slot);\r\n\t\tplayer.sim.waitForInit().then(() => {\r\n\t\t\tthis._items = this.player.getItems(this.slot);\r\n\t\t\tthis._enchants = this.player.getEnchants(this.slot);\r\n\r\n\t\t\tconst gearData = {\r\n\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => {\r\n\t\t\t\t\tthis.player.equipItem(eventID, this.slot, equippedItem);\r\n\t\t\t\t},\r\n\t\t\t\tgetEquippedItem: () => this.player.getEquippedItem(this.slot),\r\n\t\t\t\tchangeEvent: player.gearChangeEmitter,\r\n\t\t\t};\r\n\r\n\t\t\tconst openGearSelector = (event: Event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tthis.openSelectorModal(SelectorModalTabs.Items, gearData);\r\n\t\t\t};\r\n\t\t\tconst openEnchantSelector = (event: Event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tthis.openSelectorModal(SelectorModalTabs.Enchants, gearData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.itemElem.iconElem.addEventListener('click', openGearSelector);\r\n\t\t\tthis.itemElem.nameElem.addEventListener('click', openGearSelector);\r\n\t\t\tthis.itemElem.enchantElem.addEventListener('click', openEnchantSelector);\r\n\t\t});\r\n\r\n\t\tplayer.gearChangeEmitter.on(() => {\r\n\t\t\tthis.item = player.getEquippedItem(slot);\r\n\t\t});\r\n\t\tplayer.professionChangeEmitter.on(() => {\r\n\t\t\tif (this._equippedItem != null) {\r\n\t\t\t\tthis.player.setWowheadData(this._equippedItem, this.itemElem.iconElem);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tset item(newItem: EquippedItem | null) {\r\n\t\t// Clear everything first\r\n\t\tthis.itemElem.clear();\r\n\t\tthis.itemElem.nameElem.textContent = slotNames[this.slot];\r\n\t\tsetItemQualityCssClass(this.itemElem.nameElem, null);\r\n\r\n\t\tif (newItem != null) {\r\n\t\t\tthis.itemElem.update(newItem);\r\n\t\t} else {\r\n\t\t\tthis.itemElem.iconElem.style.backgroundImage = `url('${getEmptySlotIconUrl(this.slot)}')`;\r\n\t\t}\r\n\r\n\t\tthis._equippedItem = newItem;\r\n\t}\r\n\r\n\tprivate openSelectorModal(tab: SelectorModalTabs, gearData: GearData) {\r\n\t\tnew SelectorModal(this.simUI.rootElem, this.simUI, this.player, {\r\n\t\t\tselectedTab: tab,\r\n\t\t\tslot: this.slot,\r\n\t\t\tequippedItem: this._equippedItem,\r\n\t\t\teligibleItems: this._items,\r\n\t\t\teligibleEnchants: this._enchants,\r\n\t\t\tgearData: gearData\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport class IconItemSwapPicker<SpecType extends Spec, ValueType> extends Input<Player<SpecType>, ValueType> {\r\n\tprivate readonly config: InputConfig<Player<SpecType>, ValueType>;\r\n\tprivate readonly iconAnchor: HTMLAnchorElement;\r\n\tprivate readonly socketsContainerElem: HTMLElement;\r\n\tprivate readonly player: Player<SpecType>;\r\n\tprivate readonly slot: ItemSlot;\r\n\tprivate readonly gear: ItemSwapGear;\r\n\r\n\t// All items and enchants that are eligible for this slot\r\n\tprivate _items: Array<Item> = [];\r\n\tprivate _enchants: Array<Enchant> = [];\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<SpecType>, slot: ItemSlot, config: InputConfig<Player<SpecType>, ValueType>) {\r\n\t\tsuper(parent, 'icon-picker-root', player, config)\r\n\t\tthis.rootElem.classList.add('icon-picker');\r\n\t\tthis.player = player;\r\n\t\tthis.config = config;\r\n\t\tthis.slot = slot;\r\n\t\tthis.gear = this.player.getItemSwapGear();\r\n\r\n\t\tthis.iconAnchor = document.createElement('a');\r\n\t\tthis.iconAnchor.classList.add('icon-picker-button');\r\n\t\tthis.iconAnchor.target = '_blank';\r\n\t\tthis.rootElem.prepend(this.iconAnchor);\r\n\r\n\t\tthis.socketsContainerElem = document.createElement('div')\r\n\t\tthis.socketsContainerElem.classList.add('item-picker-sockets-container')\r\n\t\tthis.iconAnchor.appendChild(this.socketsContainerElem);\r\n\r\n\t\tplayer.sim.waitForInit().then(() => {\r\n\t\t\tthis._items = this.player.getItems(slot);\r\n\t\t\tthis._enchants = this.player.getEnchants(slot);\r\n\t\t\tthis.addItemSpecToGear();\r\n\t\t\tconst gearData = {\r\n\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => {\r\n\t\t\t\t\tthis.gear.equipItem(this.slot, equippedItem, player.canDualWield2H());\r\n\t\t\t\t\tthis.inputChanged(eventID);\r\n\t\t\t\t},\r\n\t\t\t\tgetEquippedItem: () => this.gear.getEquippedItem(this.slot),\r\n\t\t\t\tchangeEvent: config.changedEvent(player),\r\n\t\t\t}\r\n\r\n\t\t\tconst onClickStart = (event: Event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tnew SelectorModal(simUI.rootElem, simUI, this.player, {\r\n\t\t\t\t\tselectedTab: SelectorModalTabs.Items,\r\n\t\t\t\t\tslot: this.slot,\r\n\t\t\t\t\tequippedItem: this.gear.getEquippedItem(slot),\r\n\t\t\t\t\teligibleItems: this._items,\r\n\t\t\t\t\teligibleEnchants: this._enchants,\r\n\t\t\t\t\tgearData: gearData,\r\n\t\t\t\t})\r\n\t\t\t};\r\n\r\n\t\t\tthis.iconAnchor.addEventListener('click', onClickStart);\r\n\t\t}).finally(() => this.init());\r\n\r\n\t}\r\n\r\n\tprivate addItemSpecToGear() {\r\n\t\tconst itemSwap = this.config.getValue(this.player) as unknown as ItemSwap\r\n\t\tconst fieldName = this.getFieldNameFromItemSlot(this.slot)\r\n\r\n\t\tif (!fieldName)\r\n\t\t\treturn;\r\n\r\n\t\tconst itemSpec = itemSwap[fieldName] as unknown as ItemSpec\r\n\r\n\t\tif (!itemSpec)\r\n\t\t\treturn;\r\n\r\n\t\tconst equippedItem = this.player.sim.db.lookupItemSpec(itemSpec);\r\n\r\n\t\tif (equippedItem) {\r\n\t\t\tthis.gear.equipItem(this.slot, equippedItem, this.player.canDualWield2H());\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getFieldNameFromItemSlot(slot: ItemSlot): keyof ItemSwap | undefined {\r\n\t\tswitch (slot) {\r\n\t\t\tcase ItemSlot.ItemSlotMainHand:\r\n\t\t\t\treturn 'mhItem';\r\n\t\t\tcase ItemSlot.ItemSlotOffHand:\r\n\t\t\t\treturn 'ohItem';\r\n\t\t\tcase ItemSlot.ItemSlotRanged:\r\n\t\t\t\treturn 'rangedItem';\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.iconAnchor;\r\n\t}\r\n\tgetInputValue(): ValueType {\r\n\t\treturn this.gear.toProto() as unknown as ValueType\r\n\t}\r\n\r\n\tsetInputValue(newValue: ValueType): void {\r\n\t\tthis.iconAnchor.style.backgroundImage = `url('${getEmptySlotIconUrl(this.slot)}')`;\r\n\t\tthis.iconAnchor.removeAttribute('data-wowhead');\r\n\t\tthis.iconAnchor.href = \"#\";\r\n\t\tthis.socketsContainerElem.innerText = '';\r\n\r\n\t\tconst equippedItem = this.gear.getEquippedItem(this.slot);\r\n\t\tif (equippedItem) {\r\n\t\t\tthis.iconAnchor.classList.add(\"active\")\r\n\r\n\t\t\tequippedItem.asActionId().fillAndSet(this.iconAnchor, true, true);\r\n\t\t\tthis.player.setWowheadData(equippedItem, this.iconAnchor);\r\n\r\n\t\t\tequippedItem.allSocketColors().forEach((socketColor, gemIdx) => {\r\n\t\t\t\tthis.socketsContainerElem.appendChild(createGemContainer(socketColor, equippedItem.gems[gemIdx]));\r\n\t\t\t});\r\n\r\n\t\t} else {\r\n\t\t\tthis.iconAnchor.classList.remove(\"active\")\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport interface GearData {\r\n\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => void,\r\n\tgetEquippedItem: () => EquippedItem | null,\r\n\tchangeEvent: TypedEvent<any>,\r\n}\r\n\r\nexport enum SelectorModalTabs {\r\n\tItems = 'Items',\r\n\tEnchants = 'Enchants',\r\n\tGem1 = 'Gem1',\r\n\tGem2 = 'Gem2',\r\n\tGem3 = 'Gem3',\r\n}\r\n\r\ninterface SelectorModalConfig {\r\n\tselectedTab: SelectorModalTabs\r\n\tslot: ItemSlot,\r\n\tequippedItem: EquippedItem | null,\r\n\teligibleItems: Array<Item>,\r\n\teligibleEnchants: Array<Enchant>,\r\n\tgearData: GearData\r\n}\r\n\r\nexport class SelectorModal extends BaseModal {\r\n\tprivate readonly simUI: SimUI;\r\n\tprivate player: Player<any>;\r\n\tprivate config: SelectorModalConfig;\r\n\tprivate ilists: ItemList<any>[];\r\n\r\n\tprivate readonly tabsElem: HTMLElement;\r\n\tprivate readonly contentElem: HTMLElement;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<any>, config: SelectorModalConfig) {\r\n\t\tsuper(parent, 'selector-modal');\r\n\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.player = player;\r\n\t\tthis.config = config;\r\n\t\tthis.ilists = [];\r\n\r\n\t\twindow.scrollTo({ top: 0 });\r\n\r\n\t\tthis.header!.insertAdjacentElement('afterbegin', <ul className=\"nav nav-tabs selector-modal-tabs\"></ul>);\r\n\r\n\t\tthis.body.appendChild(<div className='tab-content selector-modal-tab-content'></div>);\r\n\r\n\t\tthis.tabsElem = this.rootElem.querySelector('.selector-modal-tabs') as HTMLElement;\r\n\t\tthis.contentElem = this.rootElem.querySelector('.selector-modal-tab-content') as HTMLElement;\r\n\r\n\t\tthis.setData();\r\n\t}\r\n\r\n\t// Could be 'Items' 'Enchants' or 'Gem1'-'Gem3'\r\n\topenTabName(name: string) {\r\n\t\tArray.from(this.tabsElem.getElementsByClassName(\"selector-modal-item-tab\")).forEach(elem => {\r\n\t\t\tif (elem.getAttribute(\"data-content-id\") == name + \"-tab\") {\r\n\t\t\t\t(elem as HTMLElement).click();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\topenTab(idx: number) {\r\n\t\tconst elems = this.tabsElem.getElementsByClassName(\"selector-modal-item-tab\");\r\n\t\t(elems[idx] as HTMLElement).click();\r\n\t}\r\n\r\n\tsetData() {\r\n\t\tthis.tabsElem.innerText = '';\r\n\t\tthis.contentElem.innerText = '';\r\n\r\n\t\tconst { slot, equippedItem, eligibleItems, eligibleEnchants, gearData } = this.config;\r\n\r\n\t\tthis.addTab<Item>(\r\n\t\t\t'Items',\r\n\t\t\teligibleItems.map(item => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\titem: item,\r\n\t\t\t\t\tid: item.id,\r\n\t\t\t\t\tactionId: ActionId.fromItem(item),\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tquality: item.quality,\r\n\t\t\t\t\theroic: item.heroic,\r\n\t\t\t\t\tphase: item.phase,\r\n\t\t\t\t\tbaseEP: this.player.computeItemEP(item, slot),\r\n\t\t\t\t\tignoreEPFilter: false,\r\n\t\t\t\t\tonEquip: (eventID, item: Item) => {\r\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\t\t\tif (equippedItem) {\r\n\t\t\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withItem(item));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgearData.equipItem(eventID, new EquippedItem(item));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\titem => this.player.computeItemEP(item, slot),\r\n\t\t\tequippedItem => equippedItem?.item,\r\n\t\t\tGemColor.GemColorUnknown,\r\n\t\t\teventID => {\r\n\t\t\t\tgearData.equipItem(eventID, null);\r\n\t\t\t\tthis.removeTabs('Gem');\r\n\t\t\t});\r\n\r\n\t\tthis.addTab<Enchant>(\r\n\t\t\t'Enchants',\r\n\t\t\teligibleEnchants.map(enchant => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\titem: enchant,\r\n\t\t\t\t\tid: enchant.effectId,\r\n\t\t\t\t\tactionId: enchant.spellId ? ActionId.fromSpellId(enchant.spellId) : ActionId.fromItemId(enchant.itemId),\r\n\t\t\t\t\tname: enchant.name,\r\n\t\t\t\t\tquality: enchant.quality,\r\n\t\t\t\t\tphase: enchant.phase || 1,\r\n\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(enchant.stats)),\r\n\t\t\t\t\tignoreEPFilter: true,\r\n\t\t\t\t\theroic: false,\r\n\t\t\t\t\tonEquip: (eventID, enchant: Enchant) => {\r\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\t\t\tif (equippedItem)\r\n\t\t\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withEnchant(enchant));\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tenchant => this.player.computeEnchantEP(enchant),\r\n\t\t\tequippedItem => equippedItem?.enchant,\r\n\t\t\tGemColor.GemColorUnknown,\r\n\t\t\teventID => {\r\n\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\tif (equippedItem)\r\n\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withEnchant(null));\r\n\t\t\t});\r\n\r\n\t\tthis.addGemTabs(slot, equippedItem, gearData);\r\n\t}\r\n\r\n\tprotected override onShow(e: Event) {\r\n\t\t// Only refresh opened tab\r\n\t\tlet t = e.target! as HTMLElement;\r\n\t\tlet tab = t.querySelector<HTMLElement>('.active')!.dataset.contentId!;\r\n\t\tif (tab.includes('Item')) {\r\n\t\t\tthis.ilists[0].sizeRefresh();\r\n\t\t}\r\n\t\telse if (tab.includes('Enchant')) {\r\n\t\t\tthis.ilists[1].sizeRefresh();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate addGemTabs(slot: ItemSlot, equippedItem: EquippedItem | null, gearData: GearData) {\r\n\t\tif (equippedItem == undefined) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst socketBonusEP = this.player.computeStatsEP(new Stats(equippedItem.item.socketBonus)) / (equippedItem.item.gemSockets.length || 1);\r\n\t\tequippedItem.curSocketColors(this.player.isBlacksmithing()).forEach((socketColor, socketIdx) => {\r\n\t\t\tthis.addTab<Gem>(\r\n\t\t\t\t'Gem ' + (socketIdx + 1),\r\n\t\t\t\tthis.player.getGems(socketColor).map((gem: Gem) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\titem: gem,\r\n\t\t\t\t\t\tid: gem.id,\r\n\t\t\t\t\t\tactionId: ActionId.fromItemId(gem.id),\r\n\t\t\t\t\t\tname: gem.name,\r\n\t\t\t\t\t\tquality: gem.quality,\r\n\t\t\t\t\t\tphase: gem.phase,\r\n\t\t\t\t\t\theroic: false,\r\n\t\t\t\t\t\tbaseEP: this.player.computeStatsEP(new Stats(gem.stats)),\r\n\t\t\t\t\t\tignoreEPFilter: true,\r\n\t\t\t\t\t\tonEquip: (eventID, gem: Gem) => {\r\n\t\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\t\t\t\tif (equippedItem)\r\n\t\t\t\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withGem(gem, socketIdx));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t\tgem => {\r\n\t\t\t\t\tlet gemEP = this.player.computeGemEP(gem);\r\n\t\t\t\t\tif (gemMatchesSocket(gem, socketColor)) {\r\n\t\t\t\t\t\tgemEP += socketBonusEP;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn gemEP;\r\n\t\t\t\t},\r\n\t\t\t\tequippedItem => equippedItem?.gems[socketIdx],\r\n\t\t\t\tsocketColor,\r\n\t\t\t\teventID => {\r\n\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\t\tif (equippedItem)\r\n\t\t\t\t\t\tgearData.equipItem(eventID, equippedItem.withGem(null, socketIdx));\r\n\t\t\t\t},\r\n\t\t\t\ttabAnchor => {\r\n\t\t\t\t\tlet gemContainer = createGemContainer(socketColor, null);\r\n\t\t\t\t\ttabAnchor.appendChild(gemContainer);\r\n\t\t\t\t\ttabAnchor.classList.add('selector-modal-tab-gem');\r\n\r\n\t\t\t\t\tconst gemElem = tabAnchor.querySelector('.gem-icon') as HTMLElement;\r\n\t\t\t\t\tconst emptySocketUrl = getEmptyGemSocketIconUrl(socketColor)\r\n\r\n\t\t\t\t\tconst updateGemIcon = () => {\r\n\t\t\t\t\t\tconst equippedItem = gearData.getEquippedItem();\r\n\t\t\t\t\t\tconst gem = equippedItem?.gems[socketIdx];\r\n\r\n\t\t\t\t\t\tif (gem) {\r\n\t\t\t\t\t\t\tgemElem.classList.remove('hide');\r\n\t\t\t\t\t\t\tActionId.fromItemId(gem.id).fill().then(filledId => {\r\n\t\t\t\t\t\t\t\tgemElem.setAttribute('src', filledId.iconUrl);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgemElem.classList.add('hide');\r\n\t\t\t\t\t\t\tgemElem.setAttribute('src', emptySocketUrl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tgearData.changeEvent.on(updateGemIcon);\r\n\t\t\t\t\tthis.addOnDisposeCallback(() => gearData.changeEvent.off(updateGemIcon));\r\n\t\t\t\t\tupdateGemIcon();\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Adds one of the tabs for the item selector menu.\r\n\t *\r\n\t * T is expected to be Item, Enchant, or Gem. Tab menus for all 3 looks extremely\r\n\t * similar so this function uses extra functions to do it generically.\r\n\t */\r\n\tprivate addTab<T>(\r\n\t\tlabel: string,\r\n\t\titemData: Array<ItemData<T>>,\r\n\t\tcomputeEP: (item: T) => number,\r\n\t\tequippedToItemFn: (equippedItem: EquippedItem | null) => (T | null | undefined),\r\n\t\tsocketColor: GemColor,\r\n\t\tonRemove: (eventID: EventID) => void,\r\n\t\tsetTabContent?: (tabElem: HTMLAnchorElement) => void) {\r\n\t\tif (itemData.length == 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { slot, gearData } = this.config;\r\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\r\n\t\tconst selected = label === this.config.selectedTab;\r\n\r\n\t\tconst tabAnchor = ref<HTMLAnchorElement>();\r\n\t\tthis.tabsElem.appendChild(\r\n\t\t\t<li className=\"nav-item\">\r\n\t\t\t\t<a\r\n\t\t\t\t\tref={tabAnchor}\r\n\t\t\t\t\tclassName={`nav-link selector-modal-item-tab ${selected ? 'active' : ''}`}\r\n\t\t\t\t\tdataset={{\r\n\t\t\t\t\t\tlabel: label,\r\n\t\t\t\t\t\tcontentId:tabContentId,\r\n\t\t\t\t\t\tbsToggle:'tab',\r\n\t\t\t\t\t\tbsTarget:`#${tabContentId}`,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tattributes={{\r\n\t\t\t\t\t\trole:'tab',\r\n\t\t\t\t\t\t'aria-selected':selected,\r\n\t\t\t\t\t}}\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t></a>\r\n\t\t\t</li>\r\n\t\t);\r\n\r\n\t\tif (setTabContent) {\r\n\t\t\tsetTabContent(tabAnchor.value!);\r\n\t\t} else {\r\n\t\t\ttabAnchor.value!.textContent = label;\r\n\t\t}\r\n\r\n\t\t// TODO: do we need this check here?\r\n\t\tif (itemData.length == 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet ilist = new ItemList<T>(\r\n\t\t\tthis.contentElem,\r\n\t\t\tthis.simUI,\r\n\t\t\tthis.config,\r\n\t\t\tthis.player,\r\n\t\t\tlabel,\r\n\t\t\titemData,\r\n\t\t\tcomputeEP,\r\n\t\t\tequippedToItemFn,\r\n\t\t\tsocketColor,\r\n\t\t\tonRemove,\r\n\t\t\t(itemData: ItemData<T>) => {\r\n\t\t\t\tconst item = itemData.item;\r\n\t\t\t\titemData.onEquip(TypedEvent.nextEventID(), item);\r\n\r\n\t\t\t\t// If the item changes, the gem slots might change, so remove and recreate the gem tabs\r\n\t\t\t\tif (Item.is(item)) {\r\n\t\t\t\t\tthis.removeTabs('Gem');\r\n\t\t\t\t\tthis.addGemTabs(slot, gearData.getEquippedItem(), gearData);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t)\r\n\r\n\t\tlet invokeUpdate = () => { ilist.updateSelected() }\r\n\t\tlet applyFilter = () => { ilist.applyFilters() }\r\n\t\tlet hideOrShowEPValues = () => { ilist.hideOrShowEPValues() }\r\n\t\t// Add event handlers\r\n\t\tgearData.changeEvent.on(invokeUpdate);\r\n\r\n\t\tthis.player.sim.phaseChangeEmitter.on(applyFilter);\r\n\t\tthis.player.sim.filtersChangeEmitter.on(applyFilter);\r\n\t\tthis.player.sim.showEPValuesChangeEmitter.on(hideOrShowEPValues);\r\n\r\n\t\tthis.addOnDisposeCallback(() => {\r\n\t\t\tgearData.changeEvent.off(invokeUpdate)\r\n\t\t\tthis.player.sim.phaseChangeEmitter.off(applyFilter);\r\n\t\t\tthis.player.sim.filtersChangeEmitter.off(applyFilter);\r\n\t\t\tthis.player.sim.showEPValuesChangeEmitter.off(hideOrShowEPValues);\r\n\t\t\tilist.dispose();\r\n\t\t});\r\n\r\n\t\ttabAnchor.value!.addEventListener('shown.bs.tab', (event) => {\r\n\t\t\tilist.sizeRefresh()\r\n\t\t});\r\n\r\n\t\tthis.ilists.push(ilist);\r\n\t}\r\n\r\n\tprivate removeTabs(labelSubstring: string) {\r\n\t\tconst tabElems = Array.prototype.slice.call(this.tabsElem.getElementsByClassName('selector-modal-item-tab'))\r\n\t\t\t.filter(tab => tab.dataset.label.includes(labelSubstring));\r\n\r\n\t\tconst contentElems = tabElems\r\n\t\t\t.map(tabElem => document.getElementById(tabElem.dataset.contentId!))\r\n\t\t\t.filter(tabElem => Boolean(tabElem));\r\n\r\n\t\ttabElems.forEach(elem => elem.parentElement.remove());\r\n\t\tcontentElems.forEach(elem => elem!.remove());\r\n\t}\r\n}\r\n\r\nexport interface ItemData<T> {\r\n\titem: T,\r\n\tname: string,\r\n\tid: number,\r\n\tactionId: ActionId,\r\n\tquality: ItemQuality,\r\n\tphase: number,\r\n\tbaseEP: number,\r\n\tignoreEPFilter: boolean,\r\n\theroic: boolean,\r\n\tonEquip: (eventID: EventID, item: T) => void,\r\n}\r\n\r\ninterface ItemDataWithIdx<T> {\r\n\tidx: number,\r\n\tdata: ItemData<T>,\r\n}\r\n\r\nconst emptySlotIcons: Record<ItemSlot, string> = {\r\n\t[ItemSlot.ItemSlotHead]: '/wotlk/assets/item_slots/head.jpg',\r\n\t[ItemSlot.ItemSlotNeck]: '/wotlk/assets/item_slots/neck.jpg',\r\n\t[ItemSlot.ItemSlotShoulder]: '/wotlk/assets/item_slots/shoulders.jpg',\r\n\t[ItemSlot.ItemSlotBack]: '/wotlk/assets/item_slots/shirt.jpg',\r\n\t[ItemSlot.ItemSlotChest]: '/wotlk/assets/item_slots/chest.jpg',\r\n\t[ItemSlot.ItemSlotWrist]: '/wotlk/assets/item_slots/wrists.jpg',\r\n\t[ItemSlot.ItemSlotHands]: '/wotlk/assets/item_slots/hands.jpg',\r\n\t[ItemSlot.ItemSlotWaist]: '/wotlk/assets/item_slots/waist.jpg',\r\n\t[ItemSlot.ItemSlotLegs]: '/wotlk/assets/item_slots/legs.jpg',\r\n\t[ItemSlot.ItemSlotFeet]: '/wotlk/assets/item_slots/feet.jpg',\r\n\t[ItemSlot.ItemSlotFinger1]: '/wotlk/assets/item_slots/finger.jpg',\r\n\t[ItemSlot.ItemSlotFinger2]: '/wotlk/assets/item_slots/finger.jpg',\r\n\t[ItemSlot.ItemSlotTrinket1]: '/wotlk/assets/item_slots/trinket.jpg',\r\n\t[ItemSlot.ItemSlotTrinket2]: '/wotlk/assets/item_slots/trinket.jpg',\r\n\t[ItemSlot.ItemSlotMainHand]: '/wotlk/assets/item_slots/mainhand.jpg',\r\n\t[ItemSlot.ItemSlotOffHand]: '/wotlk/assets/item_slots/offhand.jpg',\r\n\t[ItemSlot.ItemSlotRanged]: '/wotlk/assets/item_slots/ranged.jpg',\r\n};\r\nexport function getEmptySlotIconUrl(slot: ItemSlot): string {\r\n\treturn emptySlotIcons[slot];\r\n}\r\n\r\nexport class ItemList<T> {\r\n\tprivate listElem: HTMLElement;\r\n\tprivate readonly player: Player<any>;\r\n\tprivate label: string;\r\n\tprivate slot: ItemSlot;\r\n\tprivate itemData: Array<ItemData<T>>;\r\n\tprivate itemsToDisplay: Array<number>;\r\n\tprivate currentFilters: DatabaseFilters;\r\n\tprivate searchInput: HTMLInputElement;\r\n\tprivate socketColor: GemColor;\r\n\tprivate computeEP: (item: T) => number;\r\n\tprivate equippedToItemFn: (equippedItem: EquippedItem | null) => (T | null | undefined);\r\n\tprivate gearData: GearData;\r\n\tprivate tabContent: Element;\r\n\tprivate onItemClick: (itemData: ItemData<T>) => void;\r\n\tprivate scroller: Clusterize;\r\n\r\n\tconstructor(\r\n\t\tparent: HTMLElement,\r\n\t\tsimUI: SimUI,\r\n\t\tconfig: SelectorModalConfig,\r\n\t\tplayer: Player<any>,\r\n\t\tlabel: string,\r\n\t\titemData: Array<ItemData<T>>,\r\n\t\tcomputeEP: (item: T) => number,\r\n\t\tequippedToItemFn: (equippedItem: EquippedItem | null) => (T | null | undefined),\r\n\t\tsocketColor: GemColor,\r\n\t\tonRemove: (eventID: EventID) => void,\r\n\t\tonItemClick: (itemData: ItemData<T>) => void) {\r\n\t\tthis.label = label;\r\n\t\tthis.player = player;\r\n\t\tthis.itemData = itemData;\r\n\t\tthis.socketColor = socketColor;\r\n\t\tthis.computeEP = computeEP;\r\n\t\tthis.equippedToItemFn = equippedToItemFn;\r\n\t\tthis.onItemClick = onItemClick;\r\n\r\n\t\tconst { slot, gearData } = config;\r\n\t\tthis.slot = slot;\r\n\t\tthis.gearData = gearData;\r\n\t\tthis.currentFilters = this.player.sim.getFilters();\r\n\r\n\t\tconst tabContentId = (label + '-tab').split(' ').join('');\r\n\t\tconst selected = label === config.selectedTab;\r\n\r\n\t\tconst epButton = ref<HTMLButtonElement>();\r\n\t\tthis.tabContent = (\r\n\t\t\t<div\r\n\t\t\t\tid={tabContentId}\r\n\t\t\t\tclassName={`selector-modal-tab-pane tab-pane fade ${selected ? 'active show' : ''}`}\r\n\t\t\t>\r\n\t\t\t\t<div className=\"selector-modal-filters\">\r\n\t\t\t\t\t<input className=\"selector-modal-search form-control\" type=\"text\" placeholder=\"Search...\"/>\r\n\t\t\t\t\t{label == 'Items' && <button className=\"selector-modal-filters-button btn btn-primary\">Filters</button>}\r\n\t\t\t\t\t<div className=\"selector-modal-phase-selector\"></div>\r\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons\"></div>\r\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons\"></div>\r\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-matching-gems\"></div>\r\n\t\t\t\t\t<div className=\"sim-input selector-modal-boolean-option selector-modal-show-ep-values\"></div>\r\n\t\t\t\t\t<button className=\"selector-modal-simall-button btn btn-warning\">Add to Batch Sim</button>\r\n\t\t\t\t\t<button className=\"selector-modal-remove-button btn btn-danger\">Unequip Item</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"selector-modal-list-labels\">\r\n\t\t\t\t\t<label>Item</label>\r\n\t\t\t\t\t<label className=\"ep-delta-label\">\r\n\t\t\t\t\t\tEP\r\n\t\t\t\t\t\t<i className=\"fa-solid fa-plus-minus fa-2xs\"></i>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tref={epButton}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-link p-0 ms-1\">\r\n\t\t\t\t\t\t\t<i className=\"far fa-question-circle fa-lg\"></i>\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ul className=\"selector-modal-list\"></ul>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tparent.appendChild(this.tabContent);\r\n\r\n\t\tnew Tooltip(epButton.value!, {\r\n\t\t\ttitle: EP_TOOLTIP\r\n\t\t});\r\n\r\n\t\tconst show1hWeaponsSelector = makeShow1hWeaponsSelector(this.tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement, player.sim);\r\n\t\tconst show2hWeaponsSelector = makeShow2hWeaponsSelector(this.tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement, player.sim);\r\n\t\tif (!(label == 'Items' && (slot == ItemSlot.ItemSlotMainHand || (slot == ItemSlot.ItemSlotOffHand && player.getClass() == Class.ClassWarrior)))) {\r\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-1h-weapons')[0] as HTMLElement).style.display = 'none';\r\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-2h-weapons')[0] as HTMLElement).style.display = 'none';\r\n\t\t}\r\n\r\n\t\tmakeShowEPValuesSelector(this.tabContent.getElementsByClassName('selector-modal-show-ep-values')[0] as HTMLElement, player.sim);\r\n\r\n\t\tconst showMatchingGemsSelector = makeShowMatchingGemsSelector(this.tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement, player.sim);\r\n\t\tif (!label.startsWith('Gem')) {\r\n\t\t\t(this.tabContent.getElementsByClassName('selector-modal-show-matching-gems')[0] as HTMLElement).style.display = 'none';\r\n\t\t}\r\n\r\n\t\tconst phaseSelector = makePhaseSelector(this.tabContent.getElementsByClassName('selector-modal-phase-selector')[0] as HTMLElement, player.sim);\r\n\r\n\t\tif (label == 'Items') {\r\n\t\t\tconst filtersButton = this.tabContent.getElementsByClassName('selector-modal-filters-button')[0] as HTMLElement;\r\n\t\t\tfiltersButton.addEventListener('click', () => new FiltersMenu(parent, player, slot));\r\n\t\t}\r\n\r\n\t\tthis.listElem = this.tabContent.getElementsByClassName('selector-modal-list')[0] as HTMLElement;\r\n\r\n\t\tthis.itemsToDisplay = [];\r\n\r\n\t\tthis.scroller = new Clusterize({\r\n\t\t\tgetNumberOfRows: () => { return this.itemsToDisplay.length },\r\n\t\t\tgenerateRows: (startIdx, endIdx) => {\r\n\t\t\t\tlet items = [];\r\n\t\t\t\tfor (let i = startIdx; i < endIdx; ++i) {\r\n\t\t\t\t\tif (i >= this.itemsToDisplay.length)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\titems.push(this.createItemElem({idx:this.itemsToDisplay[i], data:this.itemData[this.itemsToDisplay[i]]}));\r\n\t\t\t\t}\r\n\t\t\t\treturn items;\r\n\t\t\t}\r\n\t\t}, {\r\n\t\t\trows: [],\r\n\t\t\tscroll_elem: this.listElem,\r\n\t\t\tcontent_elem: this.listElem,\r\n\t\t\titem_height: 56,\r\n\t\t\tshow_no_data_row: false,\r\n\t\t\tno_data_text: '',\r\n\t\t\ttag: 'li',\r\n\t\t\trows_in_block: 16,\r\n\t\t\tblocks_in_cluster: 2,\r\n\t\t});\r\n\r\n\t\tconst removeButton = this.tabContent.getElementsByClassName('selector-modal-remove-button')[0] as HTMLButtonElement;\r\n\t\tremoveButton.addEventListener('click', event => {\r\n\t\t\tonRemove(TypedEvent.nextEventID());\r\n\t\t});\r\n\r\n\t\tif (label.startsWith(\"Enchants\")) {\r\n\t\t\tremoveButton.textContent = 'Remove Enchant';\r\n\t\t} else if (label.startsWith(\"Gem\")) {\r\n\t\t\tremoveButton.textContent = 'Remove Gem';\r\n\t\t}\r\n\r\n\t\tthis.updateSelected();\r\n\r\n\t\tthis.searchInput = this.tabContent.getElementsByClassName('selector-modal-search')[0] as HTMLInputElement;\r\n\t\tthis.searchInput.addEventListener('input', () => this.applyFilters());\r\n\r\n\t\tconst simAllButton = this.tabContent.getElementsByClassName('selector-modal-simall-button')[0] as HTMLButtonElement;\r\n\t\tif (label == \"Items\") {\r\n\t\t\tsimAllButton.hidden = !player.sim.getShowExperimental()\r\n\t\t\tplayer.sim.showExperimentalChangeEmitter.on(() => {\r\n\t\t\t\tsimAllButton.hidden = !player.sim.getShowExperimental();\r\n\t\t\t});\r\n\t\t\tsimAllButton.addEventListener('click', (event) => {\r\n\t\t\t\tif (simUI instanceof IndividualSimUI) {\r\n\t\t\t\t\tlet itemSpecs = Array<ItemSpec>();\r\n\t\t\t\t\tconst isRangedOrTrinket = this.slot == ItemSlot.ItemSlotRanged ||\r\n\t\t\t\t\t\tthis.slot == ItemSlot.ItemSlotTrinket1 ||\r\n\t\t\t\t\t\tthis.slot == ItemSlot.ItemSlotTrinket2\r\n\r\n\t\t\t\t\tconst curItem = this.equippedToItemFn(this.player.getEquippedItem(this.slot));\r\n\t\t\t\t\tlet curEP = 0;\r\n\t\t\t\t\tif (curItem != null) {\r\n\t\t\t\t\t\tcurEP = this.computeEP(curItem);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor(let i of this.itemsToDisplay) {\r\n\t\t\t\t\t\tconst idata = this.itemData[i];\r\n\t\t\t\t\t\tif (!isRangedOrTrinket && curEP > 0 && idata.baseEP < (curEP / 2)) {\r\n\t\t\t\t\t\t\tcontinue; // If we have EPs on current item, dont sim items with less than half the EP.\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add any item that is either >0 EP or a trinket/ranged item.\r\n\t\t\t\t\t\tif (idata.baseEP > 0 || isRangedOrTrinket) {\r\n\t\t\t\t\t\t\titemSpecs.push(ItemSpec.create({ id: idata.id }));\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsimUI.bt.addItems(itemSpecs);\r\n\t\t\t\t\t// TODO: should we open the bulk sim UI or should we run in the background showing progress, and then sort the items in the picker?\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// always hide non-items from being added to batch.\r\n\t\t\tsimAllButton.hidden = true;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic sizeRefresh() {\r\n\t\tthis.scroller.refresh(true);\r\n\t\tthis.applyFilters();\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tthis.scroller.dispose();\r\n\t}\r\n\r\n\tpublic updateSelected() {\r\n\t\tconst newEquippedItem = this.gearData.getEquippedItem();\r\n\t\tconst newItem = this.equippedToItemFn(newEquippedItem);\r\n\r\n\t\tconst newItemId = newItem ? (this.label == 'Enchants' ? (newItem as unknown as Enchant).effectId : (newItem as unknown as Item | Gem).id) : 0;\r\n\t\tconst newEP = newItem ? this.computeEP(newItem) : 0;\r\n\r\n\t\tthis.scroller.elementUpdate((item) => {\r\n\t\t\tlet idx = (item as HTMLElement).dataset.idx!;\r\n\t\t\tconst itemData = this.itemData[parseFloat(idx)];\r\n\t\t\tif (itemData.id == newItemId)\r\n\t\t\t\titem.classList.add('active');\r\n\t\t\telse\r\n\t\t\t\titem.classList.remove('active');\r\n\r\n\t\t\tconst epDeltaElem = item.getElementsByClassName('selector-modal-list-item-ep-delta')[0] as HTMLSpanElement;\r\n\t\t\tif (epDeltaElem) {\r\n\t\t\t\tepDeltaElem.textContent = '';\r\n\t\t\t\tif (itemData.item) {\r\n\t\t\t\t\tconst listItemEP = this.computeEP(itemData.item);\r\n\t\t\t\t\tformatDeltaTextElem(epDeltaElem, newEP, listItemEP, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tpublic applyFilters() {\r\n\t\tthis.currentFilters = this.player.sim.getFilters();\r\n\t\tlet itemIdxs = new Array<number>(this.itemData.length);\r\n\t\tfor (let i = 0; i < this.itemData.length; ++i)  {\r\n\t\t\titemIdxs[i] = i;\r\n\t\t}\r\n\r\n\t\tconst currentEquippedItem = this.player.getEquippedItem(this.slot);\r\n\r\n\t\tif (this.label == 'Items') {\r\n\t\t\titemIdxs = this.player.filterItemData(\r\n\t\t\t\titemIdxs,\r\n\t\t\t\ti => this.itemData[i].item as unknown as Item,\r\n\t\t\t\tthis.slot);\r\n\t\t} else if (this.label == 'Enchants') {\r\n\t\t\titemIdxs = this.player.filterEnchantData(\r\n\t\t\t\titemIdxs,\r\n\t\t\t\ti => this.itemData[i].item as unknown as Enchant,\r\n\t\t\t\tthis.slot,\r\n\t\t\t\tcurrentEquippedItem);\r\n\t\t} else if (this.label.startsWith('Gem')) {\r\n\t\t\titemIdxs = this.player.filterGemData(\r\n\t\t\t\titemIdxs,\r\n\t\t\t\ti => this.itemData[i].item as unknown as Gem,\r\n\t\t\t\tthis.slot,\r\n\t\t\t\tthis.socketColor);\r\n\t\t}\r\n\r\n\t\titemIdxs = itemIdxs.filter(i => {\r\n\t\t\tconst listItemData = this.itemData[i];\r\n\t\t\tif (listItemData.phase > this.player.sim.getPhase()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.searchInput.value.length > 0) {\r\n\t\t\t\tconst searchQuery = this.searchInput.value.toLowerCase().replaceAll(/[^a-zA-Z0-9\\s]/g, '').split(\" \");\r\n\t\t\t\tconst name = listItemData.name.toLowerCase().replaceAll(/[^a-zA-Z0-9\\s]/g, '');\r\n\r\n\t\t\t\tvar include = true;\r\n\t\t\t\tsearchQuery.forEach(v => {\r\n\t\t\t\t\tif (!name.includes(v))\r\n\t\t\t\t\t\tinclude = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (!include) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tlet sortFn: (itemA: T, itemB: T) => number;\r\n\t\tif (this.slot == ItemSlot.ItemSlotTrinket1 || this.slot == ItemSlot.ItemSlotTrinket2) {\r\n\t\t\t// Trinket EP is weird so just sort by ilvl instead.\r\n\t\t\tsortFn = (itemA, itemB) => (itemB as unknown as Item).ilvl - (itemA as unknown as Item).ilvl;\r\n\t\t} else {\r\n\t\t\tsortFn = (itemA, itemB) => {\r\n\t\t\t\tconst diff = this.computeEP(itemB) - this.computeEP(itemA);\r\n\t\t\t\t// if EP is same, sort by ilvl\r\n\t\t\t\tif (Math.abs(diff) < 0.01) return (itemB as unknown as Item).ilvl - (itemA as unknown as Item).ilvl;\r\n\t\t\t\treturn diff;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\titemIdxs = itemIdxs.sort((dataA, dataB) => {\r\n\t\t\tconst itemA = this.itemData[dataA];\r\n\t\t\tconst itemB = this.itemData[dataB];\r\n\t\t\tif (this.isItemFavorited(itemA) && !this.isItemFavorited(itemB)) return -1;\r\n\t\t\tif (this.isItemFavorited(itemB) && !this.isItemFavorited(itemA)) return 1;\r\n\r\n\t\t\treturn sortFn(itemA.item, itemB.item);\r\n\t\t});\r\n\r\n\t\tthis.itemsToDisplay = itemIdxs;\r\n\t\tthis.scroller.update();\r\n\r\n\t\tthis.hideOrShowEPValues();\r\n\t}\r\n\r\n\tpublic hideOrShowEPValues() {\r\n\t\tconst labels = this.tabContent.getElementsByClassName(\"ep-delta-label\")\r\n\t\tconst container = this.tabContent.getElementsByClassName(\"selector-modal-list\")\r\n\t\tconst show = this.player.sim.getShowEPValues();\r\n\t\tconst display = show ? \"\" : \"none\"\r\n\r\n\t\tfor (let label of labels) {\r\n\t\t\t(label as HTMLElement).style.display = display;\r\n\t\t}\r\n\r\n\t\tfor (let c of container) {\r\n\t\t\tif (show)\r\n\t\t\t\tc.classList.remove(\"hide-ep\");\r\n\t\t\telse\r\n\t\t\t\tc.classList.add(\"hide-ep\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate createItemElem(item: ItemDataWithIdx<T>): JSX.Element {\r\n\t\tconst itemData = item.data;\r\n\t\tconst itemEP = this.computeEP(itemData.item);\r\n\r\n\t\tconst equipedItem = this.equippedToItemFn(this.gearData.getEquippedItem());\r\n\t\tconst equipdItemId = equipedItem ? (this.label == 'Enchants' ? (equipedItem as unknown as Enchant).effectId : (equipedItem as unknown as Item | Gem).id) : 0;\r\n\r\n\t\tconst nameElem = ref<HTMLLabelElement>();\r\n\t\tconst anchorElem = ref<HTMLAnchorElement>();\r\n\t\tconst iconElem = ref<HTMLImageElement>();\r\n\t\tconst listItemElem = (\r\n\t\t\t<li className={`selector-modal-list-item ${equipdItemId == itemData.id ? 'active' : ''}`} dataset={{idx: item.idx.toString()}}>\r\n\t\t\t\t<div className='selector-modal-list-label-cell'>\r\n\t\t\t\t\t<a className='selector-modal-list-item-link' ref={anchorElem} dataset={{whtticon:'false'}}>\r\n\t\t\t\t\t\t<img className='selector-modal-list-item-icon' ref={iconElem}></img>\r\n\t\t\t\t\t\t<label className='selector-modal-list-item-name' ref={nameElem}>\r\n\t\t\t\t\t\t\t{itemData.name}\r\n\t\t\t\t\t\t\t{itemData.heroic && createHeroicLabel()}\r\n\t\t\t\t\t\t</label>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t</div>\r\n\t\t\t</li>\r\n\t\t);\r\n\r\n\t\tif (this.label == 'Items') {\r\n\t\t\tlistItemElem.appendChild(\r\n\t\t\t\t<div className='selector-modal-list-item-source-container'>\r\n\t\t\t\t\t{this.getSourceInfo(itemData.item as unknown as Item, this.player.sim)}\r\n\t\t\t\t</div>\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tlet favoriteElem = ref<HTMLButtonElement>();\r\n\r\n\t\tlistItemElem.appendChild(\r\n\t\t\t<div>\r\n\t\t\t\t<button className=\"selector-modal-list-item-favorite btn btn-link p-0\"\r\n\t\t\t\t\t\tref={favoriteElem}\r\n\t\t\t\t\t\tonclick={() => setFavorite(listItemElem.dataset.fav == 'false')}>\r\n\t\t\t\t\t<i className='fa-star fa-xl'></i>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t)\r\n\r\n\r\n\t\tif (this.slot != ItemSlot.ItemSlotTrinket1 && this.slot != ItemSlot.ItemSlotTrinket2) {\r\n\t\t\tlistItemElem.appendChild(\r\n\t\t\t\t<div className='selector-modal-list-item-ep'>\r\n\t\t\t\t\t<span className='selector-modal-list-item-ep-value'>\r\n\t\t\t\t\t\t{itemEP < 9.95 ? itemEP.toFixed(1).toString() : Math.round(itemEP).toString()}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlistItemElem.appendChild(\r\n\t\t\t<div className='selector-modal-list-item-ep'>\r\n\t\t\t\t<span className='selector-modal-list-item-ep-delta'\r\n\t\t\t\t\tref={(e) => itemData.item && formatDeltaTextElem(e, equipedItem ? this.computeEP(equipedItem) : 0, itemEP, 0)}></span>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tanchorElem.value!.addEventListener('click', (event: Event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.target === favoriteElem.value) return false;\r\n\t\t\tthis.onItemClick(itemData);\r\n\t\t});\r\n\r\n\t\titemData.actionId.fill().then(filledId => {\r\n\t\t\tfilledId.setWowheadHref(anchorElem.value!);\r\n\t\t\ticonElem.value!.src = filledId.iconUrl;\r\n\t\t});\r\n\r\n\t\tsetItemQualityCssClass(nameElem.value!, itemData.quality);\r\n\r\n\t\tnew Tooltip(favoriteElem.value!, {\r\n\t\t\ttitle: 'Add to favorites'\r\n\t\t});\r\n\t\tconst setFavorite = (isFavorite: boolean) => {\r\n\t\t\tconst filters = this.player.sim.getFilters();\r\n\t\t\tif (this.label == 'Items') {\r\n\t\t\t\tconst favId = itemData.id;\r\n\t\t\t\tif (isFavorite) {\r\n\t\t\t\t\tfilters.favoriteItems.push(favId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst favIdx = filters.favoriteItems.indexOf(favId);\r\n\t\t\t\t\tif (favIdx != -1) {\r\n\t\t\t\t\t\tfilters.favoriteItems.splice(favIdx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.label == 'Enchants') {\r\n\t\t\t\tconst favId = getUniqueEnchantString(itemData.item as unknown as Enchant);\r\n\t\t\t\tif (isFavorite) {\r\n\t\t\t\t\tfilters.favoriteEnchants.push(favId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst favIdx = filters.favoriteEnchants.indexOf(favId);\r\n\t\t\t\t\tif (favIdx != -1) {\r\n\t\t\t\t\t\tfilters.favoriteEnchants.splice(favIdx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.label.startsWith('Gem')) {\r\n\t\t\t\tconst favId = itemData.id;\r\n\t\t\t\tif (isFavorite) {\r\n\t\t\t\t\tfilters.favoriteGems.push(favId);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst favIdx = filters.favoriteGems.indexOf(favId);\r\n\t\t\t\t\tif (favIdx != -1) {\r\n\t\t\t\t\t\tfilters.favoriteGems.splice(favIdx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfavoriteElem.value!.children[0].classList.toggle('fas');\r\n\t\t\tfavoriteElem.value!.children[0].classList.toggle('far');\r\n\t\t\tlistItemElem.dataset.fav = isFavorite.toString();\r\n\r\n\t\t\tthis.player.sim.setFilters(TypedEvent.nextEventID(), filters);\r\n\t\t};\r\n\r\n\t\tlet isFavorite = this.isItemFavorited(itemData);\r\n\t\t\r\n\t\tif (isFavorite) {\r\n\t\t\tfavoriteElem.value!.children[0].classList.add('fas');\r\n\t\t\tlistItemElem.dataset.fav = 'true';\r\n\t\t} else {\r\n\t\t\tfavoriteElem.value!.children[0].classList.add('far');\r\n\t\t\tlistItemElem.dataset.fav = 'false';\r\n\t\t}\r\n\r\n\t\treturn listItemElem;\r\n\t}\r\n\r\n\tprivate isItemFavorited(itemData: ItemData<T>) : boolean {\r\n\t\tif (this.label == 'Items') {\r\n\t\t\treturn this.currentFilters.favoriteItems.includes(itemData.id);\r\n\t\t} else if (this.label == 'Enchants') {\r\n\t\t\treturn this.currentFilters.favoriteEnchants.includes(getUniqueEnchantString(itemData.item as unknown as Enchant));\r\n\t\t} else if (this.label.startsWith('Gem')) {\r\n\t\t\treturn this.currentFilters.favoriteGems.includes(itemData.id);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate getSourceInfo(item: Item, sim: Sim): JSX.Element {\r\n\t\tif (!item.sources || item.sources.length == 0) {\r\n\t\t\treturn <></>;\r\n\t\t}\r\n\r\n\t\tconst makeAnchor = (href:string, inner:string) => {\r\n\t\t\treturn <a href={href}><small>{inner}</small></a>;\r\n\t\t}\r\n\r\n\t\tconst source = item.sources[0];\r\n\t\tif (source.source.oneofKind == 'crafted') {\r\n\t\t\tconst src = source.source.crafted;\r\n\t\t\treturn makeAnchor( ActionId.makeSpellUrl(src.spellId), professionNames[src.profession]);\r\n\t\t} else if (source.source.oneofKind == 'drop') {\r\n\t\t\tconst src = source.source.drop;\r\n\t\t\tconst zone = sim.db.getZone(src.zoneId);\r\n\t\t\tconst npc = sim.db.getNpc(src.npcId);\r\n\t\t\tif (!zone) {\r\n\t\t\t\tthrow new Error('No zone found for item: ' + item);\r\n\t\t\t}\r\n\r\n\t\t\tlet rtnEl = makeAnchor( ActionId.makeZoneUrl(zone.id), `${zone.name} (${difficultyNames[src.difficulty]})`);\r\n\r\n\t\t\tconst category = src.category ? ` - ${src.category}` : '';\r\n\t\t\tif (npc) {\r\n\t\t\t\trtnEl.appendChild(document.createElement('br'));\r\n\t\t\t\trtnEl.appendChild(makeAnchor(ActionId.makeNpcUrl(npc.id), `${npc.name + category}`));\r\n\t\t\t} else if (src.otherName) {\r\n\t\t\t\t/*innerHTML += `\r\n\t\t\t\t\t<br>\r\n\t\t\t\t\t<a href=\"${ActionId.makeZoneUrl(zone.id)}\"><small>${src.otherName + category}</small></a>\r\n\t\t\t\t`;*/\r\n\t\t\t} else if (category) {\r\n\t\t\t\t/*innerHTML += `\r\n\t\t\t\t\t<br>\r\n\t\t\t\t\t<a href=\"${ActionId.makeZoneUrl(zone.id)}\"><small>${category}</small></a>\r\n\t\t\t\t`;*/\r\n\t\t\t}\r\n\t\t\treturn rtnEl;\r\n\t\t} else if (source.source.oneofKind == 'quest') {\r\n\t\t\tconst src = source.source.quest;\r\n\t\t\treturn makeAnchor(ActionId.makeQuestUrl(src.id), src.name);\r\n\t\t} else if (source.source.oneofKind == 'soldBy') {\r\n\t\t\tconst src = source.source.soldBy;\r\n\t\t\treturn makeAnchor(ActionId.makeNpcUrl(src.npcId), src.npcName);\r\n\t\t}\r\n\t\treturn <></>;\r\n\t}\r\n}","import { SimUI } from \"../sim_ui\";\r\nimport { Component } from \"./component\";\r\n\r\nexport interface SimTabConfig {\r\n\tidentifier: string,\r\n\ttitle: string,\r\n}\r\n\r\nexport abstract class SimTab extends Component {\r\n\tprotected simUI: SimUI;\r\n\tprotected config: SimTabConfig;\r\n\r\n\treadonly navItem: HTMLElement;\r\n\treadonly navLink: HTMLElement;\r\n\treadonly contentContainer: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: SimUI, config: SimTabConfig) {\r\n\t\tsuper(parentElem, 'sim-tab');\r\n\r\n\t\tthis.rootElem.classList.add(config.identifier);\r\n\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.config = config;\r\n\r\n\t\tthis.rootElem.id = this.config.identifier;\r\n\t\tthis.rootElem.classList.add('tab-pane', 'fade');\r\n\r\n\t\tif (parentElem.childNodes.length == 0)\r\n\t\t\tthis.rootElem.classList.add('active', 'show');\r\n\r\n\t\tthis.navItem = this.buildNavItem();\r\n\t\tthis.navLink = this.navItem.children[0] as HTMLElement;\r\n\t\tthis.contentContainer = document.createElement('div');\r\n\t\tthis.contentContainer.classList.add('tab-pane-content-container');\r\n\t\tthis.rootElem.appendChild(this.contentContainer);\r\n\r\n\t\tthis.simUI.simHeader.addSimTabLink(this);\r\n\t}\r\n\r\n\tprivate buildNavItem(): HTMLElement {\r\n\t\tconst tabFragment = document.createElement('fragment');\r\n\t\ttabFragment.innerHTML = `\r\n\t\t\t<li class=\"${this.config.identifier} nav-item\" role=\"presentation\">\r\n\t\t\t\t<a\r\n\t\t\t\t\tclass=\"nav-link\"\r\n\t\t\t\t\tdata-bs-toggle=\"tab\"\r\n\t\t\t\t\tdata-bs-target=\"#${this.config.identifier}\"\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\trole=\"tab\"\r\n\t\t\t\t\taria-controls=\"${this.config.identifier}\"\r\n\t\t\t\t>${this.config.title}</a>\r\n\t\t\t</li>\r\n\t\t`;\r\n\r\n\t\treturn tabFragment.children[0] as HTMLElement;\r\n\t}\r\n\r\n\tprotected abstract buildTabContent(): void;\r\n\r\n\tprotected buildColumn(index: number, customCssClass: string): HTMLElement {\r\n\t\tlet column = document.createElement('div');\r\n\t\tcolumn.classList.add('tab-panel-col', `${customCssClass}-${index}`)\r\n\t\treturn column;\r\n\t}\r\n}\r\n","import { Database } from '../../proto_utils/database';\r\nimport { ContentBlock } from \"../content_block\";\r\nimport { Importer } from \"../importers\";\r\n\r\nimport { IndividualSimUI } from \"../../individual_sim_ui\";\r\nimport { TypedEvent } from \"../../typed_event\";\r\n\r\nimport { EventID } from '../../typed_event.js';\r\n\r\nimport { BulkComboResult, BulkSettings, ItemSpecWithSlot, ProgressMetrics } from \"../../proto/api\";\r\nimport { EquipmentSpec, Faction, GemColor, ItemSlot, ItemSpec, SimDatabase, SimEnchant, SimGem, SimItem, Spec } from \"../../proto/common\";\r\n\r\nimport { ItemData, ItemList, ItemRenderer, SelectorModal, SelectorModalTabs } from \"../gear_picker\";\r\nimport { SimTab } from \"../sim_tab\";\r\n\r\nimport { UIEnchant, UIGem, UIItem } from \"../../proto/ui\";\r\nimport { EquippedItem } from \"../../proto_utils/equipped_item\";\r\nimport { Component } from \"../component\";\r\nimport { ResultsViewer } from \"../results_viewer\";\r\n\r\nimport { ActionId } from \"../../proto_utils/action_id\";\r\nimport { getEmptyGemSocketIconUrl } from \"../../proto_utils/gems\";\r\nimport { canEquipItem, getEligibleItemSlots } from \"../../proto_utils/utils\";\r\nimport { BaseModal } from \"../base_modal\";\r\nimport { BooleanPicker } from \"../boolean_picker\";\r\nimport { UIItem_FactionRestriction } from '../../proto/ui';\r\n\r\nexport class BulkGearJsonImporter<SpecType extends Spec> extends Importer {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\tprivate readonly bulkUI: BulkTab\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>, bulkUI: BulkTab) {\r\n\t\tsuper(parent, simUI, 'Bag Item Import', true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.bulkUI = bulkUI;\r\n\t\tthis.descriptionElem.innerHTML = `\r\n      <p>Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn.</p>\r\n      <p>To import, upload the file or paste the text below, then click, 'Import'.</p>\r\n    `;\r\n\t}\r\n\r\n\tasync onImport(data: string) {\r\n\t\ttry {\r\n\t\t\tconst equipment = EquipmentSpec.fromJsonString(data, { ignoreUnknownFields: true });\r\n\t\t\tif (equipment?.items?.length > 0) {\r\n\t\t\t\tconst db = await Database.loadLeftoversIfNecessary(equipment);\r\n\t\t\t\tconst items = equipment.items.filter((spec) => spec.id > 0 && db.lookupItemSpec(spec));\r\n\t\t\t\tif (items.length > 0) {\r\n\t\t\t\t\tthis.bulkUI.addItems(items);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.close();\r\n\t\t} catch (e: any) {\r\n\t\t\talert(e.toString());\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass BulkSimResultRenderer {\r\n\r\n\tconstructor(parent: ContentBlock, simUI: IndividualSimUI<Spec>, result: BulkComboResult, baseResult: BulkComboResult) {\r\n\t\tconst dpsDivParent = document.createElement('div');\r\n\t\tdpsDivParent.classList.add('results-sim');\r\n\r\n\t\tconst dpsDiv = document.createElement('div');\r\n\t\tdpsDiv.classList.add('bulk-result-body-dps', 'bulk-items-text-line', 'results-sim-dps', 'damage-metrics');\r\n\t\tdpsDivParent.appendChild(dpsDiv);\r\n\r\n\t\tconst dpsNumber = document.createElement('span');\r\n\t\tdpsNumber.textContent = this.formatDps(result.unitMetrics?.dps?.avg!);\r\n\t\tdpsNumber.classList.add('topline-result-avg');\r\n\t\tdpsDiv.appendChild(dpsNumber);\r\n\r\n\t\tconst dpsDelta = result.unitMetrics?.dps?.avg! - baseResult.unitMetrics?.dps?.avg!;\r\n\t\tconst dpsDeltaSpan = document.createElement('span');\r\n\t\tdpsDeltaSpan.textContent = `${this.formatDpsDelta(dpsDelta)}`;\r\n\t\tdpsDeltaSpan.classList.add(dpsDelta >= 0 ? 'bulk-result-header-positive' : 'bulk-result-header-negative');\r\n\t\tdpsDiv.appendChild(dpsDeltaSpan);\r\n\r\n\t\tconst itemsContainer = document.createElement('div');\r\n\t\titemsContainer.classList.add('bulk-gear-combo');\r\n\t\tparent.bodyElement.appendChild(itemsContainer);\r\n\t\tparent.bodyElement.appendChild(dpsDivParent);\r\n\r\n\t\tif (result.itemsAdded && result.itemsAdded.length > 0) {\r\n\t\t\tconst equipBtn = document.createElement('button');\r\n\t\t\tequipBtn.textContent = 'Equip';\r\n\t\t\tequipBtn.classList.add('btn', 'btn-primary', 'bulk-equipit');\r\n\t\t\tequipBtn.onclick = () => {\r\n\t\t\t\tresult.itemsAdded.forEach((itemAdded) => {\r\n\t\t\t\t\tconst item = simUI.sim.db.lookupItemSpec(itemAdded.item!);\r\n\t\t\t\t\tsimUI.player.equipItem(TypedEvent.nextEventID(), itemAdded.slot, item);\r\n\t\t\t\t\tsimUI.simHeader.activateTab('gear-tab');\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tparent.bodyElement.appendChild(equipBtn);\r\n\r\n\t\t\tfor (const is of result.itemsAdded) {\r\n\t\t\t\tconst item = simUI.sim.db.lookupItemSpec(is.item!)\r\n\t\t\t\tconst renderer = new ItemRenderer(itemsContainer, simUI.player);\r\n\t\t\t\trenderer.update(item!);\r\n\r\n\t\t\t\tconst p = document.createElement('a');\r\n\t\t\t\tp.classList.add('bulk-result-item-slot');\r\n\t\t\t\tp.textContent = this.itemSlotName(is);\r\n\t\t\t\trenderer.nameElem.appendChild(p);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst p = document.createElement('p');\r\n\t\t\tp.textContent = 'No changes - this is your currently equipped gear!';\r\n\t\t\tparent.bodyElement.appendChild(p);\r\n\t\t\tdpsDeltaSpan.textContent = '';\r\n\t\t}\r\n\t}\r\n\r\n\tprivate formatDps(dps: number): string {\r\n\t\treturn (Math.round(dps * 100) / 100).toFixed(2);\r\n\t}\r\n\r\n\tprivate formatDpsDelta(delta: number): string {\r\n\t\treturn ((delta >= 0) ? \"+\" : \"\") + this.formatDps(delta);\r\n\t}\r\n\r\n\tprivate itemSlotName(is: ItemSpecWithSlot): string {\r\n\t\treturn JSON.parse(ItemSpecWithSlot.toJsonString(is, { emitDefaultValues: true }))['slot'].replace('ItemSlot', '')\r\n\t}\r\n}\r\n\r\nexport class BulkItemPicker extends Component {\r\n\tprivate readonly itemElem: ItemRenderer;\r\n\treadonly simUI: IndividualSimUI<Spec>;\r\n\treadonly bulkUI: BulkTab;\r\n\treadonly index: number;\r\n\r\n\tprotected item: EquippedItem;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<Spec>, bulkUI: BulkTab, item: EquippedItem, index: number) {\r\n\t\tsuper(parent, 'bulk-item-picker');\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.bulkUI = bulkUI;\r\n\t\tthis.index = index;\r\n\t\tthis.item = item;\r\n\t\tthis.itemElem = new ItemRenderer(this.rootElem, simUI.player);\r\n\r\n\t\tthis.simUI.sim.waitForInit().then(() => {\r\n\t\t\tthis.setItem(item);\r\n\t\t\tconst slot = getEligibleItemSlots(this.item.item)[0];\r\n\t\t\tconst eligibleEnchants = this.simUI.sim.db.getEnchants(slot);\r\n\t\t\tconst openEnchantGemSelector = (event: Event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tconst changeEvent = new TypedEvent<void>();\r\n\t\t\t\tconst modal = new SelectorModal(this.bulkUI.rootElem, this.simUI, this.simUI.player, {\r\n\t\t\t\t\tselectedTab: SelectorModalTabs.Enchants,\r\n\t\t\t\t\tslot: slot,\r\n\t\t\t\t\tequippedItem: this.item,\r\n\t\t\t\t\teligibleItems: new Array<UIItem>(),\r\n\t\t\t\t\teligibleEnchants: eligibleEnchants,\r\n\t\t\t\t\tgearData: {\r\n\t\t\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => {\r\n\t\t\t\t\t\t\tif (equippedItem) {\r\n\t\t\t\t\t\t\t\tconst allItems = this.bulkUI.getItems();\r\n\t\t\t\t\t\t\t\tallItems[this.index] = equippedItem.asSpec();\r\n\t\t\t\t\t\t\t\tthis.item = equippedItem;\r\n\t\t\t\t\t\t\t\tthis.bulkUI.setItems(allItems);\r\n\t\t\t\t\t\t\t\tchangeEvent.emit(TypedEvent.nextEventID());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tgetEquippedItem: () => this.item,\r\n\t\t\t\t\t\tchangeEvent: changeEvent,\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (eligibleEnchants.length > 0) {\r\n\t\t\t\t\tmodal.openTabName(\"Enchants\");\r\n\t\t\t\t} else if (this.item._gems.length > 0) {\r\n\t\t\t\t\tmodal.openTabName(\"Gem1\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst destroyItemButton = document.createElement('button');\r\n\t\t\t\tdestroyItemButton.textContent = 'Remove from Batch';\r\n\t\t\t\tdestroyItemButton.classList.add('btn', 'btn-danger');\r\n\t\t\t\tdestroyItemButton.onclick = () => {\r\n\t\t\t\t\tbulkUI.setItems(bulkUI.getItems().filter((item, idx) => { return idx != this.index }));\r\n\t\t\t\t\tmodal.close();\r\n\t\t\t\t};\r\n\t\t\t\tconst closeX = modal.header?.querySelector('.close-button');\r\n\t\t\t\tif (closeX != undefined) {\r\n\t\t\t\t\tmodal.header?.insertBefore(destroyItemButton, closeX);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.itemElem.iconElem.addEventListener('click', openEnchantGemSelector);\r\n\t\t\tthis.itemElem.nameElem.addEventListener('click', openEnchantGemSelector);\r\n\t\t\tthis.itemElem.enchantElem.addEventListener('click', openEnchantGemSelector);\r\n\t\t});\r\n\t}\r\n\r\n\tsetItem(newItem: EquippedItem | null) {\r\n\t\tthis.itemElem.clear();\r\n\t\tif (newItem != null) {\r\n\t\t\tthis.itemElem.update(newItem);\r\n\t\t\tthis.item = newItem;\r\n\t\t} else {\r\n\t\t\tthis.itemElem.rootElem.style.opacity = '30%';\r\n\t\t\tthis.itemElem.iconElem.style.backgroundImage = `url('/wotlk/assets/item_slots/empty.jpg')`;\r\n\t\t\tthis.itemElem.nameElem.textContent = 'Add new item (not implemented)';\r\n\t\t\tthis.itemElem.rootElem.style.alignItems = 'center';\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class BulkTab extends SimTab {\r\n\treadonly simUI: IndividualSimUI<Spec>;\r\n\r\n\treadonly itemsChangedEmitter = new TypedEvent<void>();\r\n\r\n\treadonly leftPanel: HTMLElement;\r\n\treadonly rightPanel: HTMLElement;\r\n\r\n\treadonly column1: HTMLElement = this.buildColumn(1, 'raid-settings-col');\r\n\r\n\tprotected items: Array<ItemSpec> = new Array<ItemSpec>();\r\n\r\n\tprivate pendingResults: ResultsViewer;\r\n\tprivate pendingDiv: HTMLDivElement;\r\n\r\n\t// TODO: Make a real options probably\r\n\tprivate doCombos: boolean;\r\n\tprivate fastMode: boolean;\r\n\tprivate autoGem: boolean;\r\n\tprivate autoEnchant: boolean;\r\n\tprivate defaultGems: SimGem[];\r\n\tprivate gemIconElements: HTMLImageElement[];\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, simUI, { identifier: 'bulk-tab', title: 'Batch' });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.leftPanel = document.createElement('div');\r\n\t\tthis.leftPanel.classList.add('bulk-tab-left', 'tab-panel-left');\r\n\t\tthis.leftPanel.appendChild(this.column1);\r\n\r\n\t\tthis.rightPanel = document.createElement('div');\r\n\t\tthis.rightPanel.classList.add('bulk-tab-right', 'tab-panel-right');\r\n\r\n\t\tthis.pendingDiv = document.createElement('div');\r\n\t\tthis.pendingDiv.classList.add(\"results-pending-overlay\");\r\n\t\tthis.pendingResults = new ResultsViewer(this.pendingDiv);\r\n\t\tthis.pendingResults.hideAll();\r\n\r\n\t\tthis.contentContainer.appendChild(this.leftPanel);\r\n\t\tthis.contentContainer.appendChild(this.rightPanel);\r\n\t\tthis.contentContainer.appendChild(this.pendingDiv);\r\n\r\n\t\tthis.doCombos = true;\r\n\t\tthis.fastMode = true;\r\n\t\tthis.autoGem = true;\r\n\t\tthis.autoEnchant = true;\r\n\t\tthis.defaultGems = [UIGem.create(), UIGem.create(), UIGem.create(), UIGem.create()];\r\n\t\tthis.gemIconElements = [];\r\n\t\tthis.buildTabContent();\r\n\r\n\t\tthis.simUI.sim.waitForInit().then(() => {\r\n\t\t\tthis.loadSettings();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate getSettingsKey(): string {\r\n\t\treturn this.simUI.getStorageKey(\"bulk-settings.v1\");\r\n\t}\r\n\r\n\tprivate loadSettings() {\r\n\t\tconst storedSettings = window.localStorage.getItem(this.getSettingsKey());\r\n\t\tif (storedSettings != null) {\r\n\t\t\tlet settings = BulkSettings.fromJsonString(storedSettings, { ignoreUnknownFields: true })\r\n\r\n\t\t\tthis.doCombos = settings.combinations;\r\n\t\t\tthis.fastMode = settings.fastMode;\r\n\t\t\tthis.autoEnchant = settings.autoEnchant;\r\n\t\t\tthis.autoGem = settings.autoGem;\r\n\t\t\tthis.defaultGems = new Array<SimGem>(\r\n\t\t\t\tSimGem.create({ id: settings.defaultRedGem }),\r\n\t\t\t\tSimGem.create({ id: settings.defaultYellowGem }),\r\n\t\t\t\tSimGem.create({ id: settings.defaultBlueGem }),\r\n\t\t\t\tSimGem.create({ id: settings.defaultMetaGem }),\r\n\t\t\t)\r\n\r\n\t\t\tthis.defaultGems.forEach((gem, idx) => {\r\n\t\t\t\tActionId.fromItemId(gem.id).fill().then(filledId => {\r\n\t\t\t\t\tthis.gemIconElements[idx].src = filledId.iconUrl;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tprivate storeSettings() {\r\n\t\tconst settings = this.createBulkSettings();\r\n\t\tconst setStr = BulkSettings.toJsonString(settings, { enumAsInteger: true })\r\n\t\twindow.localStorage.setItem(this.getSettingsKey(), setStr);\r\n\t}\r\n\r\n\r\n\tprotected createBulkSettings(): BulkSettings {\r\n\r\n\t\treturn BulkSettings.create({\r\n\t\t\titems: this.items,\r\n\t\t\t// TODO(Riotdog-GehennasEU): Make all of these configurable.\r\n\t\t\t// For now, it's always constant iteration combinations mode for \"sim my bags\".\r\n\t\t\tcombinations: this.doCombos,\r\n\t\t\tfastMode: this.fastMode,\r\n\t\t\tautoEnchant: this.autoEnchant,\r\n\t\t\tautoGem: this.autoGem,\r\n\t\t\tdefaultRedGem: this.defaultGems[0].id,\r\n\t\t\tdefaultYellowGem: this.defaultGems[1].id,\r\n\t\t\tdefaultBlueGem: this.defaultGems[2].id,\r\n\t\t\tdefaultMetaGem: this.defaultGems[3].id,\r\n\t\t\titerationsPerCombo: this.simUI.sim.getIterations(), // TODO(Riotdog-GehennasEU): Define a new UI element for the iteration setting.\r\n\t\t});\r\n\t}\r\n\r\n\tprotected createBulkItemsDatabase(): SimDatabase {\r\n\t\tconst itemsDb = SimDatabase.create();\r\n\t\tfor (const is of this.items) {\r\n\t\t\tconst item = this.simUI.sim.db.lookupItemSpec(is)\r\n\t\t\tif (!item) {\r\n\t\t\t\tthrow new Error(`item with ID ${is.id} not found in database`);\r\n\t\t\t}\r\n\t\t\titemsDb.items.push(SimItem.fromJson(UIItem.toJson(item.item), { ignoreUnknownFields: true }))\r\n\t\t\tif (item.enchant) {\r\n\t\t\t\titemsDb.enchants.push(SimEnchant.fromJson(UIEnchant.toJson(item.enchant), { ignoreUnknownFields: true }));\r\n\t\t\t}\r\n\t\t\tfor (const gem of item.gems) {\r\n\t\t\t\tif (gem) {\r\n\t\t\t\t\titemsDb.gems.push(SimGem.fromJson(UIGem.toJson(gem), { ignoreUnknownFields: true }));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const gem of this.defaultGems) {\r\n\t\t\tif (gem.id > 0) {\r\n\t\t\t\titemsDb.gems.push(gem);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn itemsDb;\r\n\t}\r\n\r\n\taddItems(items: Array<ItemSpec>) {\r\n\t\tif (this.items.length == 0) {\r\n\t\t\tthis.items = items;\r\n\t\t} else {\r\n\t\t\tthis.items = this.items.concat(items);\r\n\t\t}\r\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tsetItems(items: Array<ItemSpec>) {\r\n\t\tthis.items = items;\r\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tclearItems() {\r\n\t\tthis.items = new Array<ItemSpec>();\r\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tgetItems(): Array<ItemSpec> {\r\n\t\tconst result = new Array<ItemSpec>();\r\n\t\tthis.items.forEach((spec) => { result.push(ItemSpec.clone(spec)); });\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsetCombinations(doCombos: boolean) {\r\n\t\tthis.doCombos = doCombos;\r\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tsetFastMode(fastMode: boolean) {\r\n\t\tthis.fastMode = fastMode;\r\n\t\tthis.itemsChangedEmitter.emit(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tprotected async runBulkSim(onProgress: Function) {\r\n\t\tthis.pendingResults.setPending();\r\n\r\n\t\ttry {\r\n\t\t\tawait this.simUI.sim.runBulkSim(this.createBulkSettings(), this.createBulkItemsDatabase(), onProgress);\r\n\t\t} catch (e) {\r\n\t\t\tthis.simUI.handleCrash(e);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected buildTabContent() {\r\n\t\tconst itemsBlock = new ContentBlock(this.column1, 'bulk-items', {\r\n\t\t\theader: { title: 'Items' }\r\n\t\t});\r\n\r\n\t\titemsBlock.bodyElement.classList.add('gear-picker-root');\r\n\r\n\t\tconst noticeWorkInProgress = document.createElement('div');\r\n\t\tnoticeWorkInProgress.classList.add('bulk-items-text-line');\r\n\t\titemsBlock.bodyElement.appendChild(noticeWorkInProgress);\r\n\t\tnoticeWorkInProgress.innerHTML = '<i>Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.</i>'\r\n\r\n\t\tconst itemTextIntro = document.createElement('div');\r\n\t\titemTextIntro.classList.add('bulk-items-text-line');\r\n\t\titemsBlock.bodyElement.appendChild(itemTextIntro);\r\n\r\n\t\tconst itemList = document.createElement('div');\r\n\r\n\t\titemList.classList.add('tab-panel-col', 'bulk-gear-combo');\r\n\t\titemsBlock.bodyElement.appendChild(itemList);\r\n\r\n\t\tthis.itemsChangedEmitter.on(() => {\r\n\t\t\titemList.innerHTML = '';\r\n\t\t\tif (this.items.length > 0) {\r\n\t\t\t\titemTextIntro.textContent = 'The following items will be simmed together with your equipped gear.';\r\n\t\t\t\tfor (let i = 0; i < this.items.length; ++i) {\r\n\t\t\t\t\tconst spec = this.items[i];\r\n\t\t\t\t\tconst item = this.simUI.sim.db.lookupItemSpec(spec);\r\n\t\t\t\t\tconst bulkItemPicker = new BulkItemPicker(itemList, this.simUI, this, item!, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.clearItems();\r\n\r\n\t\tlet resultsBlock = new ContentBlock(this.column1, 'bulk-results', {\r\n\t\t\theader: {\r\n\t\t\t\ttitle: 'Results',\r\n\t\t\t\textraCssClasses: ['bulk-results-header'],\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tresultsBlock.rootElem.hidden = true;\r\n\t\tresultsBlock.bodyElement.classList.add('gear-picker-root', 'tab-panel-col');\r\n\r\n\t\tthis.simUI.sim.bulkSimStartEmitter.on(() => {\r\n\t\t\tresultsBlock.rootElem.hidden = true;\r\n\t\t});\r\n\r\n\t\tthis.simUI.sim.bulkSimResultEmitter.on((_, bulkSimResult) => {\r\n\t\t\tresultsBlock.rootElem.hidden = bulkSimResult.results.length == 0;\r\n\t\t\tresultsBlock.bodyElement.innerHTML = '';\r\n\r\n\t\t\tfor (const r of bulkSimResult.results) {\r\n\t\t\t\tconst resultBlock = new ContentBlock(resultsBlock.bodyElement, 'bulk-result', { header: { title: '' }, bodyClasses: ['bulk-results-body'] });\r\n\t\t\t\tnew BulkSimResultRenderer(resultBlock, this.simUI, r, bulkSimResult.equippedGearResult!);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst settingsBlock = new ContentBlock(this.rightPanel, 'bulk-settings', {\r\n\t\t\theader: { title: 'Setup' }\r\n\t\t});\r\n\r\n\t\tconst bulkSimButton = document.createElement('button');\r\n\t\tbulkSimButton.classList.add('btn', 'btn-primary', 'w-100', 'bulk-settings-button');\r\n\t\tbulkSimButton.textContent = 'Simulate Batch';\r\n\t\tbulkSimButton.addEventListener('click', () => {\r\n\r\n\t\t\tthis.pendingDiv.style.display = \"flex\";\r\n\t\t\tthis.leftPanel.classList.add(\"blurred\");\r\n\t\t\tthis.rightPanel.classList.add(\"blurred\");\r\n\r\n\t\t\tconst previousContents = bulkSimButton.innerHTML;\r\n\t\t\tbulkSimButton.disabled = true;\r\n\t\t\tbulkSimButton.classList.add(\".disabled\");\r\n\t\t\tbulkSimButton.innerHTML = `<i class=\"fa fa-spinner fa-spin\"></i>&nbsp;Running`;\r\n\r\n\r\n\t\t\tlet simStart = new Date().getTime();\r\n\t\t\tlet lastTotal = 0;\r\n\t\t\tlet rounds = 0;\r\n\t\t\tlet currentRound = 0;\r\n\t\t\tlet combinations = 0;\r\n\r\n\t\t\tthis.runBulkSim((progressMetrics: ProgressMetrics) => {\r\n\t\t\t\tconsole.log(progressMetrics);\r\n\r\n\t\t\t\tconst msSinceStart = new Date().getTime() - simStart;\r\n\t\t\t\tconst iterPerSecond = progressMetrics.completedIterations / (msSinceStart / 1000);\r\n\r\n\t\t\t\tif (combinations == 0) {\r\n\t\t\t\t\tcombinations = progressMetrics.totalSims;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.fastMode) {\r\n\t\t\t\t\tif (rounds == 0 && progressMetrics.totalSims > 0) {\r\n\t\t\t\t\t\trounds = Math.ceil(Math.log(progressMetrics.totalSims / 20) / Math.log(2)) + 1;\r\n\t\t\t\t\t\tcurrentRound = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (progressMetrics.totalSims < lastTotal) {\r\n\t\t\t\t\t\tcurrentRound += 1;\r\n\t\t\t\t\t\tsimStart = new Date().getTime();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setSimProgress(progressMetrics, iterPerSecond, currentRound, rounds, combinations);\r\n\t\t\t\tlastTotal = progressMetrics.totalSims;\r\n\r\n\t\t\t\tif (progressMetrics.finalBulkResult != null) {\r\n\t\t\t\t\t// reset state\r\n\t\t\t\t\tthis.pendingDiv.style.display = \"none\";\r\n\t\t\t\t\tthis.leftPanel.classList.remove(\"blurred\");\r\n\t\t\t\t\tthis.rightPanel.classList.remove(\"blurred\");\r\n\r\n\t\t\t\t\tthis.pendingResults.hideAll();\r\n\t\t\t\t\tbulkSimButton.disabled = false;\r\n\t\t\t\t\tbulkSimButton.classList.remove(\".disabled\");\r\n\t\t\t\t\tbulkSimButton.innerHTML = previousContents;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsettingsBlock.bodyElement.appendChild(bulkSimButton);\r\n\r\n\t\tconst importButton = document.createElement('button');\r\n\t\timportButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\r\n\t\timportButton.innerHTML = '<i class=\"fa fa-download\"></i> Import From Bags';\r\n\t\timportButton.addEventListener('click', () => new BulkGearJsonImporter(this.simUI.rootElem, this.simUI, this));\r\n\t\tsettingsBlock.bodyElement.appendChild(importButton);\r\n\r\n\t\tconst importFavsButton = document.createElement('button');\r\n\t\timportFavsButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\r\n\t\timportFavsButton.innerHTML = '<i class=\"fa fa-download\"></i> Import Favorites';\r\n\t\timportFavsButton.addEventListener('click', () => {\r\n\t\t\tconst filters = this.simUI.player.sim.getFilters();\r\n\t\t\tconst items = filters.favoriteItems.map((itemID) => {\r\n\t\t\t\treturn ItemSpec.create({ id: itemID });\r\n\t\t\t});\r\n\t\t\tthis.addItems(items);\r\n\t\t});\r\n\t\tsettingsBlock.bodyElement.appendChild(importFavsButton);\r\n\r\n\t\tconst searchButton = document.createElement('button');\r\n\t\tlet searchText = document.createElement('input');\r\n\t\tsearchText.type = \"text\";\r\n\t\tsearchText.placeholder = \"search...\";\r\n\t\tsearchText.style.display = \"none\";\r\n\r\n\t\tconst searchResults = document.createElement('ul');\r\n\t\tsearchResults.classList.add(\"batch-search-results\");\r\n\r\n\t\tlet allItems = Array<UIItem>();\r\n\r\n\t\tsearchText.addEventListener(\"keyup\", ev => {\r\n\t\t\tif (ev.key == \"Enter\") {\r\n\t\t\t\tlet toAdd = Array<ItemSpec>();\r\n\t\t\t\tsearchResults.childNodes.forEach((node) => {\r\n\t\t\t\t\tconst strID = (node as HTMLElement).getAttribute('data-item-id');\r\n\t\t\t\t\tif (strID != null) {\r\n\t\t\t\t\t\ttoAdd.push(ItemSpec.create({ id: Number.parseInt(strID) }));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.addItems(toAdd);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsearchText.addEventListener(\"input\", (e) => {\r\n\t\t\tconst searchString = searchText.value;\r\n\t\t\tsearchResults.innerHTML = \"\";\r\n\t\t\tif (searchString.length == 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar pieces = searchString.split(' ');\r\n\r\n\t\t\tlet displayCount = 0;\r\n\t\t\tallItems.every((item) => {\r\n\t\t\t\tlet matched = true;\r\n\t\t\t\tconst lcName = item.name.toLowerCase();\r\n\t\t\t\tconst lcSetName = item.setName.toLowerCase();\r\n\r\n\t\t\t\tpieces.forEach((piece) => {\r\n\t\t\t\t\tvar lcPiece = piece.toLowerCase();\r\n\t\t\t\t\tif (!lcName.includes(lcPiece) && !lcSetName.includes(lcPiece)) {\r\n\t\t\t\t\t\tmatched = false;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t})\r\n\r\n\t\t\t\tif (matched) {\r\n\t\t\t\t\tlet itemElement = document.createElement('li');\r\n\t\t\t\t\titemElement.innerHTML = `<span>${item.name}</span>`;\r\n\t\t\t\t\titemElement.setAttribute(\"data-item-id\", item.id.toString());\r\n\t\t\t\t\titemElement.addEventListener(\"click\", (ev) => {\r\n\t\t\t\t\t\tthis.addItems(Array<ItemSpec>(ItemSpec.create({ id: item.id })));\r\n\t\t\t\t\t})\r\n\t\t\t\t\tif (item.heroic) {\r\n\t\t\t\t\t\tlet htxt = document.createElement(\"span\");\r\n\t\t\t\t\t\thtxt.style.color = \"green\";\r\n\t\t\t\t\t\thtxt.innerText = \"[H]\";\r\n\t\t\t\t\t\titemElement.appendChild(htxt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.factionRestriction == UIItem_FactionRestriction.HORDE_ONLY) {\r\n\t\t\t\t\t\tlet ftxt = document.createElement(\"span\");\r\n\t\t\t\t\t\tftxt.style.color = \"red\";\r\n\t\t\t\t\t\tftxt.innerText = \"(H)\";\r\n\t\t\t\t\t\titemElement.appendChild(ftxt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (item.factionRestriction == UIItem_FactionRestriction.ALLIANCE_ONLY) {\r\n\t\t\t\t\t\tlet ftxt = document.createElement(\"span\");\r\n\t\t\t\t\t\tftxt.style.color = \"blue\";\r\n\t\t\t\t\t\tftxt.innerText = \"(A)\";\r\n\t\t\t\t\t\titemElement.appendChild(ftxt);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsearchResults.append(itemElement);\r\n\t\t\t\t\tdisplayCount++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn displayCount < 10;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsearchButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\r\n\t\tconst baseSearchHTML = '<i class=\"fa fa-search\"></i> Add Item';\r\n\t\tsearchButton.innerHTML = baseSearchHTML;\r\n\t\tsearchButton.addEventListener('click', () => {\r\n\t\t\tif (searchText.style.display == \"none\") {\r\n\t\t\t\tsearchButton.innerHTML = 'Close Search Results';\r\n\t\t\t\tallItems = this.simUI.sim.db.getAllItems().filter((item) => {\r\n\t\t\t\t\treturn canEquipItem(item, this.simUI.player.spec, undefined);\r\n\t\t\t\t})\r\n\t\t\t\tsearchText.style.display = \"block\";\r\n\t\t\t\tsearchText.focus();\r\n\t\t\t} else {\r\n\t\t\t\tsearchButton.innerHTML = baseSearchHTML;\r\n\t\t\t\tsearchText.style.display = \"none\";\r\n\t\t\t\tsearchResults.innerHTML = \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t\tsettingsBlock.bodyElement.appendChild(searchButton);\r\n\t\tsettingsBlock.bodyElement.appendChild(searchText);\r\n\t\tsettingsBlock.bodyElement.appendChild(searchResults);\r\n\r\n\t\tconst clearButton = document.createElement('button');\r\n\t\tclearButton.classList.add('btn', 'btn-secondary', 'w-100', 'bulk-settings-button');\r\n\t\tclearButton.textContent = 'Clear All';\r\n\t\tclearButton.addEventListener('click', () => {\r\n\t\t\tthis.clearItems();\r\n\t\t\tresultsBlock.rootElem.hidden = true;\r\n\t\t\tresultsBlock.bodyElement.innerHTML = '';\r\n\t\t});\r\n\t\tsettingsBlock.bodyElement.appendChild(clearButton);\r\n\r\n\t\t// Default Gem Options\r\n\t\tconst defaultGemDiv = document.createElement(\"div\");\r\n\t\tif (this.autoGem) {\r\n\t\t\tdefaultGemDiv.style.display = \"flex\";\r\n\t\t} else {\r\n\t\t\tdefaultGemDiv.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\tdefaultGemDiv.classList.add(\"default-gem-container\");\r\n\t\tconst gemLabel = document.createElement(\"label\");\r\n\t\tgemLabel.innerText = \"Defaults for Auto Gem\";\r\n\t\tdefaultGemDiv.appendChild(gemLabel);\r\n\r\n\t\tconst gemSocketsDiv = document.createElement(\"div\");\r\n\t\tgemSocketsDiv.classList.add(\"sockets-container\");\r\n\r\n\t\tArray<GemColor>(GemColor.GemColorRed, GemColor.GemColorYellow, GemColor.GemColorBlue, GemColor.GemColorMeta).forEach((socketColor, socketIndex) => {\r\n\t\t\tlet gemFragment = document.createElement('fragment');\r\n\t\t\tgemFragment.innerHTML = `\r\n          <div class=\"gem-socket-container\">\r\n            <img class=\"gem-icon\" />\r\n            <img class=\"socket-icon\" />\r\n          </div>\r\n        `;\r\n\r\n\t\t\tconst gemContainer = gemFragment.children[0] as HTMLElement;\r\n\t\t\tthis.gemIconElements.push(gemContainer.querySelector('.gem-icon') as HTMLImageElement);\r\n\t\t\tconst socketIconElem = gemContainer.querySelector('.socket-icon') as HTMLImageElement;\r\n\t\t\tsocketIconElem.src = getEmptyGemSocketIconUrl(socketColor);\r\n\r\n\t\t\tlet selector: GemSelectorModal;\r\n\r\n\t\t\tlet handleChoose = (itemData: ItemData<UIGem>) => {\r\n\t\t\t\tthis.defaultGems[socketIndex] = itemData.item;\r\n\t\t\t\tthis.storeSettings();\r\n\t\t\t\tActionId.fromItemId(itemData.id).fill().then(filledId => {\r\n\t\t\t\t\tthis.gemIconElements[socketIndex].src = filledId.iconUrl;\r\n\t\t\t\t});\r\n\t\t\t\tselector.close();\r\n\t\t\t};\r\n\r\n\t\t\tlet openGemSelector = (color: GemColor, socketIndex: number) => {\r\n\t\t\t\treturn (event: Event) => {\r\n\t\t\t\t\tif (selector == null) {\r\n\t\t\t\t\t\tselector = new GemSelectorModal(this.simUI.rootElem, this.simUI, socketColor, handleChoose);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tselector.show();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.gemIconElements[socketIndex].addEventListener(\"click\", openGemSelector(socketColor, socketIndex));\r\n\t\t\tgemContainer.addEventListener(\"click\", openGemSelector(socketColor, socketIndex));\r\n\t\t\tgemSocketsDiv.appendChild(gemContainer);\r\n\t\t});\r\n\t\tdefaultGemDiv.appendChild(gemSocketsDiv);\r\n\r\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\r\n\t\t\tlabel: \"Fast Mode\",\r\n\t\t\tlabelTooltip: \"Fast mode reduces accuracy but will run faster.\",\r\n\t\t\tchangedEvent: (obj: BulkTab) => this.itemsChangedEmitter,\r\n\t\t\tgetValue: (obj) => this.fastMode,\r\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => { obj.fastMode = value }\r\n\t\t});\r\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\r\n\t\t\tlabel: \"Combinations\",\r\n\t\t\tlabelTooltip: \"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.\",\r\n\t\t\tchangedEvent: (obj: BulkTab) => this.itemsChangedEmitter,\r\n\t\t\tgetValue: (obj) => this.doCombos,\r\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => { obj.doCombos = value }\r\n\t\t});\r\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\r\n\t\t\tlabel: \"Auto Enchant\",\r\n\t\t\tlabelTooltip: \"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.\",\r\n\t\t\tchangedEvent: (obj: BulkTab) => this.itemsChangedEmitter,\r\n\t\t\tgetValue: (obj) => this.autoEnchant,\r\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\r\n\t\t\t\tobj.autoEnchant = value\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\tdefaultGemDiv.style.display = \"flex\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefaultGemDiv.style.display = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tnew BooleanPicker<BulkTab>(settingsBlock.bodyElement, this, {\r\n\t\t\tlabel: \"Auto Gem\",\r\n\t\t\tlabelTooltip: \"When checked bulk simulator will fill any un-filled gem sockets with default gems.\",\r\n\t\t\tchangedEvent: (obj: BulkTab) => this.itemsChangedEmitter,\r\n\t\t\tgetValue: (obj) => this.autoGem,\r\n\t\t\tsetValue: (id: EventID, obj: BulkTab, value: boolean) => {\r\n\t\t\t\tobj.autoGem = value\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\tdefaultGemDiv.style.display = \"flex\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdefaultGemDiv.style.display = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsettingsBlock.bodyElement.appendChild(defaultGemDiv);\r\n\t}\r\n\r\n\tprivate setSimProgress(progress: ProgressMetrics, iterPerSecond: number, currentRound: number, rounds: number, combinations: number) {\r\n\t\tconst secondsRemain = ((progress.totalIterations - progress.completedIterations) / iterPerSecond).toFixed();\r\n\r\n\t\tlet roundsText = \"\";\r\n\t\tif (rounds > 0) {\r\n\t\t\troundsText = `${currentRound} / ${rounds} refining rounds`;\r\n\t\t}\r\n\r\n\t\tthis.pendingResults.setContent(`\r\n      <div class=\"results-sim\">\r\n        <div class=\"\">${combinations} total combinations.</div>\r\n        <div class=\"\">${roundsText}</div>\r\n        <div class=\"\"> ${progress.completedSims} / ${progress.totalSims}<br>simulations complete</div>\r\n        <div class=\"\">\r\n          ${progress.completedIterations} / ${progress.totalIterations}<br>iterations complete\r\n        </div>\r\n        <div class=\"\">\r\n          ${secondsRemain} seconds remaining.\r\n        </div>\r\n      </div>\r\n    `);\r\n\t}\r\n}\r\n\r\n\r\nclass GemSelectorModal extends BaseModal {\r\n\tprivate readonly simUI: IndividualSimUI<Spec>;\r\n\r\n\tprivate readonly contentElem: HTMLElement;\r\n\tprivate ilist: ItemList<UIGem> | null;\r\n\tprivate socketColor: GemColor;\r\n\tprivate onSelect: (itemData: ItemData<UIGem>) => void;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<Spec>, socketColor: GemColor, onSelect: (itemData: ItemData<UIGem>) => void) {\r\n\t\tsuper(parent, 'selector-modal');\r\n\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.onSelect = onSelect;\r\n\t\tthis.socketColor = socketColor;\r\n\t\tthis.ilist = null;\r\n\r\n\t\twindow.scrollTo({ top: 0 });\r\n\r\n\t\tthis.header!.insertAdjacentHTML('afterbegin', `<span>Choose Default Gem</span>`);\r\n\t\tthis.body.innerHTML = `<div class=\"tab-content selector-modal-tab-content\"></div>`\r\n\t\tthis.contentElem = this.rootElem.querySelector('.selector-modal-tab-content') as HTMLElement;\r\n\t}\r\n\r\n\tshow() {\r\n\t\t// construct item list the first time its opened. \r\n\t\t// This makes startup faster and also means we are sure to have item database loaded.\r\n\t\tif (this.ilist == null) {\r\n\t\t\tthis.ilist = new ItemList<UIGem>(\r\n\t\t\t\tthis.body,\r\n\t\t\t\tthis.simUI,\r\n\t\t\t\t{\r\n\t\t\t\t\tselectedTab: SelectorModalTabs.Gem1,\r\n\t\t\t\t\tslot: ItemSlot.ItemSlotHead,\r\n\t\t\t\t\tequippedItem: null,\r\n\t\t\t\t\teligibleItems: new Array<UIItem>(),\r\n\t\t\t\t\teligibleEnchants: new Array<UIEnchant>(),\r\n\t\t\t\t\tgearData: {\r\n\t\t\t\t\t\tequipItem: (eventID: EventID, equippedItem: EquippedItem | null) => { },\r\n\t\t\t\t\t\tgetEquippedItem: () => null,\r\n\t\t\t\t\t\tchangeEvent: new TypedEvent(), // FIXME\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\t\"Gem1\",\r\n\t\t\t\tthis.simUI.player.getGems(this.socketColor).map((gem: UIGem) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\titem: gem,\r\n\t\t\t\t\t\tid: gem.id,\r\n\t\t\t\t\t\tactionId: ActionId.fromItemId(gem.id),\r\n\t\t\t\t\t\tname: gem.name,\r\n\t\t\t\t\t\tquality: gem.quality,\r\n\t\t\t\t\t\tphase: gem.phase,\r\n\t\t\t\t\t\theroic: false,\r\n\t\t\t\t\t\tbaseEP: 0,\r\n\t\t\t\t\t\tignoreEPFilter: true,\r\n\t\t\t\t\t\tonEquip: (eventID, gem: UIGem) => {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t\tgem => {\r\n\t\t\t\t\treturn this.simUI.player.computeGemEP(gem);\r\n\t\t\t\t},\r\n\t\t\t\t() => { return null },\r\n\t\t\t\tthis.socketColor,\r\n\t\t\t\t() => { },\r\n\t\t\t\tthis.onSelect\r\n\t\t\t)\r\n\r\n\t\t\t// let invokeUpdate = () => {this.ilist?.updateSelected()}\r\n\t\t\tlet applyFilter = () => { this.ilist?.applyFilters() }\r\n\t\t\t// Add event handlers\r\n\t\t\t// this.itemsChangedEmitter.on(invokeUpdate);\r\n\r\n\t\t\tthis.addOnDisposeCallback(() => this.ilist?.dispose());\r\n\r\n\t\t\tthis.simUI.sim.phaseChangeEmitter.on(applyFilter);\r\n\t\t\tthis.simUI.sim.filtersChangeEmitter.on(applyFilter);\r\n\t\t\t// gearData.changeEvent.on(applyFilter);\r\n\t\t}\r\n\r\n\t\tthis.open();\r\n\t}\r\n}","import { EventID, TypedEvent } from '../typed_event.js';\r\nimport { ContentBlock, ContentBlockHeaderConfig } from './content_block';\r\n\r\nimport { Component } from '../components/component.js';\r\nimport { Tooltip } from 'bootstrap';\r\nimport { json } from 'stream/consumers';\r\nimport { SimUI } from '../sim_ui.js';\r\n\r\nexport type SavedDataManagerConfig<ModObject, T> = {\r\n\tlabel: string;\r\n\theader?: ContentBlockHeaderConfig;\r\n\tpresetsOnly?: boolean;\r\n\tstorageKey: string;\r\n\tchangeEmitters: Array<TypedEvent<any>>,\r\n\tequals: (a: T, b: T) => boolean;\r\n\tgetData: (modObject: ModObject) => T;\r\n\tsetData: (eventID: EventID, modObject: ModObject, data: T) => void;\r\n\ttoJson: (a: T) => any;\r\n\tfromJson: (obj: any) => T;\r\n};\r\n\r\nexport type SavedDataConfig<ModObject, T> = {\r\n\tname: string;\r\n\tdata: T;\r\n\ttooltip?: string;\r\n\tisPreset?: boolean;\r\n\r\n\t// If set, will automatically hide the saved data when this evaluates to false.\r\n\tenableWhen?: (obj: ModObject) => boolean;\r\n};\r\n\r\ntype SavedData<ModObject, T> = {\r\n\tname: string;\r\n\tdata: T;\r\n\telem: HTMLElement;\r\n\tenableWhen?: (obj: ModObject) => boolean;\r\n};\r\n\r\nexport class SavedDataManager<ModObject, T> extends Component {\r\n\tprivate readonly simUI: SimUI;\r\n\tprivate readonly modObject: ModObject;\r\n\tprivate readonly config: SavedDataManagerConfig<ModObject, T>;\r\n\r\n\tprivate readonly userData: Array<SavedData<ModObject, T>>;\r\n\tprivate readonly presets: Array<SavedData<ModObject, T>>;\r\n\r\n\tprivate readonly savedDataDiv: HTMLElement;\r\n\tprivate readonly saveInput?: HTMLInputElement;\r\n\tprivate frozen: boolean;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, modObject: ModObject, config: SavedDataManagerConfig<ModObject, T>) {\r\n\t\tsuper(parent, 'saved-data-manager-root');\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.modObject = modObject;\r\n\t\tthis.config = config;\r\n\r\n\t\tthis.userData = [];\r\n\t\tthis.presets = [];\r\n\t\tthis.frozen = false;\r\n\r\n\t\tlet contentBlock = new ContentBlock(this.rootElem, 'saved-data', { header: config.header });\r\n\r\n\t\tcontentBlock.bodyElement.innerHTML = `<div class=\"saved-data-container hide\"></div>`;\r\n\t\tthis.savedDataDiv = contentBlock.bodyElement.querySelector('.saved-data-container') as HTMLElement;\r\n\r\n\t\tif (!config.presetsOnly) {\r\n\t\t\tcontentBlock.bodyElement.appendChild(this.buildCreateContainer());\r\n\t\t\tthis.saveInput = contentBlock.bodyElement.querySelector('.saved-data-save-input') as HTMLInputElement;\r\n\t\t}\r\n\t}\r\n\r\n\taddSavedData(config: SavedDataConfig<ModObject, T>) {\r\n\t\tthis.savedDataDiv.classList.remove('hide');\r\n\r\n\t\tconst newData = this.makeSavedData(config);\r\n\t\tconst dataArr = config.isPreset ? this.presets : this.userData;\r\n\t\tconst oldIdx = dataArr.findIndex(data => data.name == config.name);\r\n\r\n\t\tif (oldIdx == -1) {\r\n\t\t\tif (config.isPreset || this.presets.length == 0) {\r\n\t\t\t\tthis.savedDataDiv.appendChild(newData.elem);\r\n\t\t\t} else {\r\n\t\t\t\tthis.savedDataDiv.insertBefore(newData.elem, this.presets[0].elem);\r\n\t\t\t}\r\n\t\t\tdataArr.push(newData);\r\n\t\t} else {\r\n\t\t\tthis.savedDataDiv.replaceChild(newData.elem, dataArr[oldIdx].elem);\r\n\t\t\tdataArr[oldIdx] = newData;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate makeSavedData(config: SavedDataConfig<ModObject, T>): SavedData<ModObject, T> {\r\n\t\tconst dataElemFragment = document.createElement('fragment');\r\n\t\tdataElemFragment.innerHTML = `\r\n\t\t\t<div class=\"saved-data-set-chip badge rounded-pill\">\r\n\t\t\t\t<a href=\"javascript:void(0)\" class=\"saved-data-set-name\" role=\"button\">${config.name}</a>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tconst dataElem = dataElemFragment.children[0] as HTMLElement;\r\n\t\tdataElem.addEventListener('click', event => {\r\n\t\t\tthis.config.setData(TypedEvent.nextEventID(), this.modObject, config.data);\r\n\r\n\t\t\tif (this.saveInput)\r\n\t\t\t\tthis.saveInput.value = config.name;\r\n\t\t});\r\n\r\n\t\tif (!config.isPreset) {\r\n\t\t\tlet deleteFragment = document.createElement('fragment');\r\n\t\t\tdeleteFragment.innerHTML = `\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\t\tclass=\"saved-data-set-delete\"\r\n\t\t\t\t\trole=\"button\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<i class=\"fa fa-times fa-lg\"></i>\r\n\t\t\t\t</a>\r\n\t\t\t`;\r\n\r\n\t\t\tconst deleteButton = deleteFragment.children[0] as HTMLElement;\r\n\t\t\tdataElem.appendChild(deleteButton);\r\n\r\n\t\t\tconst tooltip = Tooltip.getOrCreateInstance(deleteButton, {title:`Delete saved ${this.config.label}`});\r\n\r\n\t\t\tdeleteButton.addEventListener('click', event => {\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tconst shouldDelete = confirm(`Delete saved ${this.config.label} '${config.name}'?`);\r\n\t\t\t\tif (!shouldDelete)\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\ttooltip.dispose();\r\n\r\n\t\t\t\tconst idx = this.userData.findIndex(data => data.name == config.name);\r\n\t\t\t\tthis.userData[idx].elem.remove();\r\n\t\t\t\tthis.userData.splice(idx, 1);\r\n\t\t\t\tthis.saveUserData();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (config.tooltip) {\r\n\t\t\tTooltip.getOrCreateInstance(dataElem, {\r\n\t\t\t\ttitle: config.tooltip,\r\n\t\t\t\tplacement: 'bottom',\r\n\t\t\t\thtml: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst checkActive = () => {\r\n\t\t\tif (this.config.equals(config.data, this.config.getData(this.modObject))) {\r\n\t\t\t\tdataElem.classList.add('active');\r\n\t\t\t} else {\r\n\t\t\t\tdataElem.classList.remove('active');\r\n\t\t\t}\r\n\r\n\t\t\tif (config.enableWhen && !config.enableWhen(this.modObject)) {\r\n\t\t\t\tdataElem.classList.add('disabled');\r\n\t\t\t} else {\r\n\t\t\t\tdataElem.classList.remove('disabled');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tcheckActive();\r\n\t\tthis.config.changeEmitters.forEach(emitter => emitter.on(checkActive));\r\n\r\n\t\treturn {\r\n\t\t\tname: config.name,\r\n\t\t\tdata: config.data,\r\n\t\t\telem: dataElem,\r\n\t\t\tenableWhen: config.enableWhen,\r\n\t\t};\r\n\t}\r\n\r\n\t// Save data to window.localStorage.\r\n\tprivate saveUserData() {\r\n\t\tconst userData: Record<string, Object> = {};\r\n\t\tthis.userData.forEach(savedData => {\r\n\t\t\tuserData[savedData.name] = this.config.toJson(savedData.data);\r\n\t\t});\r\n\r\n\t\tif (this.userData.length == 0 && this.presets.length == 0)\r\n\t\t\tthis.savedDataDiv.classList.add('hide');\r\n\r\n\t\twindow.localStorage.setItem(this.config.storageKey, JSON.stringify(userData));\r\n\t}\r\n\r\n\t// Load data from window.localStorage.\r\n\tloadUserData() {\r\n\t\tconst dataStr = window.localStorage.getItem(this.config.storageKey);\r\n\t\tif (!dataStr)\r\n\t\t\treturn;\r\n\r\n\t\tlet jsonData;\r\n\t\ttry {\r\n\t\t\tjsonData = JSON.parse(dataStr);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn('Invalid json for local storage value: ' + dataStr);\r\n\t\t}\r\n\r\n\t\tfor (let name in jsonData) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.addSavedData({\r\n\t\t\t\t\tname: name,\r\n\t\t\t\t\tdata: this.config.fromJson(jsonData[name]),\r\n\t\t\t\t});\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.warn('Failed parsing saved data: ' + jsonData[name]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Prevent user input from creating / deleting saved data.\r\n\tfreeze() {\r\n\t\tthis.frozen = true;\r\n\t\tthis.rootElem.classList.add('frozen');\r\n\t}\r\n\r\n\tprivate buildCreateContainer(): HTMLElement {\r\n\t\tlet savedDataCreateFragment = document.createElement('fragment');\r\n\t\tsavedDataCreateFragment.innerHTML = `\r\n\t\t\t<div class=\"saved-data-create-container\">\r\n\t\t\t\t<label class=\"form-label\">${this.config.label} Name</label>\r\n\t\t\t\t<input class=\"saved-data-save-input form-control\" type=\"text\" placeholder=\"Name\">\r\n\t\t\t\t<button class=\"saved-data-save-button btn btn-primary\">Save ${this.config.label}</button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tconst saveButton = savedDataCreateFragment.querySelector('.saved-data-save-button') as HTMLButtonElement;\r\n\r\n\t\tsaveButton.addEventListener('click', event => {\r\n\t\t\tif (this.frozen)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tconst newName = this.saveInput?.value;\r\n\t\t\tif (!newName) {\r\n\t\t\t\talert(`Choose a label for your saved ${this.config.label}!`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (newName in this.presets) {\r\n\t\t\t\talert(`${this.config.label} with name ${newName} already exists.`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.addSavedData({\r\n\t\t\t\tname: newName,\r\n\t\t\t\tdata: this.config.getData(this.modObject),\r\n\t\t\t});\r\n\t\t\tthis.saveUserData();\r\n\t\t});\r\n\r\n\t\treturn savedDataCreateFragment.children[0] as HTMLElement;\r\n\t}\r\n}\r\n","import { IndividualSimUI } from \"../../individual_sim_ui\";\r\nimport { Player } from \"../../player\";\r\nimport { EventID, TypedEvent } from \"../../typed_event\";\r\n\r\nimport { EquipmentSpec, Spec, UnitStats } from \"../../proto/common\";\r\nimport { SavedGearSet } from \"../../proto/ui\";\r\nimport { Stats } from \"../../proto_utils/stats\";\r\n\r\nimport { GearPicker } from \"../gear_picker\";\r\nimport { SavedDataManager } from \"../saved_data_manager\";\r\nimport { SimTab } from \"../sim_tab\";\r\n\r\nexport class GearTab extends SimTab {\r\n\tprotected simUI: IndividualSimUI<Spec>;\r\n\r\n\treadonly leftPanel: HTMLElement;\r\n\treadonly rightPanel: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, simUI, { identifier: 'gear-tab', title: 'Gear' });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.leftPanel = document.createElement('div');\r\n\t\tthis.leftPanel.classList.add('gear-tab-left', 'tab-panel-left');\r\n\r\n\t\tthis.rightPanel = document.createElement('div');\r\n\t\tthis.rightPanel.classList.add('gear-tab-right', 'tab-panel-right');\r\n\r\n\t\tthis.contentContainer.appendChild(this.leftPanel);\r\n\t\tthis.contentContainer.appendChild(this.rightPanel);\r\n\r\n\t\tthis.buildTabContent();\r\n\t}\r\n\r\n\tprotected buildTabContent() {\r\n\t\tthis.buildGearPickers();\r\n\r\n\t\tthis.buildSavedGearsetPicker();\r\n\t}\r\n\r\n\tprivate buildGearPickers() {\r\n\t\tnew GearPicker(this.leftPanel, this.simUI, this.simUI.player);\r\n\t}\r\n\r\n\tprivate buildSavedGearsetPicker() {\r\n\t\tconst savedGearManager = new SavedDataManager<Player<any>, SavedGearSet>(this.rightPanel, this.simUI, this.simUI.player, {\r\n\t\t\theader: { title: \"Gear Sets\" },\r\n\t\t\tlabel: 'Gear Set',\r\n\t\t\tstorageKey: this.simUI.getSavedGearStorageKey(),\r\n\t\t\tgetData: (player: Player<any>) => {\r\n\t\t\t\treturn SavedGearSet.create({\r\n\t\t\t\t\tgear: player.getGear().asSpec(),\r\n\t\t\t\t\tbonusStatsStats: player.getBonusStats().toProto(),\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newSavedGear: SavedGearSet) => {\r\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\t\t\tplayer.setGear(eventID, this.simUI.sim.db.lookupEquipmentSpec(newSavedGear.gear || EquipmentSpec.create()));\r\n\t\t\t\t\tif (newSavedGear.bonusStats && newSavedGear.bonusStats.some(s => s != 0)) {\r\n\t\t\t\t\t\tplayer.setBonusStats(eventID, new Stats(newSavedGear.bonusStats));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tplayer.setBonusStats(eventID, Stats.fromProto(newSavedGear.bonusStatsStats || UnitStats.create()));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tchangeEmitters: [this.simUI.player.changeEmitter],\r\n\t\t\tequals: (a: SavedGearSet, b: SavedGearSet) => SavedGearSet.equals(a, b),\r\n\t\t\ttoJson: (a: SavedGearSet) => SavedGearSet.toJson(a),\r\n\t\t\tfromJson: (obj: any) => SavedGearSet.fromJson(obj),\r\n\t\t});\r\n\r\n\t\tthis.simUI.sim.waitForInit().then(() => {\r\n\t\t\tsavedGearManager.loadUserData();\r\n\t\t\tthis.simUI.individualConfig.presets.gear.forEach(presetGear => {\r\n\t\t\t\tsavedGearManager.addSavedData({\r\n\t\t\t\t\tname: presetGear.name,\r\n\t\t\t\t\ttooltip: presetGear.tooltip,\r\n\t\t\t\t\tisPreset: true,\r\n\t\t\t\t\tdata: SavedGearSet.create({\r\n\t\t\t\t\t\t// Convert to gear and back so order is always the same.\r\n\t\t\t\t\t\tgear: this.simUI.sim.db.lookupEquipmentSpec(presetGear.gear).asSpec(),\r\n\t\t\t\t\t\tbonusStatsStats: new Stats().toProto(),\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tenableWhen: presetGear.enableWhen,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n","import { Tooltip } from 'bootstrap';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { swap } from '../utils.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\nexport type ListItemAction = 'create' | 'delete' | 'move' | 'copy';\r\n\r\nexport interface ListPickerActionsConfig {\r\n\tcreate?: {\r\n\t\t// Whether or not to use an icon for the create action button\r\n\t\t// defaults to FALSE\r\n\t\tuseIcon?: boolean\t\r\n\t}\r\n}\r\n\r\nexport interface ListPickerConfig<ModObject, ItemType> extends InputConfig<ModObject, Array<ItemType>> {\r\n\titemLabel: string,\r\n\tnewItem: () => ItemType,\r\n\tcopyItem: (oldItem: ItemType) => ItemType,\r\n\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<ModObject, ItemType>, index: number, config: ListItemPickerConfig<ModObject, ItemType>) => Input<ModObject, ItemType>,\r\n\tactions?: ListPickerActionsConfig\r\n\ttitle?: string,\r\n\ttitleTooltip?: string,\r\n\tinlineMenuBar?: boolean,\r\n\thideUi?: boolean,\r\n\thorizontalLayout?: boolean,\r\n\r\n\t// If set, only actions included in the list are allowed. Otherwise, all actions are allowed.\r\n\tallowedActions?: Array<ListItemAction>,\r\n}\r\n\r\nconst DEFAULT_CONFIG = {\r\n\tactions: {\r\n\t\tcreate: {\r\n\t\t\tuseIcon: false,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport interface ListItemPickerConfig<ModObject, ItemType> extends InputConfig<ModObject, ItemType> {\r\n}\r\n\r\ninterface ItemPickerPair<ItemType> {\r\n\telem: HTMLElement,\r\n\tpicker: Input<any, ItemType>,\r\n\tidx: number,\r\n}\r\n\r\ninterface ListDragData<ModObject, ItemType> {\r\n\tlistPicker: ListPicker<ModObject, ItemType>;\r\n\titem: ItemPickerPair<ItemType>;\r\n}\r\n\r\nvar curDragData: ListDragData<any, any>|null = null;\r\n\r\nexport class ListPicker<ModObject, ItemType> extends Input<ModObject, Array<ItemType>> {\r\n\treadonly config: ListPickerConfig<ModObject, ItemType>;\r\n\tprivate readonly itemsDiv: HTMLElement;\r\n\r\n\tprivate itemPickerPairs: Array<ItemPickerPair<ItemType>>;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: ListPickerConfig<ModObject, ItemType>) {\r\n\t\tsuper(parent, 'list-picker-root', modObject, config);\r\n\t\tthis.config = {...DEFAULT_CONFIG, ...config};\r\n\t\tthis.itemPickerPairs = [];\r\n\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<>\r\n\t\t\t\t{config.title &&\r\n\t\t\t\t\t<label className='list-picker-title form-label'>\r\n\t\t\t\t\t\t{config.title}\r\n\t\t\t\t\t</label>\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"list-picker-items\"></div>\r\n\t\t\t</>\r\n\t\t)\r\n\r\n\t\tif (this.config.hideUi) {\r\n\t\t\tthis.rootElem.classList.add('hide-ui');\r\n\t\t}\r\n\t\tif (this.config.horizontalLayout) {\r\n\t\t\tthis.config.inlineMenuBar = true;\r\n\t\t\tthis.rootElem.classList.add('horizontal');\r\n\t\t}\r\n\r\n\t\tif (this.config.titleTooltip) {\r\n\t\t\tlet cfg = {\r\n\t\t\t\ttitle: this.config.titleTooltip\r\n\t\t\t}\r\n\t\t\tTooltip.getOrCreateInstance(this.rootElem.querySelector('.list-picker-title') as HTMLElement, cfg);\r\n\t\t}\r\n\r\n\t\tthis.itemsDiv = this.rootElem.getElementsByClassName('list-picker-items')[0] as HTMLElement;\r\n\r\n\t\tif (this.actionEnabled('create')) {\r\n\t\t\tlet newItemButton = null;\r\n\t\t\tlet newButtonTooltip: Tooltip | null = null;\r\n\t\t\tif (this.config.actions?.create?.useIcon) {\r\n\t\t\t\tnewItemButton = ListPicker.makeActionElem('link-success', 'fa-plus')\r\n\t\t\t\tnewButtonTooltip = Tooltip.getOrCreateInstance(newItemButton, {title: `New ${config.itemLabel}`});\r\n\t\t\t} else {\r\n\t\t\t\tnewItemButton = document.createElement('button');\r\n\t\t\t\tnewItemButton.classList.add('btn', 'btn-primary');\r\n\t\t\t\tnewItemButton.textContent = `New ${config.itemLabel}`;\r\n\t\t\t}\r\n\t\t\tnewItemButton.classList.add('list-picker-new-button');\r\n\t\t\tnewItemButton.addEventListener('click', event => {\r\n\t\t\t\tconst newItem = this.config.newItem();\r\n\t\t\t\tconst newList = this.config.getValue(this.modObject).concat([newItem]);\r\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\r\n\t\t\t\tif (newButtonTooltip) {\r\n\t\t\t\t\tnewButtonTooltip.hide();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.rootElem.appendChild(newItemButton);\r\n\t\t}\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): Array<ItemType> {\r\n\t\treturn this.itemPickerPairs.map(pair => pair.picker.getInputValue());\r\n\t}\r\n\r\n\tsetInputValue(newValue: Array<ItemType>): void {\r\n\t\t// Add/remove pickers to make the lengths match.\r\n\t\tif (newValue.length < this.itemPickerPairs.length) {\r\n\t\t\tthis.itemPickerPairs.slice(newValue.length).forEach(ipp => ipp.elem.remove());\r\n\t\t\tthis.itemPickerPairs = this.itemPickerPairs.slice(0, newValue.length);\r\n\t\t} else if (newValue.length > this.itemPickerPairs.length) {\r\n\t\t\tconst numToAdd = newValue.length - this.itemPickerPairs.length;\r\n\t\t\tfor (let i = 0; i < numToAdd; i++) {\r\n\t\t\t\tthis.addNewPicker();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set all the values.\r\n\t\tnewValue.forEach((val, i) => this.itemPickerPairs[i].picker.setInputValue(val))\r\n\t}\r\n\r\n\tprivate actionEnabled(action: ListItemAction): boolean {\r\n\t\treturn !this.config.allowedActions || this.config.allowedActions.includes(action);\r\n\t}\r\n\r\n\tprivate addNewPicker() {\r\n\t\tconst index = this.itemPickerPairs.length;\r\n\t\tconst itemContainer = document.createElement('div');\r\n\t\titemContainer.classList.add('list-picker-item-container');\r\n\t\tif (this.config.inlineMenuBar) {\r\n\t\t\titemContainer.classList.add('inline');\r\n\t\t}\r\n\t\tthis.itemsDiv.appendChild(itemContainer);\r\n\r\n\t\tconst itemElem = document.createElement('div');\r\n\t\titemElem.classList.add('list-picker-item');\r\n\r\n\t\tconst itemHeader = document.createElement('div');\r\n\t\titemHeader.classList.add('list-picker-item-header');\r\n\t\tconst itemHTML = '<div class=\"list-picker-item\"></div>';\r\n\r\n\t\tif (this.config.inlineMenuBar) {\r\n\t\t\titemContainer.appendChild(itemElem);\r\n\t\t\titemContainer.appendChild(itemHeader);\r\n\t\t} else {\r\n\t\t\titemContainer.appendChild(itemHeader);\r\n\t\t\titemContainer.appendChild(itemElem);\r\n\t\t\tif (this.config.itemLabel) {\r\n\t\t\t\tconst itemLabel = document.createElement('h6');\r\n\t\t\t\titemLabel.classList.add('list-picker-item-title');\r\n\t\t\t\titemLabel.textContent = `${this.config.itemLabel} ${this.itemPickerPairs.length + 1}`;\r\n\t\t\t\titemHeader.appendChild(itemLabel);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst itemPicker = this.config.newItemPicker(itemElem, this, index, {\r\n\t\t\tchangedEvent: this.config.changedEvent,\r\n\t\t\tgetValue: (modObj: ModObject) => this.getSourceValue()[index],\r\n\t\t\tsetValue: (eventID: EventID, modObj: ModObject, newValue: ItemType) => {\r\n\t\t\t\tconst newList = this.getSourceValue();\r\n\t\t\t\tnewList[index] = newValue;\r\n\t\t\t\tthis.config.setValue(eventID, modObj, newList);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst item: ItemPickerPair<ItemType> = { elem: itemContainer, picker: itemPicker, idx: index };\r\n\r\n\t\tif (this.actionEnabled('move')) {\r\n\t\t\tconst moveButton = ListPicker.makeActionElem('list-picker-item-move', 'fa-arrows-up-down');\r\n\t\t\titemHeader.appendChild(moveButton);\r\n\r\n\t\t\tconst moveButtonTooltip = Tooltip.getOrCreateInstance(moveButton, {title: 'Move (Drag+Drop)'});\r\n\t\t\tmoveButton.addEventListener('click', event => {\r\n\t\t\t\tmoveButtonTooltip.hide();\r\n\t\t\t});\r\n\r\n\t\t\tmoveButton.draggable = true;\r\n\t\t\tmoveButton.ondragstart = event => {\r\n\t\t\t\tif (event.target == moveButton) {\r\n\t\t\t\t\tevent.dataTransfer!.dropEffect = 'move';\r\n\t\t\t\t\tevent.dataTransfer!.effectAllowed = 'move';\r\n\t\t\t\t\titemContainer.classList.add('dragfrom');\r\n\t\t\t\t\tcurDragData = {\r\n\t\t\t\t\t\tlistPicker: this,\r\n\t\t\t\t\t\titem: item,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tlet dragEnterCounter = 0;\r\n\t\t\titemContainer.ondragenter = event => {\r\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdragEnterCounter++;\r\n\t\t\t\titemContainer.classList.add('dragto');\r\n\t\t\t};\r\n\t\t\titemContainer.ondragleave = event => {\r\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdragEnterCounter--;\r\n\t\t\t\tif (dragEnterCounter <= 0) {\r\n\t\t\t\t\titemContainer.classList.remove('dragto');\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\titemContainer.ondragover = event => {\r\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t};\r\n\t\t\titemContainer.ondrop = event => {\r\n\t\t\t\tif (!curDragData || curDragData.listPicker != this) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdragEnterCounter = 0;\r\n\t\t\t\titemContainer.classList.remove('dragto');\r\n\t\t\t\tcurDragData.item.elem.classList.remove('dragfrom');\r\n\r\n\t\t\t\tconst srcIdx = curDragData.item.idx;\r\n\t\t\t\tconst dstIdx = index;\r\n\t\t\t\tconst newList = this.config.getValue(this.modObject);\r\n\t\t\t\tconst arrElem = newList[srcIdx];\r\n\t\t\t\tnewList.splice(srcIdx, 1);\r\n\t\t\t\tnewList.splice(dstIdx, 0, arrElem);\r\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\r\n\r\n\t\t\t\tcurDragData = null;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (this.actionEnabled('copy')) {\r\n\t\t\tconst copyButton = ListPicker.makeActionElem('list-picker-item-copy', 'fa-copy');\r\n\t\t\titemHeader.appendChild(copyButton);\r\n\t\t\tconst copyButtonTooltip = Tooltip.getOrCreateInstance(copyButton, {title: `Copy to New ${this.config.itemLabel}`});\r\n\r\n\t\t\tcopyButton.addEventListener('click', event => {\r\n\t\t\t\tconst newList = this.config.getValue(this.modObject).slice();\r\n\t\t\t\tnewList.splice(index, 0, this.config.copyItem(newList[index]));\r\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\r\n\t\t\t\tcopyButtonTooltip.hide();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.actionEnabled('delete')) {\r\n\t\t\tconst deleteButton = ListPicker.makeActionElem('list-picker-item-delete', 'fa-times');\r\n\t\t\tdeleteButton.classList.add('link-danger');\r\n\t\t\titemHeader.appendChild(deleteButton);\r\n\t\t\tconst deleteButtonTooltip = Tooltip.getOrCreateInstance(deleteButton, { title: `Delete ${this.config.itemLabel}`});\r\n\r\n\t\t\tdeleteButton.addEventListener('click', event => {\r\n\t\t\t\tconst newList = this.config.getValue(this.modObject);\r\n\t\t\t\tnewList.splice(index, 1);\r\n\t\t\t\tthis.config.setValue(TypedEvent.nextEventID(), this.modObject, newList);\r\n\t\t\t\tdeleteButtonTooltip.hide();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.itemPickerPairs.push(item);\r\n\t}\r\n\r\n\tstatic makeActionElem(cssClass: string, iconCssClass: string): HTMLElement {\r\n\t\tconst actionElem = document.createElement('a');\r\n\t\tactionElem.classList.add('list-picker-item-action', cssClass);\r\n\t\tactionElem.href = 'javascript:void(0)';\r\n\t\tactionElem.setAttribute('role', 'button');\r\n\r\n\t\tconst icon = document.createElement('i');\r\n\t\ticon.classList.add('fa', 'fa-xl', iconCssClass);\r\n\t\tactionElem.appendChild(icon);\r\n\r\n\t\treturn actionElem;\r\n\t}\r\n\r\n\tstatic getItemHeaderElem(itemPicker: Input<any, any>): HTMLElement {\r\n\t\tconst itemElem = itemPicker.rootElem.parentElement!;\r\n\t\tconst headerElem = (itemElem.nextElementSibling || itemElem.previousElementSibling);\r\n\t\tif (!headerElem?.classList.contains('list-picker-item-header')) {\r\n\t\t\tthrow new Error('Could not find list item header');\r\n\t\t}\r\n\t\treturn headerElem as HTMLElement;\r\n\t}\r\n}\r\n","import {\r\n\tInputType,\r\n\tMobType,\r\n\tSpellSchool,\r\n\tStat,\r\n\tTarget as TargetProto,\r\n\tTargetInput,\r\n\tTarget,\r\n} from '../proto/common.js';\r\nimport { Encounter } from '../encounter.js';\r\nimport { Raid } from '../raid.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { BooleanPicker } from '../components/boolean_picker.js';\r\nimport { EnumPicker } from '../components/enum_picker.js';\r\nimport { ListItemPickerConfig, ListPicker } from '../components/list_picker.js';\r\nimport { NumberPicker } from '../components/number_picker.js';\r\nimport { Stats } from '../proto_utils/stats.js';\r\nimport { isHealingSpec, isTankSpec } from '../proto_utils/utils.js';\r\nimport { statNames } from '../proto_utils/names.js';\r\n\r\nimport { Component } from './component.js';\r\n\r\nimport * as Mechanics from '../constants/mechanics.js';\r\nimport { IndividualSimUI } from '../individual_sim_ui.js';\r\nimport { SimUI } from '../sim_ui.js';\r\nimport { Input } from './input.js';\r\nimport { BaseModal } from './base_modal.js';\r\n\r\nexport interface EncounterPickerConfig {\r\n\tshowExecuteProportion: boolean,\r\n}\r\n\r\nexport class EncounterPicker extends Component {\r\n\tconstructor(parent: HTMLElement, modEncounter: Encounter, config: EncounterPickerConfig, simUI: SimUI) {\r\n\t\tsuper(parent, 'encounter-picker-root');\r\n\r\n\t\taddEncounterFieldPickers(this.rootElem, modEncounter, config.showExecuteProportion);\r\n\r\n\t\t// Need to wait so that the encounter and target presets will be loaded.\r\n\t\tmodEncounter.sim.waitForInit().then(() => {\r\n\t\t\tconst presetTargets = modEncounter.sim.db.getAllPresetTargets();\r\n\r\n\t\t\tnew EnumPicker<Encounter>(this.rootElem, modEncounter, {\r\n\t\t\t\textraCssClasses: ['damage-metrics', 'npc-picker'],\r\n\t\t\t\tlabel: 'NPC',\r\n\t\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\r\n\t\t\t\tvalues: [\r\n\t\t\t\t\t{ name: 'Custom', value: -1 },\r\n\t\t\t\t].concat(presetTargets.map((pe, i) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tname: pe.path,\r\n\t\t\t\t\t\tvalue: i,\r\n\t\t\t\t\t};\r\n\t\t\t\t})),\r\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t\tgetValue: (encounter: Encounter) => presetTargets.findIndex(pe => equalTargetsIgnoreInputs(encounter.primaryTarget, pe.target)),\r\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\t\tif (newValue != -1) {\r\n\t\t\t\t\t\tencounter.applyPresetTarget(eventID, presetTargets[newValue], 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\t//new EnumPicker<Encounter>(this.rootElem, modEncounter, {\r\n\t\t\t//\tlabel: 'Target Level',\r\n\t\t\t//\tvalues: [\r\n\t\t\t//\t\t{ name: '83', value: 83 },\r\n\t\t\t//\t\t{ name: '82', value: 82 },\r\n\t\t\t//\t\t{ name: '81', value: 81 },\r\n\t\t\t//\t\t{ name: '80', value: 80 },\r\n\t\t\t//\t],\r\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getLevel(),\r\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t//\t\tencounter.primaryTarget.setLevel(eventID, newValue);\r\n\t\t\t//\t},\r\n\t\t\t//});\r\n\r\n\t\t\t//new EnumPicker(this.rootElem, modEncounter, {\r\n\t\t\t//\tlabel: 'Mob Type',\r\n\t\t\t//\tvalues: mobTypeEnumValues,\r\n\t\t\t//\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t//\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getMobType(),\r\n\t\t\t//\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t//\t\tencounter.primaryTarget.setMobType(eventID, newValue);\r\n\t\t\t//\t},\r\n\t\t\t//});\r\n\r\n\t\t\t// Leaving this commented in case we want it later. But it takes up a lot of\r\n\t\t\t// screen space and none of these fields get changed much.\r\n\t\t\t//if (config.simpleTargetStats) {\r\n\t\t\t//\tconfig.simpleTargetStats.forEach(stat => {\r\n\t\t\t//\t\tnew NumberPicker(this.rootElem, modEncounter, {\r\n\t\t\t//\t\t\tlabel: statNames[stat],\r\n\t\t\t//\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t//\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.getStats().getStat(stat),\r\n\t\t\t//\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t//\t\t\t\tencounter.primaryTarget.setStats(eventID, encounter.primaryTarget.getStats().withStat(stat, newValue));\r\n\t\t\t//\t\t\t},\r\n\t\t\t//\t\t});\r\n\t\t\t//\t});\r\n\t\t\t//}\r\n\r\n\t\t\tif (simUI.isIndividualSim() && isHealingSpec((simUI as IndividualSimUI<any>).player.spec)) {\r\n\t\t\t\tnew NumberPicker(this.rootElem, simUI.sim.raid, {\r\n\t\t\t\t\tlabel: 'Num Allies',\r\n\t\t\t\t\tlabelTooltip: 'Number of allied players in the raid.',\r\n\t\t\t\t\tchangedEvent: (raid: Raid) => raid.targetDummiesChangeEmitter,\r\n\t\t\t\t\tgetValue: (raid: Raid) => raid.getTargetDummies(),\r\n\t\t\t\t\tsetValue: (eventID: EventID, raid: Raid, newValue: number) => {\r\n\t\t\t\t\t\traid.setTargetDummies(eventID, newValue);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (simUI.isIndividualSim() && isTankSpec((simUI as IndividualSimUI<any>).player.spec)) {\r\n\t\t\t\tnew NumberPicker(this.rootElem, modEncounter, {\r\n\t\t\t\t\tlabel: 'Min Base Damage',\r\n\t\t\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\r\n\t\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t\t\tgetValue: (encounter: Encounter) => encounter.primaryTarget.minBaseDamage,\r\n\t\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\t\t\tencounter.primaryTarget.minBaseDamage = newValue;\r\n\t\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Transfer Target Inputs from target Id if they dont match (possible when custom AI is selected)\r\n\t\t\tlet targetIndex = presetTargets.findIndex(pe => modEncounter.primaryTarget.id == pe.target?.id);\r\n\t\t\tlet targetInputs = presetTargets[targetIndex]?.target?.targetInputs || [];\r\n\r\n\t\t\tif (targetInputs.length != modEncounter.primaryTarget.targetInputs.length\r\n\t\t\t\t|| modEncounter.primaryTarget.targetInputs.some((ti, i) => ti.label != targetInputs[i].label)) {\r\n\t\t\t\tmodEncounter.primaryTarget.targetInputs = targetInputs;\r\n\t\t\t\tmodEncounter.targetsChangeEmitter.emit(TypedEvent.nextEventID());\r\n\t\t\t}\r\n\r\n\t\t\tmakeTargetInputsPicker(this.rootElem, modEncounter, 0);\r\n\r\n\t\t\tconst advancedButton = document.createElement('button');\r\n\t\t\tadvancedButton.classList.add('advanced-button', 'btn', 'btn-primary');\r\n\t\t\tadvancedButton.textContent = 'Advanced';\r\n\t\t\tadvancedButton.addEventListener('click', () => new AdvancedEncounterModal(simUI.rootElem, simUI, modEncounter));\r\n\t\t\tthis.rootElem.appendChild(advancedButton);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nclass AdvancedEncounterModal extends BaseModal {\r\n\tprivate readonly encounter: Encounter;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, encounter: Encounter) {\r\n\t\tsuper(parent, 'advanced-encounter-picker-modal');\r\n\r\n\t\tthis.encounter = encounter;\r\n\r\n\t\tthis.addHeader();\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"encounter-header\"></div>\r\n\t\t\t<div class=\"encounter-targets\"></div>\r\n\t\t`;\r\n\r\n\t\tconst header = this.rootElem.getElementsByClassName('encounter-header')[0] as HTMLElement;\r\n\t\tconst targetsElem = this.rootElem.getElementsByClassName('encounter-targets')[0] as HTMLElement;\r\n\r\n\t\taddEncounterFieldPickers(header, this.encounter, true);\r\n\t\tif (!simUI.isIndividualSim()) {\r\n\t\t\tnew BooleanPicker<Encounter>(header, encounter, {\r\n\t\t\t\tlabel: 'Use Health',\r\n\t\t\t\tlabelTooltip: 'Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.',\r\n\t\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\t\tgetValue: (encounter: Encounter) => encounter.getUseHealth(),\r\n\t\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: boolean) => {\r\n\t\t\t\t\tencounter.setUseHealth(eventID, newValue);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t\tnew ListPicker<Encounter, TargetProto>(targetsElem, this.encounter, {\r\n\t\t\textraCssClasses: ['targets-picker', 'mb-0'],\r\n\t\t\titemLabel: 'Target',\r\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: (encounter: Encounter) => encounter.targets,\r\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: Array<TargetProto>) => {\r\n\t\t\t\tencounter.targets = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tnewItem: () => Encounter.defaultTargetProto(),\r\n\t\t\tcopyItem: (oldItem: TargetProto) => TargetProto.clone(oldItem),\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Encounter, TargetProto>, index: number, config: ListItemPickerConfig<Encounter, TargetProto>) => new TargetPicker(parent, encounter, index, config),\r\n\t\t});\r\n\t}\r\n\r\n\tprivate addHeader() {\r\n\t\tconst presetEncounters = this.encounter.sim.db.getAllPresetEncounters();\r\n\r\n\t\tnew EnumPicker<Encounter>(this.header as HTMLElement, this.encounter, {\r\n\t\t\tlabel: 'Encounter',\r\n\t\t\textraCssClasses: ['encounter-picker', 'mb-0', 'pe-2'],\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: 'Custom', value: -1 },\r\n\t\t\t].concat(presetEncounters.map((pe, i) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: pe.path,\r\n\t\t\t\t\tvalue: i,\r\n\t\t\t\t};\r\n\t\t\t})),\r\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\tgetValue: (encounter: Encounter) => presetEncounters.findIndex(pe => encounter.matchesPreset(pe)),\r\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\tif (newValue != -1) {\r\n\t\t\t\t\tencounter.applyPreset(eventID, presetEncounters[newValue]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n\r\nclass TargetPicker extends Input<Encounter, TargetProto> {\r\n\tprivate readonly encounter: Encounter;\r\n\tprivate readonly targetIndex: number;\r\n\r\n\tprivate readonly aiPicker: Input<null, number>;\r\n\tprivate readonly levelPicker: Input<null, number>;\r\n\tprivate readonly mobTypePicker: Input<null, number>;\r\n\tprivate readonly tankIndexPicker: Input<null, number>;\r\n\tprivate readonly statPickers: Array<Input<null, number>>;\r\n\tprivate readonly swingSpeedPicker: Input<null, number>;\r\n\tprivate readonly minBaseDamagePicker: Input<null, number>;\r\n\tprivate readonly dualWieldPicker: Input<null, boolean>;\r\n\tprivate readonly dwMissPenaltyPicker: Input<null, boolean>;\r\n\tprivate readonly parryHastePicker: Input<null, boolean>;\r\n\tprivate readonly spellSchoolPicker: Input<null, number>;\r\n\tprivate readonly suppressDodgePicker: Input<null, boolean>;\r\n\tprivate readonly damageSpreadPicker: Input<null, number>;\r\n\tprivate readonly targetInputPickers: ListPicker<Encounter, TargetInput>;\r\n\r\n\tprivate getTarget(): TargetProto {\r\n\t\treturn this.encounter.targets[this.targetIndex] || Target.create();\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, encounter: Encounter, targetIndex: number, config: ListItemPickerConfig<Encounter, TargetProto>) {\r\n\t\tsuper(parent, 'target-picker-root', encounter, config)\r\n\t\tthis.encounter = encounter;\r\n\t\tthis.targetIndex = targetIndex;\r\n\r\n\t\tthis.rootElem.innerHTML = `\r\n\t\t\t<div class=\"target-picker-section target-picker-section1\"></div>\r\n\t\t\t<div class=\"target-picker-section target-picker-section2\"></div>\r\n\t\t\t<div class=\"target-picker-section target-picker-section3 threat-metrics\"></div>\r\n\t\t`;\r\n\r\n\t\tconst section1 = this.rootElem.getElementsByClassName('target-picker-section1')[0] as HTMLElement;\r\n\t\tconst section2 = this.rootElem.getElementsByClassName('target-picker-section2')[0] as HTMLElement;\r\n\t\tconst section3 = this.rootElem.getElementsByClassName('target-picker-section3')[0] as HTMLElement;\r\n\r\n\t\tconst presetTargets = encounter.sim.db.getAllPresetTargets();\r\n\t\tnew EnumPicker<null>(section1, null, {\r\n\t\t\textraCssClasses: ['npc-picker'],\r\n\t\t\tlabel: 'NPC',\r\n\t\t\tlabelTooltip: 'Selects a preset NPC configuration.',\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: 'Custom', value: -1 },\r\n\t\t\t].concat(presetTargets.map((pe, i) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: pe.path,\r\n\t\t\t\t\tvalue: i,\r\n\t\t\t\t};\r\n\t\t\t})),\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => presetTargets.findIndex(pe => equalTargetsIgnoreInputs(this.getTarget(), pe.target)),\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tif (newValue != -1) {\r\n\t\t\t\t\tencounter.applyPresetTarget(eventID, presetTargets[newValue], this.targetIndex);\r\n\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.aiPicker = new EnumPicker<null>(section1, null, {\r\n\t\t\textraCssClasses: ['ai-picker'],\r\n\t\t\tlabel: 'AI',\r\n\t\t\tlabelTooltip: `\r\n\t\t\t\t<p>Determines the target\\'s ability rotation.</p>\r\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\r\n\t\t\t`,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: 'None', value: 0 },\r\n\t\t\t].concat(presetTargets.map(pe => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: pe.path,\r\n\t\t\t\t\tvalue: pe.target!.id,\r\n\t\t\t\t};\r\n\t\t\t})),\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().id,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tconst target = this.getTarget();\r\n\t\t\t\ttarget.id = newValue;\r\n\r\n\t\t\t\t// Transfer Target Inputs from the AI of the selected target\r\n\t\t\t\ttarget.targetInputs = (presetTargets.find(pe => target.id == pe.target?.id)?.target?.targetInputs || []).map(ti => TargetInput.clone(ti));\r\n\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.levelPicker = new EnumPicker<null>(section1, null, {\r\n\t\t\tlabel: 'Level',\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: '73', value: 73 },\r\n\t\t\t\t{ name: '72', value: 72 },\r\n\t\t\t\t{ name: '71', value: 71 },\r\n\t\t\t\t{ name: '70', value: 70 },\r\n\t\t\t],\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().level,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().level = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.mobTypePicker = new EnumPicker(section1, null, {\r\n\t\t\tlabel: 'Mob Type',\r\n\t\t\tvalues: mobTypeEnumValues,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().mobType,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().mobType = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.tankIndexPicker = new EnumPicker<null>(section1, null, {\r\n\t\t\textraCssClasses: ['threat-metrics'],\r\n\t\t\tlabel: 'Tanked By',\r\n\t\t\tlabelTooltip: 'Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.',\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: 'None', value: -1 },\r\n\t\t\t\t{ name: 'Main Tank', value: 0 },\r\n\t\t\t\t{ name: 'Tank 2', value: 1 },\r\n\t\t\t\t{ name: 'Tank 3', value: 2 },\r\n\t\t\t\t{ name: 'Tank 4', value: 3 },\r\n\t\t\t],\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().tankIndex,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().tankIndex = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.targetInputPickers = makeTargetInputsPicker(section1, encounter, this.targetIndex);\r\n\r\n\t\tthis.statPickers = ALL_TARGET_STATS.map(statData => {\r\n\t\t\tconst stat = statData.stat;\r\n\t\t\treturn new NumberPicker(section2, null, {\r\n\t\t\t\tinline: true,\r\n\t\t\t\textraCssClasses: statData.extraCssClasses,\r\n\t\t\t\tlabel: statNames[stat],\r\n\t\t\t\tlabelTooltip: statData.tooltip,\r\n\t\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\t\tgetValue: () => this.getTarget().stats[stat],\r\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\t\tthis.getTarget().stats[stat] = newValue;\r\n\t\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.swingSpeedPicker = new NumberPicker(section3, null, {\r\n\t\t\tlabel: 'Swing Speed',\r\n\t\t\tlabelTooltip: 'Time in seconds between auto attacks. Set to 0 to disable auto attacks.',\r\n\t\t\tfloat: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().swingSpeed,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().swingSpeed = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.minBaseDamagePicker = new NumberPicker(section3, null, {\r\n\t\t\tlabel: 'Min Base Damage',\r\n\t\t\tlabelTooltip: 'Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.',\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().minBaseDamage,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().minBaseDamage = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.damageSpreadPicker = new NumberPicker(section3, null, {\r\n\t\t\tlabel: 'Damage Spread',\r\n\t\t\tlabelTooltip: 'Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.',\r\n\t\t\tfloat: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().damageSpread,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().damageSpread = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.dualWieldPicker = new BooleanPicker(section3, null, {\r\n\t\t\tlabel: 'Dual Wield',\r\n\t\t\tlabelTooltip: 'Uses 2 separate weapons to attack.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().dualWield,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\r\n\t\t\t\tthis.getTarget().dualWield = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.dwMissPenaltyPicker = new BooleanPicker(section3, null, {\r\n\t\t\tlabel: 'DW Miss Penalty',\r\n\t\t\tlabelTooltip: 'Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().dualWieldPenalty,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\r\n\t\t\t\tthis.getTarget().dualWieldPenalty = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tenableWhen: () => this.getTarget().dualWield,\r\n\t\t});\r\n\t\tthis.parryHastePicker = new BooleanPicker(section3, null, {\r\n\t\t\tlabel: 'Parry Haste',\r\n\t\t\tlabelTooltip: 'Whether this enemy will gain parry haste when parrying attacks.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().parryHaste,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\r\n\t\t\t\tthis.getTarget().parryHaste = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.spellSchoolPicker = new EnumPicker<null>(section3, null, {\r\n\t\t\tlabel: 'Spell School',\r\n\t\t\tlabelTooltip: 'Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.',\r\n\t\t\tvalues: [\r\n\t\t\t\t{ name: 'Physical', value: SpellSchool.SpellSchoolPhysical },\r\n\t\t\t\t{ name: 'Arcane', value: SpellSchool.SpellSchoolArcane },\r\n\t\t\t\t{ name: 'Fire', value: SpellSchool.SpellSchoolFire },\r\n\t\t\t\t{ name: 'Frost', value: SpellSchool.SpellSchoolFrost },\r\n\t\t\t\t{ name: 'Holy', value: SpellSchool.SpellSchoolHoly },\r\n\t\t\t\t{ name: 'Nature', value: SpellSchool.SpellSchoolNature },\r\n\t\t\t\t{ name: 'Shadow', value: SpellSchool.SpellSchoolShadow },\r\n\t\t\t],\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().spellSchool,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tthis.getTarget().spellSchool = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.suppressDodgePicker = new BooleanPicker(section3, null, {\r\n\t\t\tlabel: 'Chill of the Throne',\r\n\t\t\tlabelTooltip: 'Reduces the chance for this enemy\\'s attacks to be dodged by 20%. Active in Icecrown Citadel.',\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: () => encounter.targetsChangeEmitter,\r\n\t\t\tgetValue: () => this.getTarget().suppressDodge,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\r\n\t\t\t\tthis.getTarget().suppressDodge = newValue;\r\n\t\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tenableWhen: () => this.getTarget().level == Mechanics.BOSS_LEVEL,\r\n\t\t});\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn null;\r\n\t}\r\n\tgetInputValue(): TargetProto {\r\n\t\treturn TargetProto.create({\r\n\t\t\tid: this.aiPicker.getInputValue(),\r\n\t\t\tlevel: this.levelPicker.getInputValue(),\r\n\t\t\tmobType: this.mobTypePicker.getInputValue(),\r\n\t\t\ttankIndex: this.tankIndexPicker.getInputValue(),\r\n\t\t\tswingSpeed: this.swingSpeedPicker.getInputValue(),\r\n\t\t\tminBaseDamage: this.minBaseDamagePicker.getInputValue(),\r\n\t\t\tsuppressDodge: this.suppressDodgePicker.getInputValue(),\r\n\t\t\tdualWield: this.dualWieldPicker.getInputValue(),\r\n\t\t\tdualWieldPenalty: this.dwMissPenaltyPicker.getInputValue(),\r\n\t\t\tparryHaste: this.parryHastePicker.getInputValue(),\r\n\t\t\tspellSchool: this.spellSchoolPicker.getInputValue(),\r\n\t\t\tdamageSpread: this.damageSpreadPicker.getInputValue(),\r\n\t\t\tstats: this.statPickers\r\n\t\t\t\t.map(picker => picker.getInputValue())\r\n\t\t\t\t.map((statValue, i) => new Stats().withStat(ALL_TARGET_STATS[i].stat, statValue))\r\n\t\t\t\t.reduce((totalStats, curStats) => totalStats.add(curStats)).asArray(),\r\n\t\t\ttargetInputs: this.targetInputPickers.getInputValue(),\r\n\t\t});\r\n\t}\r\n\tsetInputValue(newValue: TargetProto) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.aiPicker.setInputValue(newValue.id);\r\n\t\tthis.levelPicker.setInputValue(newValue.level);\r\n\t\tthis.mobTypePicker.setInputValue(newValue.mobType);\r\n\t\tthis.tankIndexPicker.setInputValue(newValue.tankIndex);\r\n\t\tthis.swingSpeedPicker.setInputValue(newValue.swingSpeed);\r\n\t\tthis.minBaseDamagePicker.setInputValue(newValue.minBaseDamage);\r\n\t\tthis.suppressDodgePicker.setInputValue(newValue.suppressDodge);\r\n\t\tthis.dualWieldPicker.setInputValue(newValue.dualWield);\r\n\t\tthis.dwMissPenaltyPicker.setInputValue(newValue.dualWieldPenalty);\r\n\t\tthis.parryHastePicker.setInputValue(newValue.parryHaste);\r\n\t\tthis.spellSchoolPicker.setInputValue(newValue.spellSchool);\r\n\t\tthis.damageSpreadPicker.setInputValue(newValue.damageSpread);\r\n\t\tALL_TARGET_STATS.forEach((statData, i) => this.statPickers[i].setInputValue(newValue.stats[statData.stat]));\r\n\t\tthis.targetInputPickers.setInputValue(newValue.targetInputs);\r\n\t}\r\n}\r\n\r\nclass TargetInputPicker extends Input<Encounter, TargetInput> {\r\n\tprivate readonly encounter: Encounter;\r\n\tprivate readonly targetIndex: number;\r\n\tprivate readonly targetInputIndex: number;\r\n\r\n\tprivate boolPicker: Input<null, boolean> | null;\r\n\tprivate numberPicker: Input<null, number> | null;\r\n\r\n\tprivate getTargetInput(): TargetInput {\r\n\t\treturn this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex] || TargetInput.create();\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, encounter: Encounter, targetIndex: number, targetInputIndex: number, config: ListItemPickerConfig<Encounter, TargetInput>) {\r\n\t\tsuper(parent, 'target-input-picker-root', encounter, config)\r\n\t\tthis.encounter = encounter;\r\n\t\tthis.targetIndex = targetIndex;\r\n\t\tthis.targetInputIndex = targetInputIndex;\r\n\r\n\t\tthis.boolPicker = null;\r\n\t\tthis.numberPicker = null;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\tgetInputValue(): TargetInput {\r\n\t\treturn TargetInput.create({\r\n\t\t\tboolValue: this.boolPicker ? this.boolPicker.getInputValue() : undefined,\r\n\t\t\tnumberValue: this.numberPicker ? this.numberPicker.getInputValue() : undefined,\r\n\t\t});\r\n\t}\r\n\tsetInputValue(newValue: TargetInput) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (newValue.inputType == InputType.Number && !this.numberPicker) {\r\n\t\t\tif (this.boolPicker) {\r\n\t\t\t\tthis.boolPicker.rootElem.remove();\r\n\t\t\t\tthis.boolPicker = null;\r\n\t\t\t}\r\n\t\t\tthis.numberPicker = new NumberPicker(this.rootElem, null, {\r\n\t\t\t\tlabel: newValue.label,\r\n\t\t\t\tlabelTooltip: newValue.tooltip,\r\n\t\t\t\tchangedEvent: () => this.encounter.targetsChangeEmitter,\r\n\t\t\t\tgetValue: () => this.getTargetInput().numberValue,\r\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\t\tthis.getTargetInput().numberValue = newValue;\r\n\t\t\t\t\tthis.encounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} else if (newValue.inputType == InputType.Bool && !this.boolPicker) {\r\n\t\t\tif (this.numberPicker) {\r\n\t\t\t\tthis.numberPicker.rootElem.remove();\r\n\t\t\t\tthis.numberPicker = null;\r\n\t\t\t}\r\n\t\t\tthis.boolPicker = new BooleanPicker(this.rootElem, null, {\r\n\t\t\t\tlabel: newValue.label,\r\n\t\t\t\tlabelTooltip: newValue.tooltip,\r\n\t\t\t\tchangedEvent: () => this.encounter.targetsChangeEmitter,\r\n\t\t\t\tgetValue: () => this.getTargetInput().boolValue,\r\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: boolean) => {\r\n\t\t\t\t\tthis.getTargetInput().boolValue = newValue;\r\n\t\t\t\t\tthis.encounter.targetsChangeEmitter.emit(eventID);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction addEncounterFieldPickers(rootElem: HTMLElement, encounter: Encounter, showExecuteProportion: boolean) {\r\n\tlet durationGroup = Input.newGroupContainer();\r\n\trootElem.appendChild(durationGroup);\r\n\r\n\tnew NumberPicker(durationGroup, encounter, {\r\n\t\tlabel: 'Duration',\r\n\t\tlabelTooltip: 'The fight length for each sim iteration, in seconds.',\r\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\tgetValue: (encounter: Encounter) => encounter.getDuration(),\r\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\tencounter.setDuration(eventID, newValue);\r\n\t\t},\r\n\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\r\n\t});\r\n\tnew NumberPicker(durationGroup, encounter, {\r\n\t\tlabel: 'Duration +/-',\r\n\t\tlabelTooltip: 'Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.',\r\n\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\tgetValue: (encounter: Encounter) => encounter.getDurationVariation(),\r\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\tencounter.setDurationVariation(eventID, newValue);\r\n\t\t},\r\n\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\r\n\t});\r\n\r\n\tif (showExecuteProportion) {\r\n\t\tlet executeGroup = Input.newGroupContainer();\r\n\t\texecuteGroup.classList.add('execute-group');\r\n\t\trootElem.appendChild(executeGroup);\r\n\r\n\t\tnew NumberPicker(executeGroup, encounter, {\r\n\t\t\tlabel: 'Execute Duration 20 (%)',\r\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\r\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion20() * 100,\r\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\tencounter.setExecuteProportion20(eventID, newValue / 100);\r\n\t\t\t},\r\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\r\n\t\t});\r\n\t\tnew NumberPicker(executeGroup, encounter, {\r\n\t\t\tlabel: 'Execute Duration 25 (%)',\r\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock\\'s Drain Soul.',\r\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion25() * 100,\r\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\tencounter.setExecuteProportion25(eventID, newValue / 100);\r\n\t\t\t},\r\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\r\n\t\t});\r\n\t\tnew NumberPicker(executeGroup, encounter, {\r\n\t\t\tlabel: 'Execute Duration 35 (%)',\r\n\t\t\tlabelTooltip: 'Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.',\r\n\t\t\tchangedEvent: (encounter: Encounter) => encounter.changeEmitter,\r\n\t\t\tgetValue: (encounter: Encounter) => encounter.getExecuteProportion35() * 100,\r\n\t\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: number) => {\r\n\t\t\t\tencounter.setExecuteProportion35(eventID, newValue / 100);\r\n\t\t\t},\r\n\t\t\tenableWhen: (obj) => { return !encounter.getUseHealth() },\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction makeTargetInputsPicker(parent: HTMLElement, encounter: Encounter, targetIndex: number): ListPicker<Encounter, TargetInput> {\r\n\treturn new ListPicker<Encounter, TargetInput>(parent, encounter, {\r\n\t\titemLabel: 'Target Input',\r\n\t\tchangedEvent: (encounter: Encounter) => encounter.targetsChangeEmitter,\r\n\t\tgetValue: (encounter: Encounter) => encounter.targets[targetIndex].targetInputs,\r\n\t\tsetValue: (eventID: EventID, encounter: Encounter, newValue: Array<TargetInput>) => {\r\n\t\t\tencounter.targets[targetIndex].targetInputs = newValue;\r\n\t\t\tencounter.targetsChangeEmitter.emit(eventID);\r\n\t\t},\r\n\t\tnewItem: () => TargetInput.create(),\r\n\t\tcopyItem: (oldItem: TargetInput) => TargetInput.clone(oldItem),\r\n\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Encounter, TargetInput>, index: number, config: ListItemPickerConfig<Encounter, TargetInput>) => new TargetInputPicker(parent, encounter, targetIndex, index, config),\r\n\t\thideUi: true,\r\n\t});\r\n}\r\n\r\nfunction equalTargetsIgnoreInputs(target1: TargetProto | undefined, target2: TargetProto | undefined): boolean {\r\n\tif ((target1 == null) != (target2 == null)) {\r\n\t\treturn false;\r\n\t}\r\n\tif (target1 == null) {\r\n\t\treturn true;\r\n\t}\r\n\tconst modTarget2 = TargetProto.clone(target2!);\r\n\tmodTarget2.targetInputs = target1.targetInputs;\r\n\treturn TargetProto.equals(target1, modTarget2);\r\n}\r\n\r\nconst ALL_TARGET_STATS: Array<{ stat: Stat, tooltip: string, extraCssClasses: Array<string> }> = [\r\n\t{ stat: Stat.StatHealth, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatArmor, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatArcaneResistance, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatFireResistance, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatFrostResistance, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatNatureResistance, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatShadowResistance, tooltip: '', extraCssClasses: [] },\r\n\t{ stat: Stat.StatAttackPower, tooltip: '', extraCssClasses: ['threat-metrics'] },\r\n\t{ stat: Stat.StatBlockValue, tooltip: '', extraCssClasses: ['threat-metrics'] },\r\n];\r\n\r\nconst mobTypeEnumValues = [\r\n\t{ name: 'None', value: MobType.MobTypeUnknown },\r\n\t{ name: 'Beast', value: MobType.MobTypeBeast },\r\n\t{ name: 'Demon', value: MobType.MobTypeDemon },\r\n\t{ name: 'Dragonkin', value: MobType.MobTypeDragonkin },\r\n\t{ name: 'Elemental', value: MobType.MobTypeElemental },\r\n\t{ name: 'Giant', value: MobType.MobTypeGiant },\r\n\t{ name: 'Humanoid', value: MobType.MobTypeHumanoid },\r\n\t{ name: 'Mechanical', value: MobType.MobTypeMechanical },\r\n\t{ name: 'Undead', value: MobType.MobTypeUndead },\r\n];\r\n","import { ActionId } from '../proto_utils/action_id.js';\r\nimport { TypedEvent } from '../typed_event.js';\r\nimport { isRightClick } from '../utils.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\nimport { element, ref } from 'tsx-vanilla';\r\n\r\n// Data for creating an icon-based input component.\r\n// \r\n// E.g. one of these for arcane brilliance, another for kings, etc.\r\n// ModObject is the object being modified (Sim, Player, or Target).\r\n// ValueType is either number or boolean.\r\nexport interface IconPickerConfig<ModObject, ValueType> extends InputConfig<ModObject, ValueType> {\r\n\tid: ActionId;\r\n\r\n\t// The number of possible 'states' this icon can have. Most inputs will use 2\r\n\t// for a bi-state icon (on or off). 0 indicates an unlimited number of states.\r\n\tstates: number;\r\n\r\n\t// Only used if states >= 3.\r\n\timprovedId?: ActionId;\r\n\r\n\t// Only used if states >= 4.\r\n\timprovedId2?: ActionId;\r\n};\r\n\r\n// Icon-based UI for picking buffs / consumes / etc\r\n// ModObject is the object being modified (Sim, Player, or Target).\r\nexport class IconPicker<ModObject, ValueType> extends Input<ModObject, ValueType> {\r\n\tactive: Boolean;\r\n\r\n\tprivate readonly config: IconPickerConfig<ModObject, ValueType>;\r\n\r\n\tprivate readonly rootAnchor: HTMLAnchorElement;\r\n\tprivate readonly improvedAnchor: HTMLAnchorElement;\r\n\tprivate readonly improvedAnchor2: HTMLAnchorElement;\r\n\tprivate readonly counterElem: HTMLElement;\r\n\r\n\tprivate currentValue: number;\r\n\r\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconPickerConfig<ModObject, ValueType>) {\r\n\t\tsuper(parent, 'icon-picker-root', modObj, config);\r\n\t\tthis.rootElem.classList.add('icon-picker');\r\n\t\tthis.active = false;\r\n\t\tthis.config = config;\r\n\t\tthis.currentValue = 0;\r\n\r\n\t\tthis.rootAnchor = document.createElement('a');\r\n\t\tthis.rootAnchor.classList.add('icon-picker-button');\r\n\t\tthis.rootAnchor.dataset.whtticon = 'false';\r\n\t\tthis.rootAnchor.dataset.disableWowheadTouchTooltip = 'true';\r\n\t\tthis.rootAnchor.target = '_blank';\r\n\t\tthis.rootElem.prepend(this.rootAnchor);\r\n\r\n\t\tconst useImprovedIcons = Boolean(this.config.improvedId);\r\n\t\tif (useImprovedIcons) {\r\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons');\r\n\t\t}\r\n\t\tif (this.config.improvedId2) {\r\n\t\t\tthis.rootAnchor.classList.add('use-improved-icons2');\r\n\t\t}\r\n\t\tif (!useImprovedIcons && this.config.states > 2) {\r\n\t\t\tthis.rootAnchor.classList.add('use-counter');\r\n\t\t}\r\n\r\n\t\tlet ia = ref<HTMLAnchorElement>();\r\n\t\tlet ia2 = ref<HTMLAnchorElement>();\r\n\t\tlet ce = ref<HTMLSpanElement>();\r\n\t\tthis.rootAnchor.appendChild(\r\n\t\t\t<div className='icon-input-level-container'>\r\n\t\t\t\t<a ref={ia} className=\"icon-picker-button icon-input-improved icon-input-improved1\" dataset={{disableWowheadTouchTooltip:'true'}}></a>\r\n\t\t\t\t<a ref={ia2} className=\"icon-picker-button icon-input-improved icon-input-improved2\" dataset={{disableWowheadTouchTooltip:'true'}}></a>\r\n\t\t\t\t<span ref={ce} className={`icon-picker-label ${this.config.states > 2 ? '' : 'hide'}`}></span>\r\n\t\t\t</div>\r\n\t\t);\r\n\r\n\t\tthis.improvedAnchor = ia.value!;\r\n\t\tthis.improvedAnchor2 = ia2.value!;\r\n\t\tthis.counterElem = ce.value!;\r\n\r\n\t\tthis.config.id.fillAndSet(this.rootAnchor, true, true);\r\n\r\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\r\n\t\t\tthis.config.improvedId.fillAndSet(this.improvedAnchor, true, true);\r\n\t\t}\r\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\r\n\t\t\tthis.config.improvedId2.fillAndSet(this.improvedAnchor2, true, true);\r\n\t\t}\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.rootAnchor.addEventListener('click', event => {\r\n\t\t\tthis.handleLeftClick(event);\r\n\t\t})\r\n\r\n\t\tthis.rootAnchor.addEventListener('contextmenu', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\t\tthis.rootAnchor.addEventListener('mousedown', event => {\r\n\t\t\tconst rightClick = isRightClick(event);\r\n\r\n\t\t\tif (rightClick) {\r\n\t\t\t\tthis.handleRightClick(event)\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleLeftClick = (event: UIEvent) => {\r\n\t\tif (this.config.states == 0 || (this.currentValue + 1) < this.config.states) {\r\n\t\t\tthis.currentValue++;\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t} else if (this.currentValue > 0) { // roll over\r\n\t\t\tthis.currentValue = 0;\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t}\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\thandleRightClick = (event: UIEvent) => {\r\n\t\tif (this.currentValue > 0) {\r\n\t\t\tthis.currentValue--;\r\n\t\t} else { // roll over\r\n\t\t\tif (this.config.states === 0) {\r\n\t\t\t\tthis.currentValue = 1\r\n\t\t\t} else {\r\n\t\t\t\tthis.currentValue = this.config.states - 1\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.rootAnchor;\r\n\t}\r\n\r\n\tgetInputValue(): ValueType {\r\n\t\tif (this.config.states == 2) {\r\n\t\t\treturn Boolean(this.currentValue) as unknown as ValueType;\r\n\t\t} else {\r\n\t\t\treturn this.currentValue as unknown as ValueType;\r\n\t\t}\r\n\t}\r\n\r\n\t// Returns the ActionId of the currently selected value, or null if none selected.\r\n\tgetActionId(): ActionId | null {\r\n\r\n\t\t// Go directly to source because during event propogation \r\n\t\t//  the internal `this.currentValue` may not yet have been updated.\r\n\t\tconst v = Number(this.config.getValue(this.modObject));\r\n\t\tif (v == 0) {\r\n\t\t\treturn null;\r\n\t\t} else if (v == 1) {\r\n\t\t\treturn this.config.id;\r\n\t\t} else if (v == 2 && this.config.improvedId) {\r\n\t\t\treturn this.config.improvedId;\r\n\t\t} else if (v == 3 && this.config.improvedId2) {\r\n\t\t\treturn this.config.improvedId2;\r\n\t\t} else {\r\n\t\t\treturn this.config.id;\r\n\t\t}\r\n\t}\r\n\r\n\tsetInputValue(newValue: ValueType) {\r\n\t\tthis.currentValue = Number(newValue);\r\n\r\n\t\tif (this.currentValue > 0) {\r\n\t\t\tthis.active = true;\r\n\t\t\tthis.rootAnchor.classList.add('active');\r\n\t\t\tthis.counterElem.classList.add('active');\r\n\t\t} else {\r\n\t\t\tthis.active = false;\r\n\t\t\tthis.rootAnchor.classList.remove('active');\r\n\t\t\tthis.counterElem.classList.remove('active');\r\n\t\t}\r\n\r\n\t\tif (this.config.states >= 3 && this.config.improvedId) {\r\n\t\t\tif (this.currentValue > 1) {\r\n\t\t\t\tthis.improvedAnchor.classList.add('active');\r\n\t\t\t} else {\r\n\t\t\t\tthis.improvedAnchor.classList.remove('active');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.config.states >= 4 && this.config.improvedId2) {\r\n\t\t\tif (this.currentValue > 2) {\r\n\t\t\t\tthis.improvedAnchor2.classList.add('active');\r\n\t\t\t\tthis.improvedAnchor.hidden = true;\r\n\t\t\t\tthis.improvedAnchor2.hidden = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis.improvedAnchor2.classList.remove('active');\r\n\t\t\t\tthis.improvedAnchor.hidden = false;\r\n\t\t\t\tthis.improvedAnchor2.hidden = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.config.improvedId && (this.config.states > 3 || this.config.states == 0)) {\r\n\t\t\tthis.counterElem.textContent = String(this.currentValue);\r\n\t\t}\r\n\t}\r\n}\r\n","import { ActionId } from '../proto_utils/action_id.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { SimUI } from '../sim_ui.js';\r\nimport { isRightClick } from '../utils.js';\r\n\r\nimport { Component } from './component.js';\r\nimport { IconPicker, IconPickerConfig } from './icon_picker.js';\r\nimport { Input, InputConfig } from './input.js';\r\n\r\nexport interface MultiIconPickerItemConfig<ModObject> extends IconPickerConfig<ModObject, any> {\r\n}\r\n\r\nexport interface MultiIconPickerConfig<ModObject> {\r\n\tinputs: Array<MultiIconPickerItemConfig<ModObject>>,\r\n\tnumColumns: number,\r\n\tlabel?: string,\r\n\tcategoryId?: ActionId,\r\n}\r\n\r\n// Icon-based UI for a dropdown with multiple icon pickers.\r\n// ModObject is the object being modified (Sim, Player, or Target).\r\nexport class MultiIconPicker<ModObject> extends Component {\r\n\tprivate readonly config: MultiIconPickerConfig<ModObject>;\r\n\r\n\tprivate currentValue: ActionId | null;\r\n\r\n\tprivate readonly dropdownRootElem: HTMLElement;\r\n\tprivate readonly buttonElem: HTMLAnchorElement;\r\n\tprivate readonly dropdownMenu: HTMLElement;\r\n\r\n\tprivate readonly pickers: Array<IconPicker<ModObject, any>>;\r\n\r\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: MultiIconPickerConfig<ModObject>, simUI: SimUI) {\r\n\t\tsuper(parent, 'multi-icon-picker-root');\r\n\t\tthis.rootElem.classList.add('icon-picker');\r\n\t\tthis.config = config;\r\n\t\tthis.currentValue = null;\r\n\r\n\t\tthis.rootElem.innerHTML = `\r\n\t\t\t<div class=\"dropend\">\r\n\t\t\t\t<a\r\n\t\t\t\t\tclass=\"icon-picker-button\"\r\n\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\tdata-bs-toggle=\"dropdown\"\r\n\t\t\t\t\taria-expanded=\"false\"\r\n\t\t\t\t\tdata-disable-wowhead-touch-tooltip='true'\r\n\t\t\t\t\tdata-whtticon='false'\r\n\t\t\t\t></a>\r\n\t\t\t\t<ul class=\"dropdown-menu\"></ul>\r\n\t\t\t</div>\r\n\t\t\t<label class=\"multi-icon-picker-label form-label\"></label>\r\n    `;\r\n\t\tthis.dropdownRootElem = this.rootElem.querySelector('.dropdown') as HTMLElement;\r\n\r\n\t\tconst labelElem = this.rootElem.querySelector('.multi-icon-picker-label') as HTMLElement;\r\n\t\tif (config.label) {\r\n\t\t\tlabelElem.textContent = config.label;\r\n\t\t} else {\r\n\t\t\tlabelElem.remove();\r\n\t\t}\r\n\r\n\t\tthis.buttonElem = this.rootElem.querySelector('.icon-picker-button') as HTMLAnchorElement;\r\n\t\tthis.dropdownMenu = this.rootElem.querySelector('.dropdown-menu') as HTMLElement;\r\n\r\n\t\tthis.buttonElem.addEventListener('hide.bs.dropdown', event => {\r\n\t\t\tif (event.hasOwnProperty('clickEvent'))\r\n\t\t\t\tevent.preventDefault();\r\n\t\t})\r\n\r\n\t\tthis.buttonElem.addEventListener('contextmenu', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\tthis.buttonElem.addEventListener('mousedown', event => {\r\n\t\t\tconst rightClick = isRightClick(event);\r\n\r\n\t\t\tif (rightClick) {\r\n\t\t\t\tthis.clearPicker();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.buildBlankOption();\r\n\r\n\t\tthis.pickers = config.inputs.map((pickerConfig, i) => {\r\n\t\t\tconst optionContainer = document.createElement('li');\r\n\t\t\toptionContainer.classList.add('icon-picker-option', 'dropdown-option');\r\n\t\t\tthis.dropdownMenu.appendChild(optionContainer);\r\n\r\n\t\t\treturn new IconPicker(optionContainer, modObj, pickerConfig);\r\n\t\t});\r\n\t\tsimUI.sim.waitForInit().then(() => this.updateButtonImage());\r\n\t\tsimUI.changeEmitter.on(() => this.updateButtonImage());\r\n\t}\r\n\r\n\tprivate buildBlankOption() {\r\n\t\tconst listItem = document.createElement('li');\r\n\t\tthis.dropdownMenu.appendChild(listItem);\r\n\r\n\t\tconst option = document.createElement('a');\r\n\t\toption.classList.add('icon-dropdown-option', 'dropdown-option');\r\n\t\tlistItem.appendChild(option);\r\n\r\n\t\toption.addEventListener('click', () => this.clearPicker());\r\n\t}\r\n\r\n\tprivate clearPicker() {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tthis.pickers.forEach((picker) => {\r\n\t\t\t\tpicker.setInputValue(null)\r\n\t\t\t\tpicker.inputChanged(TypedEvent.nextEventID());\r\n\t\t\t});\r\n\t\t\tthis.updateButtonImage();\r\n\t\t})\r\n\t}\r\n\r\n\tprivate updateButtonImage() {\r\n\t\tthis.currentValue = this.getMaxValue();\r\n\r\n\t\tif (this.currentValue) {\r\n\t\t\tthis.buttonElem.classList.add('active');\r\n\t\t\tif (this.config.categoryId != null) {\r\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\r\n\t\t\t} else {\r\n\t\t\t\tthis.currentValue.fillAndSet(this.buttonElem, false, true);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.buttonElem.classList.remove('active');\r\n\t\t\tif (this.config.categoryId != null) {\r\n\t\t\t\tthis.config.categoryId.fillAndSet(this.buttonElem, false, true);\r\n\t\t\t} else {\r\n\t\t\t\tthis.buttonElem.style.backgroundImage = '';\r\n\t\t\t}\r\n\t\t\tthis.buttonElem.removeAttribute(\"href\");\r\n\t\t}\r\n\t}\r\n\r\n\tprivate getMaxValue(): ActionId | null {\r\n\t\treturn this.pickers.map(picker => picker.getActionId()).filter(id => id != null)[0] || null;\r\n\t}\r\n}\r\n","import { Tooltip } from 'bootstrap';\r\nimport { ActionId } from '../proto_utils/action_id.js';\r\nimport { TypedEvent } from '../typed_event.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\nimport { element, fragment } from 'tsx-vanilla';\r\n\r\nexport interface IconEnumValueConfig<ModObject, T> {\r\n\tvalue: T,\r\n\t// One of these should be set. If actionId is set, shows the icon for that id. If\r\n\t// color is set, shows that color.\r\n\tactionId?: ActionId,\r\n\tcolor?: string,\r\n\t// Text to be displayed on the icon.\r\n\ttext?: string,\r\n\t// Hover tooltip.\r\n\ttooltip?: string,\r\n\r\n\tshowWhen?: (obj: ModObject) => boolean,\r\n}\r\n\r\nexport interface IconEnumPickerConfig<ModObject, T> extends InputConfig<ModObject, T> {\r\n\tnumColumns: number,\r\n\tvalues: Array<IconEnumValueConfig<ModObject, T>>;\r\n\t// Value that will be considered inactive.\r\n\tzeroValue: T,\r\n\t// Function for comparing two values.\r\n\t// Tooltip that will be shown whne hovering over the icon-picker-button\r\n\ttooltip?: string,\r\n\tequals: (a: T, b: T) => boolean,\r\n\tbackupIconUrl?: (value: T) => ActionId,\r\n\tshowWhen?: (obj: ModObject) => boolean,\r\n}\r\n\r\n// Icon-based UI for picking enum values.\r\n// ModObject is the object being modified (Sim, Player, or Target).\r\nexport class IconEnumPicker<ModObject, T> extends Input<ModObject, T> {\r\n\tprivate readonly config: IconEnumPickerConfig<ModObject, T>;\r\n\r\n\tprivate currentValue: T;\r\n\r\n\tprivate readonly buttonElem: HTMLAnchorElement;\r\n\tprivate readonly buttonText: HTMLElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObj: ModObject, config: IconEnumPickerConfig<ModObject, T>) {\r\n\t\tsuper(parent, 'icon-enum-picker-root', modObj, config);\r\n\t\tthis.rootElem.classList.add('icon-picker', 'dropdown');\r\n\t\tthis.config = config;\r\n\t\tthis.currentValue = this.config.zeroValue;\r\n\r\n\t\tif (config.showWhen) {\r\n\t\t\tconfig.changedEvent(this.modObject).on(eventID => {\r\n\t\t\t\tconst show = config.showWhen && config.showWhen(this.modObject);\r\n\t\t\t\tif (!show)\r\n\t\t\t\t\tthis.rootElem.classList.add('hide');\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (config.tooltip) {\r\n\t\t\tTooltip.getOrCreateInstance(this.rootElem, {\r\n\t\t\t\thtml: true,\r\n\t\t\t\ttitle: config.tooltip\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.rootElem.appendChild(\r\n\t\t\t<>\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\t\tclassName=\"icon-picker-button\"\r\n\t\t\t\t\tattributes={{\r\n\t\t\t\t\t\t'aria-expanded':\"false\",\r\n\t\t\t\t\t\trole: 'button'\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tdataset={{\r\n\t\t\t\t\t\tbsToggle: 'dropdown',\r\n\t\t\t\t\t\tbsPlacement: 'bottom',\r\n\t\t\t\t\t\twhtticon:\"false\",\r\n\t\t\t\t\t\tdisableWowheadTouchTooltip:'true'\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<span className='icon-picker-label'></span>\r\n\t\t\t\t</a>\r\n\t\t\t\t<ul className=\"dropdown-menu\"></ul>\r\n\t\t\t</>\r\n\t\t)\r\n\r\n\t\tthis.buttonElem = this.rootElem.querySelector('.icon-picker-button') as HTMLAnchorElement;\r\n\t\tthis.buttonText = this.buttonElem.querySelector('.icon-picker-label') as HTMLElement;\r\n\t\tconst dropdownMenu = this.rootElem.querySelector('.dropdown-menu') as HTMLElement;\r\n\r\n\t\tdropdownMenu.style.gridTemplateColumns = `repeat(${this.config.numColumns}, 1fr)`;\r\n\r\n\t\tconfig.values.forEach((valueConfig, i) => {\r\n\t\t\tconst optionContainer = document.createElement('li');\r\n\t\t\toptionContainer.classList.add('icon-dropdown-option', 'dropdown-option')\r\n\t\t\tdropdownMenu.appendChild(optionContainer);\r\n\r\n\t\t\tconst option = document.createElement('a');\r\n\t\t\toption.classList.add('icon-picker-button');\r\n\t\t\toption.dataset.disableWowheadTouchTooltip='true';\r\n\t\t\toptionContainer.appendChild(option);\r\n\t\t\tthis.setImage(option, valueConfig);\r\n\r\n\t\t\tif (valueConfig.text != undefined) {\r\n\t\t\t\tconst optionText = document.createElement('div');\r\n\t\t\t\toptionText.classList.add(\"icon-picker-label\");\r\n\t\t\t\toptionText.textContent = valueConfig.text;\r\n\t\t\t\toption.append(optionText);\r\n\t\t\t}\r\n\r\n\t\t\tif (valueConfig.tooltip) {\r\n\t\t\t\tTooltip.getOrCreateInstance(option, {\r\n\t\t\t\t\thtml: true,\r\n\t\t\t\t\ttitle: valueConfig.tooltip\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (valueConfig.showWhen) {\r\n\t\t\t\tconfig.changedEvent(this.modObject).on(eventID => {\r\n\t\t\t\t\tconst show = valueConfig.showWhen && valueConfig.showWhen(this.modObject);\r\n\t\t\t\t\tif (show)\r\n\t\t\t\t\t\toptionContainer.classList.remove('hide');\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toptionContainer.classList.add('hide');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\toption.addEventListener('click', event => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tthis.currentValue = valueConfig.value;\r\n\t\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tprivate setActionImage(elem: HTMLAnchorElement, actionId: ActionId) {\r\n\t\tactionId.fillAndSet(elem, true, true);\r\n\t}\r\n\r\n\tprivate setImage(elem: HTMLAnchorElement, valueConfig: IconEnumValueConfig<ModObject, T>) {\r\n\t\tif (valueConfig.actionId) {\r\n\t\t\tthis.setActionImage(elem, valueConfig.actionId);\r\n\t\t} else {\r\n\t\t\telem.style.backgroundImage = '';\r\n\t\t\telem.style.backgroundColor = valueConfig.color!;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tsuper.update();\r\n\t\tthis.setActive(this.enabled && !this.config.equals(this.currentValue, this.config.zeroValue));\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.buttonElem;\r\n\t}\r\n\r\n\tgetInputValue(): T {\r\n\t\treturn this.currentValue;\r\n\t}\r\n\r\n\tsetInputValue(newValue: T) {\r\n\t\tthis.currentValue = newValue;\r\n\t\tthis.setActive(this.enabled && !this.config.equals(this.currentValue, this.config.zeroValue))\r\n\r\n\t\tthis.buttonText.textContent = ''\r\n\t\tthis.buttonText.style.display = 'none'\r\n\r\n\t\tconst valueConfig = this.config.values.find(valueConfig => this.config.equals(valueConfig.value, this.currentValue))!;\r\n\t\tif (valueConfig) {\r\n\t\t\tthis.setImage(this.buttonElem, valueConfig);\r\n\t\t\tif (valueConfig.text != undefined) {\r\n\t\t\t\tthis.buttonText.style.display = 'block'\r\n\t\t\t\tthis.buttonText.textContent = valueConfig.text\r\n\t\t\t}\r\n\t\t} else if (this.config.backupIconUrl) {\r\n\t\t\tconst backupId = this.config.backupIconUrl(this.currentValue);\r\n\t\t\tthis.setActionImage(this.buttonElem, backupId);\r\n\t\t\tthis.setActive(false);\r\n\t\t}\r\n\t}\r\n\r\n\tsetActive(active: boolean) {\r\n\t\tif (active)\r\n\t\t\tthis.buttonElem.classList.add('active');\r\n\t\telse\r\n\t\t\tthis.buttonElem.classList.remove('active');\r\n\t}\r\n}\r\n","import { Spec } from '../../proto/common.js';\r\nimport { CustomRotation, CustomSpell } from '../../proto/common.js';\r\nimport { EventID } from '../../typed_event.js';\r\nimport { Player } from '../../player.js';\r\nimport { IconEnumPicker, IconEnumValueConfig } from '../icon_enum_picker.js';\r\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\r\nimport { NumberPicker } from '../number_picker.js';\r\n\r\nimport { Component } from '../component.js';\r\nimport { Input } from '../input.js';\r\nimport { SimUI } from 'ui/core/sim_ui.js';\r\n\r\nexport interface CustomRotationPickerConfig<SpecType extends Spec, T> {\r\n\tgetValue: (player: Player<SpecType>) => CustomRotation,\r\n\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => void,\r\n\r\n\tnumColumns: number,\r\n\textraCssClasses?: string[];\r\n\tshowCastsPerMinute?: boolean,\r\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\r\n\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n}\r\n\r\nexport class CustomRotationPicker<SpecType extends Spec, T> extends Component {\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, modPlayer: Player<SpecType>, config: CustomRotationPickerConfig<SpecType, T>) {\r\n\t\tsuper(parent, 'custom-rotation-picker-root');\r\n\r\n\t\tif (config.extraCssClasses)\r\n\t\t\tthis.rootElem.classList.add(...config.extraCssClasses);\r\n\r\n\t\tnew ListPicker<Player<SpecType>, CustomSpell>(this.rootElem, modPlayer, {\r\n\t\t\textraCssClasses: ['custom-spells-picker'],\r\n\t\t\ttitle: 'Spell Priority',\r\n\t\t\ttitleTooltip: 'Spells at the top of the list are prioritized first. Safely ignores untalented options.',\r\n\t\t\titemLabel: 'Spell',\r\n\t\t\tchangedEvent: (player: Player<SpecType>) => player.changeEmitter,\r\n\t\t\tgetValue: (player: Player<SpecType>) => config.getValue(player).spells,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: Array<CustomSpell>) => {\r\n\t\t\t\tconfig.setValue(eventID, player, CustomRotation.create({\r\n\t\t\t\t\tspells: newValue,\r\n\t\t\t\t}));\r\n\t\t\t},\r\n\t\t\tnewItem: () => CustomSpell.create(),\r\n\t\t\tcopyItem: (oldItem: CustomSpell) => CustomSpell.clone(oldItem),\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<SpecType>, CustomSpell>, index: number, itemConfig: ListItemPickerConfig<Player<SpecType>, CustomSpell>) => new CustomSpellPicker(parent, modPlayer, index, itemConfig, listPicker, config),\r\n\t\t\tinlineMenuBar: true,\r\n\t\t\tshowWhen: config.showWhen,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nclass CustomSpellPicker<SpecType extends Spec, T> extends Input<Player<SpecType>, CustomSpell> {\r\n\tprivate readonly player: Player<SpecType>;\r\n\tprivate readonly listPicker: ListPicker<Player<SpecType>, CustomSpell>;\r\n\tprivate readonly spellIndex: number;\r\n\r\n\tprivate readonly spellPicker: Input<null, number>;\r\n\tprivate readonly cpmPicker: Input<null, number> | null;\r\n\r\n\tgetSpell(): CustomSpell {\r\n\t\treturn this.listPicker.config.getValue(this.player)[this.spellIndex] || CustomSpell.create();\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<SpecType>, spellIndex: number, config: ListItemPickerConfig<Player<SpecType>, CustomSpell>, listPicker: ListPicker<Player<SpecType>, CustomSpell>, crConfig: CustomRotationPickerConfig<SpecType, T>) {\r\n\t\tsuper(parent, 'custom-spell-picker-root', player, config);\r\n\t\tthis.player = player;\r\n\t\tthis.listPicker = listPicker;\r\n\t\tthis.spellIndex = spellIndex;\r\n\r\n\t\tthis.spellPicker = new IconEnumPicker<null, number>(this.rootElem, null, {\r\n\t\t\tnumColumns: crConfig.numColumns,\r\n\t\t\tvalues: crConfig.values.map(value => {\r\n\t\t\t\tif (value.showWhen) {\r\n\t\t\t\t\tconst oldShowWhen = value.showWhen;\r\n\t\t\t\t\tvalue.showWhen = (() => oldShowWhen(player)) as unknown as ((player: Player<SpecType>) => boolean);\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}) as unknown as Array<IconEnumValueConfig<null, number>>,\r\n\t\t\tequals: (a: number, b: number) => a == b,\r\n\t\t\tzeroValue: 0,\r\n\t\t\tchangedEvent: () => player.changeEmitter,\r\n\t\t\tgetValue: () => this.getSpell().spell,\r\n\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\tconst spell = this.getSpell();\r\n\t\t\t\tspell.spell = newValue;\r\n\t\t\t\tthis.setSpell(eventID, spell);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.cpmPicker = null;\r\n\t\tif (crConfig.showCastsPerMinute) {\r\n\t\t\tthis.cpmPicker = new NumberPicker<null>(this.rootElem, null, {\r\n\t\t\t\tlabel: 'CPM',\r\n\t\t\t\tlabelTooltip: 'Desired Casts-Per-Minute for this spell.',\r\n\t\t\t\tfloat: true,\r\n\t\t\t\tpositive: true,\r\n\t\t\t\tchangedEvent: () => player.changeEmitter,\r\n\t\t\t\tgetValue: () => this.getSpell().castsPerMinute,\r\n\t\t\t\tsetValue: (eventID: EventID, _: null, newValue: number) => {\r\n\t\t\t\t\tconst spell = this.getSpell();\r\n\t\t\t\t\tspell.castsPerMinute = newValue;\r\n\t\t\t\t\tthis.setSpell(eventID, spell);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): CustomSpell {\r\n\t\treturn CustomSpell.create({\r\n\t\t\tspell: this.spellPicker.getInputValue(),\r\n\t\t\tcastsPerMinute: this.cpmPicker?.getInputValue(),\r\n\t\t});\r\n\t}\r\n\r\n\tsetInputValue(newValue: CustomSpell) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.spellPicker.setInputValue(newValue.spell);\r\n\t\tif (this.cpmPicker) {\r\n\t\t\tthis.cpmPicker.setInputValue(newValue.castsPerMinute);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setSpell(eventID: EventID, spell: CustomSpell) {\r\n\t\tconst customSpells = this.listPicker.config.getValue(this.player);\r\n\t\tcustomSpells[this.spellIndex] = CustomSpell.clone(spell);\r\n\t\tthis.listPicker.config.setValue(eventID, this.player, customSpells);\r\n\t}\r\n}\r\n","import { EventID, TypedEvent } from '../typed_event.js';\r\nimport { arrayEquals } from '../utils.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\n/**\r\n * Data for creating a number list picker.\r\n */\r\nexport interface NumberListPickerConfig<ModObject> extends InputConfig<ModObject, Array<number>> {\r\n\tplaceholder?: string,\r\n}\r\n\r\n// UI element for picking an arbitrary number list field.\r\nexport class NumberListPicker<ModObject> extends Input<ModObject, Array<number>> {\r\n\tprivate readonly inputElem: HTMLInputElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: NumberListPickerConfig<ModObject>) {\r\n\t\tsuper(parent, 'number-list-picker-root', modObject, config);\r\n\r\n\t\tthis.inputElem = document.createElement('input');\r\n\t\tthis.inputElem.type = 'text';\r\n\t\tthis.inputElem.placeholder = config.placeholder || '';\r\n\t\tthis.inputElem.classList.add('number-list-picker-input', 'form-control');\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('change', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): Array<number> {\r\n\t\tconst str = this.inputElem.value;\r\n\t\tif (!str) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\treturn str.split(',').map(parseFloat).filter(val => !isNaN(val));\r\n\t}\r\n\r\n\tsetInputValue(newValue: Array<number>) {\r\n\t\tif (arrayEquals(this.getInputValue(), newValue)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.inputElem.value = newValue.map(v => String(v)).join(',');\r\n\t}\r\n}\r\n","import { Component } from '../component.js';\r\nimport { IconEnumPicker, IconEnumValueConfig } from '../icon_enum_picker.js';\r\nimport { NumberListPicker } from '../number_list_picker.js';\r\nimport { Player } from '../../player.js';\r\nimport { EventID, TypedEvent } from '../../typed_event.js';\r\nimport { ActionID as ActionIdProto, ItemSlot } from '../../proto/common.js';\r\nimport { Cooldown } from '../../proto/common.js';\r\nimport { ActionId } from '../../proto_utils/action_id.js';\r\nimport { Tooltip } from 'bootstrap';\r\nimport { NumberPicker } from '../number_picker.js';\r\nimport { Sim } from 'ui/core/sim.js';\r\n\r\nexport class CooldownsPicker extends Component {\r\n\treadonly player: Player<any>;\r\n\r\n\tprivate cooldownPickers: Array<HTMLElement>;\r\n\r\n\tconstructor(parentElem: HTMLElement, player: Player<any>) {\r\n\t\tsuper(parentElem, 'cooldowns-picker-root');\r\n\t\tthis.player = player;\r\n\t\tthis.cooldownPickers = [];\r\n\r\n\t\tTypedEvent.onAny([this.player.cooldownsChangeEmitter, this.player.sim.unitMetadataEmitter]).on(eventID => {\r\n\t\t\tthis.update();\r\n\t\t});\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tprivate update() {\r\n\t\tthis.rootElem.innerHTML = '';\r\n\t\tconst cooldowns = this.player.getCooldowns().cooldowns;\r\n\r\n\t\tthis.cooldownPickers = [];\r\n\t\tfor (let i = 0; i < cooldowns.length + 1; i++) {\r\n\t\t\tconst cooldown = cooldowns[i];\r\n\r\n\t\t\tconst row = document.createElement('div');\r\n\t\t\trow.classList.add('cooldown-picker');\r\n\t\t\tif (i == cooldowns.length) {\r\n\t\t\t\trow.classList.add('add-cooldown-picker');\r\n\t\t\t}\r\n\t\t\tthis.rootElem.appendChild(row);\r\n\r\n\t\t\tconst actionPicker = this.makeActionPicker(row, i);\r\n\r\n\t\t\tconst label = document.createElement('label');\r\n\t\t\tlabel.classList.add('cooldown-picker-label', 'form-label');\r\n\t\t\tif (cooldown && cooldown.id) {\r\n\t\t\t\tActionId.fromProto(cooldown.id).fill(this.player.getRaidIndex()).then(filledId => label.textContent = filledId.name);\r\n\t\t\t}\r\n\t\t\trow.appendChild(label);\r\n\r\n\t\t\tconst timingsPicker = this.makeTimingsPicker(row, i);\r\n\r\n\t\t\tlet deleteButtonFragment = document.createElement('fragment');\r\n\t\t\tdeleteButtonFragment.innerHTML = `\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\t\tclass=\"delete-cooldown link-danger\"\r\n\t\t\t\t\trole=\"button\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<i class=\"fa fa-times fa-xl\"></i>\r\n\t\t\t\t</a>\r\n\t\t\t`\r\n\t\t\tconst deleteButton = deleteButtonFragment.children[0] as HTMLElement;\r\n\t\t\tconst deleteButtonTooltip = Tooltip.getOrCreateInstance(deleteButton, {title: 'Delete Cooldown'});\r\n\t\t\tdeleteButton.addEventListener('click', event => {\r\n\t\t\t\tconst newCooldowns = this.player.getCooldowns();\r\n\t\t\t\tnewCooldowns.cooldowns.splice(i, 1);\r\n\t\t\t\tthis.player.setCooldowns(TypedEvent.nextEventID(), newCooldowns);\r\n\t\t\t\tdeleteButtonTooltip.hide();\r\n\t\t\t});\r\n\t\t\trow.appendChild(deleteButton);\r\n\r\n\t\t\tthis.cooldownPickers.push(row);\r\n\t\t}\r\n\r\n\t\tthis.addTrinketDesyncPicker(ItemSlot.ItemSlotTrinket1);\r\n\t\tthis.addTrinketDesyncPicker(ItemSlot.ItemSlotTrinket2);\r\n\t}\r\n\r\n\tprivate addTrinketDesyncPicker(slot: ItemSlot) {\r\n\t\tconst index = slot - ItemSlot.ItemSlotTrinket1 + 1;\r\n\t\tconst picker = new NumberPicker(this.rootElem, this.player.sim, {\r\n\t\t\tlabel: `Desync Proc Trinket ${index}`,\r\n\t\t\tlabelTooltip: ' Put the trinket on a cooldown before pull by re-equipping it. Must be between 0 and 30 seconds.',\r\n\t\t\textraCssClasses: [\r\n\t\t\t\t'within-raid-sim-hide',\r\n\t\t\t],\r\n\t\t\tinline: true,\r\n\t\t\tchangedEvent: (_: Sim) => this.player.cooldownsChangeEmitter,\r\n\t\t\tgetValue: (_: Sim) => {\r\n\t\t\t\tconst cooldowns = this.player.getCooldowns();\r\n\t\t\t\treturn (slot == ItemSlot.ItemSlotTrinket1) ? cooldowns.desyncProcTrinket1Seconds : cooldowns.desyncProcTrinket2Seconds;\r\n\t\t\t},\r\n\t\t\tsetValue: (eventID: EventID, _: Sim, newValue: number) => {\r\n\t\t\t\tif (newValue >= 0) {\r\n\t\t\t\t\tconst newCooldowns = this.player.getCooldowns();\r\n\t\t\t\t\tif (slot == ItemSlot.ItemSlotTrinket1) {\r\n\t\t\t\t\t\tnewCooldowns.desyncProcTrinket1Seconds = newValue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewCooldowns.desyncProcTrinket2Seconds = newValue\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.player.setCooldowns(eventID, newCooldowns);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tenableWhen: (sim: Sim) => {\r\n\t\t\t\t// TODO(Riotdog-GehennasEU): Only show if the slot is non-empty and the\r\n\t\t\t\t// trinket has a proc effect?\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconst pickerInput = picker.rootElem.querySelector('.number-picker-input') as HTMLInputElement;\r\n\t\tpickerInput.type = 'number';\r\n\t\tpickerInput.min = \"0\";\r\n\r\n\t\tconst validator = () => {\r\n\t\t\tif (!pickerInput.checkValidity()) {\r\n\t\t\t\tpickerInput.reportValidity();\r\n\t\t\t}\r\n\t\t};\r\n\t\tpickerInput.addEventListener('change', validator);\r\n\t\tpickerInput.addEventListener('focusout', validator);\r\n\t}\r\n\r\n\tprivate makeActionPicker(parentElem: HTMLElement, cooldownIndex: number): IconEnumPicker<Player<any>, ActionIdProto> {\r\n\t\tconst availableCooldowns = this.player.getMetadata().getSpells().filter(spell => spell.data.isMajorCooldown).map(spell => spell.id);\r\n\r\n\t\tconst actionPicker = new IconEnumPicker<Player<any>, ActionIdProto>(parentElem, this.player, {\r\n\t\t\textraCssClasses: [\r\n\t\t\t\t'cooldown-action-picker',\r\n\t\t\t],\r\n\t\t\tnumColumns: 3,\r\n\t\t\tvalues: ([\r\n\t\t\t\t{ color: '#grey', value: ActionIdProto.create() },\r\n\t\t\t] as Array<IconEnumValueConfig<Player<any>, ActionIdProto>>).concat(availableCooldowns.map(cooldownAction => {\r\n\t\t\t\treturn { actionId: cooldownAction, value: cooldownAction.toProto() };\r\n\t\t\t})),\r\n\t\t\tequals: (a: ActionIdProto, b: ActionIdProto) => ActionIdProto.equals(a, b),\r\n\t\t\tzeroValue: ActionIdProto.create(),\r\n\t\t\tbackupIconUrl: (value: ActionIdProto) => ActionId.fromProto(value),\r\n\t\t\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.getCooldowns().cooldowns[cooldownIndex]?.id || ActionIdProto.create(),\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: ActionIdProto) => {\r\n\t\t\t\tconst newCooldowns = player.getCooldowns();\r\n\r\n\t\t\t\twhile (newCooldowns.cooldowns.length < cooldownIndex) {\r\n\t\t\t\t\tnewCooldowns.cooldowns.push(Cooldown.create());\r\n\t\t\t\t}\r\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex] = Cooldown.create({\r\n\t\t\t\t\tid: newValue,\r\n\t\t\t\t\ttimings: [],\r\n\t\t\t\t});\r\n\r\n\t\t\t\tplayer.setCooldowns(eventID, newCooldowns);\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn actionPicker;\r\n\t}\r\n\r\n\tprivate makeTimingsPicker(parentElem: HTMLElement, cooldownIndex: number): NumberListPicker<Player<any>> {\r\n\t\tconst actionPicker = new NumberListPicker(parentElem, this.player, {\r\n\t\t\textraCssClasses: [\r\n\t\t\t\t'cooldown-timings-picker',\r\n\t\t\t],\r\n\t\t\tplaceholder: '20, 40, ...',\r\n\t\t\tchangedEvent: (player: Player<any>) => player.cooldownsChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => {\r\n\t\t\t\treturn player.getCooldowns().cooldowns[cooldownIndex]?.timings || [];\r\n\t\t\t},\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<number>) => {\r\n\t\t\t\tconst newCooldowns = player.getCooldowns();\r\n\t\t\t\tnewCooldowns.cooldowns[cooldownIndex].timings = newValue;\r\n\t\t\t\tplayer.setCooldowns(eventID, newCooldowns);\r\n\t\t\t},\r\n\t\t\tenableWhen: (player: Player<any>) => {\r\n\t\t\t\tconst curCooldown = player.getCooldowns().cooldowns[cooldownIndex];\r\n\t\t\t\treturn curCooldown && !ActionIdProto.equals(curCooldown.id, ActionIdProto.create());\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn actionPicker;\r\n\t}\r\n}\r\n","import { ActionId } from '../proto_utils/action_id.js';\r\nimport { CustomRotation, ItemSwap, ItemSlot } from '../proto/common.js';\r\nimport { Spec } from '../proto/common.js';\r\nimport { Player } from '../player.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { SpecOptions, SpecRotation } from '../proto_utils/utils.js';\r\nimport { ItemSwapPickerConfig } from './item_swap_picker.js'\r\nimport { CustomRotationPickerConfig } from './individual_sim_ui/custom_rotation_picker.js';\r\nimport { IconPickerConfig } from './icon_picker.js';\r\nimport { IconEnumPicker, IconEnumPickerConfig, IconEnumValueConfig } from './icon_enum_picker.js';\r\nimport { EnumPickerConfig, EnumValueConfig } from './enum_picker.js';\r\nimport { BooleanPickerConfig } from './boolean_picker.js';\r\nimport { NumberPickerConfig } from './number_picker.js';\r\nimport { MultiIconPickerConfig } from './multi_icon_picker.js';\r\n\r\nexport function makeMultiIconInput<ModObject>(inputs: Array<IconPickerConfig<ModObject, any>>, label: string, numColumns?: number): MultiIconPickerConfig<ModObject> {\r\n\treturn {\r\n\t\tinputs: inputs,\r\n\t\tnumColumns: numColumns || 1,\r\n\t\tlabel: label,\r\n\t};\r\n}\r\n\r\n// Extend this to add player callbacks as optional config fields.\r\ninterface BasePlayerConfig<SpecType extends Spec, T> {\r\n\tgetValue?: (player: Player<SpecType>) => T,\r\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newVal: T) => void,\r\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\r\n\textraCssClasses?: Array<string>,\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////\r\n//                                    BOOLEAN\r\n/////////////////////////////////////////////////////////////////////////////////\r\nexport interface TypedBooleanPickerConfig<ModObject> extends BooleanPickerConfig<ModObject> {\r\n\ttype: 'boolean',\r\n}\r\n\r\ninterface WrappedBooleanInputConfig<SpecType extends Spec, ModObject> extends BooleanPickerConfig<ModObject> {\r\n\tgetModObject: (player: Player<SpecType>) => ModObject,\r\n}\r\nfunction makeWrappedBooleanInput<SpecType extends Spec, ModObject>(config: WrappedBooleanInputConfig<SpecType, ModObject>): TypedBooleanPickerConfig<Player<SpecType>> {\r\n\tconst getModObject = config.getModObject;\r\n\treturn {\r\n\t\ttype: 'boolean',\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\r\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: boolean) => config.setValue(eventID, getModObject(player), newValue),\r\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\r\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t}\r\n}\r\nexport interface PlayerBooleanInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, boolean> {\r\n\tfieldName: keyof Message,\r\n\tlabel: string,\r\n\tlabelTooltip?: string,\r\n\tenableWhen?: (player: Player<SpecType>) => boolean,\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n}\r\nexport function makeSpecOptionsBooleanInput<SpecType extends Spec>(config: PlayerBooleanInputConfig<SpecType, SpecOptions<SpecType>>): TypedBooleanPickerConfig<Player<SpecType>> {\r\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as boolean),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\r\n\t\t\tconst newMessage = player.getSpecOptions();\r\n\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\r\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t});\r\n}\r\nexport function makeRotationBooleanInput<SpecType extends Spec>(config: PlayerBooleanInputConfig<SpecType, SpecRotation<SpecType>>): TypedBooleanPickerConfig<Player<SpecType>> {\r\n\treturn makeWrappedBooleanInput<SpecType, Player<SpecType>>({\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as boolean),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: boolean) => {\r\n\t\t\tconst newMessage = player.getRotation();\r\n\t\t\t(newMessage[config.fieldName] as unknown as boolean) = newVal;\r\n\t\t\tplayer.setRotation(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t});\r\n}\r\n\r\n/////////////////////////////////////////////////////////////////////////////////\r\n//                                    NUMBER\r\n/////////////////////////////////////////////////////////////////////////////////\r\nexport interface TypedNumberPickerConfig<ModObject> extends NumberPickerConfig<ModObject> {\r\n\ttype: 'number',\r\n}\r\n\r\ninterface WrappedNumberInputConfig<SpecType extends Spec, ModObject> extends NumberPickerConfig<ModObject> {\r\n\tgetModObject: (player: Player<SpecType>) => ModObject,\r\n}\r\nfunction makeWrappedNumberInput<SpecType extends Spec, ModObject>(config: WrappedNumberInputConfig<SpecType, ModObject>): TypedNumberPickerConfig<Player<SpecType>> {\r\n\tconst getModObject = config.getModObject;\r\n\treturn {\r\n\t\ttype: 'number',\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tfloat: config.float,\r\n\t\tpositive: config.positive,\r\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\r\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\r\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\r\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t}\r\n}\r\nexport interface PlayerNumberInputConfig<SpecType extends Spec, Message> extends BasePlayerConfig<SpecType, number> {\r\n\tfieldName: keyof Message,\r\n\tlabel: string,\r\n\tlabelTooltip?: string,\r\n\tpercent?: boolean,\r\n\tfloat?: boolean,\r\n\tpositive?: boolean,\r\n\tenableWhen?: (player: Player<SpecType>) => boolean,\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\r\n}\r\nexport function makeSpecOptionsNumberInput<SpecType extends Spec>(config: PlayerNumberInputConfig<SpecType, SpecOptions<SpecType>>): TypedNumberPickerConfig<Player<SpecType>> {\r\n\tconst internalConfig = {\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tfloat: config.float,\r\n\t\tpositive: config.positive,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\r\n\t\t\tconst newMessage = player.getSpecOptions();\r\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\r\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t};\r\n\tif (config.percent) {\r\n\t\tconst getValue = internalConfig.getValue;\r\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\r\n\t\tconst setValue = internalConfig.setValue;\r\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\r\n\t}\r\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\r\n}\r\nexport function makeRotationNumberInput<SpecType extends Spec>(config: PlayerNumberInputConfig<SpecType, SpecRotation<SpecType>>): TypedNumberPickerConfig<Player<SpecType>> {\r\n\tconst internalConfig = {\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tfloat: config.float,\r\n\t\tpositive: config.positive,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as number),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\r\n\t\t\tconst newMessage = player.getRotation();\r\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\r\n\t\t\tplayer.setRotation(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t};\r\n\tif (config.percent) {\r\n\t\tconst getValue = internalConfig.getValue;\r\n\t\tinternalConfig.getValue = (player: Player<SpecType>) => getValue(player) * 100;\r\n\t\tconst setValue = internalConfig.setValue;\r\n\t\tinternalConfig.setValue = (eventID: EventID, player: Player<SpecType>, newVal: number) => setValue(eventID, player, newVal / 100);\r\n\t}\r\n\treturn makeWrappedNumberInput<SpecType, Player<SpecType>>(internalConfig);\r\n}\r\n\r\n\r\n/////////////////////////////////////////////////////////////////////////////////\r\n//                                    ENUM\r\n/////////////////////////////////////////////////////////////////////////////////\r\nexport interface TypedEnumPickerConfig<ModObject> extends EnumPickerConfig<ModObject> {\r\n\ttype: 'enum',\r\n}\r\n\r\ninterface WrappedEnumInputConfig<SpecType extends Spec, ModObject> extends EnumPickerConfig<ModObject> {\r\n\tgetModObject: (player: Player<SpecType>) => ModObject,\r\n}\r\nfunction makeWrappedEnumInput<SpecType extends Spec, ModObject>(config: WrappedEnumInputConfig<SpecType, ModObject>): TypedEnumPickerConfig<Player<SpecType>> {\r\n\tconst getModObject = config.getModObject;\r\n\treturn {\r\n\t\ttype: 'enum',\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tvalues: config.values,\r\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\r\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: number) => config.setValue(eventID, getModObject(player), newValue),\r\n\t\tenableWhen: config.enableWhen ? (player: Player<SpecType>) => config.enableWhen!(getModObject(player)) : undefined,\r\n\t\tshowWhen: config.showWhen ? (player: Player<SpecType>) => config.showWhen!(getModObject(player)) : undefined,\r\n\t}\r\n}\r\n\r\nexport interface PlayerEnumInputConfig<SpecType extends Spec, Message> {\r\n\tfieldName: keyof Message,\r\n\tlabel: string,\r\n\tlabelTooltip?: string,\r\n\tvalues: Array<EnumValueConfig>;\r\n\tgetValue?: (player: Player<SpecType>) => number,\r\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: number) => void,\r\n\tenableWhen?: (player: Player<SpecType>) => boolean,\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n\tchangeEmitter?: (player: Player<SpecType>) => TypedEvent<any>,\r\n}\r\n// T is unused, but kept to have the same interface as the icon enum inputs.\r\nexport function makeSpecOptionsEnumInput<SpecType extends Spec, T>(config: PlayerEnumInputConfig<SpecType, SpecOptions<SpecType>>): TypedEnumPickerConfig<Player<SpecType>> {\r\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tvalues: config.values,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as number),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\r\n\t\t\tconst newMessage = player.getSpecOptions();\r\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\r\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t});\r\n}\r\n// T is unused, but kept to have the same interface as the icon enum inputs.\r\nexport function makeRotationEnumInput<SpecType extends Spec, T>(config: PlayerEnumInputConfig<SpecType, SpecRotation<SpecType>>): TypedEnumPickerConfig<Player<SpecType>> {\r\n\treturn makeWrappedEnumInput<SpecType, Player<SpecType>>({\r\n\t\tlabel: config.label,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tvalues: config.values,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as number),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: number) => {\r\n\t\t\tconst newMessage = player.getRotation();\r\n\t\t\t(newMessage[config.fieldName] as unknown as number) = newVal;\r\n\t\t\tplayer.setRotation(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\r\n\t\tenableWhen: config.enableWhen,\r\n\t\tshowWhen: config.showWhen,\r\n\t});\r\n}\r\n\r\n\r\n/////////////////////////////////////////////////////////////////////////////////\r\n//                                  ICON\r\n/////////////////////////////////////////////////////////////////////////////////\r\nexport interface TypedIconPickerConfig<ModObject, T> extends IconPickerConfig<ModObject, T> {\r\n\ttype: 'icon',\r\n}\r\n\r\ninterface WrappedIconInputConfig<SpecType extends Spec, ModObject, T> extends IconPickerConfig<ModObject, T> {\r\n\tgetModObject: (player: Player<SpecType>) => ModObject,\r\n}\r\nfunction makeWrappedIconInput<SpecType extends Spec, ModObject, T>(config: WrappedIconInputConfig<SpecType, ModObject, T>): TypedIconPickerConfig<Player<SpecType>, T> {\r\n\tconst getModObject = config.getModObject;\r\n\treturn {\r\n\t\ttype: 'icon',\r\n\t\tid: config.id,\r\n\t\tstates: config.states,\r\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\r\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t}\r\n}\r\n\r\ninterface WrappedTypedInputConfig<Message, ModObject, T> {\r\n\tgetModObject: (player: Player<any>) => ModObject,\r\n\tgetValue: (modObj: ModObject) => Message,\r\n\tsetValue: (eventID: EventID, modObj: ModObject, messageVal: Message) => void,\r\n\tchangeEmitter: (modObj: ModObject) => TypedEvent<any>,\r\n\textraCssClasses?: Array<string>,\r\n\r\n\tgetFieldValue?: (modObj: ModObject) => T,\r\n\tsetFieldValue?: (eventID: EventID, modObj: ModObject, newValue: T) => void,\r\n}\r\n\r\nexport function makeBooleanIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, boolean>, id: ActionId, fieldName: keyof Message, value?: number): TypedIconPickerConfig<Player<SpecType>, boolean> {\r\n\treturn makeWrappedIconInput<SpecType, ModObject, boolean>({\r\n\t\tgetModObject: config.getModObject,\r\n\t\tid: id,\r\n\t\tstates: 2,\r\n\t\tchangedEvent: config.changeEmitter,\r\n\t\tgetValue: config.getFieldValue || ((modObj: ModObject) => value ? (config.getValue(modObj)[fieldName] as unknown as number) == value : (config.getValue(modObj)[fieldName] as unknown as boolean)),\r\n\t\tsetValue: config.setFieldValue || ((eventID: EventID, modObj: ModObject, newValue: boolean) => {\r\n\t\t\tconst newMessage = config.getValue(modObj);\r\n\t\t\tif (value) {\r\n\t\t\t\tif (newValue) {\r\n\t\t\t\t\t(newMessage[fieldName] as unknown as number) = value;\r\n\t\t\t\t} else if ((newMessage[fieldName] as unknown as number) == value) {\r\n\t\t\t\t\t(newMessage[fieldName] as unknown as number) = 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t(newMessage[fieldName] as unknown as boolean) = newValue;\r\n\t\t\t}\r\n\t\t\tconfig.setValue(eventID, modObj, newMessage);\r\n\t\t}),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t});\r\n}\r\n\r\nexport interface PlayerBooleanIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\r\n\tfieldName: keyof Message,\r\n\tid: ActionId,\r\n\tvalue?: number,\r\n}\r\nexport function makeSpecOptionsBooleanIconInput<SpecType extends Spec>(config: PlayerBooleanIconInputConfig<SpecType, SpecOptions<SpecType>, boolean>): TypedIconPickerConfig<Player<SpecType>, boolean> {\r\n\treturn makeBooleanIconInput<SpecType, SpecOptions<SpecType>, Player<SpecType>>({\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: (player: Player<SpecType>) => player.getSpecOptions(),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newVal: SpecOptions<SpecType>) => player.setSpecOptions(eventID, newVal),\r\n\t\tchangeEmitter: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t\tgetFieldValue: config.getValue,\r\n\t\tsetFieldValue: config.setValue,\r\n\t}, config.id, config.fieldName, config.value);\r\n}\r\n\r\nfunction makeNumberIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, fieldName: keyof Message, multiplier?: number): TypedIconPickerConfig<Player<SpecType>, number> {\r\n\treturn makeWrappedIconInput<SpecType, ModObject, number>({\r\n\t\tgetModObject: config.getModObject,\r\n\t\tid: id,\r\n\t\tstates: 0, // Must be assigned externally.\r\n\t\tchangedEvent: config.changeEmitter,\r\n\t\tgetValue: (modObj: ModObject) => config.getValue(modObj)[fieldName] as unknown as number,\r\n\t\tsetValue: (eventID: EventID, modObj: ModObject, newValue: number) => {\r\n\t\t\tconst newMessage = config.getValue(modObj);\r\n\t\t\tif (multiplier) {\r\n\t\t\t\tconst sign = newValue - (newMessage[fieldName] as unknown as number)\r\n\t\t\t\tnewValue += (multiplier - 1) * sign\r\n\t\t\t}\r\n\t\t\tif (newValue < 0) {\r\n\t\t\t\tnewValue = 0\r\n\t\t\t}\r\n\t\t\t(newMessage[fieldName] as unknown as number) = newValue;\r\n\t\t\tconfig.setValue(eventID, modObj, newMessage);\r\n\t\t},\r\n\t});\r\n}\r\nexport function makeTristateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, impId: ActionId, fieldName: keyof Message): TypedIconPickerConfig<Player<SpecType>, number> {\r\n\tconst input = makeNumberIconInput(config, id, fieldName);\r\n\tinput.states = 3;\r\n\tinput.improvedId = impId;\r\n\treturn input;\r\n}\r\nexport function makeQuadstateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, impId: ActionId, impId2: ActionId, fieldName: keyof Message): TypedIconPickerConfig<Player<SpecType>, number> {\r\n\tconst input = makeNumberIconInput(config, id, fieldName);\r\n\tinput.states = 4;\r\n\tinput.improvedId = impId;\r\n\tinput.improvedId2 = impId2;\r\n\treturn input;\r\n}\r\nexport function makeMultistateIconInput<SpecType extends Spec, Message, ModObject>(config: WrappedTypedInputConfig<Message, ModObject, number>, id: ActionId, numStates: number, fieldName: keyof Message, multiplier?: number): TypedIconPickerConfig<Player<SpecType>, number> {\r\n\tconst input = makeNumberIconInput(config, id, fieldName, multiplier);\r\n\tinput.states = numStates;\r\n\treturn input;\r\n}\r\n\r\n\r\nexport interface TypedIconEnumPickerConfig<ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\r\n\ttype: 'iconEnum',\r\n}\r\n\r\ninterface WrappedEnumIconInputConfig<SpecType extends Spec, ModObject, T> extends IconEnumPickerConfig<ModObject, T> {\r\n\tgetModObject: (player: Player<SpecType>) => ModObject,\r\n}\r\nfunction makeWrappedEnumIconInput<SpecType extends Spec, ModObject, T>(config: WrappedEnumIconInputConfig<SpecType, ModObject, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\r\n\tconst getModObject = config.getModObject;\r\n\treturn {\r\n\t\ttype: 'iconEnum',\r\n\t\tnumColumns: config.numColumns,\r\n\t\tvalues: config.values.map(value => {\r\n\t\t\tif (value.showWhen) {\r\n\t\t\t\tconst showWhen = value.showWhen;\r\n\t\t\t\tvalue.showWhen = ((player: Player<SpecType>) => showWhen(getModObject(player))) as any;\r\n\t\t\t}\r\n\t\t\treturn value as unknown as IconEnumValueConfig<Player<SpecType>, T>;\r\n\t\t}),\r\n\t\tequals: config.equals,\r\n\t\tshowWhen: (player: Player<SpecType>): boolean => !config.showWhen || config.showWhen(getModObject(player)) as any,\r\n\t\tzeroValue: config.zeroValue,\r\n\t\tchangedEvent: (player: Player<SpecType>) => config.changedEvent(getModObject(player)),\r\n\t\tgetValue: (player: Player<SpecType>) => config.getValue(getModObject(player)),\r\n\t\tsetValue: (eventID: EventID, player: Player<SpecType>, newValue: T) => config.setValue(eventID, getModObject(player), newValue),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t}\r\n}\r\n\r\nexport interface PlayerEnumIconInputConfig<SpecType extends Spec, Message, T> extends BasePlayerConfig<SpecType, T> {\r\n\tfieldName: keyof Message,\r\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\r\n\tnumColumns?: number,\r\n}\r\nexport function makeSpecOptionsEnumIconInput<SpecType extends Spec, T>(config: PlayerEnumIconInputConfig<SpecType, SpecOptions<SpecType>, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\r\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\r\n\t\tnumColumns: config.numColumns || 1,\r\n\t\tvalues: config.values,\r\n\t\tequals: (a: T, b: T) => a == b,\r\n\t\tshowWhen: config.showWhen,\r\n\t\tzeroValue: 0 as unknown as T,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getSpecOptions()[config.fieldName] as unknown as T),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: T) => {\r\n\t\t\tconst newMessage = player.getSpecOptions();\r\n\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\r\n\t\t\tplayer.setSpecOptions(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.specOptionsChangeEmitter),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t});\r\n}\r\nexport function makeRotationEnumIconInput<SpecType extends Spec, T>(config: PlayerEnumIconInputConfig<SpecType, SpecRotation<SpecType>, T>): TypedIconEnumPickerConfig<Player<SpecType>, T> {\r\n\treturn makeWrappedEnumIconInput<SpecType, Player<SpecType>, T>({\r\n\t\tnumColumns: config.numColumns || 1,\r\n\t\tvalues: config.values,\r\n\t\tequals: (a: T, b: T) => a == b,\r\n\t\tshowWhen: config.showWhen,\r\n\t\tzeroValue: 0 as unknown as T,\r\n\t\tgetModObject: (player: Player<SpecType>) => player,\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => player.getRotation()[config.fieldName] as unknown as T),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newVal: T) => {\r\n\t\t\tconst newMessage = player.getRotation();\r\n\t\t\t(newMessage[config.fieldName] as unknown as T) = newVal;\r\n\t\t\tplayer.setRotation(eventID, newMessage);\r\n\t\t}),\r\n\t\tchangedEvent: config.changeEmitter || ((player: Player<SpecType>) => player.rotationChangeEmitter),\r\n\t\textraCssClasses: config.extraCssClasses,\r\n\t});\r\n}\r\n\r\nexport interface TypedCustomRotationPickerConfig<SpecType extends Spec, T> extends CustomRotationPickerConfig<SpecType, T> {\r\n\ttype: 'customRotation',\r\n}\r\n\r\ninterface WrappedCustomRotationInputConfig<SpecType extends Spec, T> {\r\n\tfieldName: keyof SpecRotation<SpecType>,\r\n\tgetValue?: (player: Player<SpecType>) => CustomRotation,\r\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => void,\r\n\r\n\tnumColumns: number,\r\n\tshowCastsPerMinute?: boolean,\r\n\tvalues: Array<IconEnumValueConfig<Player<SpecType>, T>>;\r\n\r\n\tshowWhen?: (player: Player<SpecType>) => boolean,\r\n}\r\nexport function makeCustomRotationInput<SpecType extends Spec, T>(config: WrappedCustomRotationInputConfig<SpecType, T>): TypedCustomRotationPickerConfig<SpecType, T> {\r\n\treturn {\r\n\t\ttype: 'customRotation',\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => (player.getRotation()[config.fieldName] as unknown as CustomRotation) || CustomRotation.create()),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newValue: CustomRotation) => {\r\n\t\t\tconst rotation = player.getRotation();\r\n\t\t\t(rotation[config.fieldName] as unknown as CustomRotation) = newValue;\r\n\t\t\tplayer.setRotation(eventID, rotation);\r\n\t\t}),\r\n\t\tshowWhen: config.showWhen,\r\n\t\tnumColumns: config.numColumns,\r\n\t\tshowCastsPerMinute: config.showCastsPerMinute || false,\r\n\t\tvalues: config.values,\r\n\t}\r\n}\r\n\r\n\r\nexport interface TypedItemSwapPickerConfig<SpecType extends Spec, T> extends ItemSwapPickerConfig<SpecType, T> {\r\n\ttype: 'itemSwap',\r\n}\r\n\r\ninterface WrappedItemSwapInputConfig<SpecType extends Spec> {\r\n\tfieldName: keyof SpecRotation<SpecType>,\r\n\tvalues: Array<ItemSlot>,\r\n\tlabelTooltip?: string,\r\n\tgetValue?: (player: Player<SpecType>) => ItemSwap,\r\n\tsetValue?: (eventID: EventID, player: Player<SpecType>, newValue: ItemSwap) => void,\r\n\tshowWhen?: (player: Player<SpecType>) => boolean\r\n}\r\n\r\nexport function MakeItemSwapInput<SpecType extends Spec>(config: WrappedItemSwapInputConfig<SpecType>): TypedItemSwapPickerConfig<SpecType, ItemSwap> {\r\n\treturn {\r\n\t\ttype: 'itemSwap',\r\n\t\tgetValue: config.getValue || ((player: Player<SpecType>) => (player.getRotation()[config.fieldName] as unknown as ItemSwap) || ItemSwap.create()),\r\n\t\tsetValue: config.setValue || ((eventID: EventID, player: Player<SpecType>, newValue: ItemSwap) => {\r\n\t\t\tconst options = player.getRotation();\r\n\t\t\t(options[config.fieldName] as unknown as ItemSwap) = newValue;\r\n\t\t\tplayer.setRotation(eventID, options);\r\n\t\t}),\r\n\t\titemSlots: config.values,\r\n\t\tchangedEvent: (player: Player<SpecType>) => player.rotationChangeEmitter,\r\n\t\tlabelTooltip: config.labelTooltip,\r\n\t\tshowWhen: config.showWhen,\r\n\t}\r\n}\r\n","import { ActionId } from '../proto_utils/action_id.js';\r\nimport { BattleElixir } from '../proto/common.js';\r\nimport { WeaponImbue } from '../proto/common.js';\r\nimport { Explosive } from '../proto/common.js';\r\nimport { Flask } from '../proto/common.js';\r\nimport { Food } from '../proto/common.js';\r\nimport { GuardianElixir } from '../proto/common.js';\r\nimport { RaidBuffs } from '../proto/common.js';\r\nimport { PartyBuffs } from '../proto/common.js';\r\nimport { IndividualBuffs } from '../proto/common.js';\r\nimport { Conjured } from '../proto/common.js';\r\nimport { Consumes } from '../proto/common.js';\r\nimport { Debuffs } from '../proto/common.js';\r\n\r\nimport { PetFood } from '../proto/common.js';\r\nimport { Potions } from '../proto/common.js';\r\nimport { Spec } from '../proto/common.js';\r\nimport { TristateEffect } from '../proto/common.js';\r\nimport { Party } from '../party.js';\r\nimport { Player } from '../player.js';\r\nimport { Raid } from '../raid.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { IconPicker, IconPickerConfig } from './icon_picker.js';\r\nimport { IconEnumPicker, IconEnumPickerConfig, IconEnumValueConfig } from './icon_enum_picker.js';\r\n\r\nimport * as InputHelpers from './input_helpers.js';\r\nimport { Tooltip } from 'bootstrap';\r\n\r\n// Component Functions\r\n\r\nexport type IconInputConfig<ModObject, T> = (\r\n\tInputHelpers.TypedIconPickerConfig<ModObject, T> |\r\n\tInputHelpers.TypedIconEnumPickerConfig<ModObject, T>\r\n);\r\n\r\nexport const buildIconInput = (parent: HTMLElement, player: Player<Spec>, inputConfig: IconInputConfig<Player<Spec>, any>) => {\r\n\tif (inputConfig.type == 'icon') {\r\n\t\treturn new IconPicker<Player<Spec>, any>(parent, player, inputConfig);\r\n\t} else if (inputConfig.type == 'iconEnum') {\r\n\t\treturn new IconEnumPicker<Player<Spec>, any>(parent, player, inputConfig);\r\n\t}\r\n};\r\n\r\n// Raid Buffs\r\n\r\nexport const AllStatsBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(26991), ActionId.fromSpellId(17051), 'giftOfTheWild'),\r\n], 'Stats');\r\n\r\nexport const AllStatsPercentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(25898), 'blessingOfKings'),\r\n], 'Stats %');\r\n\r\nexport const ArmorBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(27149), ActionId.fromSpellId(20140), 'devotionAura'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(25509), ActionId.fromSpellId(16293), 'stoneskinTotem'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33459), 'scrollOfProtection'),\r\n], 'Armor');\r\n\r\nexport const StaminaBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(25389), ActionId.fromSpellId(14767), 'powerWordFortitude'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33461), 'scrollOfStamina'),\r\n], 'Stamina');\r\n\r\nexport const StrengthAndAgilityBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(25528), ActionId.fromSpellId(52456), 'strengthOfEarthTotem'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33457), 'scrollOfAgility'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33462), 'scrollOfStrength'),\r\n], 'Str/Agi');\r\n\r\nexport const IntellectBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(27127), 'arcaneBrilliance'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(57566), ActionId.fromSpellId(54038), 'felIntelligence'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33458), 'scrollOfIntellect'),\r\n], 'Int');\r\n\r\nexport const SpiritBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(25312), 'divineSpirit'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(57566), ActionId.fromSpellId(54038), 'felIntelligence'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromItemId(33460), 'scrollOfSpirit'),\r\n], 'Spirit');\r\n\r\nexport const AttackPowerBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateIndividualBuffInput(ActionId.fromSpellId(27141), ActionId.fromSpellId(20045), 'blessingOfMight'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(2048), ActionId.fromSpellId(12861), 'battleShout'),\r\n], 'AP');\r\n\r\nexport const AttackPowerPercentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(30809), 'unleashedRage'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(19506), 'trueshotAura'),\r\n], 'Atk Pwr %');\r\n\r\nexport const DamagePercentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(31869), 'sanctifiedRetribution'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(31583), 'arcaneEmpowerment'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(34460), 'ferociousInspiration'),\r\n], 'Dmg %');\r\n\r\nexport const DamageReductionPercentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(57472), 'renewedHope'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(25899), 'blessingOfSanctuary'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(50720), 'vigilance'),\r\n], 'Mit %');\r\n\r\nexport const ResistanceBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(39374), 'shadowProtection'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(25574), 'natureResistanceTotem'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(27045), 'aspectOfTheWild'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(27152), 'frostResistanceAura'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(25560), 'frostResistanceTotem'),\r\n], 'Resistances');\r\n\r\nexport const HastePercentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(53648), 'swiftRetribution'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(48396), 'moonkinAura', TristateEffect.TristateEffectImproved),\r\n], 'Haste %');\r\n\r\nexport const HealthBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(469), ActionId.fromSpellId(12861), 'commandingShout'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(27268), ActionId.fromSpellId(18696), 'bloodPact'),\r\n], 'Health');\r\n\r\nexport const MP5Buff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateIndividualBuffInput(ActionId.fromSpellId(27143), ActionId.fromSpellId(20245), 'blessingOfWisdom'),\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(25570), ActionId.fromSpellId(16206), 'manaSpringTotem'),\r\n], 'MP5');\r\n\r\nexport const MeleeCritBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(17007), ActionId.fromSpellId(34300), 'leaderOfThePack'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(29801), 'rampage'),\r\n], 'Melee Crit');\r\n\r\nexport const MeleeHasteBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(65990), ActionId.fromSpellId(29193), 'windfuryTotem'),\r\n], 'Melee Haste');\r\n\r\nexport const ReplenishmentBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(34917), 'vampiricTouch'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(31878), 'judgementsOfTheWise'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(53292), 'huntingParty'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(54118), 'improvedSoulLeech'),\r\n\tmakeBooleanIndividualBuffInput(ActionId.fromSpellId(44561), 'enduringWinter'),\r\n], 'Replen', 2);\r\n\r\nexport const SpellCritBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateRaidBuffInput(ActionId.fromSpellId(24907), ActionId.fromSpellId(48396), 'moonkinAura'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(51470), 'elementalOath'),\r\n], 'Spell Crit');\r\n\r\nexport const SpellHasteBuff = withLabel(makeBooleanRaidBuffInput(ActionId.fromSpellId(3738), 'wrathOfAirTotem'), 'Spell Haste');\r\n\r\nexport const SpellPowerBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeMultistateRaidBuffInput(ActionId.fromSpellId(47240), 3000, 'demonicPact', 100),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(57721), 'totemOfWrath'),\r\n\tmakeBooleanRaidBuffInput(ActionId.fromSpellId(25557), 'flametongueTotem'),\r\n], 'Spell Power');\r\n\r\nexport const Bloodlust = withLabel(makeBooleanRaidBuffInput(ActionId.fromSpellId(2825), 'bloodlust'), 'Lust');\r\n\r\nexport const DefensiveCooldownBuff = InputHelpers.makeMultiIconInput([\r\n\tmakeMultistateIndividualBuffInput(ActionId.fromSpellId(53530), 11, 'divineGuardians'),\r\n\tmakeMultistateIndividualBuffInput(ActionId.fromSpellId(33206), 11, 'painSuppressions'),\r\n], 'Defensive CDs');\r\n\r\n// Misc Buffs\r\nexport const RetributionAura = makeBooleanRaidBuffInput(ActionId.fromSpellId(27150), 'retributionAura');\r\nexport const ShadowProtection = makeBooleanRaidBuffInput(ActionId.fromSpellId(39374), 'shadowProtection');\r\nexport const BraidedEterniumChain = makeBooleanPartyBuffInput(ActionId.fromSpellId(31025), 'braidedEterniumChain');\r\nexport const ChainOfTheTwilightOwl = makeBooleanPartyBuffInput(ActionId.fromSpellId(31035), 'chainOfTheTwilightOwl');\r\nexport const HeroicPresence = makeBooleanPartyBuffInput(ActionId.fromSpellId(6562), 'heroicPresence');\r\nexport const EyeOfTheNight = makeBooleanPartyBuffInput(ActionId.fromSpellId(31033), 'eyeOfTheNight');\r\nexport const Thorns = makeTristateRaidBuffInput(ActionId.fromSpellId(26992), ActionId.fromSpellId(16840), 'thorns');\r\nexport const ManaTideTotem = makeMultistatePartyBuffInput(ActionId.fromSpellId(16190), 5, 'manaTideTotems');\r\nexport const Innervate = makeMultistateIndividualBuffInput(ActionId.fromSpellId(29166), 11, 'innervates');\r\nexport const PowerInfusion = makeMultistateIndividualBuffInput(ActionId.fromSpellId(10060), 11, 'powerInfusions');\r\nexport const FocusMagic = makeBooleanIndividualBuffInput(ActionId.fromSpellId(54648), 'focusMagic');\r\nexport const RevitalizeRejuvination = makeMultistateMultiplierIndividualBuffInput(ActionId.fromSpellId(26982), 101, 10, 'revitalizeRejuvination');\r\nexport const RevitalizeWildGrowth = makeMultistateMultiplierIndividualBuffInput(ActionId.fromSpellId(53251), 101, 10, 'revitalizeWildGrowth');\r\n\r\n// Debuffs\r\n\r\nexport const MajorArmorDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(25225), 'sunderArmor'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(8647), 'exposeArmor'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(55754), 'acidSpit'),\r\n], 'Major ArP');\r\n\r\nexport const MinorArmorDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(770), ActionId.fromSpellId(33602), 'faerieFire'),\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(30909), ActionId.fromSpellId(18180), 'curseOfWeakness'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(56631), 'sting'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(53598), 'sporeCloud'),\r\n], 'Minor ArP');\r\n\r\nexport const AttackPowerDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(26016), 'vindication'),\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(25203), ActionId.fromSpellId(12879), 'demoralizingShout'),\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(48560), ActionId.fromSpellId(16862), 'demoralizingRoar'),\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(30909), ActionId.fromSpellId(18180), 'curseOfWeakness'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(55487), 'demoralizingScreech'),\r\n], 'Atk Pwr');\r\n\r\nexport const BleedDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33876), 'mangle'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(46855), 'trauma'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(57393), 'stampede'),\r\n], 'Bleed');\r\n\r\nexport const CritDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(30706), 'totemOfWrath'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(20337), 'heartOfTheCrusader'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(58410), 'masterPoisoner'),\r\n], 'Crit');\r\n\r\nexport const MeleeAttackSpeedDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeTristateDebuffInput(ActionId.fromSpellId(25264), ActionId.fromSpellId(12666), 'thunderClap'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(53696), 'judgementsOfTheJust'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(48485), 'infectedWounds'),\r\n], 'Atk Speed');\r\n\r\nexport const MeleeHitDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(65855), 'insectSwarm'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(3043), 'scorpidSting'),\r\n], 'Miss');\r\n\r\nexport const PhysicalDamageDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(29859), 'bloodFrenzy'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(58413), 'savageCombat'),\r\n], 'Phys Vuln');\r\n\r\nexport const SpellCritDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(17803), 'shadowMastery'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(12873), 'improvedScorch'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(28593), 'wintersChill'),\r\n], 'Spell Crit');\r\n\r\nexport const SpellHitDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33198), 'misery'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(33602), 'faerieFire', TristateEffect.TristateEffectImproved),\r\n], 'Spell Hit');\r\n\r\nexport const SpellDamageDebuff = InputHelpers.makeMultiIconInput([\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(48511), 'earthAndMoon'),\r\n\tmakeBooleanDebuffInput(ActionId.fromSpellId(27228), 'curseOfElements'),\r\n], 'Spell Dmg');\r\n\r\nexport const HuntersMark = withLabel(makeQuadstateDebuffInput(ActionId.fromSpellId(14325), ActionId.fromSpellId(19423), ActionId.fromItemId(42907), 'huntersMark'), 'Mark');\r\nexport const JudgementOfWisdom = withLabel(makeBooleanDebuffInput(ActionId.fromSpellId(53408), 'judgementOfWisdom'), 'JoW');\r\nexport const JudgementOfLight = makeBooleanDebuffInput(ActionId.fromSpellId(20271), 'judgementOfLight');\r\nexport const GiftOfArthas = makeBooleanDebuffInput(ActionId.fromSpellId(11374), 'giftOfArthas');\r\n\r\n// Consumes\r\nexport const SuperSapper = makeBooleanConsumeInput(ActionId.fromItemId(23827), 'superSapper');\r\n\r\nexport const SpicedMammothTreats = makeBooleanConsumeInput(ActionId.fromItemId(33874), 'petFood', PetFood.PetFoodKiblersBits);\r\nexport const PetScrollOfAgilityV = makeBooleanConsumeInput(ActionId.fromItemId(27498), 'petScrollOfAgility', 5);\r\nexport const PetScrollOfStrengthV = makeBooleanConsumeInput(ActionId.fromItemId(27503), 'petScrollOfStrength', 5);\r\n\r\nfunction withLabel<ModObject, T>(config: InputHelpers.TypedIconPickerConfig<ModObject, T>, label: string): InputHelpers.TypedIconPickerConfig<ModObject, T> {\r\n\tconfig.label = label;\r\n\treturn config;\r\n}\r\n\r\nfunction makeBooleanRaidBuffInput(id: ActionId, fieldName: keyof RaidBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\r\n\treturn InputHelpers.makeBooleanIconInput<any, RaidBuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\r\n\t}, id, fieldName, value);\r\n}\r\nfunction makeBooleanPartyBuffInput(id: ActionId, fieldName: keyof PartyBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\r\n\treturn InputHelpers.makeBooleanIconInput<any, PartyBuffs, Party>({\r\n\t\tgetModObject: (player: Player<any>) => player.getParty()!,\r\n\t\tgetValue: (party: Party) => party.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\r\n\t}, id, fieldName, value);\r\n}\r\nfunction makeBooleanIndividualBuffInput(id: ActionId, fieldName: keyof IndividualBuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\r\n\treturn InputHelpers.makeBooleanIconInput<any, IndividualBuffs, Player<any>>({\r\n\t\tgetModObject: (player: Player<any>) => player,\r\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\r\n\t}, id, fieldName, value);\r\n}\r\nfunction makeBooleanConsumeInput(id: ActionId, fieldName: keyof Consumes, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\r\n\treturn InputHelpers.makeBooleanIconInput<any, Consumes, Player<any>>({\r\n\t\tgetModObject: (player: Player<any>) => player,\r\n\t\tgetValue: (player: Player<any>) => player.getConsumes(),\r\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: Consumes) => player.setConsumes(eventID, newVal),\r\n\t\tchangeEmitter: (player: Player<any>) => player.consumesChangeEmitter,\r\n\t}, id, fieldName, value);\r\n}\r\nfunction makeBooleanDebuffInput(id: ActionId, fieldName: keyof Debuffs, value?: number): InputHelpers.TypedIconPickerConfig<Player<any>, boolean> {\r\n\treturn InputHelpers.makeBooleanIconInput<any, Debuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\r\n\t}, id, fieldName, value);\r\n}\r\n\r\nfunction makeTristateRaidBuffInput(id: ActionId, impId: ActionId, fieldName: keyof RaidBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeTristateIconInput<any, RaidBuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\r\n\t}, id, impId, fieldName);\r\n}\r\nfunction makeTristateIndividualBuffInput(id: ActionId, impId: ActionId, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeTristateIconInput<any, IndividualBuffs, Player<any>>({\r\n\t\tgetModObject: (player: Player<any>) => player,\r\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\r\n\t}, id, impId, fieldName);\r\n}\r\nfunction makeTristateDebuffInput(id: ActionId, impId: ActionId, fieldName: keyof Debuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeTristateIconInput<any, Debuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\r\n\t}, id, impId, fieldName);\r\n}\r\nfunction makeQuadstateDebuffInput(id: ActionId, impId: ActionId, impId2: ActionId, fieldName: keyof Debuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeQuadstateIconInput<any, Debuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getDebuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: Debuffs) => raid.setDebuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.debuffsChangeEmitter,\r\n\t}, id, impId, impId2, fieldName);\r\n}\r\nfunction makeMultistateRaidBuffInput(id: ActionId, numStates: number, fieldName: keyof RaidBuffs, multiplier?: number): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeMultistateIconInput<any, RaidBuffs, Raid>({\r\n\t\tgetModObject: (player: Player<any>) => player.getRaid()!,\r\n\t\tgetValue: (raid: Raid) => raid.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, raid: Raid, newVal: RaidBuffs) => raid.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (raid: Raid) => raid.buffsChangeEmitter,\r\n\t}, id, numStates, fieldName, multiplier);\r\n}\r\nfunction makeMultistatePartyBuffInput(id: ActionId, numStates: number, fieldName: keyof PartyBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeMultistateIconInput<any, PartyBuffs, Party>({\r\n\t\tgetModObject: (player: Player<any>) => player.getParty()!,\r\n\t\tgetValue: (party: Party) => party.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, party: Party, newVal: PartyBuffs) => party.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (party: Party) => party.buffsChangeEmitter,\r\n\t}, id, numStates, fieldName);\r\n}\r\nfunction makeMultistateIndividualBuffInput(id: ActionId, numStates: number, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<any>>({\r\n\t\tgetModObject: (player: Player<any>) => player,\r\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\r\n\t}, id, numStates, fieldName);\r\n}\r\nfunction makeMultistateMultiplierIndividualBuffInput(id: ActionId, numStates: number, multiplier: number, fieldName: keyof IndividualBuffs): InputHelpers.TypedIconPickerConfig<Player<any>, number> {\r\n\treturn InputHelpers.makeMultistateIconInput<any, IndividualBuffs, Player<any>>({\r\n\t\tgetModObject: (player: Player<any>) => player,\r\n\t\tgetValue: (player: Player<any>) => player.getBuffs(),\r\n\t\tsetValue: (eventID: EventID, player: Player<any>, newVal: IndividualBuffs) => player.setBuffs(eventID, newVal),\r\n\t\tchangeEmitter: (player: Player<any>) => player.buffsChangeEmitter,\r\n\t}, id, numStates, fieldName, multiplier);\r\n}\r\n\r\n\r\n//////////////////////////////////////////////////////////////////////\r\n// Custom buffs that don't fit into any of the helper functions above.\r\n//////////////////////////////////////////////////////////////////////\r\n\r\nfunction makePotionInputFactory(consumesFieldName: keyof Consumes): (options: Array<Potions>, tooltip?: string) => InputHelpers.TypedIconEnumPickerConfig<Player<any>, Potions> {\r\n\treturn makeConsumeInputFactory({\r\n\t\tconsumesFieldName: consumesFieldName,\r\n\t\tallOptions: [\r\n\t\t\t{ actionId: ActionId.fromItemId(33447), value: Potions.RunicHealingPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(41166), value: Potions.RunicHealingInjector },\r\n\t\t\t{ actionId: ActionId.fromItemId(33448), value: Potions.RunicManaPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(42545), value: Potions.RunicManaInjector },\r\n\t\t\t{ actionId: ActionId.fromItemId(40093), value: Potions.IndestructiblePotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(40211), value: Potions.PotionOfSpeed },\r\n\t\t\t{ actionId: ActionId.fromItemId(40212), value: Potions.PotionOfWildMagic },\r\n\r\n\t\t\t{ actionId: ActionId.fromItemId(22839), value: Potions.DestructionPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(22838), value: Potions.HastePotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(13442), value: Potions.MightyRagePotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(22832), value: Potions.SuperManaPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(31677), value: Potions.FelManaPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(22828), value: Potions.InsaneStrengthPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(22849), value: Potions.IronshieldPotion },\r\n\t\t\t{ actionId: ActionId.fromItemId(22837), value: Potions.HeroicPotion },\r\n\t\t] as Array<IconEnumValueConfig<Player<any>, Potions>>,\r\n\t});\r\n}\r\nexport const makePotionsInput = makePotionInputFactory('defaultPotion');\r\nexport const makePrepopPotionsInput = makePotionInputFactory('prepopPotion');\r\n\r\nexport const makeConjuredInput = makeConsumeInputFactory({\r\n\tconsumesFieldName: 'defaultConjured',\r\n\tallOptions: [\r\n\t\t{ actionId: ActionId.fromItemId(12662), value: Conjured.ConjuredDarkRune },\r\n\t\t{ actionId: ActionId.fromItemId(22788), value: Conjured.ConjuredFlameCap },\r\n\t\t{ actionId: ActionId.fromItemId(22105), value: Conjured.ConjuredHealthstone },\r\n\t\t{ actionId: ActionId.fromItemId(7676), value: Conjured.ConjuredRogueThistleTea },\r\n\t] as Array<IconEnumValueConfig<Player<any>, Conjured>>\r\n});\r\n\r\nfunction makeWeaponImbueFactory(consumesFieldName: keyof Consumes): (options: Array<WeaponImbue>, tooltip?: string) => InputHelpers.TypedIconEnumPickerConfig<Player<any>, WeaponImbue> {\r\n\treturn makeConsumeInputFactory({\r\n\t\tconsumesFieldName: consumesFieldName,\r\n\t\tallOptions: [\r\n\t\t\t{actionId: ActionId.fromItemId(20749), value: WeaponImbue.ImbueBrilliantWizardOil},\r\n\t\t\t{actionId: ActionId.fromItemId(20748), value: WeaponImbue.ImbueBrilliantManaOil},\r\n\t\t\t{actionId: ActionId.fromItemId(22522), value: WeaponImbue.ImbueSuperiorWizardOil},\r\n\t\t\t{actionId: ActionId.fromItemId(22521), value: WeaponImbue.ImbueSuperiorManaOil},\r\n\t\t\t{actionId: ActionId.fromItemId(23529), value: WeaponImbue.ImbueAdamantiteSharpeningStone},\r\n\t\t\t{actionId: ActionId.fromItemId(28421), value: WeaponImbue.ImbueAdamantiteWeightStone},\r\n\t\t\t{actionId: ActionId.fromItemId(18262), value: WeaponImbue.ImbueElementalSharpeningStone},\r\n\t\t\t{actionId: ActionId.fromItemId(41194), value: WeaponImbue.ImbueSpellStone},\r\n\t\t\t{actionId: ActionId.fromItemId(40773), value: WeaponImbue.ImbueFireStone},\r\n\t\t] as Array<IconEnumValueConfig<Player<any>, WeaponImbue>>,\r\n\t});\r\n}\r\n\r\nexport const makeMainWeaponImbueInput = makeWeaponImbueFactory('weaponMain');\r\nexport const makeOffWeaponImbueInput = makeWeaponImbueFactory('weaponOff');\r\n\r\nexport const makeFlasksInput = makeConsumeInputFactory({\r\n\tconsumesFieldName: 'flask',\r\n\tallOptions: [\r\n\t\t{ actionId: ActionId.fromItemId(46376), value: Flask.FlaskOfTheFrostWyrm },\r\n\t\t{ actionId: ActionId.fromItemId(46377), value: Flask.FlaskOfEndlessRage },\r\n\t\t{ actionId: ActionId.fromItemId(46378), value: Flask.FlaskOfPureMojo },\r\n\t\t{ actionId: ActionId.fromItemId(46379), value: Flask.FlaskOfStoneblood },\r\n\t\t{ actionId: ActionId.fromItemId(40079), value: Flask.LesserFlaskOfToughness },\r\n\t\t{ actionId: ActionId.fromItemId(44939), value: Flask.LesserFlaskOfResistance },\r\n\t\t{ actionId: ActionId.fromItemId(22861), value: Flask.FlaskOfBlindingLight },\r\n\t\t{ actionId: ActionId.fromItemId(22853), value: Flask.FlaskOfMightyRestoration },\r\n\t\t{ actionId: ActionId.fromItemId(22866), value: Flask.FlaskOfPureDeath },\r\n\t\t{ actionId: ActionId.fromItemId(22854), value: Flask.FlaskOfRelentlessAssault },\r\n\t\t{ actionId: ActionId.fromItemId(13512), value: Flask.FlaskOfSupremePower },\r\n\t\t{ actionId: ActionId.fromItemId(22851), value: Flask.FlaskOfFortification },\r\n\t\t{ actionId: ActionId.fromItemId(33208), value: Flask.FlaskOfChromaticWonder },\r\n\t\t{ actionId: ActionId.fromItemId(13511), value: Flask.FlaskOfDistilledWisdom },\r\n\t] as Array<IconEnumValueConfig<Player<any>, Flask>>,\r\n\tonSet: (eventID: EventID, player: Player<any>, newValue: Flask) => {\r\n\t\tif (newValue) {\r\n\t\t\tconst newConsumes = player.getConsumes();\r\n\t\t\tnewConsumes.battleElixir = BattleElixir.BattleElixirUnknown;\r\n\t\t\tnewConsumes.guardianElixir = GuardianElixir.GuardianElixirUnknown;\r\n\t\t\tplayer.setConsumes(eventID, newConsumes);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport const makeBattleElixirsInput = makeConsumeInputFactory({\r\n\tconsumesFieldName: 'battleElixir',\r\n\tallOptions: [\r\n\t\t{ actionId: ActionId.fromItemId(44325), value: BattleElixir.ElixirOfAccuracy },\r\n\t\t{ actionId: ActionId.fromItemId(44330), value: BattleElixir.ElixirOfArmorPiercing },\r\n\t\t{ actionId: ActionId.fromItemId(44327), value: BattleElixir.ElixirOfDeadlyStrikes },\r\n\t\t{ actionId: ActionId.fromItemId(44329), value: BattleElixir.ElixirOfExpertise },\r\n\t\t{ actionId: ActionId.fromItemId(44331), value: BattleElixir.ElixirOfLightningSpeed },\r\n\t\t{ actionId: ActionId.fromItemId(39666), value: BattleElixir.ElixirOfMightyAgility },\r\n\t\t{ actionId: ActionId.fromItemId(40073), value: BattleElixir.ElixirOfMightyStrength },\r\n\t\t{ actionId: ActionId.fromItemId(40076), value: BattleElixir.GurusElixir },\r\n\t\t{ actionId: ActionId.fromItemId(40070), value: BattleElixir.SpellpowerElixir },\r\n\t\t{ actionId: ActionId.fromItemId(40068), value: BattleElixir.WrathElixir },\r\n\t\t{ actionId: ActionId.fromItemId(28103), value: BattleElixir.AdeptsElixir },\r\n\t\t{ actionId: ActionId.fromItemId(9224), value: BattleElixir.ElixirOfDemonslaying },\r\n\t\t{ actionId: ActionId.fromItemId(22831), value: BattleElixir.ElixirOfMajorAgility },\r\n\t\t{ actionId: ActionId.fromItemId(22833), value: BattleElixir.ElixirOfMajorFirePower },\r\n\t\t{ actionId: ActionId.fromItemId(22827), value: BattleElixir.ElixirOfMajorFrostPower },\r\n\t\t{ actionId: ActionId.fromItemId(22835), value: BattleElixir.ElixirOfMajorShadowPower },\r\n\t\t{ actionId: ActionId.fromItemId(22824), value: BattleElixir.ElixirOfMajorStrength },\r\n\t\t{ actionId: ActionId.fromItemId(28104), value: BattleElixir.ElixirOfMastery },\r\n\t\t{ actionId: ActionId.fromItemId(13452), value: BattleElixir.ElixirOfTheMongoose },\r\n\t\t{ actionId: ActionId.fromItemId(31679), value: BattleElixir.FelStrengthElixir },\r\n\t\t{ actionId: ActionId.fromItemId(13454), value: BattleElixir.GreaterArcaneElixir },\r\n\t\t{ actionId: ActionId.fromItemId(22825), value: BattleElixir.ElixirOfHealingPower },\r\n\t] as Array<IconEnumValueConfig<Player<any>, BattleElixir>>,\r\n\tonSet: (eventID: EventID, player: Player<any>, newValue: BattleElixir) => {\r\n\t\tif (newValue) {\r\n\t\t\tconst newConsumes = player.getConsumes();\r\n\t\t\tnewConsumes.flask = Flask.FlaskUnknown;\r\n\t\t\tplayer.setConsumes(eventID, newConsumes);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport const makeGuardianElixirsInput = makeConsumeInputFactory({\r\n\tconsumesFieldName: 'guardianElixir',\r\n\tallOptions: [\r\n\t\t{ actionId: ActionId.fromItemId(44328), value: GuardianElixir.ElixirOfMightyDefense },\r\n\t\t{ actionId: ActionId.fromItemId(40078), value: GuardianElixir.ElixirOfMightyFortitude },\r\n\t\t{ actionId: ActionId.fromItemId(40109), value: GuardianElixir.ElixirOfMightyMageblood },\r\n\t\t{ actionId: ActionId.fromItemId(44332), value: GuardianElixir.ElixirOfMightyThoughts },\r\n\t\t{ actionId: ActionId.fromItemId(40097), value: GuardianElixir.ElixirOfProtection },\r\n\t\t{ actionId: ActionId.fromItemId(40072), value: GuardianElixir.ElixirOfSpirit },\r\n\t\t{ actionId: ActionId.fromItemId(9088), value: GuardianElixir.GiftOfArthas },\r\n\t\t{ actionId: ActionId.fromItemId(32067), value: GuardianElixir.ElixirOfDraenicWisdom },\r\n\t\t{ actionId: ActionId.fromItemId(32068), value: GuardianElixir.ElixirOfIronskin },\r\n\t\t{ actionId: ActionId.fromItemId(22834), value: GuardianElixir.ElixirOfMajorDefense },\r\n\t\t{ actionId: ActionId.fromItemId(32062), value: GuardianElixir.ElixirOfMajorFortitude },\r\n\t\t{ actionId: ActionId.fromItemId(22840), value: GuardianElixir.ElixirOfMajorMageblood },\r\n\t] as Array<IconEnumValueConfig<Player<any>, GuardianElixir>>,\r\n\tonSet: (eventID: EventID, player: Player<any>, newValue: GuardianElixir) => {\r\n\t\tif (newValue) {\r\n\t\t\tconst newConsumes = player.getConsumes();\r\n\t\t\tnewConsumes.flask = Flask.FlaskUnknown;\r\n\t\t\tplayer.setConsumes(eventID, newConsumes);\r\n\t\t}\r\n\t}\r\n});\r\n\r\nexport const makeFoodInput = makeConsumeInputFactory({\r\n\tconsumesFieldName: 'food',\r\n\tallOptions: [\r\n\t\t{ actionId: ActionId.fromItemId(43015), value: Food.FoodFishFeast },\r\n\t\t{ actionId: ActionId.fromItemId(34753), value: Food.FoodGreatFeast },\r\n\t\t{ actionId: ActionId.fromItemId(42999), value: Food.FoodBlackenedDragonfin },\r\n\t\t{ actionId: ActionId.fromItemId(42995), value: Food.FoodHeartyRhino },\r\n\t\t{ actionId: ActionId.fromItemId(34754), value: Food.FoodMegaMammothMeal },\r\n\t\t{ actionId: ActionId.fromItemId(34756), value: Food.FoodSpicedWormBurger },\r\n\t\t{ actionId: ActionId.fromItemId(42994), value: Food.FoodRhinoliciousWormsteak },\r\n\t\t{ actionId: ActionId.fromItemId(34769), value: Food.FoodImperialMantaSteak },\r\n\t\t{ actionId: ActionId.fromItemId(42996), value: Food.FoodSnapperExtreme },\r\n\t\t{ actionId: ActionId.fromItemId(34758), value: Food.FoodMightyRhinoDogs },\r\n\t\t{ actionId: ActionId.fromItemId(34767), value: Food.FoodFirecrackerSalmon },\r\n\t\t{ actionId: ActionId.fromItemId(42998), value: Food.FoodCuttlesteak },\r\n\t\t{ actionId: ActionId.fromItemId(43000), value: Food.FoodDragonfinFilet },\r\n\r\n\t\t{ actionId: ActionId.fromItemId(27657), value: Food.FoodBlackenedBasilisk },\r\n\t\t{ actionId: ActionId.fromItemId(27664), value: Food.FoodGrilledMudfish },\r\n\t\t{ actionId: ActionId.fromItemId(27655), value: Food.FoodRavagerDog },\r\n\t\t{ actionId: ActionId.fromItemId(27658), value: Food.FoodRoastedClefthoof },\r\n\t\t{ actionId: ActionId.fromItemId(33872), value: Food.FoodSpicyHotTalbuk },\r\n\t\t{ actionId: ActionId.fromItemId(33825), value: Food.FoodSkullfishSoup },\r\n\t\t{ actionId: ActionId.fromItemId(33052), value: Food.FoodFishermansFeast },\r\n\t] as Array<IconEnumValueConfig<Player<any>, Food>>\r\n});\r\n\r\nexport const FillerExplosiveInput = makeConsumeInput('fillerExplosive', [\r\n\t{ actionId: ActionId.fromItemId(41119), value: Explosive.ExplosiveSaroniteBomb },\r\n\t{ actionId: ActionId.fromItemId(40771), value: Explosive.ExplosiveCobaltFragBomb },\r\n\t{ actionId: ActionId.fromItemId(23826), value: Explosive.ExplosiveBiggerOne },\r\n\t{ actionId: ActionId.fromItemId(23737), value: Explosive.ExplosiveAdamantiteGrenade },\r\n\t{ actionId: ActionId.fromItemId(23736), value: Explosive.ExplosiveFelIronBomb },\r\n] as Array<IconEnumValueConfig<Player<any>, Explosive>>);\r\n\r\nexport interface ConsumeInputFactoryArgs<T extends number> {\r\n\tconsumesFieldName: keyof Consumes,\r\n\tallOptions: Array<IconEnumValueConfig<Player<any>, T>>,\r\n\tonSet?: (eventID: EventID, player: Player<any>, newValue: T) => void\r\n}\r\nfunction makeConsumeInputFactory<T extends number>(args: ConsumeInputFactoryArgs<T>): (options: Array<T>, tooltip?: string) => InputHelpers.TypedIconEnumPickerConfig<Player<any>, T> {\r\n\treturn (options: Array<T>, tooltip?: string) => {\r\n\t\treturn {\r\n\t\t\ttype: 'iconEnum',\r\n\t\t\ttooltip: tooltip,\r\n\t\t\tnumColumns: options.length > 5 ? 2 : 1,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: 0 } as unknown as IconEnumValueConfig<Player<any>, T>,\r\n\t\t\t].concat(options.map(option => args.allOptions.find(allOption => allOption.value == option)!)),\r\n\t\t\tequals: (a: T, b: T) => a == b,\r\n\t\t\tzeroValue: 0 as T,\r\n\t\t\tchangedEvent: (player: Player<any>) => player.consumesChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.getConsumes()[args.consumesFieldName] as T,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\tconst newConsumes = player.getConsumes();\r\n\t\t\t\t(newConsumes[args.consumesFieldName] as number) = newValue;\r\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\t\t\tplayer.setConsumes(eventID, newConsumes);\r\n\t\t\t\t\tif (args.onSet) {\r\n\t\t\t\t\t\targs.onSet(eventID, player, newValue as T);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t};\r\n\t};\r\n}\r\n\r\nfunction makeConsumeInput<T extends number>(consumesFieldName: keyof Consumes, allOptions: Array<IconEnumValueConfig<Player<any>, T>>, onSet?: (eventID: EventID, player: Player<any>, newValue: T) => void): InputHelpers.TypedIconEnumPickerConfig<Player<any>, T> {\r\n\tconst factory = makeConsumeInputFactory({\r\n\t\tconsumesFieldName: consumesFieldName,\r\n\t\tallOptions: allOptions,\r\n\t\tonSet: onSet\r\n\t});\r\n\treturn factory(allOptions.map(option => option.value));\r\n}\r\n","import { IndividualSimUI } from \"../../individual_sim_ui\";\r\nimport {\r\n\tBattleElixir,\r\n\tClass,\r\n\tConjured,\r\n\tFlask,\r\n\tFood,\r\n\tGuardianElixir,\r\n\tPotions,\r\n\tProfession,\r\n\tSpec,\r\n\tStat,\r\n\tWeaponImbue\r\n} from \"../../proto/common\";\r\nimport { Component } from \"../component\";\r\nimport { IconEnumPicker } from \"../icon_enum_picker\";\r\n\r\nimport * as IconInputs from '../icon_inputs.js';\r\nimport { buildIconInput } from \"../icon_inputs.js\";\r\nimport { SettingsTab } from \"./settings_tab\";\r\n\r\nexport class ConsumesPicker extends Component {\r\n\tprotected settingsTab: SettingsTab;\r\n\tprotected simUI: IndividualSimUI<Spec>;\r\n\r\n\tconstructor(parentElem: HTMLElement, settingsTab: SettingsTab, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, 'consumes-picker-root');\r\n\t\tthis.settingsTab = settingsTab;\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.buildPotionsPicker();\r\n\t\tthis.buildElixirsPicker();\r\n\t\tthis.buildFoodPicker();\r\n\t\tif (!((this.simUI.player.getClass() == Class.ClassRogue) || (this.simUI.player.getClass() == Class.ClassShaman))) {\r\n\t\t\tthis.buildWeaponImbuePicker();\r\n\t\t  }\r\n\t\tthis.buildEngPicker();\r\n\t\tthis.buildPetPicker();\r\n\t}\r\n\r\n\tprivate buildPotionsPicker() {\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <div class=\"consumes-row input-root input-inline\">\r\n        <label class=\"form-label\">Potions</label>\r\n        <div class=\"consumes-row-inputs\">\r\n          <div class=\"consumes-prepot\"></div>\r\n          <div class=\"consumes-potions\"></div>\r\n          <div class=\"consumes-conjured\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\r\n\t\tconst prepopPotionOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t// This list is smaller because some potions don't make sense to use as prepot.\r\n\t\t\t// E.g. healing/mana potions.\r\n\t\t\t{ item: Potions.DestructionPotion, stats: [Stat.StatSpellCrit,Stat.StatSpellPower] },\r\n\t\t\t{ item: Potions.HeroicPotion, stats: [Stat.StatStrength] },\r\n\t\t\t{ item: Potions.InsaneStrengthPotion, stats: [Stat.StatStrength] },\r\n\t\t\t{ item: Potions.HastePotion, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\r\n\t\t]);\r\n\t\tif (prepopPotionOptions.length) {\r\n\t\t\tconst elem = this.rootElem.querySelector('.consumes-prepot') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(\r\n\t\t\t\telem,\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\tIconInputs.makePrepopPotionsInput(prepopPotionOptions, 'Prepop Potion (1s before combat)')\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst potionOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: Potions.SuperManaPotion, stats: [Stat.StatIntellect] },\r\n\t\t\t{ item: Potions.IronshieldPotion, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: Potions.HeroicPotion, stats: [Stat.StatStrength] },\r\n\t\t\t{ item: Potions.InsaneStrengthPotion, stats: [Stat.StatStrength] },\r\n\t\t\t{ item: Potions.HastePotion, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\r\n\t\t\t{ item: Potions.DestructionPotion, stats: [Stat.StatSpellCrit, Stat.StatSpellPower] },\r\n\t\t]);\r\n\t\tif (potionOptions.length) {\r\n\t\t\tconst elem = this.rootElem.querySelector('.consumes-potions') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(\r\n\t\t\t\telem,\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\tIconInputs.makePotionsInput(potionOptions, 'Combat Potion')\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst conjuredOptions = this.simUI.splitRelevantOptions([\r\n\t\t\tthis.simUI.player.getClass() == Class.ClassRogue ? { item: Conjured.ConjuredRogueThistleTea, stats: [] } : null,\r\n\t\t\t{ item: Conjured.ConjuredHealthstone, stats: [Stat.StatStamina] },\r\n\t\t\t{ item: Conjured.ConjuredDarkRune, stats: [Stat.StatIntellect] },\r\n\t\t\t{ item: Conjured.ConjuredFlameCap, stats: [] },\r\n\t\t]);\r\n\t\tif (conjuredOptions.length) {\r\n\t\t\tconst elem = this.rootElem.querySelector('.consumes-conjured') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(elem, this.simUI.player, IconInputs.makeConjuredInput(conjuredOptions));\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildElixirsPicker() {\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <div class=\"consumes-row input-root input-inline\">\r\n        <label class=\"form-label\">Elixirs</label>\r\n        <div class=\"consumes-row-inputs\">\r\n          <div class=\"consumes-flasks\"></div>\r\n          <span class=\"elixir-space\">or</span>\r\n          <div class=\"consumes-battle-elixirs\"></div>\r\n          <div class=\"consumes-guardian-elixirs\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\r\n\t\tconst flaskOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: Flask.FlaskOfSupremePower, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: Flask.FlaskOfRelentlessAssault, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: Flask.FlaskOfMightyRestoration, stats: [Stat.StatMP5] },\r\n\t\t\t{ item: Flask.FlaskOfFortification, stats: [Stat.StatStamina, Stat.StatDefense] },\r\n\t\t\t{ item: Flask.FlaskOfPureDeath, stats: [Stat.StatSpellPower] },\r\n      \t\t{ item: Flask.FlaskOfBlindingLight, stats: [Stat.StatSpellPower] },\r\n      \t\t{ item: Flask.FlaskOfDistilledWisdom, stats: [Stat.StatIntellect] },\r\n\t\t\t{ item: Flask.FlaskOfChromaticWonder, stats: [Stat.StatAgility,Stat.StatStrength,Stat.StatIntellect,Stat.StatStamina,Stat.StatSpirit,Stat.StatArcaneResistance, Stat.StatFireResistance, Stat.StatFrostResistance, Stat.StatNatureResistance, Stat.StatShadowResistance] },\r\n\t\t]);\r\n\t\tif (flaskOptions.length) {\r\n\t\t\tconst elem = this.rootElem.querySelector('.consumes-flasks') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(\r\n\t\t\t\telem,\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\tIconInputs.makeFlasksInput(flaskOptions, 'Flask')\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tconst battleElixirOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: BattleElixir.ElixirOfMajorShadowPower, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: BattleElixir.ElixirOfMajorFirePower, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: BattleElixir.FelStrengthElixir, stats: [Stat.StatAttackPower,Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: BattleElixir.ElixirOfMajorAgility, stats: [Stat.StatAgility,Stat.StatMeleeCrit] },\r\n\t\t\t{ item: BattleElixir.ElixirOfMastery, stats: [Stat.StatAgility,Stat.StatStrength,Stat.StatIntellect,Stat.StatStamina,Stat.StatSpirit] },\r\n    \t    { item: BattleElixir.ElixirOfHealingPower, stats: [Stat.StatSpirit,Stat.StatSpellPower] },\r\n\t\t\t{ item: BattleElixir.AdeptsElixir, stats: [Stat.StatSpellCrit,Stat.StatSpellPower] },\r\n\t\t\t{ item: BattleElixir.ElixirOfMajorStrength, stats: [Stat.StatStrength] },\r\n\t\t\t{ item: BattleElixir.ElixirOfDemonslaying, stats: [Stat.StatAttackPower,Stat.StatRangedAttackPower] },\r\n\t\t]);\r\n\r\n\t\tconst battleElixirsContainer = this.rootElem.querySelector('.consumes-battle-elixirs') as HTMLElement;\r\n\t\tif (battleElixirOptions.length) {\r\n\t\t\tnew IconEnumPicker(\r\n\t\t\t\tbattleElixirsContainer,\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\tIconInputs.makeBattleElixirsInput(battleElixirOptions, 'Battle Elixir')\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tbattleElixirsContainer.remove();\r\n\t\t}\r\n\r\n\t\tconst guardianElixirOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: GuardianElixir.ElixirOfDraenicWisdom, stats: [Stat.StatIntellect,Stat.StatSpirit] },\r\n\t\t\t{ item: GuardianElixir.ElixirOfMajorFortitude, stats: [Stat.StatStamina] },\r\n\t\t\t{ item: GuardianElixir.ElixirOfMajorMageblood, stats: [Stat.StatMP5] },\r\n\t\t\t{ item: GuardianElixir.ElixirOfMajorDefense, stats: [Stat.StatArmor] },\r\n\t\t]);\r\n\r\n\t\tconst guardianElixirsContainer = this.rootElem.querySelector('.consumes-guardian-elixirs') as HTMLElement;\r\n\t\tif (guardianElixirOptions.length) {\r\n\t\t\tconst guardianElixirsContainer = this.rootElem.querySelector('.consumes-guardian-elixirs') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(\r\n\t\t\t\tguardianElixirsContainer,\r\n\t\t\t\tthis.simUI.player,\r\n\t\t\t\tIconInputs.makeGuardianElixirsInput(guardianElixirOptions, 'Guardian Elixir')\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tguardianElixirsContainer.remove();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildFoodPicker() {\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <div class=\"consumes-row input-root input-inline\">\r\n        <label class=\"form-label\">Food</label>\r\n        <div class=\"consumes-row-inputs\">\r\n          <div class=\"consumes-food\"></div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\r\n\t\tconst foodOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: Food.FoodBlackenedBasilisk, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: Food.FoodRoastedClefthoof, stats: [Stat.StatStrength] },\r\n    \t    { item: Food.FoodGrilledMudfish, stats: [Stat.StatAgility]},\r\n\t\t\t{ item: Food.FoodRavagerDog, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: Food.FoodSpicyHotTalbuk, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\r\n      \t\t{ item: Food.FoodFishermansFeast, stats: [Stat.StatStamina] },\r\n   \t\t    { item: Food.FoodSkullfishSoup, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit]},\r\n\t\t]);\r\n\t\tif (foodOptions.length) {\r\n\t\t\tconst elem = this.rootElem.querySelector('.consumes-food') as HTMLElement;\r\n\t\t\tnew IconEnumPicker(elem, this.simUI.player, IconInputs.makeFoodInput(foodOptions));\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildWeaponImbuePicker() {\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\t\r\n\t\tfragment.innerHTML = `\r\n\t\t  <div class=\"consumes-row input-root input-inline\">\r\n\t\t\t<label class=\"form-label\">Weapon Imbue</label>\r\n\t\t\t<div class=\"consumes-row-inputs\">\r\n\t\t\t  <div class=\"consumes-weapon-main\"></div>\r\n\t\t\t  <div class=\"consumes-weapon-off\"></div>\r\n\t\t\t</div>\r\n\t\t  </div>\r\n\t\t`;\r\n\t\r\n\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\t\r\n\t\tconst weaponOptions = this.simUI.splitRelevantOptions([\r\n\t\t\tthis.simUI.player.getClass() == Class.ClassWarlock ? { item: WeaponImbue.ImbueSpellStone, stats: [] } : null,\r\n\t\t\tthis.simUI.player.getClass() == Class.ClassWarlock ? { item: WeaponImbue.ImbueFireStone, stats: [] } : null,\r\n\t\t\t{ item: WeaponImbue.ImbueBrilliantWizardOil, stats: [Stat.StatSpellPower,Stat.StatSpellCrit] },\r\n\t\t\t{ item: WeaponImbue.ImbueBrilliantManaOil, stats: [Stat.StatSpellPower,Stat.StatMP5]},\r\n\t\t\t{ item: WeaponImbue.ImbueSuperiorWizardOil, stats: [Stat.StatSpellPower]},\r\n\t\t\t{ item: WeaponImbue.ImbueSuperiorManaOil, stats: [Stat.StatMP5]},\r\n\t\t\t{ item: WeaponImbue.ImbueAdamantiteSharpeningStone, stats: [Stat.StatAttackPower, Stat.StatMeleeCrit]},\r\n\t\t\t{ item: WeaponImbue.ImbueAdamantiteWeightStone, stats: [Stat.StatAttackPower, Stat.StatMeleeCrit]},\r\n\t\t\t{ item: WeaponImbue.ImbueElementalSharpeningStone, stats: [Stat.StatMeleeCrit]},\r\n\t\t]);\r\n\r\n\t\tif (weaponOptions.length) {\r\n\t\t\tconst main = this.rootElem.querySelector('.consumes-weapon-main') as HTMLElement;\r\n\t\t\tconst off =  this.rootElem.querySelector('.consumes-weapon-off') as HTMLElement;\r\n\t\t\tconst inputs = off.parentElement!;\r\n\t\t\t\r\n\t\t\tlet offImbue = WeaponImbue.ImbueUnknown;\r\n\r\n\t\t\tnew IconEnumPicker(main, this.simUI.player, IconInputs.makeMainWeaponImbueInput(weaponOptions));\r\n\t\t\tvar offpicker = new IconEnumPicker(off,  this.simUI.player, IconInputs.makeOffWeaponImbueInput(weaponOptions));\r\n\r\n\t\t\tconst updateGear = () => {\r\n\t\t\t\tif (this.simUI.player.getGear().hasSharpOHWeapon() || this.simUI.player.getGear().hasBluntOHWeapon()){\r\n\t\t\t\t\tif (!inputs.contains(off)) {\r\n\t\t\t\t\t\tinputs.appendChild(off);\r\n\t\t\t\t\t\toffpicker.setInputValue(offImbue);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\telse if (inputs.contains(off)) {\r\n\t\t\t\t\toffImbue = offpicker.getInputValue();\r\n\t\t\t\t\toffpicker.setInputValue(WeaponImbue.ImbueUnknown);\r\n\t\t\t\t\tinputs.removeChild(off);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t\t\tthis.simUI.player.gearChangeEmitter.on(updateGear);\r\n\t\t\tupdateGear();\r\n\t\t}\r\n\t  }\r\n\r\n\tprivate buildEngPicker() {\r\n\t\tlet fragment = document.createElement('fragment');\r\n\t\tfragment.innerHTML = `\r\n      <div class=\"consumes-row input-root input-inline\">\r\n        <label class=\"form-label\">Engineering</label>\r\n        <div class=\"consumes-row-inputs consumes-trade\"></div>\r\n      </div>\r\n    `;\r\n\r\n\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\r\n\t\tconst tradeConsumesElem = this.rootElem.querySelector('.consumes-trade') as HTMLElement;\r\n\r\n\t\tbuildIconInput(tradeConsumesElem, this.simUI.player, IconInputs.SuperSapper);\r\n\t\tbuildIconInput(tradeConsumesElem, this.simUI.player, IconInputs.FillerExplosiveInput);\r\n\r\n\t\tconst updateProfession = () => {\r\n\t\t\tif (this.simUI.player.hasProfession(Profession.Engineering))\r\n\t\t\t\ttradeConsumesElem.parentElement!.classList.remove('hide');\r\n\t\t\telse\r\n\t\t\t\ttradeConsumesElem.parentElement!.classList.add('hide');\r\n\t\t};\r\n\t\tthis.simUI.player.professionChangeEmitter.on(updateProfession);\r\n\t\tupdateProfession();\r\n\t}\r\n\r\n\tprivate buildPetPicker() {\r\n\t\tif (this.simUI.individualConfig.petConsumeInputs?.length) {\r\n\t\t\tlet fragment = document.createElement('fragment');\r\n\t\t\tfragment.innerHTML = `\r\n        <div class=\"consumes-row input-root input-inline\">\r\n          <label class=\"form-label\">Pet</label>\r\n          <div class=\"consumes-row-inputs consumes-pet\"></div>\r\n        </div>\r\n      `;\r\n\r\n\t\t\tthis.rootElem.appendChild(fragment.children[0] as HTMLElement);\r\n\r\n\t\t\tconst petConsumesElem = this.rootElem.querySelector('.consumes-pet') as HTMLElement;\r\n\t\t\tthis.simUI.individualConfig.petConsumeInputs.map(iconInput => buildIconInput(petConsumesElem, this.simUI.player, iconInput));\r\n\t\t}\r\n\t}\r\n}\r\n","export const BUFFS_SECTION = 'Buffs provided by other party/raid members.';\r\nexport const DEBUFFS_SECTION = 'Debuffs applied by other raid members.';\r\nexport const COOLDOWNS_SECTION = 'Specify cooldown timings, in seconds. Cooldowns will be used as soon as possible after their specified timings. When not specified, cooldowns will be used when ready and it is sensible to do so.<br><br>Multiple timings can be provided by separating with commas. Any cooldown usages after the last provided timing will use the default logic.';\r\nexport const BLESSINGS_SECTION = 'Specify Paladin Blessings for each role, in order of priority. Blessings in the 1st column will be used if there is at least 1 Paladin in the raid, 2nd column if at least 2, etc.';\r\n\r\nexport const BASIC_BIS_DISCLAIMER = '<p>Preset gear lists are intended as rough approximations of BIS, and will often not be the absolute highest-DPS setup for you. Your optimal gear setup will depend on many factors; that\\'s why we have a sim!</p><p>Items may also be omitted from the presets if they are highly contested and clearly better utilized on other classes, to encourage equitable gearing for the raid as a whole.</p>';\r\n\r\nexport const HEALING_SIM_DISCLAIMER = '*** WARNING - USE AT YOUR OWN RISK ***\\n\\nThe entire concept of a healing sim is EXPERIMENTAL. All results should be taken with an EXTREMELY large grain of salt.\\n\\nThis tool is currently more similar to a spreadsheet than a true sim. Options for specifying incoming damage profiles in order to have proper reactive rotations have not yet been added.';\r\n","import { Spec, ItemSlot, ItemSwap } from '../proto/common.js';\r\nimport { Player } from '../player.js';\r\nimport { Component } from './component.js';\r\nimport { IconItemSwapPicker } from './gear_picker.js'\r\nimport { Input, InputConfig } from './input.js'\r\nimport { SimUI } from '../sim_ui.js';\r\nimport { TypedEvent } from '../typed_event.js';\r\nimport tippy from 'tippy.js';\r\n\r\nexport interface ItemSwapPickerConfig<SpecType extends Spec, T> extends InputConfig<Player<SpecType>, T> {\r\n\titemSlots: Array<ItemSlot>;\r\n}\r\n\r\nexport class ItemSwapPicker<SpecType extends Spec, T> extends Component {\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: SimUI, player: Player<SpecType>, config: ItemSwapPickerConfig<SpecType, T>) {\r\n\t\tsuper(parentElem, 'item-swap-picker-root');\r\n\r\n\t\tthis.rootElem.classList.add('input-root', 'input-inline')\r\n\r\n\t\tconst label = document.createElement(\"label\")\r\n\t\tlabel.classList.add('form-label')\r\n\t\tlabel.textContent = \"Item Swap\"\r\n\t\tthis.rootElem.appendChild(label);\r\n\r\n\t\tif (config.labelTooltip) {\r\n\t\t\ttippy(label, {\r\n\t\t\t\t'content': config.labelTooltip,\r\n\t\t\t\tignoreAttributes: true,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet itemSwapContainer = Input.newGroupContainer();\r\n\t\titemSwapContainer.classList.add('icon-group')\r\n\t\tthis.rootElem.appendChild(itemSwapContainer);\r\n\r\n\t\tlet swapButtonFragment = document.createElement('fragment');\r\n\t\tswapButtonFragment.innerHTML = `\r\n\t\t\t<a\r\n\t\t\t\thref=\"javascript:void(0)\"\r\n\t\t\t\tclass=\"gear-swap-icon\"\r\n\t\t\t\trole=\"button\"\r\n\t\t\t\tdata-bs-toggle=\"tooltip\"\r\n\t\t\t\tdata-bs-title=\"Swap Items with Main Gear\"\r\n\t\t\t>\r\n\t\t\t\t<i class=\"fas fa-arrows-rotate me-1\"></i>\r\n\t\t\t</a>\r\n\t\t`\r\n\r\n\t\tconst swapButton = swapButtonFragment.children[0] as HTMLElement;\r\n\t\titemSwapContainer.appendChild(swapButton)\r\n\r\n\t\tswapButton.addEventListener('click', event => { this.swapWithGear(player, config) });\r\n\r\n\t\tconfig.changedEvent(player).on(eventID => {\r\n\t\t\tconst show = !config.showWhen || config.showWhen(player);\r\n\t\t\tif (show) {\r\n\t\t\t\tthis.rootElem.classList.remove('hide');\r\n\t\t\t} else {\r\n\t\t\t\tthis.rootElem.classList.add('hide');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconfig.itemSlots.forEach(itemSlot => {\r\n\t\t\tnew IconItemSwapPicker(itemSwapContainer, simUI, player, itemSlot, config);\r\n\t\t});\r\n\t}\r\n\r\n\tswapWithGear(player: Player<SpecType>, config: ItemSwapPickerConfig<SpecType, T>) {\r\n\t\tlet gear = player.getGear()\r\n\r\n\t\tconst gearMap = new Map();\r\n\t\tconst itemSwapMap = new Map();\r\n\r\n\t\tconfig.itemSlots.forEach(slot => {\r\n\t\t\tconst gearItem = player.getGear().getEquippedItem(slot)\r\n\t\t\tconst swapItem = player.getItemSwapGear().getEquippedItem(slot)\r\n\r\n\t\t\tgearMap.set(slot, gearItem)\r\n\t\t\titemSwapMap.set(slot, swapItem)\r\n\t\t})\r\n\r\n\t\titemSwapMap.forEach((item, slot) => {\r\n\t\t\tgear = gear.withEquippedItem(slot, item, player.canDualWield2H())\r\n\t\t})\r\n\r\n\t\tgearMap.forEach((item, slot) => {\r\n\t\t\tplayer.getItemSwapGear().equipItem(slot, item, player.canDualWield2H())\r\n\t\t})\r\n\r\n\t\tlet eventID = TypedEvent.nextEventID()\r\n\t\tplayer.setGear(eventID, gear)\r\n\r\n\t\tconst itemSwap = player.getItemSwapGear().toProto() as unknown as T\r\n\t\tconfig.setValue(eventID, player, itemSwap)\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n","import { IndividualSimUI, InputSection, StatOption } from \"../../individual_sim_ui\";\r\nimport {\r\n\tConsumes,\r\n\tCooldowns,\r\n\tDebuffs,\r\n\tHealingModel,\r\n\tIndividualBuffs,\r\n\tItemSlot,\r\n\tPartyBuffs,\r\n\tProfession,\r\n\tRaidBuffs,\r\n\tSpec,\r\n\tStat\r\n} from \"../../proto/common\";\r\nimport { ActionId } from \"../../proto_utils/action_id\";\r\nimport {nameToShattFaction, professionNames, raceNames } from \"../../proto_utils/names\";\r\nimport { specToEligibleRaces } from \"../../proto_utils/utils\";\r\nimport { Encounter } from '../../encounter';\r\nimport { SavedEncounter, SavedSettings } from \"../../proto/ui\";\r\nimport { EventID, TypedEvent } from \"../../typed_event\";\r\nimport { getEnumValues } from \"../../utils\";\r\nimport { Player } from \"../../player\";\r\nimport { aplLaunchStatuses, LaunchStatus } from '../../launched_sims';\r\n\r\nimport { ContentBlock } from \"../content_block\";\r\nimport { EncounterPicker } from '../encounter_picker.js';\r\nimport { SavedDataManager } from \"../saved_data_manager\";\r\nimport { SimTab } from \"../sim_tab\";\r\nimport { NumberPicker } from \"../number_picker\";\r\nimport { BooleanPicker } from \"../boolean_picker\";\r\nimport { EnumPicker } from \"../enum_picker\";\r\nimport { Input } from \"../input\";\r\nimport { MultiIconPicker } from \"../multi_icon_picker\";\r\nimport { IconPickerConfig } from \"../icon_picker\";\r\nimport { TypedIconPickerConfig } from \"../input_helpers\";\r\n\r\nimport { CustomRotationPicker } from \"./custom_rotation_picker\";\r\nimport { CooldownsPicker } from \"./cooldowns_picker\";\r\nimport { ConsumesPicker } from \"./consumes_picker\";\r\n\r\nimport * as IconInputs from '../icon_inputs.js';\r\nimport * as Tooltips from '../../constants/tooltips.js';\r\nimport { ItemSwapPicker } from \"../item_swap_picker\";\r\n\r\nexport class SettingsTab extends SimTab {\r\n\tprotected simUI: IndividualSimUI<Spec>;\r\n\r\n\treadonly leftPanel: HTMLElement;\r\n\treadonly rightPanel: HTMLElement;\r\n\r\n\treadonly column1: HTMLElement = this.buildColumn(1, 'settings-left-col');\r\n\treadonly column2: HTMLElement = this.buildColumn(2, 'settings-left-col');\r\n\treadonly column3: HTMLElement = this.buildColumn(3, 'settings-left-col');\r\n\treadonly column4?: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, simUI, { identifier: 'settings-tab', title: 'Settings' });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.leftPanel = document.createElement('div');\r\n\t\tthis.leftPanel.classList.add('settings-tab-left', 'tab-panel-left');\r\n\r\n\t\tthis.leftPanel.appendChild(this.column1);\r\n\t\tthis.leftPanel.appendChild(this.column2);\r\n\t\tthis.leftPanel.appendChild(this.column3);\r\n\r\n\t\t// The 4th column is only used in the raid sim player editor to spread out player settings\r\n\t\tif (this.simUI.isWithinRaidSim) {\r\n\t\t\tthis.column4 = this.buildColumn(4, 'settings-left-col');\r\n\t\t\tthis.leftPanel.appendChild(this.column4);\r\n\t\t}\r\n\r\n\t\tthis.rightPanel = document.createElement('div');\r\n\t\tthis.rightPanel.classList.add('settings-tab-right', 'tab-panel-right', 'within-raid-sim-hide');\r\n\r\n\t\tthis.contentContainer.appendChild(this.leftPanel);\r\n\t\tthis.contentContainer.appendChild(this.rightPanel);\r\n\r\n\t\tthis.buildTabContent();\r\n\t}\r\n\r\n\tprotected buildTabContent() {\r\n\t\tif (!this.simUI.isWithinRaidSim) {\r\n\t\t\tthis.buildEncounterSettings();\r\n\t\t}\r\n\r\n\t\tif (aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Unlaunched) {\r\n\t\t\tthis.buildRotationSettings();\r\n\t\t}\r\n\r\n\t\tthis.buildPlayerSettings();\r\n\t\tthis.buildCustomSettingsSections();\r\n\t\tthis.buildConsumesSection();\r\n\t\tif (aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Unlaunched) {\r\n\t\t\tthis.buildCooldownSettings();\r\n\t\t}\r\n\t\tthis.buildOtherSettings();\r\n\r\n\t\tif (!this.simUI.isWithinRaidSim) {\r\n\t\t\tthis.buildBuffsSettings();\r\n\t\t\tthis.buildDebuffsSettings();\r\n\t\t}\r\n\r\n\t\tif (!this.simUI.isWithinRaidSim) {\r\n\t\t\tthis.buildSavedDataPickers();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildEncounterSettings() {\r\n\t\tconst contentBlock = new ContentBlock(this.column1, 'encounter-settings', {\r\n\t\t\theader: { title: 'Encounter' }\r\n\t\t});\r\n\r\n\t\tnew EncounterPicker(contentBlock.bodyElement, this.simUI.sim.encounter, this.simUI.individualConfig.encounterPicker, this.simUI);\r\n\t}\r\n\r\n\tprivate buildRotationSettings() {\r\n\t\tconst contentBlock = new ContentBlock(this.column1, 'rotation-settings', {\r\n\t\t\theader: { title: 'Rotation' }\r\n\t\t});\r\n\r\n\t\tconst rotationIconGroup = Input.newGroupContainer();\r\n\t\trotationIconGroup.classList.add('rotation-icon-group', 'icon-group');\r\n\t\tcontentBlock.bodyElement.appendChild(rotationIconGroup);\r\n\r\n\t\tif (this.simUI.individualConfig.rotationIconInputs?.length) {\r\n\t\t\tthis.configureIconSection(\r\n\t\t\t\trotationIconGroup,\r\n\t\t\t\tthis.simUI.individualConfig.rotationIconInputs.map(iconInput => IconInputs.buildIconInput(rotationIconGroup, this.simUI.player, iconInput)),\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.rotationInputs);\r\n\r\n\t\tcontentBlock.bodyElement.querySelectorAll('.input-root').forEach(elem => {\r\n\t\t\telem.classList.add('input-inline');\r\n\t\t})\r\n\t}\r\n\r\n\tprivate buildPlayerSettings() {\r\n\t\tconst column = aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Unlaunched ? this.column2 : this.column1;\r\n\t\tconst contentBlock = new ContentBlock(column, 'player-settings', {\r\n\t\t\theader: { title: 'Player' }\r\n\t\t});\r\n\r\n\t\tconst playerIconGroup = Input.newGroupContainer();\r\n\t\tplayerIconGroup.classList.add('player-icon-group', 'icon-group');\r\n\t\tcontentBlock.bodyElement.appendChild(playerIconGroup);\r\n\r\n\t\tthis.configureIconSection(\r\n\t\t\tplayerIconGroup,\r\n\t\t\tthis.simUI.individualConfig.playerIconInputs.map(iconInput => IconInputs.buildIconInput(playerIconGroup, this.simUI.player, iconInput)),\r\n\t\t\ttrue\r\n\t\t);\r\n\r\n\t\tconst races = specToEligibleRaces[this.simUI.player.spec];\r\n\t\tconst racePicker = new EnumPicker(contentBlock.bodyElement, this.simUI.player, {\r\n\t\t\tlabel: 'Race',\r\n\t\t\tvalues: races.map(race => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: raceNames[race],\r\n\t\t\t\t\tvalue: race,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: sim => sim.raceChangeEmitter,\r\n\t\t\tgetValue: sim => sim.getRace(),\r\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setRace(eventID, newValue),\r\n\t\t});\r\n\r\n\t\tif (this.simUI.individualConfig.playerInputs?.inputs.length) {\r\n\t\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.playerInputs);\r\n\t\t}\r\n\r\n\t\tlet professionGroup = Input.newGroupContainer();\r\n\t\tcontentBlock.bodyElement.appendChild(professionGroup);\r\n\r\n\t\tconst professions = getEnumValues(Profession) as Array<Profession>;\r\n\t\tconst profession1Picker = new EnumPicker(professionGroup, this.simUI.player, {\r\n\t\t\tlabel: 'Profession 1',\r\n\t\t\tvalues: professions.map(p => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: professionNames[p],\r\n\t\t\t\t\tvalue: p,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\r\n\t\t\tgetValue: sim => sim.getProfession1(),\r\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession1(eventID, newValue),\r\n\t\t});\r\n\r\n\t\tconst profession2Picker = new EnumPicker(professionGroup, this.simUI.player, {\r\n\t\t\tlabel: 'Profession 2',\r\n\t\t\tvalues: professions.map(p => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: professionNames[p],\r\n\t\t\t\t\tvalue: p,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: sim => sim.professionChangeEmitter,\r\n\t\t\tgetValue: sim => sim.getProfession2(),\r\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setProfession2(eventID, newValue),\r\n\t\t});\r\n\r\n\t\tconst shattFactionPicker = new EnumPicker(contentBlock.bodyElement, this.simUI.player, {\r\n\t\t\tvalues: [\"Scryer\", \"Aldor\"].map(faction => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tname: faction,\r\n\t\t\t\t\tvalue: nameToShattFaction(faction),\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tchangedEvent: sim => sim.gearChangeEmitter,\r\n\t\t\tgetValue: sim => sim.getShattFaction(),\r\n\t\t\tsetValue: (eventID, sim, newValue) => sim.setShattFaction(eventID, newValue),\r\n\t\t\tshowWhen: (player: Player<any>) => this.simUI.player.getEquippedItem(ItemSlot.ItemSlotNeck)?.item.id == 34678 || this.simUI.player.getEquippedItem(ItemSlot.ItemSlotNeck)?.item.id == 34679,\r\n\t\t});\r\n\t}\r\n\t\r\n\r\n\tprivate buildCustomSettingsSections() {\r\n\t\t(this.simUI.individualConfig.customSections || []).forEach(customSection => {\r\n\t\t\tlet section = customSection(this.column2, this.simUI);\r\n\t\t\tsection.rootElem.classList.add('custom-section');\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildConsumesSection() {\r\n\t\tconst column = this.simUI.isWithinRaidSim ? this.column3 : this.column2;\r\n\t\tconst contentBlock = new ContentBlock(column, 'consumes-settings', {\r\n\t\t\theader: { title: 'Consumables' }\r\n\t\t});\r\n\r\n\t\tnew ConsumesPicker(contentBlock.bodyElement, this, this.simUI);\r\n\t}\r\n\r\n\tprivate buildCooldownSettings() {\r\n\t\tconst column = (this.simUI.isWithinRaidSim ? this.column4 : this.column2) as HTMLElement;\r\n\t\tconst contentBlock = new ContentBlock(column, 'cooldown-settings', {\r\n\t\t\theader: { title: 'Cooldowns', tooltip: Tooltips.COOLDOWNS_SECTION }\r\n\t\t});\r\n\r\n\t\tnew CooldownsPicker(contentBlock.bodyElement, this.simUI.player);\r\n\t}\r\n\r\n\tprivate buildOtherSettings() {\r\n\t\tconst column = this.simUI.isWithinRaidSim ? this.column4 : this.column2;\r\n\t\tconst settings = this.simUI.individualConfig.otherInputs?.inputs.filter(inputs =>\r\n\t\t\t!inputs.extraCssClasses?.includes('within-raid-sim-hide') || true\r\n\t\t)\r\n\r\n\t\tif (settings.length > 0) {\r\n\t\t\tconst contentBlock = new ContentBlock(this.column2, 'other-settings', {\r\n\t\t\t\theader: { title: 'Other' }\r\n\t\t\t});\r\n\r\n\t\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.otherInputs);\r\n\r\n\t\t\tcontentBlock.bodyElement.querySelectorAll('.input-root').forEach(elem => {\r\n\t\t\t\telem.classList.add('input-inline');\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildBuffsSettings() {\r\n\t\tconst contentBlock = new ContentBlock(this.column3, 'buffs-settings', {\r\n\t\t\theader: { title: 'Raid Buffs', tooltip: Tooltips.BUFFS_SECTION }\r\n\t\t});\r\n\r\n\t\tconst buffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.AllStatsBuff, stats: [] },\r\n\t\t\t{ item: IconInputs.AllStatsPercentBuff, stats: [] },\r\n\t\t\t{ item: IconInputs.HealthBuff, stats: [Stat.StatHealth] },\r\n\t\t\t{ item: IconInputs.ArmorBuff, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.StaminaBuff, stats: [Stat.StatStamina] },\r\n\t\t\t{ item: IconInputs.StrengthAndAgilityBuff, stats: [Stat.StatStrength, Stat.StatAgility] },\r\n\t\t\t{ item: IconInputs.IntellectBuff, stats: [Stat.StatIntellect] },\r\n\t\t\t{ item: IconInputs.SpiritBuff, stats: [Stat.StatSpirit] },\r\n\t\t\t{ item: IconInputs.AttackPowerBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: IconInputs.AttackPowerPercentBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: IconInputs.MeleeCritBuff, stats: [Stat.StatMeleeCrit] },\r\n\t\t\t{ item: IconInputs.MeleeHasteBuff, stats: [Stat.StatMeleeHaste] },\r\n\t\t\t{ item: IconInputs.SpellPowerBuff, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: IconInputs.SpellCritBuff, stats: [Stat.StatSpellCrit] },\r\n\t\t\t{ item: IconInputs.HastePercentBuff, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste] },\r\n\t\t\t{ item: IconInputs.DamagePercentBuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower, Stat.StatSpellPower] },\r\n\t\t\t{ item: IconInputs.DamageReductionPercentBuff, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.ResistanceBuff, stats: [Stat.StatNatureResistance, Stat.StatShadowResistance, Stat.StatFrostResistance] },\r\n\t\t\t{ item: IconInputs.DefensiveCooldownBuff, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.MP5Buff, stats: [Stat.StatMP5] },\r\n\t\t\t{ item: IconInputs.ReplenishmentBuff, stats: [Stat.StatMP5] },\r\n\t\t]);\r\n\r\n\t\tthis.configureIconSection(\r\n\t\t\tcontentBlock.bodyElement,\r\n\t\t\tbuffOptions.map(multiIconInput => new MultiIconPicker(contentBlock.bodyElement, this.simUI.player, multiIconInput, this.simUI))\r\n\t\t);\r\n\r\n\t\tconst otherBuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.Bloodlust, stats: [Stat.StatMeleeHaste, Stat.StatSpellHaste], inline: true, },\r\n\t\t\t{ item: IconInputs.SpellHasteBuff, stats: [Stat.StatSpellHaste] },\r\n\t\t] as Array<StatOption<IconInputs.IconInputConfig<Player<any>, any>>>);\r\n\t\totherBuffOptions.forEach(iconInput => IconInputs.buildIconInput(contentBlock.bodyElement, this.simUI.player, iconInput));\r\n\r\n\t\tconst revitalizeBuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.RevitalizeRejuvination, stats: [] },\r\n\t\t\t{ item: IconInputs.RevitalizeWildGrowth, stats: [] },\r\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\r\n\t\tif (revitalizeBuffOptions.length > 0) {\r\n\t\t\tnew MultiIconPicker(contentBlock.bodyElement, this.simUI.player, {\r\n\t\t\t\tinputs: revitalizeBuffOptions,\r\n\t\t\t\tnumColumns: 1,\r\n\t\t\t\tlabel: 'Revit',\r\n\t\t\t\tcategoryId: ActionId.fromSpellId(48545),\r\n\t\t\t}, this.simUI);\r\n\t\t}\r\n\r\n\t\tconst miscBuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.HeroicPresence, stats: [Stat.StatMeleeHit, Stat.StatSpellHit] },\r\n\t\t\t{ item: IconInputs.BraidedEterniumChain, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\r\n\t\t\t{ item: IconInputs.ChainOfTheTwilightOwl, stats: [Stat.StatSpellCrit, Stat.StatMeleeCrit] },\r\n\t\t\t{ item: IconInputs.FocusMagic, stats: [Stat.StatSpellCrit] },\r\n\t\t\t{ item: IconInputs.EyeOfTheNight, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: IconInputs.Thorns, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.RetributionAura, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.ManaTideTotem, stats: [Stat.StatMP5] },\r\n\t\t\t{ item: IconInputs.Innervate, stats: [Stat.StatMP5] },\r\n\t\t\t{ item: IconInputs.PowerInfusion, stats: [Stat.StatMP5, Stat.StatSpellPower] },\r\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\r\n\t\tif (miscBuffOptions.length > 0) {\r\n\t\t\tnew MultiIconPicker(contentBlock.bodyElement, this.simUI.player, {\r\n\t\t\t\tinputs: miscBuffOptions,\r\n\t\t\t\tnumColumns: 3,\r\n\t\t\t\tlabel: 'Misc',\r\n\t\t\t}, this.simUI);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildDebuffsSettings() {\r\n\t\tconst contentBlock = new ContentBlock(this.column3, 'debuffs-settings', {\r\n\t\t\theader: { title: 'Debuffs', tooltip: Tooltips.DEBUFFS_SECTION }\r\n\t\t});\r\n\r\n\t\tconst debuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.MajorArmorDebuff, stats: [Stat.StatArmorPenetration] },\r\n\t\t\t{ item: IconInputs.MinorArmorDebuff, stats: [Stat.StatArmorPenetration] },\r\n\t\t\t{ item: IconInputs.PhysicalDamageDebuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: IconInputs.BleedDebuff, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t\t{ item: IconInputs.SpellDamageDebuff, stats: [Stat.StatSpellPower] },\r\n\t\t\t{ item: IconInputs.SpellHitDebuff, stats: [Stat.StatSpellHit] },\r\n\t\t\t{ item: IconInputs.SpellCritDebuff, stats: [Stat.StatSpellCrit] },\r\n\t\t\t{ item: IconInputs.CritDebuff, stats: [Stat.StatMeleeCrit, Stat.StatSpellCrit] },\r\n\t\t\t{ item: IconInputs.AttackPowerDebuff, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.MeleeAttackSpeedDebuff, stats: [Stat.StatArmor] },\r\n\t\t\t{ item: IconInputs.MeleeHitDebuff, stats: [Stat.StatDodge] },\r\n\t\t]);\r\n\r\n\t\tthis.configureIconSection(\r\n\t\t\tcontentBlock.bodyElement,\r\n\t\t\tdebuffOptions.map(multiIconInput => new MultiIconPicker(contentBlock.bodyElement, this.simUI.player, multiIconInput, this.simUI))\r\n\t\t);\r\n\r\n\t\tconst otherDebuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.JudgementOfWisdom, stats: [Stat.StatMP5, Stat.StatIntellect] },\r\n\t\t\t{ item: IconInputs.HuntersMark, stats: [Stat.StatRangedAttackPower] },\r\n\t\t] as Array<StatOption<TypedIconPickerConfig<Player<any>, any>>>);\r\n\t\totherDebuffOptions.forEach(iconInput => IconInputs.buildIconInput(contentBlock.bodyElement, this.simUI.player, iconInput));\r\n\r\n\t\tconst miscDebuffOptions = this.simUI.splitRelevantOptions([\r\n\t\t\t{ item: IconInputs.JudgementOfLight, stats: [Stat.StatStamina] },\r\n\t\t\t{ item: IconInputs.GiftOfArthas, stats: [Stat.StatAttackPower, Stat.StatRangedAttackPower] },\r\n\t\t] as Array<StatOption<IconPickerConfig<Player<any>, any>>>);\r\n\t\tif (miscDebuffOptions.length > 0) {\r\n\t\t\tnew MultiIconPicker(contentBlock.bodyElement, this.simUI.player, {\r\n\t\t\t\tinputs: miscDebuffOptions,\r\n\t\t\t\tnumColumns: 3,\r\n\t\t\t\tlabel: 'Misc',\r\n\t\t\t}, this.simUI);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildSavedDataPickers() {\r\n\t\tconst savedEncounterManager = new SavedDataManager<Encounter, SavedEncounter>(this.rightPanel, this.simUI, this.simUI.sim.encounter, {\r\n\t\t\tlabel: 'Encounter',\r\n\t\t\theader: { title: 'Saved Encounters' },\r\n\t\t\tstorageKey: this.simUI.getSavedEncounterStorageKey(),\r\n\t\t\tgetData: (encounter: Encounter) => SavedEncounter.create({ encounter: encounter.toProto() }),\r\n\t\t\tsetData: (eventID: EventID, encounter: Encounter, newEncounter: SavedEncounter) => encounter.fromProto(eventID, newEncounter.encounter!),\r\n\t\t\tchangeEmitters: [this.simUI.sim.encounter.changeEmitter],\r\n\t\t\tequals: (a: SavedEncounter, b: SavedEncounter) => SavedEncounter.equals(a, b),\r\n\t\t\ttoJson: (a: SavedEncounter) => SavedEncounter.toJson(a),\r\n\t\t\tfromJson: (obj: any) => SavedEncounter.fromJson(obj),\r\n\t\t});\r\n\r\n\t\tconst savedSettingsManager = new SavedDataManager<IndividualSimUI<any>, SavedSettings>(this.rightPanel, this.simUI, this.simUI, {\r\n\t\t\tlabel: 'Settings',\r\n\t\t\theader: { title: 'Saved Settings' },\r\n\t\t\tstorageKey: this.simUI.getSavedSettingsStorageKey(),\r\n\t\t\tgetData: (simUI: IndividualSimUI<any>) => {\r\n\t\t\t\tconst player = simUI.player;\r\n\t\t\t\treturn SavedSettings.create({\r\n\t\t\t\t\traidBuffs: simUI.sim.raid.getBuffs(),\r\n\t\t\t\t\tpartyBuffs: player.getParty()?.getBuffs() || PartyBuffs.create(),\r\n\t\t\t\t\tplayerBuffs: player.getBuffs(),\r\n\t\t\t\t\tdebuffs: simUI.sim.raid.getDebuffs(),\r\n\t\t\t\t\tconsumes: player.getConsumes(),\r\n\t\t\t\t\trace: player.getRace(),\r\n\t\t\t\t\tprofessions: player.getProfessions(),\r\n\t\t\t\t\treactionTimeMs: player.getReactionTime(),\r\n\t\t\t\t\tchannelClipDelayMs: player.getChannelClipDelay(),\r\n\t\t\t\t\tinFrontOfTarget: player.getInFrontOfTarget(),\r\n\t\t\t\t\tdistanceFromTarget: player.getDistanceFromTarget(),\r\n\t\t\t\t\thealingModel: player.getHealingModel(),\r\n\t\t\t\t\tcooldowns: aplLaunchStatuses[simUI.player.spec] == LaunchStatus.Unlaunched ? player.getCooldowns() : undefined,\r\n\t\t\t\t\trotationJson: aplLaunchStatuses[simUI.player.spec] == LaunchStatus.Unlaunched ? JSON.stringify(player.specTypeFunctions.rotationToJson(player.getRotation())) : undefined,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tsetData: (eventID: EventID, simUI: IndividualSimUI<any>, newSettings: SavedSettings) => {\r\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\t\t\tsimUI.sim.raid.setBuffs(eventID, newSettings.raidBuffs || RaidBuffs.create());\r\n\t\t\t\t\tsimUI.sim.raid.setDebuffs(eventID, newSettings.debuffs || Debuffs.create());\r\n\t\t\t\t\tconst party = simUI.player.getParty();\r\n\t\t\t\t\tif (party) {\r\n\t\t\t\t\t\tparty.setBuffs(eventID, newSettings.partyBuffs || PartyBuffs.create());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsimUI.player.setBuffs(eventID, newSettings.playerBuffs || IndividualBuffs.create());\r\n\t\t\t\t\tsimUI.player.setConsumes(eventID, newSettings.consumes || Consumes.create());\r\n\t\t\t\t\tsimUI.player.setRace(eventID, newSettings.race);\r\n\t\t\t\t\tsimUI.player.setProfessions(eventID, newSettings.professions);\r\n\t\t\t\t\tsimUI.player.setReactionTime(eventID, newSettings.reactionTimeMs);\r\n\t\t\t\t\tsimUI.player.setChannelClipDelay(eventID, newSettings.channelClipDelayMs);\r\n\t\t\t\t\tsimUI.player.setInFrontOfTarget(eventID, newSettings.inFrontOfTarget);\r\n\t\t\t\t\tsimUI.player.setDistanceFromTarget(eventID, newSettings.distanceFromTarget);\r\n\t\t\t\t\tsimUI.player.setHealingModel(eventID, newSettings.healingModel || HealingModel.create());\r\n\t\t\t\t\tif (aplLaunchStatuses[simUI.player.spec] == LaunchStatus.Unlaunched) {\r\n\t\t\t\t\t\tsimUI.player.setCooldowns(eventID, newSettings.cooldowns || Cooldowns.create());\r\n\t\t\t\t\t\tif (newSettings.rotationJson) {\r\n\t\t\t\t\t\t\tsimUI.player.setRotation(eventID, simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(newSettings.rotationJson)));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tchangeEmitters: [\r\n\t\t\t\tthis.simUI.sim.raid.buffsChangeEmitter,\r\n\t\t\t\tthis.simUI.sim.raid.debuffsChangeEmitter,\r\n\t\t\t\tthis.simUI.player.getParty()!.buffsChangeEmitter,\r\n\t\t\t\tthis.simUI.player.buffsChangeEmitter,\r\n\t\t\t\tthis.simUI.player.consumesChangeEmitter,\r\n\t\t\t\tthis.simUI.player.raceChangeEmitter,\r\n\t\t\t\tthis.simUI.player.professionChangeEmitter,\r\n\t\t\t\tthis.simUI.player.miscOptionsChangeEmitter,\r\n\t\t\t\tthis.simUI.player.inFrontOfTargetChangeEmitter,\r\n\t\t\t\tthis.simUI.player.distanceFromTargetChangeEmitter,\r\n\t\t\t\tthis.simUI.player.healingModelChangeEmitter,\r\n\t\t\t].concat(aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Unlaunched ? [\r\n\t\t\t\tthis.simUI.player.cooldownsChangeEmitter,\r\n\t\t\t\tthis.simUI.player.rotationChangeEmitter,\r\n\t\t\t] : []),\r\n\t\t\tequals: (a: SavedSettings, b: SavedSettings) => SavedSettings.equals(a, b),\r\n\t\t\ttoJson: (a: SavedSettings) => SavedSettings.toJson(a),\r\n\t\t\tfromJson: (obj: any) => SavedSettings.fromJson(obj),\r\n\t\t});\r\n\r\n\t\tthis.simUI.sim.waitForInit().then(() => {\r\n\t\t\tsavedEncounterManager.loadUserData();\r\n\t\t\tsavedSettingsManager.loadUserData();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate configureInputSection(sectionElem: HTMLElement, sectionConfig: InputSection) {\r\n\t\tsectionConfig.inputs.forEach(inputConfig => {\r\n\t\t\tif (inputConfig.type == 'number') {\r\n\t\t\t\tnew NumberPicker(sectionElem, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'boolean') {\r\n\t\t\t\tnew BooleanPicker(sectionElem, this.simUI.player, { ...inputConfig, ...{ cssScheme: this.simUI.cssScheme } });\r\n\t\t\t} else if (inputConfig.type == 'enum') {\r\n\t\t\t\tnew EnumPicker(sectionElem, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'customRotation') {\r\n\t\t\t\tnew CustomRotationPicker(sectionElem, this.simUI, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'itemSwap') {\r\n\t\t\t\tnew ItemSwapPicker(sectionElem, this.simUI, this.simUI.player, inputConfig)\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tprivate configureIconSection(sectionElem: HTMLElement, iconPickers: Array<any>, adjustColumns?: boolean) {\r\n\t\tif (iconPickers.length == 0) {\r\n\t\t\tsectionElem.classList.add('hide');\r\n\t\t} else if (adjustColumns) {\r\n\t\t\tif (iconPickers.length <= 4) {\r\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${iconPickers.length}, 1fr)`;\r\n\t\t\t} else if (iconPickers.length > 4 && iconPickers.length < 8) {\r\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${Math.ceil(iconPickers.length / 2)}, 1fr)`;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n}\r\n","import { EventID, TypedEvent } from '../typed_event.js';\r\n\r\nimport { Input, InputConfig } from './input.js';\r\n\r\n/**\r\n * Data for creating a string picker.\r\n */\r\nexport interface StringPickerConfig<ModObject> extends InputConfig<ModObject, string> {\r\n}\r\n\r\n// UI element for picking an arbitrary string field.\r\nexport class StringPicker<ModObject> extends Input<ModObject, string> {\r\n\tprivate readonly inputElem: HTMLSpanElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: StringPickerConfig<ModObject>) {\r\n\t\tsuper(parent, 'string-picker-root', modObject, config);\r\n\r\n\t\tthis.inputElem = document.createElement('span');\r\n\t\tthis.inputElem.setAttribute('contenteditable', '');\r\n\t\tthis.inputElem.classList.add('string-picker-input');\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('input', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): string {\r\n\t\treturn this.inputElem.textContent || '';\r\n\t}\r\n\r\n\tsetInputValue(newValue: string) {\r\n\t\tthis.inputElem.textContent = newValue;\r\n\t}\r\n}\r\n\r\n// A string picker which adapts its width to the input.\r\nexport class AdaptiveStringPicker<ModObject> extends Input<ModObject, string> {\r\n\tprivate readonly inputElem: HTMLInputElement;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: ModObject, config: InputConfig<ModObject, string>) {\r\n\t\tsuper(parent, 'adaptive-string-picker-root', modObject, config);\r\n\r\n\t\tthis.inputElem = document.createElement('input');\r\n\t\tthis.inputElem.type = 'text';\r\n\t\tthis.inputElem.classList.add('form-control')\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('change', event => {\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t\tthis.inputElem.addEventListener('input', event => {\r\n\t\t\tthis.updateSize();\r\n\t\t});\r\n\t\tthis.updateSize();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): string {\r\n\t\treturn this.inputElem.value;\r\n\t}\r\n\r\n\tsetInputValue(newValue: string) {\r\n\t\tthis.inputElem.value = newValue;\r\n\t\tthis.updateSize();\r\n\t}\r\n\r\n\tprivate updateSize() {\r\n\t\tconst newSize = Math.max(3, this.inputElem.value.length);\r\n\t\tif (this.inputElem.size != newSize)\r\n\t\t\tthis.inputElem.size = newSize;\r\n\t}\r\n}\r\n","import { OtherAction, UnitReference, UnitReference_Type as UnitType } from '../../proto/common.js';\r\nimport { ActionId, defaultTargetIcon, getPetIconFromName } from '../../proto_utils/action_id.js';\r\nimport { Player, UnitMetadata } from '../../player.js';\r\nimport { EventID, TypedEvent } from '../../typed_event.js';\r\nimport { bucket } from '../../utils.js';\r\nimport { AdaptiveStringPicker } from '../string_picker.js';\r\nimport { NumberPicker } from '../number_picker.js';\r\nimport { DropdownPicker, DropdownPickerConfig, DropdownValueConfig, TextDropdownPicker } from '../dropdown_picker.js';\r\nimport { UnitPicker, UnitPickerConfig, UnitValue } from '../unit_picker.js';\r\nimport { Input, InputConfig } from '../input.js';\r\nimport { ActionID } from '../../proto/common.js';\r\nimport { BooleanPicker } from '../boolean_picker.js';\r\nimport { APLValueRuneSlot, APLValueRuneType } from '../../proto/apl.js';\r\n\r\nexport type ACTION_ID_SET = 'auras' | 'stackable_auras' | 'icd_auras' | 'exclusive_effect_auras' | 'castable_spells' | 'channel_spells' | 'dot_spells' | 'shield_spells';\r\n\r\nconst actionIdSets: Record<ACTION_ID_SET, {\r\n\tdefaultLabel: string,\r\n\tgetActionIDs: (metadata: UnitMetadata) => Promise<Array<DropdownValueConfig<ActionId>>>,\r\n}> = {\r\n\t'auras': {\r\n\t\tdefaultLabel: 'Aura',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getAuras().map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'stackable_auras': {\r\n\t\tdefaultLabel: 'Aura',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getAuras().filter(aura => aura.data.maxStacks > 0).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'icd_auras': {\r\n\t\tdefaultLabel: 'Aura',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getAuras().filter(aura => aura.data.hasIcd).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'exclusive_effect_auras': {\r\n\t\tdefaultLabel: 'Aura',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getAuras().filter(aura => aura.data.hasExclusiveEffect).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'castable_spells': {\r\n\t\tdefaultLabel: 'Spell',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\tconst castableSpells = metadata.getSpells().filter(spell => spell.data.isCastable);\r\n\r\n\t\t\t// Split up non-cooldowns and cooldowns into separate sections for easier browsing.\r\n\t\t\tconst { 'spells': spells, 'cooldowns': cooldowns } = bucket(castableSpells, spell => spell.data.isMajorCooldown ? 'cooldowns' : 'spells');\r\n\r\n\t\t\tconst placeholders: Array<ActionId> = [\r\n\t\t\t\tActionId.fromOtherId(OtherAction.OtherActionPotion),\r\n\t\t\t];\r\n\r\n\t\t\treturn [\r\n\t\t\t\t[{\r\n\t\t\t\t\tvalue: ActionId.fromEmpty(),\r\n\t\t\t\t\theaderText: 'Spells',\r\n\t\t\t\t}],\r\n\t\t\t\t(spells || []).map(actionId => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t\t\textraCssClasses: (actionId.data.prepullOnly ? ['apl-prepull-actions-only'] : []),\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t\t[{\r\n\t\t\t\t\tvalue: ActionId.fromEmpty(),\r\n\t\t\t\t\theaderText: 'Cooldowns',\r\n\t\t\t\t}],\r\n\t\t\t\t(cooldowns || []).map(actionId => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t\t\textraCssClasses: (actionId.data.prepullOnly ? ['apl-prepull-actions-only'] : []),\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t\t[{\r\n\t\t\t\t\tvalue: ActionId.fromEmpty(),\r\n\t\t\t\t\theaderText: 'Placeholders',\r\n\t\t\t\t}],\r\n\t\t\t\tplaceholders.map(actionId => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: actionId,\r\n\t\t\t\t\t\ttooltip: 'The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started.',\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\t].flat();\r\n\t\t},\r\n\t},\r\n\t'channel_spells': {\r\n\t\tdefaultLabel: 'Channeled Spell',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getSpells().filter(spell => spell.data.isChanneled).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'dot_spells': {\r\n\t\tdefaultLabel: 'DoT Spell',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getSpells().filter(spell => spell.data.hasDot).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n\t'shield_spells': {\r\n\t\tdefaultLabel: 'Shield Spell',\r\n\t\tgetActionIDs: async (metadata) => {\r\n\t\t\treturn metadata.getSpells().filter(spell => spell.data.hasShield).map(actionId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: actionId.id,\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport type DEFAULT_UNIT_REF = 'self' | 'currentTarget';\r\n\r\nexport interface APLActionIDPickerConfig<ModObject> extends Omit<DropdownPickerConfig<ModObject, ActionID, ActionId>, 'defaultLabel' | 'equals' | 'setOptionContent' | 'values' | 'getValue' | 'setValue'> {\r\n\tactionIdSet: ACTION_ID_SET,\r\n\tgetUnitRef: (player: Player<any>) => UnitReference,\r\n\tdefaultUnitRef: DEFAULT_UNIT_REF,\r\n\tgetValue: (obj: ModObject) => ActionID,\r\n\tsetValue: (eventID: EventID, obj: ModObject, newValue: ActionID) => void,\r\n}\r\n\r\nexport class APLActionIDPicker extends DropdownPicker<Player<any>, ActionID, ActionId> {\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLActionIDPickerConfig<Player<any>>) {\r\n\t\tconst actionIdSet = actionIdSets[config.actionIdSet];\r\n\t\tsuper(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tsourceToValue: (src: ActionID) => src ? ActionId.fromProto(src) : ActionId.fromEmpty(),\r\n\t\t\tvalueToSource: (val: ActionId) => val.toProto(),\r\n\t\t\tdefaultLabel: actionIdSet.defaultLabel,\r\n\t\t\tequals: (a, b) => ((a == null) == (b == null)) && (!a || a.equals(b!)),\r\n\t\t\tsetOptionContent: (button, valueConfig) => {\r\n\t\t\t\tconst actionId = valueConfig.value;\r\n\r\n\t\t\t\tconst iconElem = document.createElement('a');\r\n\t\t\t\ticonElem.classList.add('apl-actionid-item-icon');\r\n\t\t\t\tactionId.setBackgroundAndHref(iconElem);\r\n\t\t\t\tbutton.appendChild(iconElem);\r\n\r\n\t\t\t\tconst textElem = document.createTextNode(actionId.name);\r\n\t\t\t\tbutton.appendChild(textElem);\r\n\t\t\t},\r\n\t\t\tcreateMissingValue: value => value.fill().then(filledId => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: filledId,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tvalues: [],\r\n\t\t});\r\n\r\n\t\tconst getUnitRef = config.getUnitRef;\r\n\t\tconst defaultRef = config.defaultUnitRef == 'self' ? UnitReference.create({type: UnitType.Self}) : UnitReference.create({type: UnitType.CurrentTarget});\r\n\t\tconst getActionIDs = actionIdSet.getActionIDs;\r\n\t\tconst updateValues = async () => {\r\n\t\t\tconst unitRef = getUnitRef(player);\r\n\t\t\tconst metadata = player.sim.getUnitMetadata(unitRef, player, defaultRef)\r\n\t\t\tif (metadata) {\r\n\t\t\t\tconst values = await getActionIDs(metadata);\r\n\t\t\t\tthis.setOptions(values);\r\n\t\t\t}\r\n\t\t};\r\n\t\tupdateValues();\r\n\t\tTypedEvent.onAny([player.sim.unitMetadataEmitter, player.rotationChangeEmitter]).on(updateValues);\r\n\t}\r\n}\r\n\r\nexport type UNIT_SET = 'aura_sources' | 'aura_sources_targets_first' | 'targets';\r\n\r\nconst unitSets: Record<UNIT_SET, {\r\n\t// Uses target icon by default instead of person icon. This should be set to true for inputs that default to CurrentTarget.\r\n\ttargetUI?: boolean,\r\n\tgetUnits: (player: Player<any>) => Array<UnitReference|undefined>,\r\n}> = {\r\n\t'aura_sources': {\r\n\t\tgetUnits: (player) => {\r\n\t\t\treturn [\r\n\t\t\t\tundefined,\r\n\t\t\t\tplayer.getPetMetadatas().asList().map((petMetadata, i) => UnitReference.create({type: UnitType.Pet, index: i, owner: UnitReference.create({type: UnitType.Self})})),\r\n\t\t\t\tUnitReference.create({type: UnitType.CurrentTarget}),\r\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({type: UnitType.Target, index: i})),\r\n\t\t\t].flat();\r\n\t\t},\r\n\t},\r\n\t'aura_sources_targets_first': {\r\n\t\ttargetUI: true,\r\n\t\tgetUnits: (player) => {\r\n\t\t\treturn [\r\n\t\t\t\tundefined,\r\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({type: UnitType.Target, index: i})),\r\n\t\t\t\tUnitReference.create({type: UnitType.Self}),\r\n\t\t\t\tplayer.getPetMetadatas().asList().map((petMetadata, i) => UnitReference.create({type: UnitType.Pet, index: i, owner: UnitReference.create({type: UnitType.Self})})),\r\n\t\t\t].flat();\r\n\t\t},\r\n\t},\r\n\t'targets': {\r\n\t\ttargetUI: true,\r\n\t\tgetUnits: (player) => {\r\n\t\t\treturn [\r\n\t\t\t\tundefined,\r\n\t\t\t\tplayer.sim.encounter.targetsMetadata.asList().map((targetMetadata, i) => UnitReference.create({type: UnitType.Target, index: i})),\r\n\t\t\t].flat();\r\n\t\t},\r\n\t},\r\n};\r\n\r\nexport interface APLUnitPickerConfig extends Omit<UnitPickerConfig<Player<any>>, 'values'> {\r\n\tunitSet: UNIT_SET,\r\n}\r\n\r\nexport class APLUnitPicker extends UnitPicker<Player<any>> {\r\n\tprivate readonly unitSet: UNIT_SET;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLUnitPickerConfig) {\r\n\t\tconst targetUI = !!unitSets[config.unitSet].targetUI;\r\n\t\tsuper(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tsourceToValue: (src: UnitReference|undefined) => APLUnitPicker.refToValue(src, player, targetUI),\r\n\t\t\tvalueToSource: (val: UnitValue) => val.value,\r\n\t\t\tvalues: [],\r\n\t\t\thideLabelWhenDefaultSelected: true,\r\n\t\t});\r\n\t\tthis.unitSet = config.unitSet;\r\n\t\tthis.rootElem.classList.add('apl-unit-picker');\r\n\r\n\t\tthis.updateValues();\r\n\t\tplayer.sim.unitMetadataEmitter.on(() => this.updateValues());\r\n\t}\r\n\r\n\tprivate static refToValue(ref: UnitReference|undefined, thisPlayer: Player<any>, targetUI: boolean|undefined): UnitValue {\r\n\t\tif (!ref || ref.type == UnitType.Unknown) {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: ref,\r\n\t\t\t\ticonUrl: targetUI ? 'fa-bullseye' : 'fa-user',\r\n\t\t\t\ttext: targetUI ? 'Current Target' : 'Self',\r\n\t\t\t};\r\n\t\t} else if (ref.type == UnitType.Self) {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: ref,\r\n\t\t\t\ticonUrl: 'fa-user',\r\n\t\t\t\ttext: 'Self',\r\n\t\t\t};\r\n\t\t} else if (ref.type == UnitType.CurrentTarget) {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: ref,\r\n\t\t\t\ticonUrl: 'fa-bullseye',\r\n\t\t\t\ttext: 'Current Target',\r\n\t\t\t};\r\n\t\t} else if (ref.type == UnitType.Player) {\r\n\t\t\tconst player = thisPlayer.sim.raid.getPlayer(ref.index);\r\n\t\t\tif (player) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: ref,\r\n\t\t\t\t\t//color: player.getClassColor(),\r\n\t\t\t\t\ticonUrl: player.getSpecIcon(),\r\n\t\t\t\t\ttext: `Player ${ref.index + 1}`,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else if (ref.type == UnitType.Target) {\r\n\t\t\tconst targetMetadata = thisPlayer.sim.encounter.targetsMetadata.asList()[ref.index]\r\n\t\t\tif (targetMetadata) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: ref,\r\n\t\t\t\t\ticonUrl: defaultTargetIcon,\r\n\t\t\t\t\ttext: `Target ${ref.index + 1}`,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else if (ref.type == UnitType.Pet) {\r\n\t\t\tconst petMetadata = thisPlayer.sim.getUnitMetadata(ref, thisPlayer, UnitReference.create({type: UnitType.Self}));\r\n\t\t\tlet name = `Pet ${ref.index + 1}`;\r\n\t\t\tlet icon: string|ActionId = 'fa-paw';\r\n\t\t\tif (petMetadata) {\r\n\t\t\t\tconst petName = petMetadata.getName();\r\n\t\t\t\tif (petName) {\r\n\t\t\t\t\tconst rmIdx = petName.indexOf(' - ');\r\n\t\t\t\t\tname = petName.substring(rmIdx + ' - '.length);\r\n\t\t\t\t\ticon = getPetIconFromName(name) || icon;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tvalue: ref,\r\n\t\t\t\ticonUrl: icon,\r\n\t\t\t\ttext: name,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tvalue: ref,\r\n\t\t};\r\n\t}\r\n\r\n\tprivate updateValues() {\r\n\t\tconst unitSet = unitSets[this.unitSet];\r\n\t\tconst values = unitSet.getUnits(this.modObject);\r\n\r\n\t\tthis.setOptions(values.map(v => {\r\n\t\t\tconst valueConfig: DropdownValueConfig<UnitValue> = {\r\n\t\t\t\tvalue: APLUnitPicker.refToValue(v, this.modObject, unitSet.targetUI),\r\n\t\t\t};\r\n\t\t\tif (v && v.type == UnitType.Pet) {\r\n\t\t\t\tif (unitSet.targetUI) {\r\n\t\t\t\t\tvalueConfig.submenu = [APLUnitPicker.refToValue(v.owner!, this.modObject, unitSet.targetUI)];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalueConfig.submenu = [APLUnitPicker.refToValue(undefined, this.modObject, unitSet.targetUI)];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn valueConfig;\r\n\t\t}));\r\n\t}\r\n}\r\n\r\ntype APLPickerBuilderFieldFactory<F> = (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, F>, getParentValue: () => any) => Input<Player<any>, F>;\r\n\r\nexport interface APLPickerBuilderFieldConfig<T, F extends keyof T> {\r\n\tfield: F,\r\n\tnewValue: () => T[F],\r\n\tfactory: APLPickerBuilderFieldFactory<T[F]>,\r\n\r\n\tlabel?: string,\r\n\tlabelTooltip?: string,\r\n}\r\n\r\nexport interface APLPickerBuilderConfig<T> extends InputConfig<Player<any>, T> {\r\n\tnewValue: () => T,\r\n\tfields: Array<APLPickerBuilderFieldConfig<T, any>>,\r\n}\r\n\r\nexport interface APLPickerBuilderField<T, F extends keyof T> extends APLPickerBuilderFieldConfig<T, F> {\r\n\tpicker: Input<Player<any>, T[F]>,\r\n}\r\n\r\nexport class APLPickerBuilder<T> extends Input<Player<any>, T> {\r\n\tprivate readonly config: APLPickerBuilderConfig<T>;\r\n\tprivate readonly fieldPickers: Array<APLPickerBuilderField<T, any>>;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: Player<any>, config: APLPickerBuilderConfig<T>) {\r\n\t\tsuper(parent, 'apl-picker-builder-root', modObject, config);\r\n\t\tthis.config = config;\r\n\r\n\t\tthis.fieldPickers = config.fields.map(fieldConfig => APLPickerBuilder.makeFieldPicker(this, fieldConfig));\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tprivate static makeFieldPicker<T, F extends keyof T>(builder: APLPickerBuilder<T>, fieldConfig: APLPickerBuilderFieldConfig<T, F>): APLPickerBuilderField<T, F> {\r\n\t\tconst field: F = fieldConfig.field\r\n\t\tconst picker = fieldConfig.factory(builder.rootElem, builder.modObject, {\r\n\t\t\tlabel: fieldConfig.label,\r\n\t\t\tlabelTooltip: fieldConfig.labelTooltip,\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => {\r\n\t\t\t\tconst source = builder.getSourceValue();\r\n\t\t\t\tif (!source[field]) {\r\n\t\t\t\t\tsource[field] = fieldConfig.newValue();\r\n\t\t\t\t}\r\n\t\t\t\treturn source[field];\r\n\t\t\t},\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\r\n\t\t\t\tbuilder.getSourceValue()[field] = newValue;\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t}, () => builder.getSourceValue())\r\n\r\n\t\tif (field === 'vals' || field === 'actions') {\r\n\t\t\tpicker.rootElem.classList.add('apl-picker-builder-multi')\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t...fieldConfig,\r\n\t\t\tpicker: picker,\r\n\t\t};\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): T {\r\n\t\tconst val = this.config.newValue();\r\n\t\tthis.fieldPickers.forEach(pickerData => {\r\n\t\t\tval[pickerData.field as keyof T] = pickerData.picker.getInputValue();\r\n\t\t});\r\n\t\treturn val;\r\n\t}\r\n\r\n\tsetInputValue(newValue: T) {\r\n\t\tthis.fieldPickers.forEach(pickerData => {\r\n\t\t\tpickerData.picker.setInputValue(newValue[pickerData.field as keyof T]);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport function actionIdFieldConfig(field: string, actionIdSet: ACTION_ID_SET, unitRefField?: string, defaultUnitRef?: DEFAULT_UNIT_REF, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => ActionID.create(),\r\n\t\tfactory: (parent, player, config, getParentValue) => new APLActionIDPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tactionIdSet: actionIdSet,\r\n\t\t\tgetUnitRef: () => unitRefField ? getParentValue()[unitRefField] : UnitReference.create(),\r\n\t\t\tdefaultUnitRef: defaultUnitRef || 'self',\r\n\t\t}),\r\n\t\t...(options || {}),\r\n\t};\r\n}\r\n\r\nexport function unitFieldConfig(field: string, unitSet: UNIT_SET, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => undefined,\r\n\t\tfactory: (parent, player, config) => new APLUnitPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tunitSet: unitSet,\r\n\t\t}),\r\n\t\t...(options || {}),\r\n\t};\r\n}\r\n\r\nexport function booleanFieldConfig(field: string, label?:string, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => false,\r\n\t\tfactory: (parent, player, config) => new BooleanPicker(parent, player, config),\r\n\t\t...(options || {}),\r\n\t\tlabel: label,\r\n\t};\r\n}\r\n\r\nexport function numberFieldConfig(field: string, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => 0,\r\n\t\tfactory: (parent, player, config) => new NumberPicker(parent, player, config),\r\n\t\t...(options || {}),\r\n\t};\r\n}\r\n\r\nexport function stringFieldConfig(field: string, options?: Partial<APLPickerBuilderFieldConfig<any, any>>): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => '',\r\n\t\tfactory: (parent, player, config) => {\r\n\t\t\tconfig.extraCssClasses = ['input-inline'].concat(config.extraCssClasses || []);\r\n\t\t\treturn new AdaptiveStringPicker(parent, player, config);\r\n\t\t},\r\n\t\t...(options || {}),\r\n\t};\r\n}\r\n\r\nexport function runeTypeFieldConfig(field: string, includeDeath: boolean): APLPickerBuilderFieldConfig<any, any> {\r\n\tlet values = [\r\n\t\t{ value: APLValueRuneType.RuneBlood, label: 'Blood' },\r\n\t\t{ value: APLValueRuneType.RuneFrost, label: 'Frost' },\r\n\t\t{ value: APLValueRuneType.RuneUnholy, label: 'Unholy' },\r\n\t]\r\n\r\n\tif (includeDeath) {\r\n\t\tvalues.push({ value: APLValueRuneType.RuneDeath, label: 'Death' })\r\n\t}\r\n\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => APLValueRuneType.RuneBlood,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: values,\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nexport function runeSlotFieldConfig(field: string): APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => APLValueRuneSlot.SlotLeftBlood,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotLeftBlood, label: 'Blood Left' },\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotRightBlood, label: 'Blood Right' },\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotLeftFrost, label: 'Frost Left' },\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotRightFrost, label: 'Frost Right' },\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotLeftUnholy, label: 'Unholy Left' },\r\n\t\t\t\t{ value: APLValueRuneSlot.SlotRightUnholy, label: 'Unholy Right' },\r\n\t\t\t],\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nexport function aplInputBuilder<T>(newValue: () => T, fields: Array<APLPickerBuilderFieldConfig<T, keyof T>>): (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T> {\r\n\treturn (parent, player, config) => {\r\n\t\treturn new APLPickerBuilder(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tnewValue: newValue,\r\n\t\t\tfields: fields,\r\n\t\t})\r\n\t}\r\n}\r\n","import {\r\n\tClass,\r\n\tSpec,\r\n} from '../../proto/common.js';\r\n\r\nimport {\r\n\tShamanTotems_TotemType as TotemType,\r\n} from '../../proto/shaman.js';\r\n\r\nimport {\r\n\tAPLValue,\r\n\tAPLValueAnd,\r\n\tAPLValueOr,\r\n\tAPLValueNot,\r\n\tAPLValueCompare,\r\n\tAPLValueCompare_ComparisonOperator as ComparisonOperator,\r\n\tAPLValueMath,\r\n\tAPLValueMath_MathOperator as MathOperator,\r\n\tAPLValueMax,\r\n\tAPLValueMin,\r\n\tAPLValueConst,\r\n\tAPLValueCurrentTime,\r\n\tAPLValueCurrentTimePercent,\r\n\tAPLValueRemainingTime,\r\n\tAPLValueRemainingTimePercent,\r\n\tAPLValueIsExecutePhase,\r\n\tAPLValueIsExecutePhase_ExecutePhaseThreshold as ExecutePhaseThreshold,\r\n\tAPLValueCurrentHealth,\r\n\tAPLValueCurrentHealthPercent,\r\n\tAPLValueCurrentMana,\r\n\tAPLValueCurrentManaPercent,\r\n\tAPLValueCurrentRage,\r\n\tAPLValueCurrentEnergy,\r\n\tAPLValueCurrentComboPoints,\r\n\tAPLValueCurrentRunicPower,\r\n\tAPLValueCurrentRuneCount,\r\n\tAPLValueCurrentRuneDeath,\r\n\tAPLValueCurrentRuneActive,\r\n\tAPLValueCurrentNonDeathRuneCount,\r\n\tAPLValueGCDIsReady,\r\n\tAPLValueGCDTimeToReady,\r\n\tAPLValueAutoTimeToNext,\r\n\tAPLValueSpellCanCast,\r\n\tAPLValueSpellIsReady,\r\n\tAPLValueSpellTimeToReady,\r\n\tAPLValueSpellCastTime,\r\n\tAPLValueSpellTravelTime,\r\n\tAPLValueSpellChannelTime,\r\n\tAPLValueSpellCPM,\r\n\tAPLValueSpellIsChanneling,\r\n\tAPLValueSpellChanneledTicks,\r\n\tAPLValueAuraIsActive,\r\n\tAPLValueAuraIsActiveWithReactionTime,\r\n\tAPLValueAuraRemainingTime,\r\n\tAPLValueAuraNumStacks,\r\n\tAPLValueAuraInternalCooldown,\r\n\tAPLValueAuraICDIsReadyWithReactionTime,\r\n\tAPLValueAuraShouldRefresh,\r\n\tAPLValueDotIsActive,\r\n\tAPLValueDotRemainingTime,\r\n\tAPLValueSequenceIsComplete,\r\n\tAPLValueSequenceIsReady,\r\n\tAPLValueSequenceTimeToReady,\r\n\tAPLValueRuneCooldown,\r\n\tAPLValueNextRuneCooldown,\r\n\tAPLValueNumberTargets,\r\n\tAPLValueTotemRemainingTime,\r\n\tAPLValueCatExcessEnergy,\r\n\tAPLValueRuneSlotCooldown,\r\n\tAPLValueRuneGrace,\r\n\tAPLValueRuneSlotGrace,\r\n} from '../../proto/apl.js';\r\n\r\nimport { EventID } from '../../typed_event.js';\r\nimport { Input, InputConfig } from '../input.js';\r\nimport { Player } from '../../player.js';\r\nimport { TextDropdownPicker, TextDropdownValueConfig } from '../dropdown_picker.js';\r\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\r\n\r\nimport * as AplHelpers from './apl_helpers.js';\r\n\r\nexport interface APLValuePickerConfig extends InputConfig<Player<any>, APLValue | undefined> {\r\n}\r\n\r\nexport type APLValueKind = APLValue['value']['oneofKind'];\r\nexport type APLValueImplStruct<F extends APLValueKind> = Extract<APLValue['value'], {oneofKind: F}>;\r\ntype APLValueImplTypesUnion = {\r\n\t[f in NonNullable<APLValueKind>]: f extends keyof APLValueImplStruct<f> ? APLValueImplStruct<f>[f] : never;\r\n};\r\nexport type APLValueImplType = APLValueImplTypesUnion[NonNullable<APLValueKind>]|undefined;\r\n\r\nexport class APLValuePicker extends Input<Player<any>, APLValue | undefined> {\r\n\r\n\tprivate kindPicker: TextDropdownPicker<Player<any>, APLValueKind>;\r\n\r\n\tprivate currentKind: APLValueKind;\r\n\tprivate valuePicker: Input<Player<any>, any> | null;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLValuePickerConfig) {\r\n\t\tsuper(parent, 'apl-value-picker-root', player, config);\r\n\r\n\t\tconst isPrepull = this.rootElem.closest('.apl-prepull-action-picker') != null;\r\n\r\n\t\tconst allValueKinds = (Object.keys(valueKindFactories) as Array<NonNullable<APLValueKind>>)\r\n\t\t\t.filter(valueKind => valueKindFactories[valueKind].includeIf?.(player, isPrepull) ?? true);\r\n\r\n\t\tthis.kindPicker = new TextDropdownPicker(this.rootElem, player, {\r\n\t\t\tdefaultLabel: 'No Condition',\r\n\t\t\tvalues: [{\r\n\t\t\t\tvalue: undefined,\r\n\t\t\t\tlabel: '<None>',\r\n\t\t\t} as TextDropdownValueConfig<APLValueKind>].concat(allValueKinds.map(kind => {\r\n\t\t\t\tconst factory = valueKindFactories[kind];\r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: kind,\r\n\t\t\t\t\tlabel: factory.label,\r\n\t\t\t\t\tsubmenu: factory.submenu,\r\n\t\t\t\t\ttooltip: factory.fullDescription ? `<p>${factory.shortDescription}</p> ${factory.fullDescription}` : factory.shortDescription,\r\n\t\t\t\t};\r\n\t\t\t})),\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (_player: Player<any>) => this.getSourceValue()?.value.oneofKind,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newKind: APLValueKind) => {\r\n\t\t\t\tconst sourceValue = this.getSourceValue();\r\n\t\t\t\tconst oldKind = sourceValue?.value.oneofKind;\r\n\t\t\t\tif (oldKind == newKind) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newKind) {\r\n\t\t\t\t\tconst factory = valueKindFactories[newKind];\r\n\t\t\t\t\tlet newSourceValue = this.makeAPLValue(newKind, factory.newValue());\r\n\t\t\t\t\tif (sourceValue) {\r\n\t\t\t\t\t\t// Some pre-fill logic when swapping kinds.\r\n\t\t\t\t\t\tif (oldKind && this.valuePicker) {\r\n\t\t\t\t\t\t\tif (newKind == 'not') {\r\n\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'not'>).not.val = this.makeAPLValue(oldKind, this.valuePicker.getInputValue());\r\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'not' && sourceValue.value.not.val?.value.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.not.val;\r\n\t\t\t\t\t\t\t} else if (newKind == 'and') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'or') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'and'>).and.vals = sourceValue.value.or.vals;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'and'>).and.vals = [this.makeAPLValue(oldKind, this.valuePicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (newKind == 'or') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'and') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'or'>).or.vals = sourceValue.value.and.vals;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'or'>).or.vals = [this.makeAPLValue(oldKind, this.valuePicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (newKind == 'min') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'max') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'min'>).min.vals = sourceValue.value.max.vals;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'min'>).min.vals = [this.makeAPLValue(oldKind, this.valuePicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (newKind == 'max') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.value.oneofKind == 'min') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'max'>).max.vals = sourceValue.value.min.vals;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'max'>).max.vals = [this.makeAPLValue(oldKind, this.valuePicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'and' && sourceValue.value.and.vals?.[0]?.value.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.and.vals[0];\r\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'or' && sourceValue.value.or.vals?.[0]?.value.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.or.vals[0];\r\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'min' && sourceValue.value.min.vals?.[0]?.value.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.min.vals[0];\r\n\t\t\t\t\t\t\t} else if (sourceValue.value.oneofKind == 'max' && sourceValue.value.max.vals?.[0]?.value.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.value.max.vals[0];\r\n\t\t\t\t\t\t\t} else if (newKind == 'cmp') {\r\n\t\t\t\t\t\t\t\t(newSourceValue.value as APLValueImplStruct<'cmp'>).cmp.lhs = this.makeAPLValue(oldKind, this.valuePicker.getInputValue());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (sourceValue) {\r\n\t\t\t\t\t\tsourceValue.value = newSourceValue.value;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.setSourceValue(eventID, newSourceValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setSourceValue(eventID, undefined);\r\n\t\t\t\t}\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.currentKind = undefined;\r\n\t\tthis.valuePicker = null;\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): APLValue | undefined {\r\n\t\tconst kind = this.kindPicker.getInputValue();\r\n\t\tif (!kind) {\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\treturn APLValue.create({\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: kind,\r\n\t\t\t\t\t...((() => {\r\n\t\t\t\t\t\tconst val: any = {};\r\n\t\t\t\t\t\tif (kind && this.valuePicker) {\r\n\t\t\t\t\t\t\tval[kind] = this.valuePicker.getInputValue();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn val;\r\n\t\t\t\t\t})()),\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tsetInputValue(newValue: APLValue | undefined) {\r\n\t\tconst newKind = newValue?.value.oneofKind;\r\n\t\tthis.updateValuePicker(newKind);\r\n\r\n\t\tif (newKind && newValue) {\r\n\t\t\tthis.valuePicker!.setInputValue((newValue.value as any)[newKind]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate makeAPLValue<K extends NonNullable<APLValueKind>>(kind: K, implVal: APLValueImplTypesUnion[K]): APLValue {\r\n\t\tif (!kind) {\r\n\t\t\treturn APLValue.create();\r\n\t\t}\r\n\t\tconst obj: any = { oneofKind: kind };\r\n\t\tobj[kind] = implVal;\r\n\t\treturn APLValue.create({value: obj});\r\n\t}\r\n\r\n\tprivate updateValuePicker(newKind: APLValueKind) {\r\n\t\tconst oldKind = this.currentKind;\r\n\t\tif (newKind == oldKind) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.currentKind = newKind;\r\n\r\n\t\tif (this.valuePicker) {\r\n\t\t\tthis.valuePicker.rootElem.remove();\r\n\t\t\tthis.valuePicker = null;\r\n\t\t}\r\n\r\n\t\tif (!newKind) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.kindPicker.setInputValue(newKind);\r\n\r\n\t\tconst factory = valueKindFactories[newKind];\r\n\t\tthis.valuePicker = factory.factory(this.rootElem, this.modObject, {\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => {\r\n\t\t\t\tconst sourceVal = this.getSourceValue();\r\n\t\t\t\treturn sourceVal ? (sourceVal.value as any)[newKind] || factory.newValue() : factory.newValue();\r\n\t\t\t},\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\r\n\t\t\t\tconst sourceVal = this.getSourceValue();\r\n\t\t\t\tif (sourceVal) {\r\n\t\t\t\t\t(sourceVal.value as any)[newKind] = newValue;\r\n\t\t\t\t}\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n\r\ntype ValueKindConfig<T> = {\r\n\tlabel: string,\r\n\tsubmenu?: Array<string>,\r\n\tshortDescription: string,\r\n\tfullDescription?: string,\r\n\tnewValue: () => T,\r\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean,\r\n\tfactory: (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T>,\r\n};\r\n\r\nfunction comparisonOperatorFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => ComparisonOperator.OpEq,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: ComparisonOperator.OpEq, label: '==' },\r\n\t\t\t\t{ value: ComparisonOperator.OpNe, label: '!=' },\r\n\t\t\t\t{ value: ComparisonOperator.OpGe, label: '>=' },\r\n\t\t\t\t{ value: ComparisonOperator.OpGt, label: '>' },\r\n\t\t\t\t{ value: ComparisonOperator.OpLe, label: '<=' },\r\n\t\t\t\t{ value: ComparisonOperator.OpLt, label: '<' },\r\n\t\t\t],\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nfunction mathOperatorFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => MathOperator.OpAdd,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: MathOperator.OpAdd, label: '+' },\r\n\t\t\t\t{ value: MathOperator.OpSub, label: '-' },\r\n\t\t\t\t{ value: MathOperator.OpMul, label: '*' },\r\n\t\t\t\t{ value: MathOperator.OpDiv, label: '/' },\r\n\t\t\t],\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nfunction executePhaseThresholdFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => ExecutePhaseThreshold.E20,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: ExecutePhaseThreshold.E20, label: '20%' },\r\n\t\t\t\t{ value: ExecutePhaseThreshold.E25, label: '25%' },\r\n\t\t\t\t{ value: ExecutePhaseThreshold.E35, label: '35%' },\r\n\t\t\t],\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nfunction totemTypeFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => TotemType.Water,\r\n\t\tfactory: (parent, player, config) => new TextDropdownPicker(parent, player, {\r\n\t\t\t...config,\r\n\t\t\tdefaultLabel: 'None',\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ value: TotemType.Earth, label: 'Earth' },\r\n\t\t\t\t{ value: TotemType.Air, label: 'Air' },\r\n\t\t\t\t{ value: TotemType.Fire, label: 'Fire' },\r\n\t\t\t\t{ value: TotemType.Water, label: 'Water' },\r\n\t\t\t],\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nexport function valueFieldConfig(field: string, options?: Partial<AplHelpers.APLPickerBuilderFieldConfig<any, any>>): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: APLValue.create,\r\n\t\tfactory: (parent, player, config) => new APLValuePicker(parent, player, config),\r\n\t\t...(options || {}),\r\n\t};\r\n}\r\n\r\nexport function valueListFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => [],\r\n\t\tfactory: (parent, player, config) => new ListPicker<Player<any>, APLValue | undefined>(parent, player, {\r\n\t\t\t...config,\r\n\t\t\t// Override setValue to replace undefined elements with default messages.\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLValue | undefined>) => {\r\n\t\t\t\tconfig.setValue(eventID, player, newValue.map(val => val || APLValue.create()));\r\n\t\t\t},\r\n\t\t\titemLabel: 'Value',\r\n\t\t\tnewItem: APLValue.create,\r\n\t\t\tcopyItem: (oldValue: APLValue | undefined) => oldValue ? APLValue.clone(oldValue) : oldValue,\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLValue | undefined>, index: number, config: ListItemPickerConfig<Player<any>, APLValue | undefined>) => new APLValuePicker(parent, player, config),\r\n\t\t\tallowedActions: ['create', 'delete'],\r\n\t\t\tactions: {\r\n\t\t\t\tcreate: {\r\n\t\t\t\t\tuseIcon: true,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nfunction inputBuilder<T extends APLValueImplType>(config: {\r\n\tlabel: string,\r\n\tsubmenu?: Array<string>,\r\n\tshortDescription: string,\r\n\tfullDescription?: string,\r\n\tnewValue: () => T,\r\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean,\r\n\tfields: Array<AplHelpers.APLPickerBuilderFieldConfig<T, keyof T>>,\r\n}): ValueKindConfig<T> {\r\n\treturn {\r\n\t\tlabel: config.label,\r\n\t\tsubmenu: config.submenu,\r\n\t\tshortDescription: config.shortDescription,\r\n\t\tfullDescription: config.fullDescription,\r\n\t\tnewValue: config.newValue,\r\n\t\tincludeIf: config.includeIf,\r\n\t\tfactory: AplHelpers.aplInputBuilder(config.newValue, config.fields),\r\n\t};\r\n}\r\n\r\nconst valueKindFactories: {[f in NonNullable<APLValueKind>]: ValueKindConfig<APLValueImplTypesUnion[f]>} = {\r\n\t// Operators\r\n\t'const': inputBuilder({\r\n\t\tlabel: 'Const',\r\n\t\tshortDescription: 'A fixed value.',\r\n\t\tfullDescription: `\r\n\t\t<p>\r\n\t\t\tExamples:\r\n\t\t\t<ul>\r\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\r\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\r\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\r\n\t\t\t</ul>\r\n\t\t</p>\r\n\t\t`,\r\n\t\tnewValue: APLValueConst.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('val'),\r\n\t\t],\r\n\t}),\r\n\t'cmp': inputBuilder({\r\n\t\tlabel: 'Compare',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Compares two values.',\r\n\t\tnewValue: APLValueCompare.create,\r\n\t\tfields: [\r\n\t\t\tvalueFieldConfig('lhs'),\r\n\t\t\tcomparisonOperatorFieldConfig('op'),\r\n\t\t\tvalueFieldConfig('rhs'),\r\n\t\t],\r\n\t}),\r\n\t'math': inputBuilder({\r\n\t\tlabel: 'Math',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Do basic math on two values.',\r\n\t\tnewValue: APLValueMath.create,\r\n\t\tfields: [\r\n\t\t\tvalueFieldConfig('lhs'),\r\n\t\t\tmathOperatorFieldConfig('op'),\r\n\t\t\tvalueFieldConfig('rhs'),\r\n\t\t],\r\n\t}),\r\n\t'max': inputBuilder({\r\n\t\tlabel: 'Max',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Returns the largest value among the subvalues.',\r\n\t\tnewValue: APLValueMax.create,\r\n\t\tfields: [\r\n\t\t\tvalueListFieldConfig('vals'),\r\n\t\t],\r\n\t}),\r\n\t'min': inputBuilder({\r\n\t\tlabel: 'Min',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Returns the smallest value among the subvalues.',\r\n\t\tnewValue: APLValueMin.create,\r\n\t\tfields: [\r\n\t\t\tvalueListFieldConfig('vals'),\r\n\t\t],\r\n\t}),\r\n\t'and': inputBuilder({\r\n\t\tlabel: 'All of',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>',\r\n\t\tnewValue: APLValueAnd.create,\r\n\t\tfields: [\r\n\t\t\tvalueListFieldConfig('vals'),\r\n\t\t],\r\n\t}),\r\n\t'or': inputBuilder({\r\n\t\tlabel: 'Any of',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>',\r\n\t\tnewValue: APLValueOr.create,\r\n\t\tfields: [\r\n\t\t\tvalueListFieldConfig('vals'),\r\n\t\t],\r\n\t}),\r\n\t'not': inputBuilder({\r\n\t\tlabel: 'Not',\r\n\t\tsubmenu: ['Logic'],\r\n\t\tshortDescription: 'Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.',\r\n\t\tnewValue: APLValueNot.create,\r\n\t\tfields: [\r\n\t\t\tvalueFieldConfig('val'),\r\n\t\t],\r\n\t}),\r\n\r\n\t// Encounter\r\n\t'currentTime': inputBuilder({\r\n\t\tlabel: 'Current Time',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: 'Elapsed time of the current sim iteration.',\r\n\t\tnewValue: APLValueCurrentTime.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentTimePercent': inputBuilder({\r\n\t\tlabel: 'Current Time (%)',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: 'Elapsed time of the current sim iteration, as a percentage.',\r\n\t\tnewValue: APLValueCurrentTimePercent.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'remainingTime': inputBuilder({\r\n\t\tlabel: 'Remaining Time',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: 'Elapsed time of the remaining sim iteration.',\r\n\t\tnewValue: APLValueRemainingTime.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'remainingTimePercent': inputBuilder({\r\n\t\tlabel: 'Remaining Time (%)',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: 'Elapsed time of the remaining sim iteration, as a percentage.',\r\n\t\tnewValue: APLValueRemainingTimePercent.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'isExecutePhase': inputBuilder({\r\n\t\tlabel: 'Is Execute Phase',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: '<b>True</b> if the encounter is in Execute Phase, meaning the target\\'s health is less than the given threshold, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueIsExecutePhase.create,\r\n\t\tfields: [\r\n\t\t\texecutePhaseThresholdFieldConfig('threshold'),\r\n\t\t],\r\n\t}),\r\n\t'numberTargets': inputBuilder({\r\n\t\tlabel: 'Number of Targets',\r\n\t\tsubmenu: ['Encounter'],\r\n\t\tshortDescription: 'Count of targets in the current encounter',\r\n\t\tnewValue: APLValueNumberTargets.create,\r\n\t\tfields: [],\r\n\t}),\r\n\r\n\t// Resources\r\n\t'currentHealth': inputBuilder({\r\n\t\tlabel: 'Health',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Health.',\r\n\t\tnewValue: APLValueCurrentHealth.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t],\r\n\t}),\r\n\t'currentHealthPercent': inputBuilder({\r\n\t\tlabel: 'Health (%)',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Health, as a percentage.',\r\n\t\tnewValue: APLValueCurrentHealthPercent.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t],\r\n\t}),\r\n\t'currentMana': inputBuilder({\r\n\t\tlabel: 'Mana',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Mana.',\r\n\t\tnewValue: APLValueCurrentMana.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentManaPercent': inputBuilder({\r\n\t\tlabel: 'Mana (%)',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Mana, as a percentage.',\r\n\t\tnewValue: APLValueCurrentManaPercent.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentRage': inputBuilder({\r\n\t\tlabel: 'Rage',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Rage.',\r\n\t\tnewValue: APLValueCurrentRage.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentEnergy': inputBuilder({\r\n\t\tlabel: 'Energy',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Energy.',\r\n\t\tnewValue: APLValueCurrentEnergy.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentComboPoints': inputBuilder({\r\n\t\tlabel: 'Combo Points',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Combo Points.',\r\n\t\tnewValue: APLValueCurrentComboPoints.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'currentRunicPower': inputBuilder({\r\n\t\tlabel: 'Runic Power',\r\n\t\tsubmenu: ['Resources'],\r\n\t\tshortDescription: 'Amount of currently available Runic Power.',\r\n\t\tnewValue: APLValueCurrentRunicPower.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [],\r\n\t}),\r\n\r\n\t// Resources Rune\r\n\t'currentRuneCount': inputBuilder({\r\n\t\tlabel: 'Num Runes',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of currently available Runes of certain type including Death.',\r\n\t\tnewValue: APLValueCurrentRuneCount.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeTypeFieldConfig('runeType', true),\r\n\t\t],\r\n\t}),\r\n\t'currentNonDeathRuneCount': inputBuilder({\r\n\t\tlabel: 'Num Non Death Runes',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of currently available Runes of certain type ignoring Death',\r\n\t\tnewValue: APLValueCurrentNonDeathRuneCount.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeTypeFieldConfig('runeType', false),\r\n\t\t],\r\n\t}),\r\n\t'currentRuneActive': inputBuilder({\r\n\t\tlabel: 'Rune Is Ready',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Is the rune of a certain slot currently available.',\r\n\t\tnewValue: APLValueCurrentRuneActive.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeSlotFieldConfig('runeSlot'),\r\n\t\t],\r\n\t}),\r\n\t'currentRuneDeath': inputBuilder({\r\n\t\tlabel: 'Rune Is Death',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Is the rune of a certain slot currently converted to Death.',\r\n\t\tnewValue: APLValueCurrentRuneDeath.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeSlotFieldConfig('runeSlot'),\r\n\t\t],\r\n\t}),\r\n\t'runeCooldown': inputBuilder({\r\n\t\tlabel: 'Rune Cooldown',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of time until a rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there is a rune available',\r\n\t\tnewValue: APLValueRuneCooldown.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeTypeFieldConfig('runeType', false),\r\n\t\t],\r\n\t}),\r\n\t'nextRuneCooldown': inputBuilder({\r\n\t\tlabel: 'Next Rune Cooldown',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of time until a 2nd rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there are 2 runes available',\r\n\t\tnewValue: APLValueNextRuneCooldown.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeTypeFieldConfig('runeType', false),\r\n\t\t],\r\n\t}),\r\n\t'runeSlotCooldown': inputBuilder({\r\n\t\tlabel: 'Rune Slot Cooldown',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of time until a rune of certain slot is ready to use.<br><b>NOTE:</b> Returns 0 if rune is ready',\r\n\t\tnewValue: APLValueRuneSlotCooldown.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeSlotFieldConfig('runeSlot'),\r\n\t\t],\r\n\t}),\r\n\t'runeGrace': inputBuilder({\r\n\t\tlabel: 'Rune Grace Period',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of rune grace period available for certain rune type.',\r\n\t\tnewValue: APLValueRuneGrace.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeTypeFieldConfig('runeType', false),\r\n\t\t],\r\n\t}),\r\n\t'runeSlotGrace': inputBuilder({\r\n\t\tlabel: 'Rune Slot Grace Period',\r\n\t\tsubmenu: ['Resources', 'Runes'],\r\n\t\tshortDescription: 'Amount of rune grace period available for certain rune slot.',\r\n\t\tnewValue: APLValueRuneSlotGrace.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassDeathknight,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.runeSlotFieldConfig('runeSlot'),\r\n\t\t],\r\n\t}),\r\n\r\n\t// GCD\r\n\t'gcdIsReady': inputBuilder({\r\n\t\tlabel: 'GCD Is Ready',\r\n\t\tsubmenu: ['GCD'],\r\n\t\tshortDescription: '<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueGCDIsReady.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t'gcdTimeToReady': inputBuilder({\r\n\t\tlabel: 'GCD Time To Ready',\r\n\t\tsubmenu: ['GCD'],\r\n\t\tshortDescription: 'Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.',\r\n\t\tnewValue: APLValueGCDTimeToReady.create,\r\n\t\tfields: [],\r\n\t}),\r\n\r\n\t// Auto attacks\r\n\t'autoTimeToNext': inputBuilder({\r\n\t\tlabel: 'Time To Next Auto',\r\n\t\tsubmenu: ['Auto'],\r\n\t\tshortDescription: 'Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.',\r\n\t\tnewValue: APLValueAutoTimeToNext.create,\r\n\t\tfields: [],\r\n\t}),\r\n\r\n\t// Spells\r\n\t'spellCanCast': inputBuilder({\r\n\t\tlabel: 'Can Cast',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: '<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.',\r\n\t\tfullDescription: `\r\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\r\n\t\t`,\r\n\t\tnewValue: APLValueSpellCanCast.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellIsReady': inputBuilder({\r\n\t\tlabel: 'Is Ready',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: '<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueSpellIsReady.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellTimeToReady': inputBuilder({\r\n\t\tlabel: 'Time To Ready',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.',\r\n\t\tnewValue: APLValueSpellTimeToReady.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellCastTime': inputBuilder({\r\n\t\tlabel: 'Cast Time',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'Amount of time to cast the spell including any haste and spell cast time adjustments.',\r\n\t\tnewValue: APLValueSpellCastTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellTravelTime': inputBuilder({\r\n\t\tlabel: 'Travel Time',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'Amount of time for the spell to travel to the target.',\r\n\t\tnewValue: APLValueSpellTravelTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellCpm': inputBuilder({\r\n\t\tlabel: 'CPM',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'Casts Per Minute for the spell so far in the current iteration.',\r\n\t\tnewValue: APLValueSpellCPM.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellChannelTime': inputBuilder({\r\n\t\tlabel: 'Channel Time',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'Amount of time to fully channel the spell including any haste and spell cast time adjustments.',\r\n\t\tnewValue: APLValueSpellChannelTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'channel_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellIsChanneling': inputBuilder({\r\n\t\tlabel: 'Is Channeling',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: '<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueSpellIsChanneling.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'channel_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'spellChanneledTicks': inputBuilder({\r\n\t\tlabel: 'Channeled Ticks',\r\n\t\tsubmenu: ['Spell'],\r\n\t\tshortDescription: 'The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.',\r\n\t\tnewValue: APLValueSpellChanneledTicks.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'channel_spells', ''),\r\n\t\t],\r\n\t}),\r\n\r\n\t// Auras\r\n\t'auraIsActive': inputBuilder({\r\n\t\tlabel: 'Aura Active',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: '<b>True</b> if the aura is currently active, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueAuraIsActive.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraIsActiveWithReactionTime': inputBuilder({\r\n\t\tlabel: 'Aura Active (with Reaction Time)',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: '<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueAuraIsActiveWithReactionTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraRemainingTime': inputBuilder({\r\n\t\tlabel: 'Aura Remaining Time',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: 'Time remaining before this aura will expire, or 0 if the aura is not currently active.',\r\n\t\tnewValue: APLValueAuraRemainingTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraNumStacks': inputBuilder({\r\n\t\tlabel: 'Aura Num Stacks',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: 'Number of stacks of the aura.',\r\n\t\tnewValue: APLValueAuraNumStacks.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'stackable_auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraInternalCooldown': inputBuilder({\r\n\t\tlabel: 'Aura Remaining ICD',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: 'Time remaining before this aura\\'s internal cooldown will be ready, or <b>0</b> if the ICD is ready now.',\r\n\t\tnewValue: APLValueAuraInternalCooldown.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'icd_auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraIcdIsReadyWithReactionTime': inputBuilder({\r\n\t\tlabel: 'Aura ICD Is Ready (with Reaction Time)',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: '<b>True</b> if the aura\\'s ICD is currently ready OR it was put on CD recently, within the player\\'s reaction time (configured in Settings), otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueAuraICDIsReadyWithReactionTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'icd_auras', 'sourceUnit'),\r\n\t\t],\r\n\t}),\r\n\t'auraShouldRefresh': inputBuilder({\r\n\t\tlabel: 'Should Refresh Aura',\r\n\t\tsubmenu: ['Aura'],\r\n\t\tshortDescription: 'Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.',\r\n\t\tfullDescription: `\r\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\r\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\r\n\t\t`,\r\n\t\tnewValue: () => APLValueAuraShouldRefresh.create({\r\n\t\t\tmaxOverlap: {\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: 'const',\r\n\t\t\t\t\tconst: {\r\n\t\t\t\t\t\tval: '0ms',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('sourceUnit', 'aura_sources_targets_first'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'exclusive_effect_auras', 'sourceUnit', 'currentTarget'),\r\n\t\t\tvalueFieldConfig('maxOverlap', {\r\n\t\t\t\tlabel: 'Overlap',\r\n\t\t\t\tlabelTooltip: 'Maximum amount of time before the aura expires when it may be refreshed.',\r\n\t\t\t}),\r\n\t\t],\r\n\t}),\r\n\r\n\t// DoT\r\n\t'dotIsActive': inputBuilder({\r\n\t\tlabel: 'Dot Is Active',\r\n\t\tsubmenu: ['DoT'],\r\n\t\tshortDescription: '<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueDotIsActive.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('targetUnit', 'targets'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'dot_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'dotRemainingTime': inputBuilder({\r\n\t\tlabel: 'Dot Remaining Time',\r\n\t\tsubmenu: ['DoT'],\r\n\t\tshortDescription: 'Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.',\r\n\t\tnewValue: APLValueDotRemainingTime.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('targetUnit', 'targets'),\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'dot_spells', ''),\r\n\t\t],\r\n\t}),\r\n\t'sequenceIsComplete': inputBuilder({\r\n\t\tlabel: 'Sequence Is Complete',\r\n\t\tsubmenu: ['Sequence'],\r\n\t\tshortDescription: '<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueSequenceIsComplete.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('sequenceName'),\r\n\t\t],\r\n\t}),\r\n\t'sequenceIsReady': inputBuilder({\r\n\t\tlabel: 'Sequence Is Ready',\r\n\t\tsubmenu: ['Sequence'],\r\n\t\tshortDescription: '<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.',\r\n\t\tnewValue: APLValueSequenceIsReady.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('sequenceName'),\r\n\t\t],\r\n\t}),\r\n\t'sequenceTimeToReady': inputBuilder({\r\n\t\tlabel: 'Sequence Time To Ready',\r\n\t\tsubmenu: ['Sequence'],\r\n\t\tshortDescription: 'Returns the amount of time remaining until the next subaction in the sequence will be ready.',\r\n\t\tnewValue: APLValueSequenceTimeToReady.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('sequenceName'),\r\n\t\t],\r\n\t}),\r\n\r\n\t// Class/spec specific values\r\n\t'totemRemainingTime': inputBuilder({\r\n\t\tlabel: 'Totem Remaining Time',\r\n\t\tsubmenu: ['Shaman'],\r\n\t\tshortDescription: 'Returns the amount of time remaining until the totem will expire.',\r\n\t\tnewValue: APLValueTotemRemainingTime.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.getClass() == Class.ClassShaman,\r\n\t\tfields: [\r\n\t\t\ttotemTypeFieldConfig('totemType'),\r\n\t\t],\r\n\t}),\r\n\t'catExcessEnergy': inputBuilder({\r\n\t\tlabel: 'Excess Energy',\r\n\t\tsubmenu: ['Feral Druid'],\r\n\t\tshortDescription: 'Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.',\r\n\t\tnewValue: APLValueCatExcessEnergy.create,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => player.spec == Spec.SpecFeralDruid,\r\n\t\tfields: [\r\n\t\t],\r\n\t}),\r\n};\r\n","import {\r\n\tAPLAction,\r\n\r\n\tAPLActionCastSpell,\r\n\tAPLActionChannelSpell,\r\n\tAPLActionMultidot,\r\n\tAPLActionMultishield,\r\n\tAPLActionAutocastOtherCooldowns,\r\n\r\n\tAPLActionWait,\r\n\tAPLActionWaitUntil,\r\n\tAPLActionSchedule,\r\n\r\n\tAPLActionSequence,\r\n\tAPLActionResetSequence,\r\n\tAPLActionStrictSequence,\r\n\r\n\tAPLActionChangeTarget,\r\n\tAPLActionActivateAura,\r\n\tAPLActionCancelAura,\r\n\tAPLActionTriggerICD,\r\n\r\n\tAPLValue,\r\n} from '../../proto/apl.js';\r\n\r\nimport { isHealingSpec } from '../../proto_utils/utils.js';\r\nimport { EventID } from '../../typed_event.js';\r\nimport { Input, InputConfig } from '../input.js';\r\nimport { Player } from '../../player.js';\r\nimport { TextDropdownPicker } from '../dropdown_picker.js';\r\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\r\n\r\nimport * as AplHelpers from './apl_helpers.js';\r\nimport * as AplValues from './apl_values.js';\r\n\r\nexport interface APLActionPickerConfig extends InputConfig<Player<any>, APLAction> {\r\n}\r\n\r\nexport type APLActionKind = APLAction['action']['oneofKind'];\r\ntype APLActionImplStruct<F extends APLActionKind> = Extract<APLAction['action'], {oneofKind: F}>;\r\ntype APLActionImplTypesUnion = {\r\n\t[f in NonNullable<APLActionKind>]: f extends keyof APLActionImplStruct<f> ? APLActionImplStruct<f>[f] : never;\r\n};\r\nexport type APLActionImplType = APLActionImplTypesUnion[NonNullable<APLActionKind>]|undefined;\r\n\r\nexport class APLActionPicker extends Input<Player<any>, APLAction> {\r\n\r\n\tprivate kindPicker: TextDropdownPicker<Player<any>, APLActionKind>;\r\n\r\n\tprivate readonly actionDiv: HTMLElement;\r\n\tprivate currentKind: APLActionKind;\r\n\tprivate actionPicker: Input<Player<any>, any> | null;\r\n\r\n\tprivate readonly conditionPicker: AplValues.APLValuePicker;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: APLActionPickerConfig) {\r\n\t\tsuper(parent, 'apl-action-picker-root', player, config);\r\n\r\n\t\tthis.conditionPicker = new AplValues.APLValuePicker(this.rootElem, this.modObject, {\r\n\t\t\tlabel: 'If:',\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => this.getSourceValue()?.condition,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLValue | undefined) => {\r\n\t\t\t\tconst srcVal = this.getSourceValue();\r\n\t\t\t\tif (srcVal) {\r\n\t\t\t\t\tsrcVal.condition = newValue;\r\n\t\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setSourceValue(eventID, APLAction.create({\r\n\t\t\t\t\t\tcondition: newValue,\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.conditionPicker.rootElem.classList.add('apl-action-condition', 'apl-priority-list-only');\r\n\r\n\t\tthis.actionDiv = document.createElement('div');\r\n\t\tthis.actionDiv.classList.add('apl-action-picker-action');\r\n\t\tthis.rootElem.appendChild(this.actionDiv);\r\n\r\n\t\tconst isPrepull = this.rootElem.closest('.apl-prepull-action-picker') != null;\r\n\r\n\t\tconst allActionKinds = (Object.keys(actionKindFactories) as Array<NonNullable<APLActionKind>>)\r\n\t\t\t.filter(actionKind => actionKindFactories[actionKind].includeIf?.(player, isPrepull) ?? true);\r\n\r\n\t\tthis.kindPicker = new TextDropdownPicker(this.actionDiv, player, {\r\n\t\t\tdefaultLabel: 'Action',\r\n\t\t\tvalues: allActionKinds\r\n\t\t\t\t.map(actionKind => {\r\n\t\t\t\t\tconst factory = actionKindFactories[actionKind];\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tvalue: actionKind,\r\n\t\t\t\t\t\tlabel: factory.label,\r\n\t\t\t\t\t\tsubmenu: factory.submenu,\r\n\t\t\t\t\t\ttooltip: factory.fullDescription ? `<p>${factory.shortDescription}</p> ${factory.fullDescription}` : factory.shortDescription,\r\n\t\t\t\t\t};\r\n\t\t\t\t}),\r\n\t\t\tequals: (a, b) => a == b,\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => this.getSourceValue()?.action.oneofKind,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newKind: APLActionKind) => {\r\n\t\t\t\tconst sourceValue = this.getSourceValue();\r\n\t\t\t\tconst oldKind = sourceValue.action.oneofKind;\r\n\t\t\t\tif (oldKind == newKind) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newKind) {\r\n\t\t\t\t\tconst factory = actionKindFactories[newKind];\r\n\t\t\t\t\tlet newSourceValue = this.makeAPLAction(newKind, factory.newValue());\r\n\t\t\t\t\tif (sourceValue) {\r\n\t\t\t\t\t\t// Some pre-fill logic when swapping kinds.\r\n\t\t\t\t\t\tif (oldKind && this.actionPicker) {\r\n\t\t\t\t\t\t\tif (newKind == 'sequence') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.action.oneofKind == 'strictSequence') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'sequence'>).sequence.actions = sourceValue.action.strictSequence.actions;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'sequence'>).sequence.actions = [this.makeAPLAction(oldKind, this.actionPicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (newKind == 'strictSequence') {\r\n\t\t\t\t\t\t\t\tif (sourceValue.action.oneofKind == 'sequence') {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'strictSequence'>).strictSequence.actions = sourceValue.action.sequence.actions;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t(newSourceValue.action as APLActionImplStruct<'strictSequence'>).strictSequence.actions = [this.makeAPLAction(oldKind, this.actionPicker.getInputValue())];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if (sourceValue.action.oneofKind == 'sequence' && sourceValue.action.sequence.actions?.[0]?.action.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.action.sequence.actions[0];\r\n\t\t\t\t\t\t\t} else if (sourceValue.action.oneofKind == 'strictSequence' && sourceValue.action.strictSequence.actions?.[0]?.action.oneofKind == newKind) {\r\n\t\t\t\t\t\t\t\tnewSourceValue = sourceValue.action.strictSequence.actions[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (sourceValue) {\r\n\t\t\t\t\t\tsourceValue.action = newSourceValue.action;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.setSourceValue(eventID, newSourceValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsourceValue.action = {\r\n\t\t\t\t\t\toneofKind: newKind,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.currentKind = undefined;\r\n\t\tthis.actionPicker = null;\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): APLAction {\r\n\t\tconst actionKind = this.kindPicker.getInputValue();\r\n\t\treturn APLAction.create({\r\n\t\t\tcondition: this.conditionPicker.getInputValue(),\r\n\t\t\taction: {\r\n\t\t\t\toneofKind: actionKind,\r\n\t\t\t\t...((() => {\r\n\t\t\t\t\tconst val: any = {};\r\n\t\t\t\t\tif (actionKind && this.actionPicker) {\r\n\t\t\t\t\t\tval[actionKind] = this.actionPicker.getInputValue();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t})()),\r\n\t\t\t},\r\n\t\t})\r\n\t}\r\n\r\n\tsetInputValue(newValue: APLAction) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.conditionPicker.setInputValue(newValue.condition || APLValue.create());\r\n\r\n\t\tconst newActionKind = newValue.action.oneofKind;\r\n\t\tthis.updateActionPicker(newActionKind);\r\n\r\n\t\tif (newActionKind) {\r\n\t\t\tthis.actionPicker!.setInputValue((newValue.action as any)[newActionKind]);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate makeAPLAction<K extends NonNullable<APLActionKind>>(kind: K, implVal: APLActionImplTypesUnion[K]): APLAction {\r\n\t\tif (!kind) {\r\n\t\t\treturn APLAction.create();\r\n\t\t}\r\n\t\tconst obj: any = { oneofKind: kind };\r\n\t\tobj[kind] = implVal;\r\n\t\treturn APLAction.create({action: obj});\r\n\t}\r\n\r\n\tprivate updateActionPicker(newActionKind: APLActionKind) {\r\n\t\tconst actionKind = this.currentKind;\r\n\t\tif (newActionKind == actionKind) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.currentKind = newActionKind;\r\n\r\n\t\tif (this.actionPicker) {\r\n\t\t\tthis.actionPicker.rootElem.remove();\r\n\t\t\tthis.actionPicker = null;\r\n\t\t}\r\n\r\n\t\tif (!newActionKind) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.kindPicker.setInputValue(newActionKind);\r\n\r\n\t\tconst factory = actionKindFactories[newActionKind];\r\n\t\tthis.actionPicker = factory.factory(this.actionDiv, this.modObject, {\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => (this.getSourceValue().action as any)[newActionKind] || factory.newValue(),\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: any) => {\r\n\t\t\t\t(this.getSourceValue().action as any)[newActionKind] = newValue;\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.actionPicker.rootElem.classList.add('apl-action-' + newActionKind);\r\n\t}\r\n}\r\n\r\ntype ActionKindConfig<T> = {\r\n\tlabel: string,\r\n\tsubmenu?: Array<string>,\r\n\tshortDescription: string,\r\n\tfullDescription?: string,\r\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean,\r\n\tnewValue: () => T,\r\n\tfactory: (parent: HTMLElement, player: Player<any>, config: InputConfig<Player<any>, T>) => Input<Player<any>, T>,\r\n};\r\n\r\nfunction actionFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: APLValue.create,\r\n\t\tfactory: (parent, player, config) => new APLActionPicker(parent, player, config),\r\n\t};\r\n}\r\n\r\nfunction actionListFieldConfig(field: string): AplHelpers.APLPickerBuilderFieldConfig<any, any> {\r\n\treturn {\r\n\t\tfield: field,\r\n\t\tnewValue: () => [],\r\n\t\tfactory: (parent, player, config) => new ListPicker<Player<any>, APLAction>(parent, player, {\r\n\t\t\t...config,\r\n\t\t\t// Override setValue to replace undefined elements with default messages.\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLAction>) => {\r\n\t\t\t\tconfig.setValue(eventID, player, newValue.map(val => val || APLAction.create()));\r\n\t\t\t},\r\n\t\t\titemLabel: 'Action',\r\n\t\t\tnewItem: APLAction.create,\r\n\t\t\tcopyItem: (oldValue: APLAction) => oldValue ? APLAction.clone(oldValue) : oldValue,\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLAction>, index: number, config: ListItemPickerConfig<Player<any>, APLAction>) => new APLActionPicker(parent, player, config),\r\n\t\t\tallowedActions: ['create', 'delete', 'move'],\r\n\t\t\tactions: {\r\n\t\t\t\tcreate: {\r\n\t\t\t\t\tuseIcon: true,\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}),\r\n\t};\r\n}\r\n\r\nfunction inputBuilder<T>(config: {\r\n\tlabel: string,\r\n\tsubmenu?: Array<string>,\r\n\tshortDescription: string,\r\n\tfullDescription?: string,\r\n\tincludeIf?: (player: Player<any>, isPrepull: boolean) => boolean,\r\n\tnewValue: () => T,\r\n\tfields: Array<AplHelpers.APLPickerBuilderFieldConfig<T, any>>,\r\n}): ActionKindConfig<T> {\r\n\treturn {\r\n\t\tlabel: config.label,\r\n\t\tsubmenu: config.submenu,\r\n\t\tshortDescription: config.shortDescription,\r\n\t\tfullDescription: config.fullDescription,\r\n\t\tincludeIf: config.includeIf,\r\n\t\tnewValue: config.newValue,\r\n\t\tfactory: AplHelpers.aplInputBuilder(config.newValue, config.fields),\r\n\t};\r\n}\r\n\r\nconst actionKindFactories: {[f in NonNullable<APLActionKind>]: ActionKindConfig<APLActionImplTypesUnion[f]>} = {\r\n\t['castSpell']: inputBuilder({\r\n\t\tlabel: 'Cast',\r\n\t\tshortDescription: 'Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.',\r\n\t\tnewValue: APLActionCastSpell.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'castable_spells', ''),\r\n\t\t\tAplHelpers.unitFieldConfig('target', 'targets'),\r\n\t\t],\r\n\t}),\r\n\t['multidot']: inputBuilder({\r\n\t\tlabel: 'Multi Dot',\r\n\t\tsubmenu: ['Casting'],\r\n\t\tshortDescription: 'Keeps a DoT active on multiple targets by casting the specified spell.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: () => APLActionMultidot.create({\r\n\t\t\tmaxDots: 3,\r\n\t\t\tmaxOverlap: {\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: 'const',\r\n\t\t\t\t\tconst: {\r\n\t\t\t\t\t\tval: '0ms',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'dot_spells', ''),\r\n\t\t\tAplHelpers.numberFieldConfig('maxDots', {\r\n\t\t\t\tlabel: 'Max Dots',\r\n\t\t\t\tlabelTooltip: 'Maximum number of DoTs to simultaneously apply.',\r\n\t\t\t}),\r\n\t\t\tAplValues.valueFieldConfig('maxOverlap', {\r\n\t\t\t\tlabel: 'Overlap',\r\n\t\t\t\tlabelTooltip: 'Maximum amount of time before a DoT expires when it may be refreshed.',\r\n\t\t\t}),\r\n\t\t],\r\n\t}),\r\n\t['multishield']: inputBuilder({\r\n\t\tlabel: 'Multi Shield',\r\n\t\tsubmenu: ['Casting'],\r\n\t\tshortDescription: 'Keeps a Shield active on multiple targets by casting the specified spell.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull && isHealingSpec(player.spec),\r\n\t\tnewValue: () => APLActionMultishield.create({\r\n\t\t\tmaxShields: 3,\r\n\t\t\tmaxOverlap: {\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: 'const',\r\n\t\t\t\t\tconst: {\r\n\t\t\t\t\t\tval: '0ms',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'shield_spells', ''),\r\n\t\t\tAplHelpers.numberFieldConfig('maxShields', {\r\n\t\t\t\tlabel: 'Max Shields',\r\n\t\t\t\tlabelTooltip: 'Maximum number of Shields to simultaneously apply.',\r\n\t\t\t}),\r\n\t\t\tAplValues.valueFieldConfig('maxOverlap', {\r\n\t\t\t\tlabel: 'Overlap',\r\n\t\t\t\tlabelTooltip: 'Maximum amount of time before a Shield expires when it may be refreshed.',\r\n\t\t\t}),\r\n\t\t],\r\n\t}),\r\n\t['channelSpell']: inputBuilder({\r\n\t\tlabel: 'Channel',\r\n\t\tsubmenu: ['Casting'],\r\n\t\tshortDescription: 'Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.',\r\n\t\tfullDescription: `\r\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\r\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Immediately following a tick of the channel</li>\r\n\t\t\t\t<li>The GCD is ready</li>\r\n\t\t\t\t<li>The <b>Interrupt If</b> condition is <b>True</b></li>\r\n\t\t\t\t<li>A higher-priority action in the APL list is available</li>\r\n\t\t\t</ul>\r\n\t\t\t<p>Note that if you simply want to allow higher-priority actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\r\n\t\t`,\r\n\t\tnewValue: () => APLActionChannelSpell.create({\r\n\t\t\tinterruptIf: {\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: 'const',\r\n\t\t\t\t\tconst: {\r\n\t\t\t\t\t\tval: 'true',\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('spellId', 'channel_spells', ''),\r\n\t\t\tAplHelpers.unitFieldConfig('target', 'targets'),\r\n\t\t\tAplValues.valueFieldConfig('interruptIf', {\r\n\t\t\t\tlabel: 'Interrupt If',\r\n\t\t\t\tlabelTooltip: 'Condition which must be true to allow the channel to be interrupted.',\r\n\t\t\t}),\r\n\t\t],\r\n\t}),\r\n\t['autocastOtherCooldowns']: inputBuilder({\r\n\t\tlabel: 'Autocast Other Cooldowns',\r\n\t\tsubmenu: ['Casting'],\r\n\t\tshortDescription: 'Auto-casts cooldowns as soon as they are ready.',\r\n\t\tfullDescription: `\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\r\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\r\n\t\t\t</ul>\r\n\t\t`,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: APLActionAutocastOtherCooldowns.create,\r\n\t\tfields: [],\r\n\t}),\r\n\t['wait']: inputBuilder({\r\n\t\tlabel: 'Wait',\r\n\t\tsubmenu: ['Timing'],\r\n\t\tshortDescription: 'Pauses all APL actions for a specified amount of time.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: () => APLActionWait.create({\r\n\t\t\tduration: {\r\n\t\t\t\tvalue: {\r\n\t\t\t\t\toneofKind: 'const',\r\n\t\t\t\t\tconst: {\r\n\t\t\t\t\t\tval: '1000ms',\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplValues.valueFieldConfig('duration'),\r\n\t\t],\r\n\t}),\r\n\t['waitUntil']: inputBuilder({\r\n\t\tlabel: 'Wait Until',\r\n\t\tsubmenu: ['Timing'],\r\n\t\tshortDescription: 'Pauses all APL actions until the specified condition is <b>True</b>.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: () => APLActionWaitUntil.create(),\r\n\t\tfields: [\r\n\t\t\tAplValues.valueFieldConfig('condition'),\r\n\t\t],\r\n\t}),\r\n\t['schedule']: inputBuilder({\r\n\t\tlabel: 'Scheduled Action',\r\n\t\tsubmenu: ['Timing'],\r\n\t\tshortDescription: 'Executes the inner action once at each specified timing.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: () => APLActionSchedule.create({\r\n\t\t\tschedule: '0s, 60s',\r\n\t\t\tinnerAction: {\r\n\t\t\t\taction: {oneofKind: 'castSpell', castSpell: {}},\r\n\t\t\t},\r\n\t\t}),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('schedule', {\r\n\t\t\t\tlabel: 'Do At',\r\n\t\t\t\tlabelTooltip: 'Comma-separated list of timings. The inner action will be performed once at each timing.',\r\n\t\t\t}),\r\n\t\t\tactionFieldConfig('innerAction'),\r\n\t\t],\r\n\t}),\r\n\t['sequence']: inputBuilder({\r\n\t\tlabel: 'Sequence',\r\n\t\tsubmenu: ['Sequences'],\r\n\t\tshortDescription: 'A list of sub-actions to execute in the specified order.',\r\n\t\tfullDescription: `\r\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\r\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\r\n\t\t`,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: APLActionSequence.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('name'),\r\n\t\t\tactionListFieldConfig('actions'),\r\n\t\t],\r\n\t}),\r\n\t['resetSequence']: inputBuilder({\r\n\t\tlabel: 'Reset Sequence',\r\n\t\tsubmenu: ['Sequences'],\r\n\t\tshortDescription: 'Restarts a sequence, so that the next time it executes it will perform its first sub-action.',\r\n\t\tfullDescription: `\r\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\r\n\t\t`,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: APLActionResetSequence.create,\r\n\t\tfields: [\r\n\t\t\tAplHelpers.stringFieldConfig('sequenceName'),\r\n\t\t],\r\n\t}),\r\n\t['strictSequence']: inputBuilder({\r\n\t\tlabel: 'Strict Sequence',\r\n\t\tsubmenu: ['Sequences'],\r\n\t\tshortDescription: 'Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.',\r\n\t\tfullDescription: `\r\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\r\n\t\t`,\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => !isPrepull,\r\n\t\tnewValue: APLActionStrictSequence.create,\r\n\t\tfields: [\r\n\t\t\tactionListFieldConfig('actions'),\r\n\t\t],\r\n\t}),\r\n\t['changeTarget']: inputBuilder({\r\n\t\tlabel: 'Change Target',\r\n\t\tsubmenu: ['Misc'],\r\n\t\tshortDescription: 'Sets the current target, which is the target of auto attacks and most casts by default.',\r\n\t\tnewValue: () => APLActionChangeTarget.create(),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.unitFieldConfig('newTarget', 'targets'),\r\n\t\t],\r\n\t}),\r\n\t['activateAura']: inputBuilder({\r\n\t\tlabel: 'Activate Aura',\r\n\t\tsubmenu: ['Misc'],\r\n\t\tshortDescription: 'Activates an aura',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => isPrepull,\r\n\t\tnewValue: () => APLActionActivateAura.create(),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'auras'),\r\n\t\t],\r\n\t}),\r\n\t['cancelAura']: inputBuilder({\r\n\t\tlabel: 'Cancel Aura',\r\n\t\tsubmenu: ['Misc'],\r\n\t\tshortDescription: 'Deactivates an aura, equivalent to /cancelaura.',\r\n\t\tnewValue: () => APLActionCancelAura.create(),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'auras'),\r\n\t\t],\r\n\t}),\r\n\t['triggerIcd']: inputBuilder({\r\n\t\tlabel: 'Trigger ICD',\r\n\t\tsubmenu: ['Misc'],\r\n\t\tshortDescription: 'Triggers an aura\\'s ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.',\r\n\t\tincludeIf: (player: Player<any>, isPrepull: boolean) => isPrepull,\r\n\t\tnewValue: () => APLActionTriggerICD.create(),\r\n\t\tfields: [\r\n\t\t\tAplHelpers.actionIdFieldConfig('auraId', 'icd_auras'),\r\n\t\t],\r\n\t}),\r\n};","import { Tooltip } from 'bootstrap';\r\n\r\nimport { EventID, TypedEvent } from '../../typed_event.js';\r\nimport { Player } from '../../player.js';\r\nimport { ListItemPickerConfig, ListPicker } from '../list_picker.js';\r\nimport { AdaptiveStringPicker } from '../string_picker.js';\r\nimport {\r\n\tAPLRotation,\r\n\tAPLListItem,\r\n\tAPLAction,\r\n\tAPLPrepullAction,\r\n\tAPLValue,\r\n\tAPLValueConst,\r\n} from '../../proto/apl.js';\r\n\r\nimport { Component } from '../component.js';\r\nimport { Input, InputConfig } from '../input.js';\r\nimport { ActionId } from '../../proto_utils/action_id.js';\r\nimport { SimUI } from '../../sim_ui.js';\r\n\r\nimport { APLActionPicker } from './apl_actions.js';\r\nimport { APLValuePicker, APLValueImplStruct } from './apl_values.js';\r\n\r\nexport class APLRotationPicker extends Component {\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, modPlayer: Player<any>) {\r\n\t\tsuper(parent, 'apl-rotation-picker-root');\r\n\r\n\t\tnew ListPicker<Player<any>, APLPrepullAction>(this.rootElem, modPlayer, {\r\n\t\t\textraCssClasses: ['apl-prepull-action-picker'],\r\n\t\t\ttitle: 'Prepull Actions',\r\n\t\t\ttitleTooltip: 'Actions to perform before the pull.',\r\n\t\t\titemLabel: 'Prepull Action',\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.aplRotation.prepullActions,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLPrepullAction>) => {\r\n\t\t\t\tplayer.aplRotation.prepullActions = newValue;\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tnewItem: () => APLPrepullAction.create({\r\n\t\t\t\taction: {},\r\n\t\t\t\tdoAtValue: {\r\n\t\t\t\t\tvalue: {oneofKind: 'const', const: { val: '-1s' }}\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t\tcopyItem: (oldItem: APLPrepullAction) => APLPrepullAction.clone(oldItem),\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLPrepullAction>, index: number, config: ListItemPickerConfig<Player<any>, APLPrepullAction>) => new APLPrepullActionPicker(parent, modPlayer, config, index),\r\n\t\t\tinlineMenuBar: true,\r\n\t\t});\r\n\r\n\t\tnew ListPicker<Player<any>, APLListItem>(this.rootElem, modPlayer, {\r\n\t\t\textraCssClasses: ['apl-list-item-picker'],\r\n\t\t\ttitle: 'Priority List',\r\n\t\t\ttitleTooltip: 'At each decision point, the simulation will perform the first valid action from this list.',\r\n\t\t\titemLabel: 'Action',\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.aplRotation.priorityList,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: Array<APLListItem>) => {\r\n\t\t\t\tplayer.aplRotation.priorityList = newValue;\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tnewItem: () => APLListItem.create({\r\n\t\t\t\taction: {},\r\n\t\t\t}),\r\n\t\t\tcopyItem: (oldItem: APLListItem) => APLListItem.clone(oldItem),\r\n\t\t\tnewItemPicker: (parent: HTMLElement, listPicker: ListPicker<Player<any>, APLListItem>, index: number, config: ListItemPickerConfig<Player<any>, APLListItem>) => new APLListItemPicker(parent, modPlayer, config, index),\r\n\t\t\tinlineMenuBar: true,\r\n\t\t});\r\n\r\n\t\t//modPlayer.rotationChangeEmitter.on(() => console.log('APL: ' + APLRotation.toJsonString(modPlayer.aplRotation)))\r\n\t}\r\n}\r\n\r\nclass APLPrepullActionPicker extends Input<Player<any>, APLPrepullAction> {\r\n\tprivate readonly player: Player<any>;\r\n\r\n\tprivate readonly hidePicker: Input<Player<any>, boolean>;\r\n\tprivate readonly doAtPicker: Input<Player<any>, string>;\r\n\tprivate readonly actionPicker: APLActionPicker;\r\n\r\n\tprivate getItem(): APLPrepullAction {\r\n\t\treturn this.getSourceValue() || APLPrepullAction.create({\r\n\t\t\taction: {},\r\n\t\t});\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: ListItemPickerConfig<Player<any>, APLPrepullAction>, index: number) {\r\n\t\tconfig.enableWhen = () => !this.getItem().hide;\r\n\t\tsuper(parent, 'apl-list-item-picker-root', player, config);\r\n\t\tthis.player = player;\r\n\r\n\t\tconst itemHeaderElem = ListPicker.getItemHeaderElem(this);\r\n\t\tmakeListItemWarnings(itemHeaderElem, player, player => player.getCurrentStats().rotationStats?.prepullActions[index]?.warnings || []);\r\n\r\n\t\tthis.hidePicker = new HidePicker(itemHeaderElem, player, {\r\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => this.getItem().hide,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\r\n\t\t\t\tthis.getItem().hide = newValue;\r\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.doAtPicker = new AdaptiveStringPicker(this.rootElem, this.player, {\r\n\t\t\tlabel: 'Do At',\r\n\t\t\tlabelTooltip: 'Time before pull to do the action. Should be negative, and formatted like, \\'-1s\\' or \\'-2500ms\\'.',\r\n\t\t\textraCssClasses: ['apl-prepull-actions-doat'],\r\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => (this.getItem().doAtValue?.value as APLValueImplStruct<'const'>|undefined)?.const.val || '',\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: string) => {\r\n\t\t\t\tif (newValue) {\r\n\t\t\t\t\tthis.getItem().doAtValue = APLValue.create({\r\n\t\t\t\t\t\tvalue: {oneofKind: 'const', const: { val: newValue }}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.getItem().doAtValue = undefined;\r\n\t\t\t\t}\r\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t\tinline: true,\r\n\t\t});\r\n\t\t//this.doAtPicker = new APLValuePicker(this.rootElem, this.player, {\r\n\t\t//\tlabel: 'Do At',\r\n\t\t//\tlabelTooltip: 'Time before pull to do the action. Should be negative, and formatted like, \\'-1s\\' or \\'-2500ms\\'.',\r\n\t\t//\textraCssClasses: ['apl-prepull-actions-doat'],\r\n\t\t//\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t//\tgetValue: () => this.getItem().doAtValue,\r\n\t\t//\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLValue | undefined) => {\r\n\t\t//\t\tthis.getItem().doAtValue = newValue;\r\n\t\t//\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t//\t},\r\n\t\t//\tinline: true,\r\n\t\t//});\r\n\r\n\t\tthis.actionPicker = new APLActionPicker(this.rootElem, this.player, {\r\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => this.getItem().action!,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLAction) => {\r\n\t\t\t\tthis.getItem().action = newValue;\r\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): APLPrepullAction {\r\n\t\tconst item = APLPrepullAction.create({\r\n\t\t\thide: this.hidePicker.getInputValue(),\r\n\t\t\tdoAtValue: {\r\n\t\t\t\tvalue: {oneofKind: 'const', const: { val: this.doAtPicker.getInputValue() }},\r\n\t\t\t},\r\n\t\t\taction: this.actionPicker.getInputValue(),\r\n\t\t});\r\n\t\treturn item;\r\n\t}\r\n\r\n\tsetInputValue(newValue: APLPrepullAction) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hidePicker.setInputValue(newValue.hide);\r\n\t\tthis.doAtPicker.setInputValue((newValue.doAtValue?.value as APLValueImplStruct<'const'>|undefined)?.const.val || '');\r\n\t\tthis.actionPicker.setInputValue(newValue.action || APLAction.create());\r\n\t}\r\n}\r\n\r\nclass APLListItemPicker extends Input<Player<any>, APLListItem> {\r\n\tprivate readonly player: Player<any>;\r\n\r\n\tprivate readonly hidePicker: Input<Player<any>, boolean>;\r\n\tprivate readonly actionPicker: APLActionPicker;\r\n\r\n\tprivate getItem(): APLListItem {\r\n\t\treturn this.getSourceValue() || APLListItem.create({\r\n\t\t\taction: {},\r\n\t\t});\r\n\t}\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, config: ListItemPickerConfig<Player<any>, APLListItem>, index: number) {\r\n\t\tconfig.enableWhen = () => !this.getItem().hide;\r\n\t\tsuper(parent, 'apl-list-item-picker-root', player, config);\r\n\t\tthis.player = player;\r\n\r\n\t\tconst itemHeaderElem = ListPicker.getItemHeaderElem(this);\r\n\t\tmakeListItemWarnings(itemHeaderElem, player, player => player.getCurrentStats().rotationStats?.priorityList[index]?.warnings || []);\r\n\r\n\t\tthis.hidePicker = new HidePicker(itemHeaderElem, player, {\r\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => this.getItem().hide,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: boolean) => {\r\n\t\t\t\tthis.getItem().hide = newValue;\r\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.actionPicker = new APLActionPicker(this.rootElem, this.player, {\r\n\t\t\tchangedEvent: () => this.player.rotationChangeEmitter,\r\n\t\t\tgetValue: () => this.getItem().action!,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: APLAction) => {\r\n\t\t\t\tthis.getItem().action = newValue;\r\n\t\t\t\tthis.player.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement | null {\r\n\t\treturn this.rootElem;\r\n\t}\r\n\r\n\tgetInputValue(): APLListItem {\r\n\t\tconst item = APLListItem.create({\r\n\t\t\thide: this.hidePicker.getInputValue(),\r\n\t\t\taction: this.actionPicker.getInputValue(),\r\n\t\t});\r\n\t\treturn item;\r\n\t}\r\n\r\n\tsetInputValue(newValue: APLListItem) {\r\n\t\tif (!newValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hidePicker.setInputValue(newValue.hide);\r\n\t\tthis.actionPicker.setInputValue(newValue.action || APLAction.create());\r\n\t}\r\n}\r\n\r\nfunction makeListItemWarnings(itemHeaderElem: HTMLElement, player: Player<any>, getWarnings: (player: Player<any>) => Array<string>) {\r\n\tconst warningsElem = ListPicker.makeActionElem('apl-warnings', 'fa-exclamation-triangle');\r\n\twarningsElem.classList.add('warning', 'link-warning');\r\n\twarningsElem.setAttribute('data-bs-html', 'true');\r\n\tconst warningsTooltip = Tooltip.getOrCreateInstance(warningsElem, {\r\n\t\tcustomClass: 'dropdown-tooltip',\r\n\t\ttitle: 'Warnings',\r\n\t\thtml: true,\r\n\t});\r\n\titemHeaderElem.appendChild(warningsElem);\r\n\r\n\tconst updateWarnings = async () => {\r\n\t\twarningsTooltip.setContent({ '.tooltip-inner': '' });\r\n\t\tconst warnings = getWarnings(player);\r\n\t\tif (warnings.length == 0) {\r\n\t\t\twarningsElem.style.visibility = 'hidden';\r\n\t\t} else {\r\n\t\t\twarningsElem.style.visibility = 'visible';\r\n\t\t\tconst formattedWarnings = await Promise.all(warnings.map(w => ActionId.replaceAllInString(w)));\r\n\t\t\twarningsTooltip.setContent({\r\n\t\t\t\t'.tooltip-inner': `\r\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t${formattedWarnings.map(w => `<li>${w}</li>`).join('')}\r\n\t\t\t\t</ul>\r\n\t\t\t`});\r\n\t\t}\r\n\t};\r\n\tupdateWarnings();\r\n\tplayer.currentStatsEmitter.on(updateWarnings);\r\n}\r\n\r\nclass HidePicker extends Input<Player<any>, boolean> {\r\n\tprivate readonly inputElem: HTMLElement;\r\n\tprivate readonly iconElem: HTMLElement;\r\n\tprivate tooltip: Tooltip;\r\n\r\n\tconstructor(parent: HTMLElement, modObject: Player<any>, config: InputConfig<Player<any>, boolean>) {\r\n\t\tsuper(parent, 'hide-picker-root', modObject, config);\r\n\r\n\t\tthis.inputElem = ListPicker.makeActionElem('hide-picker-button', 'fa-eye');\r\n\t\tthis.iconElem = this.inputElem.childNodes[0] as HTMLElement;\r\n\t\tthis.rootElem.appendChild(this.inputElem);\r\n\t\tthis.tooltip = Tooltip.getOrCreateInstance(this.inputElem, { title: 'Enable/Disable' });\r\n\r\n\t\tthis.init();\r\n\r\n\t\tthis.inputElem.addEventListener('click', () => {\r\n\t\t\tthis.setInputValue(!this.getInputValue());\r\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\r\n\t\t});\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.inputElem;\r\n\t}\r\n\r\n\tgetInputValue(): boolean {\r\n\t\treturn this.iconElem.classList.contains('fa-eye-slash');\r\n\t}\r\n\r\n\tsetInputValue(newValue: boolean) {\r\n\t\tif (newValue) {\r\n\t\t\tthis.iconElem.classList.add('fa-eye-slash');\r\n\t\t\tthis.iconElem.classList.remove('fa-eye');\r\n\t\t\tthis.tooltip.setContent({ '.tooltip-inner': 'Enable Action' });\r\n\t\t} else {\r\n\t\t\tthis.iconElem.classList.add('fa-eye');\r\n\t\t\tthis.iconElem.classList.remove('fa-eye-slash');\r\n\t\t\tthis.tooltip.setContent({ '.tooltip-inner': 'Disable Action' });\r\n\t\t}\r\n\t}\r\n}","import { IndividualSimUI, InputSection } from \"../../individual_sim_ui\";\r\nimport {\r\n\tCooldowns,\r\n\tSpec,\r\n} from \"../../proto/common\";\r\nimport {\r\n\tAPLRotation,\r\n\tAPLRotation_Type as APLRotationType,\r\n\tSimpleRotation,\r\n} from \"../../proto/apl\";\r\nimport {\r\n\tSavedRotation,\r\n} from \"../../proto/ui\";\r\nimport { EventID, TypedEvent } from \"../../typed_event\";\r\nimport { Player } from \"../../player\";\r\nimport { aplLaunchStatuses, LaunchStatus } from '../../launched_sims';\r\n\r\nimport { ContentBlock } from \"../content_block\";\r\nimport { SimTab } from \"../sim_tab\";\r\nimport { NumberPicker } from \"../number_picker\";\r\nimport { BooleanPicker } from \"../boolean_picker\";\r\nimport { EnumPicker } from \"../enum_picker\";\r\nimport { Input } from \"../input\";\r\nimport { ItemSwapPicker } from \"../item_swap_picker\";\r\nimport { CooldownsPicker } from \"./cooldowns_picker\";\r\nimport { CustomRotationPicker } from \"./custom_rotation_picker\";\r\nimport { SavedDataManager } from \"../saved_data_manager\";\r\n\r\nimport * as IconInputs from '../icon_inputs.js';\r\nimport * as Tooltips from '../../constants/tooltips.js';\r\n\r\nimport { APLRotationPicker } from \"./apl_rotation_picker\";\r\n\r\nexport class RotationTab extends SimTab {\r\n\tprotected simUI: IndividualSimUI<Spec>;\r\n\r\n\treadonly leftPanel: HTMLElement;\r\n\treadonly rightPanel: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, simUI, { identifier: 'rotation-tab', title: 'Rotation' });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.leftPanel = document.createElement('div');\r\n\t\tthis.leftPanel.classList.add('rotation-tab-left', 'tab-panel-left');\r\n\r\n\t\tthis.rightPanel = document.createElement('div');\r\n\t\tthis.rightPanel.classList.add('rotation-tab-right', 'tab-panel-right');\r\n\r\n\t\tthis.contentContainer.appendChild(this.leftPanel);\r\n\t\tthis.contentContainer.appendChild(this.rightPanel);\r\n\r\n\t\tthis.buildTabContent();\r\n\r\n\t\tthis.updateSections();\r\n\t\tthis.simUI.player.rotationChangeEmitter.on(() => this.updateSections());\r\n\t}\r\n\r\n\tprotected buildTabContent() {\r\n\t\tthis.buildHeader();\r\n\r\n\t\tthis.buildAutoContent();\r\n\t\tthis.buildAplContent();\r\n\t\tthis.buildSimpleOrLegacyContent(this.simUI.player.hasSimpleRotationGenerator());\r\n\r\n\t\tthis.buildSavedDataPickers();\r\n\t}\r\n\r\n\tprivate updateSections() {\r\n\t\tthis.rootElem.classList.remove('rotation-type-auto');\r\n\t\tthis.rootElem.classList.remove('rotation-type-simple');\r\n\t\tthis.rootElem.classList.remove('rotation-type-apl');\r\n\t\tthis.rootElem.classList.remove('rotation-type-legacy');\r\n\r\n\t\tconst rotType = this.simUI.player.getRotationType();\r\n\t\tif (rotType == APLRotationType.TypeAuto) {\r\n\t\t\tthis.rootElem.classList.add('rotation-type-auto');\r\n\t\t} else if (rotType == APLRotationType.TypeSimple) {\r\n\t\t\tthis.rootElem.classList.add('rotation-type-simple');\r\n\t\t} else if (rotType == APLRotationType.TypeAPL) {\r\n\t\t\tthis.rootElem.classList.add('rotation-type-apl');\r\n\t\t} else if (rotType == APLRotationType.TypeLegacy) {\r\n\t\t\tthis.rootElem.classList.add('rotation-type-legacy');\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildHeader() {\r\n\t\tconst header = document.createElement('div');\r\n\t\theader.classList.add('rotation-tab-header');\r\n\t\tthis.leftPanel.appendChild(header);\r\n\r\n\t\tconst aplLaunchStatus = aplLaunchStatuses[this.simUI.player.spec];\r\n\r\n\t\tnew EnumPicker(header, this.simUI.player, {\r\n\t\t\tlabel: 'Rotation Type',\r\n\t\t\tlabelTooltip: 'Which set of options to use for specifying the rotation.',\r\n\t\t\tinline: true,\r\n\t\t\tvalues: aplLaunchStatus == LaunchStatus.Alpha ? [\r\n\t\t\t\t{ value: APLRotationType.TypeLegacy, name: 'Legacy' },\r\n\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\r\n\t\t\t] : aplLaunchStatus == LaunchStatus.Beta ? [\r\n\t\t\t\t{ value: APLRotationType.TypeAuto, name: 'Auto' },\r\n\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\r\n\t\t\t\t{ value: APLRotationType.TypeLegacy, name: 'Legacy' },\r\n\t\t\t] : this.simUI.player.hasSimpleRotationGenerator() ? [\r\n\t\t\t\t{ value: APLRotationType.TypeAuto, name: 'Auto' },\r\n\t\t\t\t{ value: APLRotationType.TypeSimple, name: 'Simple' },\r\n\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\r\n\t\t\t] : [\r\n\t\t\t\t{ value: APLRotationType.TypeAuto, name: 'Auto' },\r\n\t\t\t\t{ value: APLRotationType.TypeAPL, name: 'APL' },\r\n\t\t\t],\r\n\t\t\tchangedEvent: (player: Player<any>) => player.rotationChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.getRotationType(),\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\tplayer.aplRotation.enabled = false;\r\n\t\t\t\tplayer.aplRotation.type = newValue;\r\n\t\t\t\tplayer.rotationChangeEmitter.emit(eventID);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tprivate buildAutoContent() {\r\n\t\tconst content = document.createElement('div');\r\n\t\tcontent.classList.add('rotation-tab-auto');\r\n\t\tthis.leftPanel.appendChild(content);\r\n\t}\r\n\r\n\tprivate buildAplContent() {\r\n\t\tconst content = document.createElement('div');\r\n\t\tcontent.classList.add('rotation-tab-apl');\r\n\t\tthis.leftPanel.appendChild(content);\r\n\r\n\t\tnew APLRotationPicker(content, this.simUI, this.simUI.player);\r\n\t}\r\n\r\n\tprivate buildSimpleOrLegacyContent(isSimple: boolean) {\r\n\t\tif (!isSimple && aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Launched) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst cssClass = isSimple ? 'rotation-tab-simple' : 'rotation-tab-legacy';\r\n\r\n\t\tconst contentBlock = new ContentBlock(this.leftPanel, 'rotation-settings', {\r\n\t\t\theader: { title: 'Rotation' }\r\n\t\t});\r\n\t\tcontentBlock.rootElem.classList.add(cssClass);\r\n\r\n\t\tconst rotationIconGroup = Input.newGroupContainer();\r\n\t\trotationIconGroup.classList.add('rotation-icon-group', 'icon-group');\r\n\t\tcontentBlock.bodyElement.appendChild(rotationIconGroup);\r\n\r\n\t\tif (this.simUI.individualConfig.rotationIconInputs?.length) {\r\n\t\t\tthis.configureIconSection(\r\n\t\t\t\trotationIconGroup,\r\n\t\t\t\tthis.simUI.individualConfig.rotationIconInputs.map(iconInput => IconInputs.buildIconInput(rotationIconGroup, this.simUI.player, iconInput)),\r\n\t\t\t\ttrue\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.configureInputSection(contentBlock.bodyElement, this.simUI.individualConfig.rotationInputs);\r\n\r\n\t\tcontentBlock.bodyElement.querySelectorAll('.input-root').forEach(elem => {\r\n\t\t\telem.classList.add('input-inline');\r\n\t\t})\r\n\r\n\t\tconst cooldownsContentBlock = new ContentBlock(this.leftPanel, 'cooldown-settings', {\r\n\t\t\theader: { title: 'Cooldowns', tooltip: Tooltips.COOLDOWNS_SECTION }\r\n\t\t});\r\n\t\tcooldownsContentBlock.rootElem.classList.add(cssClass);\r\n\r\n\t\tnew CooldownsPicker(cooldownsContentBlock.bodyElement, this.simUI.player);\r\n\t}\r\n\r\n\tprivate configureInputSection(sectionElem: HTMLElement, sectionConfig: InputSection) {\r\n\t\tsectionConfig.inputs.forEach(inputConfig => {\r\n\t\t\tif (inputConfig.type == 'number') {\r\n\t\t\t\tnew NumberPicker(sectionElem, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'boolean') {\r\n\t\t\t\tnew BooleanPicker(sectionElem, this.simUI.player, { ...inputConfig, ...{ cssScheme: this.simUI.cssScheme } });\r\n\t\t\t} else if (inputConfig.type == 'enum') {\r\n\t\t\t\tnew EnumPicker(sectionElem, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'customRotation') {\r\n\t\t\t\tnew CustomRotationPicker(sectionElem, this.simUI, this.simUI.player, inputConfig);\r\n\t\t\t} else if (inputConfig.type == 'itemSwap') {\r\n\t\t\t\tnew ItemSwapPicker(sectionElem, this.simUI, this.simUI.player, inputConfig)\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprivate configureIconSection(sectionElem: HTMLElement, iconPickers: Array<any>, adjustColumns?: boolean) {\r\n\t\tif (iconPickers.length == 0) {\r\n\t\t\tsectionElem.classList.add('hide');\r\n\t\t} else if (adjustColumns) {\r\n\t\t\tif (iconPickers.length <= 4) {\r\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${iconPickers.length}, 1fr)`;\r\n\t\t\t} else if (iconPickers.length > 4 && iconPickers.length < 8) {\r\n\t\t\t\tsectionElem.style.gridTemplateColumns = `repeat(${Math.ceil(iconPickers.length / 2)}, 1fr)`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate buildSavedDataPickers() {\r\n\t\tconst aplIsLaunched = aplLaunchStatuses[this.simUI.player.spec] == LaunchStatus.Launched;\r\n\r\n\t\tconst savedRotationsManager = new SavedDataManager<Player<any>, SavedRotation>(this.rightPanel, this.simUI, this.simUI.player, {\r\n\t\t\tlabel: 'Rotation',\r\n\t\t\theader: { title: 'Saved Rotations' },\r\n\t\t\tstorageKey: this.simUI.getSavedRotationStorageKey(),\r\n\t\t\tgetData: (player: Player<any>) => SavedRotation.create({\r\n\t\t\t\trotation: APLRotation.clone(player.aplRotation),\r\n\t\t\t\tspecRotationOptionsJson: aplIsLaunched ? '{}' : JSON.stringify(player.specTypeFunctions.rotationToJson(player.getRotation())),\r\n\t\t\t\tcooldowns: aplIsLaunched ? Cooldowns.create() : player.getCooldowns(),\r\n\t\t\t}),\r\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newRotation: SavedRotation) => {\r\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\t\t\tplayer.setAplRotation(eventID, newRotation.rotation || APLRotation.create());\r\n\t\t\t\t\tif (!aplIsLaunched) {\r\n\t\t\t\t\t\tif (newRotation.specRotationOptionsJson) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tconst json = JSON.parse(newRotation.specRotationOptionsJson);\r\n\t\t\t\t\t\t\t\tconst specRot = player.specTypeFunctions.rotationFromJson(json);\r\n\t\t\t\t\t\t\t\tplayer.setRotation(eventID, specRot);\r\n\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\tconsole.warn('Error parsing rotation spec options: ' + e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tplayer.setCooldowns(eventID, newRotation.cooldowns || Cooldowns.create());\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tchangeEmitters: [this.simUI.player.rotationChangeEmitter, this.simUI.player.cooldownsChangeEmitter],\r\n\t\t\tequals: (a: SavedRotation, b: SavedRotation) => {\r\n\t\t\t\t// Uncomment this to debug equivalence checks with preset rotations (e.g. the chip doesn't highlight)\r\n\t\t\t\t//console.log(`Rot A: ${SavedRotation.toJsonString(a, {prettySpaces: 2})}\\n\\nRot B: ${SavedRotation.toJsonString(b, {prettySpaces: 2})}`);\r\n\t\t\t\treturn SavedRotation.equals(a, b);\r\n\t\t\t},\r\n\t\t\ttoJson: (a: SavedRotation) => SavedRotation.toJson(a),\r\n\t\t\tfromJson: (obj: any) => SavedRotation.fromJson(obj),\r\n\t\t});\r\n\r\n\t\tthis.simUI.sim.waitForInit().then(() => {\r\n\t\t\tsavedRotationsManager.loadUserData();\r\n\t\t\t(this.simUI.individualConfig.presets.rotations || []).forEach(presetRotation => {\r\n\t\t\t\tconst rotData = presetRotation.rotation;\r\n\t\t\t\t// Fill default values so the equality checks always work.\r\n\t\t\t\tif (!rotData.cooldowns) rotData.cooldowns = Cooldowns.create();\r\n\t\t\t\tif (!rotData.specRotationOptionsJson) rotData.specRotationOptionsJson = '{}';\r\n\t\t\t\tif (!rotData.rotation) rotData.rotation = APLRotation.create();\r\n\r\n\t\t\t\tsavedRotationsManager.addSavedData({\r\n\t\t\t\t\tname: presetRotation.name,\r\n\t\t\t\t\ttooltip: presetRotation.tooltip,\r\n\t\t\t\t\tisPreset: true,\r\n\t\t\t\t\tdata: rotData,\r\n\t\t\t\t\tenableWhen: presetRotation.enableWhen,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n","import { Glyphs } from '../proto/common.js';\r\nimport { ItemQuality } from '../proto/common.js';\r\nimport { ActionId } from '../proto_utils/action_id.js';\r\nimport { setItemQualityCssClass } from '../css_utils.js';\r\nimport { Player } from '../player.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { stringComparator } from '../utils.js';\r\n\r\nimport { Component } from '../components/component.js';\r\nimport { Input } from '../components/input.js';\r\nimport { BaseModal } from '../components/base_modal.js';\r\nimport { ContentBlock } from '../components/content_block.js';\r\n\r\nexport type GlyphConfig = {\r\n\tname: string,\r\n\tdescription: string,\r\n\ticonUrl: string,\r\n};\r\n\r\nexport type GlyphsConfig = {\r\n\tmajorGlyphs: Record<number, GlyphConfig>,\r\n\tminorGlyphs: Record<number, GlyphConfig>,\r\n};\r\n\r\ninterface GlyphData {\r\n\tid: number,\r\n\tname: string,\r\n\tdescription: string,\r\n\ticonUrl: string,\r\n\tquality: ItemQuality | null,\r\n}\r\n\r\nconst emptyGlyphData: GlyphData = {\r\n\tid: 0,\r\n\tname: 'Empty',\r\n\tdescription: '',\r\n\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg',\r\n\tquality: null,\r\n};\r\n\r\nexport class GlyphsPicker extends Component {\r\n\tprivate readonly glyphsConfig: GlyphsConfig;\r\n\r\n\tmajorGlyphPickers: Array<GlyphPicker> = [];\r\n\tminorGlyphPickers: Array<GlyphPicker> = [];\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, glyphsConfig: GlyphsConfig) {\r\n\t\tsuper(parent, 'glyphs-picker-root');\r\n\t\tthis.glyphsConfig = glyphsConfig;\r\n\r\n\t\tconst majorGlyphs = Object.keys(glyphsConfig.majorGlyphs).map(idStr => Number(idStr));\r\n\t\tconst minorGlyphs = Object.keys(glyphsConfig.minorGlyphs).map(idStr => Number(idStr));\r\n\r\n\t\tconst majorGlyphsData = majorGlyphs.map(glyph => this.getGlyphData(glyph));\r\n\t\tconst minorGlyphsData = minorGlyphs.map(glyph => this.getGlyphData(glyph));\r\n\r\n\t\tmajorGlyphsData.sort((a, b) => stringComparator(a.name, b.name));\r\n\t\tminorGlyphsData.sort((a, b) => stringComparator(a.name, b.name));\r\n\r\n\t\tconst majorGlyphsBlock = new ContentBlock(this.rootElem, 'major-glyphs', {\r\n\t\t\theader: { title: 'Major', extraCssClasses: ['border-0', 'mb-1'] }\r\n\t\t});\r\n\t\tconst minorGlyphsBlock = new ContentBlock(this.rootElem, 'minor-glyphs', {\r\n\t\t\theader: { title: 'Minor', extraCssClasses: ['border-0', 'mb-1'] }\r\n\t\t});\r\n\r\n\t\tthis.majorGlyphPickers = (['major1', 'major2', 'major3'] as Array<keyof Glyphs>).map(glyphField => {\r\n\t\t\treturn new GlyphPicker(majorGlyphsBlock.bodyElement, player, majorGlyphsData, glyphField, true)\r\n\t\t});\r\n\t\tthis.minorGlyphPickers = (['minor1', 'minor2', 'minor3'] as Array<keyof Glyphs>).map(glyphField => {\r\n\t\t\treturn new GlyphPicker(minorGlyphsBlock.bodyElement, player, minorGlyphsData, glyphField, false)\r\n\t\t});\r\n\t}\r\n\r\n\t// In case we ever want to parse description from tooltip HTML.\r\n\t//static descriptionRegex = /<a href=\\\\\"\\/wotlk.*>(.*)<\\/a>/g;\r\n\tgetGlyphData(glyph: number): GlyphData {\r\n\t\tconst glyphConfig = this.glyphsConfig.majorGlyphs[glyph] || this.glyphsConfig.minorGlyphs[glyph];\r\n\r\n\t\treturn {\r\n\t\t\tid: glyph,\r\n\t\t\tname: glyphConfig.name,\r\n\t\t\tdescription: glyphConfig.description,\r\n\t\t\ticonUrl: glyphConfig.iconUrl,\r\n\t\t\tquality: ItemQuality.ItemQualityCommon,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nclass GlyphPicker extends Input<Player<any>, number> {\r\n\treadonly player: Player<any>;\r\n\tprivate readonly iconElem: HTMLAnchorElement;\r\n\r\n\tprivate readonly glyphOptions: Array<GlyphData>;\r\n\tselectedGlyph: GlyphData;\r\n\r\n\tconstructor(parent: HTMLElement, player: Player<any>, glyphOptions: Array<GlyphData>, glyphField: keyof Glyphs, isMajor: boolean) {\r\n\t\tsuper(parent, 'glyph-picker-root', player, {\r\n\t\t\tchangedEvent: (player: Player<any>) => player.glyphsChangeEmitter,\r\n\t\t\tgetValue: (player: Player<any>) => player.getGlyphs()[glyphField] as number,\r\n\t\t\tsetValue: (eventID: EventID, player: Player<any>, newValue: number) => {\r\n\t\t\t\tconst glyphs = player.getGlyphs();\r\n\t\t\t\t(glyphs[glyphField] as number) = newValue;\r\n\t\t\t\tplayer.setGlyphs(eventID, glyphs);\r\n\t\t\t},\r\n\t\t});\r\n\t\tif (!isMajor) {\r\n\t\t\tthis.rootElem.classList.add('minor');\r\n\t\t}\r\n\t\tthis.player = player;\r\n\t\tthis.glyphOptions = glyphOptions;\r\n\t\tthis.selectedGlyph = emptyGlyphData;\r\n\r\n\t\tthis.rootElem.innerHTML = `<a class=\"glyph-picker-icon\" data-whtticon='false'></a>`;\r\n\r\n\t\tthis.iconElem = this.rootElem.getElementsByClassName('glyph-picker-icon')[0] as HTMLAnchorElement;\r\n\t\tthis.iconElem.addEventListener('click', event => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst selectorModal = new GlyphSelectorModal(this.rootElem.closest('.individual-sim-ui')!, this, this.glyphOptions);\r\n\t\t});\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetInputElem(): HTMLElement {\r\n\t\treturn this.iconElem;\r\n\t}\r\n\r\n\tgetInputValue(): number {\r\n\t\treturn this.selectedGlyph.id;\r\n\t}\r\n\r\n\tsetInputValue(newValue: number) {\r\n\t\tthis.selectedGlyph = this.glyphOptions.find(glyphData => glyphData.id == newValue) || emptyGlyphData;\r\n\r\n\t\tthis.iconElem.style.backgroundImage = `url('${this.selectedGlyph.iconUrl}')`;\r\n\t\tthis.iconElem.href = this.selectedGlyph.id == 0 ? '' : ActionId.makeItemUrl(this.selectedGlyph.id);\r\n\t}\r\n}\r\n\r\nclass GlyphSelectorModal extends BaseModal {\r\n\tconstructor(parent: HTMLElement, glyphPicker: GlyphPicker, glyphOptions: Array<GlyphData>) {\r\n\t\tsuper(parent, 'glyph-modal', { title: 'Glyphs' });\r\n\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<div class=\"input-root\">\r\n\t\t\t\t<input class=\"selector-modal-search form-control\" type=\"text\" placeholder=\"Search...\">\r\n\t\t\t</div>\r\n\t\t\t<ul class=\"selector-modal-list\"></ul>\r\n\t\t`;\r\n\r\n\t\tconst listElem = this.rootElem.getElementsByClassName('selector-modal-list')[0] as HTMLElement;\r\n\r\n\t\tglyphOptions = [emptyGlyphData].concat(glyphOptions);\r\n\t\tconst listItemElems = glyphOptions.map((glyphData, glyphIdx) => {\r\n\t\t\tconst listItemElem = document.createElement('li');\r\n\t\t\tlistItemElem.classList.add('selector-modal-list-item');\r\n\t\t\tlistElem.appendChild(listItemElem);\r\n\r\n\t\t\tlistItemElem.dataset.idx = String(glyphIdx);\r\n\r\n\t\t\tlistItemElem.innerHTML = `\r\n\t\t\t\t<a class=\"selector-modal-list-item-link\">\r\n\t\t\t\t\t<img class=\"selector-modal-list-item-icon\" />\r\n\t\t\t\t\t<label class=\"selector-modal-list-item-name\">${glyphData.name}</label>\r\n\t\t\t\t\t<span class=\"selector-modal-list-item-description\">${glyphData.description}</span>\r\n\t\t\t\t</a>\r\n      `;\r\n\r\n\t\t\tconst anchorElem = listItemElem.children[0] as HTMLAnchorElement\r\n\t\t\tconst iconElem = listItemElem.querySelector('.selector-modal-list-item-icon') as HTMLImageElement;\r\n\t\t\tconst nameElem = listItemElem.querySelector('.selector-modal-list-item-name') as HTMLElement;\r\n\r\n\t\t\tanchorElem.href = glyphData.id == 0 ? '' : ActionId.makeItemUrl(glyphData.id);\r\n\t\t\tanchorElem.addEventListener('click', (event: Event) => {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tglyphPicker.setValue(TypedEvent.nextEventID(), glyphData.id);\r\n\t\t\t});\r\n\t\t\ticonElem.src = glyphData.iconUrl;\r\n\t\t\tsetItemQualityCssClass(nameElem, glyphData.quality);\r\n\r\n\t\t\treturn listItemElem;\r\n\t\t});\r\n\r\n\t\tconst updateSelected = () => {\r\n\t\t\tconst selectedGlyphId = glyphPicker.selectedGlyph.id;\r\n\r\n\t\t\tlistItemElems.forEach(elem => {\r\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\r\n\t\t\t\tconst listItemData = glyphOptions[listItemIdx];\r\n\r\n\t\t\t\telem.classList.remove('active');\r\n\t\t\t\tif (listItemData.id == selectedGlyphId) {\r\n\t\t\t\t\telem.classList.add('active');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\tupdateSelected();\r\n\r\n\t\tconst applyFilters = () => {\r\n\t\t\tlet validItemElems = listItemElems;\r\n\t\t\tconst selectedGlyph = glyphPicker.selectedGlyph;\r\n\r\n\t\t\tvalidItemElems = validItemElems.filter(elem => {\r\n\t\t\t\tconst listItemIdx = parseInt(elem.dataset.idx!);\r\n\t\t\t\tconst listItemData = glyphOptions[listItemIdx];\r\n\r\n\t\t\t\tif (searchInput.value.length > 0) {\r\n\t\t\t\t\tconst searchQuery = searchInput.value.toLowerCase().split(\" \");\r\n\t\t\t\t\tconst name = listItemData.name.toLowerCase();\r\n\r\n\t\t\t\t\tvar include = true;\r\n\t\t\t\t\tsearchQuery.forEach(v => {\r\n\t\t\t\t\t\tif (!name.includes(v))\r\n\t\t\t\t\t\t\tinclude = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (!include) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\r\n\t\t\tlistElem.innerHTML = ``\r\n\t\t\tlistElem.append(...validItemElems);\r\n\t\t};\r\n\r\n\t\tconst searchInput = this.rootElem.getElementsByClassName('selector-modal-search')[0] as HTMLInputElement;\r\n\t\tsearchInput.addEventListener('input', applyFilters);\r\n\t\tsearchInput.addEventListener(\"keyup\", ev => {\r\n\t\t\tif (ev.key == \"Enter\") {\r\n\t\t\t\tlistItemElems.find(ele => {\r\n\t\t\t\t\tif (ele.classList.contains(\"hidden\")) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst nameElem = ele.getElementsByClassName('selector-modal-list-item-name')[0] as HTMLElement;\r\n\t\t\t\t\tnameElem.click();\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tglyphPicker.player.glyphsChangeEmitter.on(() => {\r\n\t\t\tapplyFilters();\r\n\t\t\tupdateSelected();\r\n\t\t});\r\n\t}\r\n}\r\n","import { Spec } from '../proto/common.js';\r\nimport { HunterPetTalents, Hunter_Options_PetType as PetType } from '../proto/hunter.js';\r\nimport { Player } from '../player.js';\r\nimport { Component } from '../components/component.js';\r\nimport { EnumPicker, EnumPickerConfig } from '../components/enum_picker.js';\r\nimport { SavedDataManager } from '../components/saved_data_manager.js';\r\nimport { EventID, TypedEvent } from '../typed_event.js';\r\nimport { ActionId } from '../proto_utils/action_id.js';\r\n\r\nimport { TalentsConfig, TalentsPicker, newTalentsConfig } from './talents_picker.js';\r\nimport { protoToTalentString, talentStringToProto } from './factory.js';\r\n\r\nimport * as InputHelpers from '../components/input_helpers.js';\r\nimport { SimUI } from '../sim_ui.js';\r\n\r\nimport HunterPetCunningJson from './trees/hunter_cunning.json'\r\nimport HunterPetFerocityJson from './trees/hunter_ferocity.json'\r\nimport HunterPetTenacityJson from './trees/hunter_tenacity.json'\r\n\r\nexport function makePetTypeInputConfig(includeLabel: boolean): InputHelpers.TypedIconEnumPickerConfig<Player<Spec.SpecHunter>, PetType> {\r\n\treturn InputHelpers.makeSpecOptionsEnumIconInput<Spec.SpecHunter, PetType>({\r\n\t\tfieldName: 'petType',\r\n\t\tnumColumns: 5,\r\n\t\t//label: includeLabel ? 'Pet' : '',\r\n\t\tvalues: [\r\n\t\t\t{ value: PetType.PetNone, tooltip: 'No Pet' },\r\n\t\t\t{ actionId: ActionId.fromPetName('Bat'), tooltip: 'Bat', value: PetType.Bat },\r\n\t\t\t{ actionId: ActionId.fromPetName('Bear'), tooltip: 'Bear', value: PetType.Bear },\r\n\t\t\t{ actionId: ActionId.fromPetName('Bird of Prey'), tooltip: 'Bird of Prey', value: PetType.BirdOfPrey },\r\n\t\t\t{ actionId: ActionId.fromPetName('Boar'), tooltip: 'Boar', value: PetType.Boar },\r\n\t\t\t{ actionId: ActionId.fromPetName('Carrion Bird'), tooltip: 'Carrion Bird', value: PetType.CarrionBird },\r\n\t\t\t{ actionId: ActionId.fromPetName('Cat'), tooltip: 'Cat', value: PetType.Cat },\r\n\t\t\t{ actionId: ActionId.fromPetName('Chimaera'), tooltip: 'Chimaera (Exotic)', value: PetType.Chimaera },\r\n\t\t\t{ actionId: ActionId.fromPetName('Core Hound'), tooltip: 'Core Hound (Exotic)', value: PetType.CoreHound },\r\n\t\t\t{ actionId: ActionId.fromPetName('Crab'), tooltip: 'Crab', value: PetType.Crab },\r\n\t\t\t{ actionId: ActionId.fromPetName('Crocolisk'), tooltip: 'Crocolisk', value: PetType.Crocolisk },\r\n\t\t\t{ actionId: ActionId.fromPetName('Devilsaur'), tooltip: 'Devilsaur (Exotic)', value: PetType.Devilsaur },\r\n\t\t\t{ actionId: ActionId.fromPetName('Dragonhawk'), tooltip: 'Dragonhawk', value: PetType.Dragonhawk },\r\n\t\t\t{ actionId: ActionId.fromPetName('Gorilla'), tooltip: 'Gorilla', value: PetType.Gorilla },\r\n\t\t\t{ actionId: ActionId.fromPetName('Hyena'), tooltip: 'Hyena', value: PetType.Hyena },\r\n\t\t\t{ actionId: ActionId.fromPetName('Moth'), tooltip: 'Moth', value: PetType.Moth },\r\n\t\t\t{ actionId: ActionId.fromPetName('Nether Ray'), tooltip: 'Nether Ray', value: PetType.NetherRay },\r\n\t\t\t{ actionId: ActionId.fromPetName('Raptor'), tooltip: 'Raptor', value: PetType.Raptor },\r\n\t\t\t{ actionId: ActionId.fromPetName('Ravager'), tooltip: 'Ravager', value: PetType.Ravager },\r\n\t\t\t{ actionId: ActionId.fromPetName('Rhino'), tooltip: 'Rhino', value: PetType.Rhino },\r\n\t\t\t{ actionId: ActionId.fromPetName('Scorpid'), tooltip: 'Scorpid', value: PetType.Scorpid },\r\n\t\t\t{ actionId: ActionId.fromPetName('Serpent'), tooltip: 'Serpent', value: PetType.Serpent },\r\n\t\t\t{ actionId: ActionId.fromPetName('Silithid'), tooltip: 'Silithid (Exotic)', value: PetType.Silithid },\r\n\t\t\t{ actionId: ActionId.fromPetName('Spider'), tooltip: 'Spider', value: PetType.Spider },\r\n\t\t\t{ actionId: ActionId.fromPetName('Spirit Beast'), tooltip: 'Spirit Beast (Exotic)', value: PetType.SpiritBeast },\r\n\t\t\t{ actionId: ActionId.fromPetName('Spore Bat'), tooltip: 'Spore Bat', value: PetType.SporeBat },\r\n\t\t\t{ actionId: ActionId.fromPetName('Tallstrider'), tooltip: 'Tallstrider', value: PetType.Tallstrider },\r\n\t\t\t{ actionId: ActionId.fromPetName('Turtle'), tooltip: 'Turtle', value: PetType.Turtle },\r\n\t\t\t{ actionId: ActionId.fromPetName('Warp Stalker'), tooltip: 'Warp Stalker', value: PetType.WarpStalker },\r\n\t\t\t{ actionId: ActionId.fromPetName('Wasp'), tooltip: 'Wasp', value: PetType.Wasp },\r\n\t\t\t{ actionId: ActionId.fromPetName('Wind Serpent'), tooltip: 'Wind Serpent', value: PetType.WindSerpent },\r\n\t\t\t{ actionId: ActionId.fromPetName('Wolf'), tooltip: 'Wolf', value: PetType.Wolf },\r\n\t\t\t{ actionId: ActionId.fromPetName('Worm'), tooltip: 'Worm (Exotic)', value: PetType.Worm },\r\n\t\t],\r\n\t});\r\n}\r\n\r\nenum PetCategory {\r\n\tCunning,\r\n\tFerocity,\r\n\tTenacity,\r\n}\r\n\r\nconst petCategories: Record<PetType, PetCategory> = {\r\n\t[PetType.PetNone]: PetCategory.Ferocity,\r\n\t[PetType.Bat]: PetCategory.Cunning,\r\n\t[PetType.Bear]: PetCategory.Tenacity,\r\n\t[PetType.BirdOfPrey]: PetCategory.Cunning,\r\n\t[PetType.Boar]: PetCategory.Tenacity,\r\n\t[PetType.CarrionBird]: PetCategory.Ferocity,\r\n\t[PetType.Cat]: PetCategory.Ferocity,\r\n\t[PetType.Chimaera]: PetCategory.Cunning,\r\n\t[PetType.CoreHound]: PetCategory.Ferocity,\r\n\t[PetType.Crab]: PetCategory.Tenacity,\r\n\t[PetType.Crocolisk]: PetCategory.Tenacity,\r\n\t[PetType.Devilsaur]: PetCategory.Ferocity,\r\n\t[PetType.Dragonhawk]: PetCategory.Cunning,\r\n\t[PetType.Gorilla]: PetCategory.Tenacity,\r\n\t[PetType.Hyena]: PetCategory.Ferocity,\r\n\t[PetType.Moth]: PetCategory.Ferocity,\r\n\t[PetType.NetherRay]: PetCategory.Cunning,\r\n\t[PetType.Raptor]: PetCategory.Ferocity,\r\n\t[PetType.Ravager]: PetCategory.Cunning,\r\n\t[PetType.Rhino]: PetCategory.Tenacity,\r\n\t[PetType.Scorpid]: PetCategory.Tenacity,\r\n\t[PetType.Serpent]: PetCategory.Cunning,\r\n\t[PetType.Silithid]: PetCategory.Cunning,\r\n\t[PetType.Spider]: PetCategory.Cunning,\r\n\t[PetType.SpiritBeast]: PetCategory.Ferocity,\r\n\t[PetType.SporeBat]: PetCategory.Cunning,\r\n\t[PetType.Tallstrider]: PetCategory.Ferocity,\r\n\t[PetType.Turtle]: PetCategory.Tenacity,\r\n\t[PetType.WarpStalker]: PetCategory.Tenacity,\r\n\t[PetType.Wasp]: PetCategory.Ferocity,\r\n\t[PetType.WindSerpent]: PetCategory.Cunning,\r\n\t[PetType.Wolf]: PetCategory.Ferocity,\r\n\t[PetType.Worm]: PetCategory.Tenacity,\r\n};\r\n\r\nconst categoryOrder = [PetCategory.Cunning, PetCategory.Ferocity, PetCategory.Tenacity];\r\nconst categoryClasses = ['cunning', 'ferocity', 'tenacity'];\r\n\r\nexport class HunterPetTalentsPicker extends Component {\r\n\tprivate readonly simUI: SimUI;\r\n\tprivate readonly player: Player<Spec.SpecHunter>;\r\n\tprivate curCategory: PetCategory | null;\r\n\tprivate curTalents: HunterPetTalents;\r\n\r\n\t// Not saved to storage, just holds last-used values for this session.\r\n\tprivate savedSets: Array<HunterPetTalents>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, player: Player<Spec.SpecHunter>) {\r\n\t\tsuper(parent, 'hunter-pet-talents-picker');\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.player = player;\r\n\r\n\t\tthis.rootElem.innerHTML = `\r\n\t\t\t<div class=\"pet-talents-container\"></div>\r\n\t\t`;\r\n\r\n\t\tthis.curCategory = this.getCategoryFromPlayer();\r\n\t\tthis.curTalents = this.getPetTalentsFromPlayer();\r\n\t\tthis.savedSets = defaultTalents.slice();\r\n\t\tthis.savedSets[this.curCategory] = this.curTalents;\r\n\t\tthis.rootElem.classList.add(categoryClasses[this.curCategory]);\r\n\r\n\t\tconst talentsContainer = this.rootElem.getElementsByClassName('pet-talents-container')[0] as HTMLElement;\r\n\r\n\t\tconst pickers = categoryOrder.map((category, i) => {\r\n\t\t\tconst talentsConfig = petTalentsConfig[i];\r\n\r\n\t\t\tconst pickerContainer = document.createElement('div');\r\n\t\t\tpickerContainer.classList.add('hunter-pet-talents-' + categoryClasses[i]);\r\n\t\t\ttalentsContainer.appendChild(pickerContainer);\r\n\r\n\t\t\tconst picker = new TalentsPicker(pickerContainer, player, {\r\n\t\t\t\tklass: player.getClass(),\r\n\t\t\t\ttrees: talentsConfig,\r\n\t\t\t\tchangedEvent: (player: Player<Spec.SpecHunter>) => player.specOptionsChangeEmitter,\r\n\t\t\t\tgetValue: (player: Player<Spec.SpecHunter>) => protoToTalentString(this.getPetTalentsFromPlayer(), talentsConfig),\r\n\t\t\t\tsetValue: (eventID: EventID, player: Player<Spec.SpecHunter>, newValue: string) => {\r\n\t\t\t\t\tconst options = player.getSpecOptions();\r\n\t\t\t\t\toptions.petTalents = talentStringToProto(HunterPetTalents.create(), newValue, talentsConfig);\r\n\t\t\t\t\tplayer.setSpecOptions(eventID, options);\r\n\r\n\t\t\t\t\tthis.savedSets[i] = options.petTalents;\r\n\t\t\t\t\tthis.curTalents = options.petTalents;\r\n\t\t\t\t},\r\n\t\t\t\tpointsPerRow: 3,\r\n\t\t\t\tmaxPoints: 13,\r\n\t\t\t});\r\n\r\n\t\t\tconst savedTalentsManager = new SavedDataManager<Player<Spec.SpecHunter>, string>(pickerContainer, this.simUI, this.player, {\r\n\t\t\t\tpresetsOnly: true,\r\n\t\t\t\tlabel: 'Pet Talents',\r\n\t\t\t\tstorageKey: '__NEVER_USED__',\r\n\t\t\t\tgetData: (player: Player<Spec.SpecHunter>) => protoToTalentString(this.getPetTalentsFromPlayer(), talentsConfig),\r\n\t\t\t\tsetData: (eventID: EventID, player: Player<Spec.SpecHunter>, newValue: string) => {\r\n\t\t\t\t\tconst options = player.getSpecOptions();\r\n\t\t\t\t\toptions.petTalents = talentStringToProto(HunterPetTalents.create(), newValue, talentsConfig);\r\n\t\t\t\t\tplayer.setSpecOptions(eventID, options);\r\n\r\n\t\t\t\t\tthis.savedSets[i] = options.petTalents;\r\n\t\t\t\t\tthis.curTalents = options.petTalents;\r\n\t\t\t\t},\r\n\t\t\t\tchangeEmitters: [this.player.specOptionsChangeEmitter],\r\n\t\t\t\tequals: (a: string, b: string) => a == b,\r\n\t\t\t\ttoJson: (a: string) => a,\r\n\t\t\t\tfromJson: (obj: any) => '',\r\n\t\t\t});\r\n\t\t\tsavedTalentsManager.addSavedData({\r\n\t\t\t\tname: 'Default',\r\n\t\t\t\tisPreset: true,\r\n\t\t\t\tdata: protoToTalentString(defaultTalents[i], talentsConfig),\r\n\t\t\t});\r\n\t\t\tsavedTalentsManager.addSavedData({\r\n\t\t\t\tname: 'Beast Mastery',\r\n\t\t\t\tisPreset: true,\r\n\t\t\t\tdata: protoToTalentString(defaultBMTalents[i], talentsConfig),\r\n\t\t\t});\r\n\r\n\t\t\treturn picker;\r\n\t\t});\r\n\r\n\t\tplayer.specOptionsChangeEmitter.on(() => {\r\n\t\t\tconst petCategory = this.getCategoryFromPlayer();\r\n\t\t\tconst categoryIdx = categoryOrder.indexOf(petCategory);\r\n\r\n\t\t\tif (petCategory != this.curCategory) {\r\n\t\t\t\tthis.curCategory = petCategory;\r\n\t\t\t\tthis.rootElem.classList.remove(...categoryClasses);\r\n\t\t\t\tthis.rootElem.classList.add(categoryClasses[categoryIdx]);\r\n\r\n\t\t\t\tconst curTalents = this.getPetTalentsFromPlayer();\r\n\t\t\t\tif (!HunterPetTalents.equals(curTalents, this.curTalents)) {\r\n\t\t\t\t\t// If the current talents have also changed, this was probably a load so we shouldn't switch sets.\r\n\t\t\t\t\tthis.curTalents = curTalents;\r\n\t\t\t\t\tthis.savedSets[this.curCategory] = this.curTalents;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Revert to the talents from last time the user was editing this category.\r\n\t\t\t\t\tconst options = this.player.getSpecOptions();\r\n\t\t\t\t\toptions.petTalents = this.savedSets[this.curCategory];\r\n\t\t\t\t\tthis.player.setSpecOptions(TypedEvent.nextEventID(), options);\r\n\t\t\t\t\tthis.curTalents = options.petTalents;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst updateIsBM = () => {\r\n\t\t\tconst maxPoints = this.player.getTalents().beastMastery ? 17 : 13;\r\n\t\t\tpickers.forEach(picker => picker.setMaxPoints(maxPoints));\r\n\t\t};\r\n\t\tplayer.talentsChangeEmitter.on(updateIsBM);\r\n\t\tupdateIsBM();\r\n\t}\r\n\r\n\tgetPetTalentsFromPlayer(): HunterPetTalents {\r\n\t\treturn this.player.getSpecOptions().petTalents || HunterPetTalents.create();\r\n\t}\r\n\r\n\tgetCategoryFromPlayer(): PetCategory {\r\n\t\tconst petType = this.player.getSpecOptions().petType;\r\n\t\treturn petCategories[petType];\r\n\t}\r\n}\r\n\r\nexport function getPetTalentsConfig(petType: PetType): TalentsConfig<HunterPetTalents> {\r\n\tconst petCategory = petCategories[petType];\r\n\tconst categoryIdx = categoryOrder.indexOf(petCategory);\r\n\treturn petTalentsConfig[categoryIdx];\r\n}\r\n\r\nexport const cunningDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tdive: true,\r\n\tboarsSpeed: true,\r\n\tmobility: 2,\r\n\tspikedCollar: 3,\r\n\tcornered: 2,\r\n\tfeedingFrenzy: 2,\r\n});\r\nexport const ferocityDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tdive: true,\r\n\tspikedCollar: 3,\r\n\tboarsSpeed: true,\r\n\tcullingTheHerd: 3,\r\n\tspidersBite: 3,\r\n});\r\nexport const tenacityDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tcharge: true,\r\n\tgreatStamina: 3,\r\n\tbloodOfTheRhino: 2,\r\n\tguardDog: 2,\r\n\tthunderstomp: true,\r\n\tgraceOfTheMantis: 2,\r\n});\r\nconst defaultTalents = [cunningDefault, ferocityDefault, tenacityDefault];\r\n\r\nexport const cunningBMDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tdive: true,\r\n\tboarsSpeed: true,\r\n\tmobility: 2,\r\n\tspikedCollar: 3,\r\n\tcornered: 2,\r\n\tfeedingFrenzy: 2,\r\n\twolverineBite: true,\r\n\tbullheaded: true,\r\n\tgraceOfTheMantis: 1,\r\n});\r\nexport const ferocityBMDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tdive: true,\r\n\tbloodthirsty: 1,\r\n\tspikedCollar: 3,\r\n\tboarsSpeed: true,\r\n\tcullingTheHerd: 3,\r\n\tspidersBite: 3,\r\n\trabid: true,\r\n\tcallOfTheWild: true,\r\n\tsharkAttack: 1,\r\n});\r\nexport const tenacityBMDefault: HunterPetTalents = HunterPetTalents.create({\r\n\tcobraReflexes: 2,\r\n\tcharge: true,\r\n\tgreatStamina: 3,\r\n\tspikedCollar: 3,\r\n\tbloodOfTheRhino: 2,\r\n\tguardDog: 2,\r\n\tthunderstomp: true,\r\n\tgraceOfTheMantis: 2,\r\n\troarOfSacrifice: true,\r\n});\r\nconst defaultBMTalents = [cunningBMDefault, ferocityBMDefault, tenacityBMDefault];\r\n\r\nconst cunningPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetCunningJson);\r\nconst ferocityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetFerocityJson);\r\nconst tenacityPetTalentsConfig: TalentsConfig<HunterPetTalents> = newTalentsConfig(HunterPetTenacityJson);\r\n\r\nconst petTalentsConfig = [\r\n\tcunningPetTalentsConfig,\r\n\tferocityPetTalentsConfig,\r\n\ttenacityPetTalentsConfig,\r\n];\r\n","import { IndividualSimUI } from \"../../individual_sim_ui\";\r\nimport { Player } from \"../../player\";\r\nimport { EventID, TypedEvent } from \"../../typed_event\";\r\n\r\nimport { Class, Glyphs, Spec } from \"../../proto/common\";\r\nimport { SavedTalents } from \"../../proto/ui\";\r\n\r\nimport { classGlyphsConfig, classTalentsConfig } from \"../../talents/factory\";\r\nimport { GlyphsPicker } from \"../../talents/glyphs_picker\";\r\nimport { HunterPetTalentsPicker, makePetTypeInputConfig } from \"../../talents/hunter_pet\";\r\nimport { TalentsPicker } from \"../../talents/talents_picker\";\r\n\r\nimport { EnumPicker } from \"../enum_picker\";\r\nimport { IconEnumPicker } from \"../icon_enum_picker\";\r\nimport { SavedDataManager } from \"../saved_data_manager\";\r\nimport { SimTab } from \"../sim_tab\";\r\n\r\nimport * as Mechanics from '../../constants/mechanics';\r\n\r\nexport class TalentsTab extends SimTab {\r\n\tprotected simUI: IndividualSimUI<Spec>;\r\n\r\n\treadonly leftPanel: HTMLElement;\r\n\treadonly rightPanel: HTMLElement;\r\n\r\n\tconstructor(parentElem: HTMLElement, simUI: IndividualSimUI<Spec>) {\r\n\t\tsuper(parentElem, simUI, { identifier: 'talents-tab', title: 'Talents' });\r\n\t\tthis.simUI = simUI;\r\n\r\n\t\tthis.leftPanel = document.createElement('div');\r\n\t\tthis.leftPanel.classList.add('talents-tab-left', 'tab-panel-left');\r\n\t\tthis.rightPanel = document.createElement('div');\r\n\t\tthis.rightPanel.classList.add('talents-tab-right', 'tab-panel-right', 'within-raid-sim-hide');\r\n\r\n\t\tthis.contentContainer.appendChild(this.leftPanel);\r\n\t\tthis.contentContainer.appendChild(this.rightPanel);\r\n\r\n\t\tthis.buildTabContent();\r\n\t}\r\n\r\n\tprotected buildTabContent() {\r\n    if (this.simUI.player.getClass() == Class.ClassHunter) {\r\n      this.buildHunterPickers();\r\n    } else {\r\n      this.buildTalentsPicker(this.leftPanel);\r\n      this.buildGlyphsPicker(this.leftPanel);\r\n    }\r\n\r\n    this.buildSavedTalentsPicker();\r\n\t}\r\n\r\n  private buildTalentsPicker(parentElem: HTMLElement) {\r\n    new TalentsPicker(parentElem, this.simUI.player, {\r\n      klass: this.simUI.player.getClass(),\r\n      trees: classTalentsConfig[this.simUI.player.getClass()],\r\n      changedEvent: (player: Player<any>) => player.talentsChangeEmitter,\r\n      getValue: (player: Player<any>) => player.getTalentsString(),\r\n      setValue: (eventID: EventID, player: Player<any>, newValue: string) => {\r\n        player.setTalentsString(eventID, newValue);\r\n      },\r\n      pointsPerRow: 5,\r\n      maxPoints: Mechanics.MAX_TALENT_POINTS,\r\n    });\r\n  }\r\n\r\n  private buildGlyphsPicker(parentElem: HTMLElement) {\r\n    new GlyphsPicker(parentElem, this.simUI.player, classGlyphsConfig[this.simUI.player.getClass()]);\r\n  }\r\n\r\n  private buildHunterPickers() {\r\n    this.leftPanel.innerHTML = `\r\n      <div class=\"hunter-talents-pickers-container tab-content\">\r\n        <ul class=\"nav nav-tabs\" role=\"tablist\">\r\n          <li class=\"nav-item\" role=\"presentation\">\r\n            <a\r\n              class=\"nav-link active\"\r\n              type=\"button\"\r\n              role=\"tab\"\r\n              data-bs-toggle=\"tab\"\r\n              data-bs-target=\"#player-talents-tab\"\r\n              aria-controls=\"#player-talents-tab\"\r\n              aria-selected=\"true\"\r\n            >\r\n              Player\r\n            </a>\r\n          </li>\r\n          <li class=\"nav-item\" role=\"presentation\">\r\n            <a\r\n              class=\"nav-link\"\r\n              type=\"button\"\r\n              role=\"tab\"\r\n              data-bs-toggle=\"tab\"\r\n              data-bs-target=\"#pet-talents-tab\"\r\n              aria-controls=\"#pet-talents-tab\"\r\n              aria-selected=\"false\"\r\n            >\r\n              Pet</a\r\n            >\r\n          </li>\r\n        </ul>\r\n        <div id=\"player-talents-tab\" class=\"tab-pane fade active show\" role=\"tabpanel\">\r\n        </div>\r\n        <div id=\"pet-talents-tab\" class=\"tab-pane fade\" role=\"tabpanel\">\r\n        </div>\r\n      </div>\r\n    `\r\n\r\n    const playerTab = this.leftPanel.querySelector('#player-talents-tab') as HTMLElement;\r\n    const petTab = this.leftPanel.querySelector('#pet-talents-tab') as HTMLElement;\r\n\r\n    this.buildTalentsPicker(playerTab);\r\n    this.buildGlyphsPicker(playerTab);\r\n    this.buildHunterPetPicker(petTab);\r\n  }\r\n\r\n  private buildHunterPetPicker(parentElem: HTMLElement) {\r\n    new HunterPetTalentsPicker(parentElem, this.simUI, this.simUI.player as Player<Spec.SpecHunter>);\r\n    const petTypeToggle = new IconEnumPicker(parentElem, this.simUI.player as Player<Spec.SpecHunter>, makePetTypeInputConfig(false));\r\n  }\r\n\r\n  private buildSavedTalentsPicker() {\r\n    const savedTalentsManager = new SavedDataManager<Player<any>, SavedTalents>(this.rightPanel, this.simUI, this.simUI.player, {\r\n\t\t\tlabel: 'Talents',\r\n\t\t\theader: { title: 'Saved Talents' },\r\n\t\t\tstorageKey: this.simUI.getSavedTalentsStorageKey(),\r\n\t\t\tgetData: (player: Player<any>) => SavedTalents.create({\r\n\t\t\t\ttalentsString: player.getTalentsString(),\r\n\t\t\t\tglyphs: player.getGlyphs(),\r\n\t\t\t}),\r\n\t\t\tsetData: (eventID: EventID, player: Player<any>, newTalents: SavedTalents) => {\r\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\t\t\tplayer.setTalentsString(eventID, newTalents.talentsString);\r\n\t\t\t\t\tplayer.setGlyphs(eventID, newTalents.glyphs || Glyphs.create());\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tchangeEmitters: [this.simUI.player.talentsChangeEmitter, this.simUI.player.glyphsChangeEmitter],\r\n\t\t\tequals: (a: SavedTalents, b: SavedTalents) => SavedTalents.equals(a, b),\r\n\t\t\ttoJson: (a: SavedTalents) => SavedTalents.toJson(a),\r\n\t\t\tfromJson: (obj: any) => SavedTalents.fromJson(obj),\r\n\t\t});\r\n\r\n    this.simUI.sim.waitForInit().then(() => {\r\n\t\t\tsavedTalentsManager.loadUserData();\r\n\t\t\tthis.simUI.individualConfig.presets.talents.forEach(config => {\r\n\t\t\t\tconfig.isPreset = true;\r\n\t\t\t\tsavedTalentsManager.addSavedData({\r\n\t\t\t\t\tname: config.name,\r\n\t\t\t\t\tisPreset: true,\r\n\t\t\t\t\tdata: config.data,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n  } \r\n}\r\n","import { IndividualSimUI } from '../individual_sim_ui';\r\nimport { SimUI } from '../sim_ui';\r\nimport {\r\n\tPseudoStat,\r\n\tSpec,\r\n\tStat\r\n} from '../proto/common';\r\nimport { IndividualSimSettings } from '../proto/ui';\r\nimport { classNames, raceNames } from '../proto_utils/names';\r\nimport { UnitStat } from '../proto_utils/stats';\r\nimport { specNames } from '../proto_utils/utils';\r\nimport { downloadString, jsonStringifyWithFlattenedPaths } from '../utils';\r\nimport { BaseModal } from './base_modal';\r\nimport { IndividualWowheadGearPlannerImporter } from './importers';\r\nimport { RaidSimRequest } from '../proto/api';\r\n\r\nimport * as Mechanics from '../constants/mechanics';\r\n\r\nexport abstract class Exporter extends BaseModal {\r\n\tprivate readonly textElem: HTMLElement;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: SimUI, title: string, allowDownload: boolean) {\r\n\t\tsuper(parent, 'exporter', { title: title, footer: true });\r\n\r\n\t\tthis.body.innerHTML = `\r\n\t\t\t<textarea class=\"exporter-textarea form-control\"></textarea>\r\n\t\t`;\r\n\t\tthis.footer!.innerHTML = `\r\n\t\t\t<button class=\"exporter-button btn btn-primary clipboard-button me-2\">\r\n\t\t\t\t<i class=\"fas fa-clipboard\"></i>\r\n\t\t\t\tCopy to Clipboard\r\n\t\t\t</button>\r\n\t\t\t${allowDownload ? `\r\n\t\t\t\t<button class=\"exporter-button btn btn-primary download-button\">\r\n\t\t\t\t\t<i class=\"fa fa-download\"></i>\r\n\t\t\t\t\tDownload\r\n\t\t\t\t</button>\r\n\t\t\t` : ''\r\n\t\t\t}\r\n\t\t`;\r\n\r\n\t\tthis.textElem = this.rootElem.getElementsByClassName('exporter-textarea')[0] as HTMLElement;\r\n\r\n\t\tconst clipboardButton = this.rootElem.getElementsByClassName('clipboard-button')[0] as HTMLElement;\r\n\t\tclipboardButton.addEventListener('click', event => {\r\n\t\t\tconst data = this.textElem.textContent!;\r\n\t\t\tif (navigator.clipboard == undefined) {\r\n\t\t\t\talert(data);\r\n\t\t\t} else {\r\n\t\t\t\tnavigator.clipboard.writeText(data);\r\n\t\t\t\tconst originalContent = clipboardButton.innerHTML;\r\n\t\t\t\tclipboardButton.style.width = `${clipboardButton.getBoundingClientRect().width.toFixed(3)}px`;\r\n\t\t\t\tclipboardButton.innerHTML = `<i class=\"fas fa-check\"></i>&nbsp;Copied`;\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tclipboardButton.innerHTML = originalContent;\r\n\t\t\t\t}, 1500);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (allowDownload) {\r\n\t\t\tconst downloadButton = this.rootElem.getElementsByClassName('download-button')[0] as HTMLElement;\r\n\t\t\tdownloadButton.addEventListener('click', event => {\r\n\t\t\t\tconst data = this.textElem.textContent!;\r\n\t\t\t\tdownloadString(data, 'wowsims.json');\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected init() {\r\n\t\tthis.textElem.textContent = this.getData();\r\n\t}\r\n\r\n\tabstract getData(): string;\r\n}\r\n\r\nexport class IndividualLinkExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'Sharable Link', false);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\treturn this.simUI.toLink();\r\n\t}\r\n}\r\n\r\nexport class IndividualJsonExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'JSON Export', true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\treturn jsonStringifyWithFlattenedPaths(IndividualSimSettings.toJson(this.simUI.toProto()), 2, (value, path) => {\r\n\t\t\tif (['stats', 'pseudoStats'].includes(path[path.length - 1])) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif (['player', 'equipment', 'items'].every((v, i) => path[i] == v)) {\r\n\t\t\t\treturn path.length > 3;\r\n\t\t\t}\r\n\r\n\t\t\tif (path[0] == 'player' && path[1] == 'rotation' && ['prepullActions', 'priorityList'].includes(path[2])) {\r\n\t\t\t\treturn path.length > 3;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport class IndividualWowheadGearPlannerExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'Wowhead Export', true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\tconst player = this.simUI.player;\r\n\r\n\t\tconst classStr = classNames[player.getClass()].replaceAll(' ', '-').toLowerCase();\r\n\t\tconst raceStr = raceNames[player.getRace()].replaceAll(' ', '-').toLowerCase();\r\n\t\tlet url = `https://www.wowhead.com/wotlk/gear-planner/${classStr}/${raceStr}/`;\r\n\r\n\t\t// See comments on the importer for how the binary formatting is structured.\r\n\t\tlet bytes: Array<number> = [];\r\n\t\tbytes.push(6);\r\n\t\tbytes.push(0);\r\n\t\tbytes.push(Mechanics.CHARACTER_LEVEL);\r\n\r\n\t\tlet talentsStr = player.getTalentsString().replaceAll('-', 'f') + 'f';\r\n\t\tif (talentsStr.length % 2 == 1) {\r\n\t\t\ttalentsStr += '0';\r\n\t\t}\r\n\t\t//console.log('Talents str: ' + talentsStr);\r\n\t\tbytes.push(talentsStr.length / 2);\r\n\t\tfor (let i = 0; i < talentsStr.length; i += 2) {\r\n\t\t\tbytes.push(parseInt(talentsStr.substring(i, i + 2), 16));\r\n\t\t}\r\n\r\n\t\tlet glyphBytes: Array<number> = [];\r\n\t\tlet glyphStr = '';\r\n\t\tconst glyphs = player.getGlyphs();\r\n\t\tconst d = \"0123456789abcdefghjkmnpqrstvwxyz\";\r\n\t\tconst addGlyph = (glyphItemId: number, glyphPosition: number) => {\r\n\t\t\tconst spellId = this.simUI.sim.db.glyphItemToSpellId(glyphItemId);\r\n\t\t\tif (!spellId) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tglyphStr += d[glyphPosition];\r\n\t\t\tglyphStr += d[(spellId >> 15) & 0b00011111];\r\n\t\t\tglyphStr += d[(spellId >> 10) & 0b00011111];\r\n\t\t\tglyphStr += d[(spellId >> 5) & 0b00011111];\r\n\t\t\tglyphStr += d[(spellId >> 0) & 0b00011111];\r\n\t\t};\r\n\t\taddGlyph(glyphs.major1, 0);\r\n\t\taddGlyph(glyphs.major2, 1);\r\n\t\taddGlyph(glyphs.major3, 2);\r\n\t\taddGlyph(glyphs.minor1, 3);\r\n\t\taddGlyph(glyphs.minor2, 4);\r\n\t\taddGlyph(glyphs.minor3, 5);\r\n\t\tif (glyphStr) {\r\n\t\t\tglyphBytes.push(0x30);\r\n\t\t\tfor (let i = 0; i < glyphStr.length; i++) {\r\n\t\t\t\tglyphBytes.push(glyphStr.charCodeAt(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\tbytes.push(glyphBytes.length);\r\n\t\tbytes = bytes.concat(glyphBytes)\r\n\r\n\t\tconst to2Bytes = (val: number): Array<number> => {\r\n\t\t\treturn [\r\n\t\t\t\t(val & 0xff00) >> 8,\r\n\t\t\t\tval & 0x00ff,\r\n\t\t\t];\r\n\t\t};\r\n\r\n\t\tconst gear = player.getGear();\r\n\t\tconst isBlacksmithing = player.isBlacksmithing();\r\n\t\tgear.getItemSlots()\r\n\t\t\t.sort((slot1, slot2) => IndividualWowheadGearPlannerImporter.slotIDs[slot1] - IndividualWowheadGearPlannerImporter.slotIDs[slot2])\r\n\t\t\t.forEach(itemSlot => {\r\n\t\t\t\tconst item = gear.getEquippedItem(itemSlot);\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet slotId = IndividualWowheadGearPlannerImporter.slotIDs[itemSlot];\r\n\t\t\t\tif (item.enchant) {\r\n\t\t\t\t\tslotId = slotId | 0b10000000;\r\n\t\t\t\t}\r\n\t\t\t\tbytes.push(slotId);\r\n\t\t\t\tbytes.push(item.curGems(isBlacksmithing).length << 5);\r\n\t\t\t\tbytes = bytes.concat(to2Bytes(item.item.id));\r\n\r\n\t\t\t\tif (item.enchant) {\r\n\t\t\t\t\tbytes.push(0);\r\n\t\t\t\t\tbytes = bytes.concat(to2Bytes(item.enchant.spellId));\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.gems.slice(0, item.numSockets(isBlacksmithing)).forEach((gem, i) => {\r\n\t\t\t\t\tif (gem) {\r\n\t\t\t\t\t\tbytes.push(i << 5);\r\n\t\t\t\t\t\tbytes = bytes.concat(to2Bytes(gem.id));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t//console.log('Hex: ' + buf2hex(new Uint8Array(bytes)));\r\n\t\tconst binaryString = String.fromCharCode(...bytes);\r\n\t\tconst b64encoded = btoa(binaryString);\r\n\t\tconst b64converted = b64encoded.replaceAll('/', '_').replaceAll('+', '-').replace(/=+$/, '');\r\n\r\n\t\treturn url + b64converted;\r\n\t}\r\n}\r\n\r\nexport class Individual80UEPExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, '80Upgrades EP Export', true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\tconst player = this.simUI.player;\r\n\t\tconst epValues = player.getEpWeights();\r\n\t\tconst allUnitStats = UnitStat.getAll();\r\n\r\n\t\tconst namesToWeights: Record<string, number> = {};\r\n\t\tallUnitStats\r\n\t\t\t.forEach(stat => {\r\n\t\t\t\tconst statName = Individual80UEPExporter.getName(stat);\r\n\t\t\t\tconst weight = epValues.getUnitStat(stat);\r\n\t\t\t\tif (weight == 0 || statName == '') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Need to add together stats with the same name (e.g. hit/crit/haste).\r\n\t\t\t\tif (namesToWeights[statName]) {\r\n\t\t\t\t\tnamesToWeights[statName] += weight;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnamesToWeights[statName] = weight;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn `https://eightyupgrades.com/ep/import?name=${encodeURIComponent(`${specNames[player.spec]} WoWSims Weights`)}` +\r\n\t\t\tObject.keys(namesToWeights)\r\n\t\t\t\t.map(statName => `&${statName}=${namesToWeights[statName].toFixed(3)}`).join('');\r\n\t}\r\n\r\n\tstatic getName(stat: UnitStat): string {\r\n\t\tif (stat.isStat()) {\r\n\t\t\treturn Individual80UEPExporter.statNames[stat.getStat()];\r\n\t\t} else {\r\n\t\t\treturn Individual80UEPExporter.pseudoStatNames[stat.getPseudoStat()] || '';\r\n\t\t}\r\n\t}\r\n\r\n\tstatic statNames: Record<Stat, string> = {\r\n\t\t[Stat.StatStrength]: 'strength',\r\n\t\t[Stat.StatAgility]: 'agility',\r\n\t\t[Stat.StatStamina]: 'stamina',\r\n\t\t[Stat.StatIntellect]: 'intellect',\r\n\t\t[Stat.StatSpirit]: 'spirit',\r\n\t\t[Stat.StatSpellPower]: 'spellDamage',\r\n\t\t[Stat.StatMP5]: 'mp5',\r\n\t\t[Stat.StatSpellHit]: 'hitRating',\r\n\t\t[Stat.StatSpellCrit]: 'critRating',\r\n\t\t[Stat.StatSpellHaste]: 'hasteRating',\r\n\t\t[Stat.StatSpellPenetration]: 'spellPen',\r\n\t\t[Stat.StatAttackPower]: 'attackPower',\r\n\t\t[Stat.StatMeleeHit]: 'hitRating',\r\n\t\t[Stat.StatMeleeCrit]: 'critRating',\r\n\t\t[Stat.StatMeleeHaste]: 'hasteRating',\r\n\t\t[Stat.StatArmorPenetration]: 'armorPenRating',\r\n\t\t[Stat.StatExpertise]: 'expertiseRating',\r\n\t\t[Stat.StatMana]: 'mana',\r\n\t\t[Stat.StatEnergy]: 'energy',\r\n\t\t[Stat.StatRage]: 'rage',\r\n\t\t[Stat.StatArmor]: 'armor',\r\n\t\t[Stat.StatRangedAttackPower]: 'attackPower',\r\n\t\t[Stat.StatDefense]: 'defenseRating',\r\n\t\t[Stat.StatBlock]: 'blockRating',\r\n\t\t[Stat.StatBlockValue]: 'blockValue',\r\n\t\t[Stat.StatDodge]: 'dodgeRating',\r\n\t\t[Stat.StatParry]: 'parryRating',\r\n\t\t[Stat.StatResilience]: 'resilienceRating',\r\n\t\t[Stat.StatHealth]: 'health',\r\n\t\t[Stat.StatArcaneResistance]: 'arcaneResistance',\r\n\t\t[Stat.StatFireResistance]: 'fireResistance',\r\n\t\t[Stat.StatFrostResistance]: 'frostResistance',\r\n\t\t[Stat.StatNatureResistance]: 'natureResistance',\r\n\t\t[Stat.StatShadowResistance]: 'shadowResistance',\r\n\t\t[Stat.StatBonusArmor]: 'armorBonus',\r\n\t\t[Stat.StatRunicPower]: 'runicPower',\r\n\t\t[Stat.StatBloodRune]: 'bloodRune',\r\n\t\t[Stat.StatFrostRune]: 'frostRune',\r\n\t\t[Stat.StatUnholyRune]: 'unholyRune',\r\n\t\t[Stat.StatDeathRune]: 'deathRune',\r\n\t}\r\n\tstatic pseudoStatNames: Partial<Record<PseudoStat, string>> = {\r\n\t\t[PseudoStat.PseudoStatMainHandDps]: 'dps',\r\n\t\t[PseudoStat.PseudoStatRangedDps]: 'rangedDps',\r\n\t}\r\n}\r\n\r\nexport class IndividualPawnEPExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, 'Pawn EP Export', true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\tconst player = this.simUI.player;\r\n\t\tconst epValues = player.getEpWeights();\r\n\t\tconst allUnitStats = UnitStat.getAll();\r\n\r\n\t\tconst namesToWeights: Record<string, number> = {};\r\n\t\tallUnitStats\r\n\t\t\t.forEach(stat => {\r\n\t\t\t\tconst statName = IndividualPawnEPExporter.getName(stat);\r\n\t\t\t\tconst weight = epValues.getUnitStat(stat);\r\n\t\t\t\tif (weight == 0 || statName == '') {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Need to add together stats with the same name (e.g. hit/crit/haste).\r\n\t\t\t\tif (namesToWeights[statName]) {\r\n\t\t\t\t\tnamesToWeights[statName] += weight;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnamesToWeights[statName] = weight;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn `( Pawn: v1: \"${specNames[player.spec]} WoWSims Weights\": Class=${classNames[player.getClass()]},` +\r\n\t\t\tObject.keys(namesToWeights)\r\n\t\t\t\t.map(statName => `${statName}=${namesToWeights[statName].toFixed(3)}`).join(',') +\r\n\t\t\t' )';\r\n\t}\r\n\r\n\tstatic getName(stat: UnitStat): string {\r\n\t\tif (stat.isStat()) {\r\n\t\t\treturn IndividualPawnEPExporter.statNames[stat.getStat()];\r\n\t\t} else {\r\n\t\t\treturn IndividualPawnEPExporter.pseudoStatNames[stat.getPseudoStat()] || '';\r\n\t\t}\r\n\t}\r\n\r\n\tstatic statNames: Record<Stat, string> = {\r\n\t\t[Stat.StatStrength]: 'Strength',\r\n\t\t[Stat.StatAgility]: 'Agility',\r\n\t\t[Stat.StatStamina]: 'Stamina',\r\n\t\t[Stat.StatIntellect]: 'Intellect',\r\n\t\t[Stat.StatSpirit]: 'Spirit',\r\n\t\t[Stat.StatSpellPower]: 'SpellDamage',\r\n\t\t[Stat.StatMP5]: 'Mp5',\r\n\t\t[Stat.StatSpellHit]: 'HitRating',\r\n\t\t[Stat.StatSpellCrit]: 'CritRating',\r\n\t\t[Stat.StatSpellHaste]: 'HasteRating',\r\n\t\t[Stat.StatSpellPenetration]: 'SpellPen',\r\n\t\t[Stat.StatAttackPower]: 'Ap',\r\n\t\t[Stat.StatMeleeHit]: 'HitRating',\r\n\t\t[Stat.StatMeleeCrit]: 'CritRating',\r\n\t\t[Stat.StatMeleeHaste]: 'HasteRating',\r\n\t\t[Stat.StatArmorPenetration]: 'ArmorPenetration',\r\n\t\t[Stat.StatExpertise]: 'ExpertiseRating',\r\n\t\t[Stat.StatMana]: 'Mana',\r\n\t\t[Stat.StatEnergy]: 'Energy',\r\n\t\t[Stat.StatRage]: 'Rage',\r\n\t\t[Stat.StatArmor]: 'Armor',\r\n\t\t[Stat.StatRangedAttackPower]: 'Ap',\r\n\t\t[Stat.StatDefense]: 'DefenseRating',\r\n\t\t[Stat.StatBlock]: 'BlockRating',\r\n\t\t[Stat.StatBlockValue]: 'BlockValue',\r\n\t\t[Stat.StatDodge]: 'DodgeRating',\r\n\t\t[Stat.StatParry]: 'ParryRating',\r\n\t\t[Stat.StatResilience]: 'ResilienceRating',\r\n\t\t[Stat.StatHealth]: 'Health',\r\n\t\t[Stat.StatArcaneResistance]: 'ArcaneResistance',\r\n\t\t[Stat.StatFireResistance]: 'FireResistance',\r\n\t\t[Stat.StatFrostResistance]: 'FrostResistance',\r\n\t\t[Stat.StatNatureResistance]: 'NatureResistance',\r\n\t\t[Stat.StatShadowResistance]: 'ShadowResistance',\r\n\t\t[Stat.StatBonusArmor]: 'Armor2',\r\n\t\t[Stat.StatRunicPower]: 'RunicPower',\r\n\t\t[Stat.StatBloodRune]: 'BloodRune',\r\n\t\t[Stat.StatFrostRune]: 'FrostRune',\r\n\t\t[Stat.StatUnholyRune]: 'UnholyRune',\r\n\t\t[Stat.StatDeathRune]: 'DeathRune',\r\n\t}\r\n\tstatic pseudoStatNames: Partial<Record<PseudoStat, string>> = {\r\n\t\t[PseudoStat.PseudoStatMainHandDps]: 'MeleeDps',\r\n\t\t[PseudoStat.PseudoStatRangedDps]: 'RangedDps',\r\n\t}\r\n}\r\n\r\nexport class IndividualCLIExporter<SpecType extends Spec> extends Exporter {\r\n\tprivate readonly simUI: IndividualSimUI<SpecType>;\r\n\r\n\tconstructor(parent: HTMLElement, simUI: IndividualSimUI<SpecType>) {\r\n\t\tsuper(parent, simUI, \"CLI Export\", true);\r\n\t\tthis.simUI = simUI;\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetData(): string {\r\n\t\tconst raidSimJson: any = RaidSimRequest.toJson(\r\n\t\t\tthis.simUI.sim.makeRaidSimRequest(false)\r\n\t\t);\r\n\t\tdelete raidSimJson.raid?.parties[0]?.players[0]?.database;\r\n\t\treturn JSON.stringify(raidSimJson, null, 2);\r\n\t}\r\n}\r\n","import { aplLaunchStatuses, LaunchStatus, simLaunchStatuses } from './launched_sims';\r\nimport { Player, AutoRotationGenerator, SimpleRotationGenerator } from './player';\r\nimport { SimUI, SimWarning } from './sim_ui';\r\nimport { EventID, TypedEvent } from './typed_event';\r\n\r\nimport { CharacterStats, StatMods } from './components/character_stats';\r\nimport { ContentBlock } from './components/content_block';\r\nimport { EmbeddedDetailedResults } from './components/detailed_results';\r\nimport { EncounterPickerConfig } from './components/encounter_picker';\r\nimport { addRaidSimAction, RaidSimResultsManager } from './components/raid_sim_action';\r\nimport { SavedDataConfig } from './components/saved_data_manager';\r\nimport { addStatWeightsAction } from './components/stat_weights_action';\r\n\r\nimport { BulkTab } from './components/individual_sim_ui/bulk_tab';\r\nimport { GearTab } from './components/individual_sim_ui/gear_tab';\r\nimport { SettingsTab } from './components/individual_sim_ui/settings_tab';\r\nimport { RotationTab } from './components/individual_sim_ui/rotation_tab';\r\nimport { TalentsTab } from './components/individual_sim_ui/talents_tab';\r\n\r\nimport {\r\n\tConsumes,\r\n\tDebuffs,\r\n\tEncounter as EncounterProto,\r\n\tEquipmentSpec,\r\n\tGlyphs,\r\n\tHandType,\r\n\tIndividualBuffs,\r\n\tItemSlot,\r\n\tPartyBuffs,\r\n\tProfession,\r\n\tPseudoStat,\r\n\tRace,\r\n\tRaidBuffs,\r\n\tSpec,\r\n\tStat,\r\n} from './proto/common';\r\n\r\nimport { IndividualSimSettings, SavedRotation, SavedTalents } from './proto/ui';\r\nimport { StatWeightsResult } from './proto/api';\r\n\r\nimport { Gear } from './proto_utils/gear';\r\nimport { getMetaGemConditionDescription } from './proto_utils/gems';\r\nimport { professionNames } from './proto_utils/names';\r\nimport { Stats } from './proto_utils/stats';\r\nimport {\r\n\tgetTalentPoints,\r\n\tisHealingSpec,\r\n\tisTankSpec,\r\n\tSpecOptions,\r\n\tSpecRotation,\r\n\tspecToEligibleRaces,\r\n\tspecToLocalStorageKey,\r\n} from './proto_utils/utils';\r\n\r\nimport * as Exporters from './components/exporters';\r\nimport * as Importers from './components/importers';\r\nimport * as IconInputs from './components/icon_inputs';\r\nimport * as InputHelpers from './components/input_helpers';\r\nimport * as Mechanics from './constants/mechanics';\r\nimport * as Tooltips from './constants/tooltips';\r\n\r\ndeclare var pako: any;\r\n\r\nconst SAVED_GEAR_STORAGE_KEY = '__savedGear__';\r\nconst SAVED_ROTATION_STORAGE_KEY = '__savedRotation__';\r\nconst SAVED_SETTINGS_STORAGE_KEY = '__savedSettings__';\r\nconst SAVED_TALENTS_STORAGE_KEY = '__savedTalents__';\r\n\r\nexport type InputConfig<ModObject> = (\r\n\tInputHelpers.TypedBooleanPickerConfig<ModObject> |\r\n\tInputHelpers.TypedNumberPickerConfig<ModObject> |\r\n\tInputHelpers.TypedEnumPickerConfig<ModObject> |\r\n\tInputHelpers.TypedCustomRotationPickerConfig<any, any> |\r\n\tInputHelpers.TypedItemSwapPickerConfig<any, any>\r\n);\r\n\r\nexport interface InputSection {\r\n\ttooltip?: string,\r\n\tinputs: Array<InputConfig<Player<any>>>,\r\n}\r\n\r\nexport interface OtherDefaults {\r\n\tprofession1?: Profession,\r\n\tprofession2?: Profession,\r\n\tdistanceFromTarget?: number,\r\n}\r\n\r\nexport interface IndividualSimUIConfig<SpecType extends Spec> {\r\n\t// Additional css class to add to the root element.\r\n\tcssClass: string,\r\n\t// Used to generate schemed components. E.g. 'shaman', 'druid', 'raid'\r\n\tcssScheme: string,\r\n\r\n\tknownIssues?: Array<string>;\r\n\twarnings?: Array<(simUI: IndividualSimUI<SpecType>) => SimWarning>,\r\n\r\n\tepStats: Array<Stat>;\r\n\tepPseudoStats?: Array<PseudoStat>;\r\n\tepReferenceStat: Stat;\r\n\tdisplayStats: Array<Stat>;\r\n\tmodifyDisplayStats?: (player: Player<SpecType>) => StatMods,\r\n\r\n\tdefaults: {\r\n\t\tgear: EquipmentSpec,\r\n\t\tepWeights: Stats,\r\n\t\tconsumes: Consumes,\r\n\t\trotation: SpecRotation<SpecType>,\r\n\t\ttalents: SavedTalents,\r\n\t\tspecOptions: SpecOptions<SpecType>,\r\n\r\n\t\traidBuffs: RaidBuffs,\r\n\t\tpartyBuffs: PartyBuffs,\r\n\t\tindividualBuffs: IndividualBuffs,\r\n\r\n\t\tdebuffs: Debuffs,\r\n\r\n\t\tother?: OtherDefaults,\r\n\t},\r\n\r\n\tplayerInputs?: InputSection,\r\n\tplayerIconInputs: Array<IconInputs.IconInputConfig<Player<SpecType>, any>>,\r\n\tpetConsumeInputs?: Array<IconInputs.IconInputConfig<Player<SpecType>, any>>,\r\n\trotationInputs: InputSection;\r\n\trotationIconInputs?: Array<IconInputs.IconInputConfig<Player<any>, any>>;\r\n\tincludeBuffDebuffInputs: Array<any>,\r\n\texcludeBuffDebuffInputs: Array<any>,\r\n\totherInputs: InputSection;\r\n\r\n\t// For when extra sections are needed (e.g. Shaman totems)\r\n\tcustomSections?: Array<(parentElem: HTMLElement, simUI: IndividualSimUI<SpecType>) => ContentBlock>,\r\n\r\n\tencounterPicker: EncounterPickerConfig,\r\n\r\n\tpresets: {\r\n\t\tgear: Array<PresetGear>,\r\n\t\ttalents: Array<SavedDataConfig<Player<any>, SavedTalents>>,\r\n\t\trotations?: Array<PresetRotation>,\r\n\t},\r\n\r\n\tautoRotation?: AutoRotationGenerator<SpecType>,\r\n\tsimpleRotation?: SimpleRotationGenerator<SpecType>,\r\n}\r\n\r\nexport interface GearAndStats {\r\n\tgear: Gear,\r\n\tbonusStats?: Stats,\r\n}\r\n\r\nexport interface PresetGear {\r\n\tname: string;\r\n\tgear: EquipmentSpec;\r\n\ttooltip?: string;\r\n\tenableWhen?: (obj: Player<any>) => boolean;\r\n}\r\n\r\nexport interface PresetRotation {\r\n\tname: string;\r\n\trotation: SavedRotation;\r\n\ttooltip?: string;\r\n\tenableWhen?: (obj: Player<any>) => boolean;\r\n}\r\n\r\nexport interface Settings {\r\n\traidBuffs: RaidBuffs,\r\n\tpartyBuffs: PartyBuffs,\r\n\tindividualBuffs: IndividualBuffs,\r\n\tconsumes: Consumes,\r\n\trace: Race,\r\n\tprofessions?: Array<Profession>;\r\n}\r\n\r\n// Extended shared UI for all individual player sims.\r\nexport abstract class IndividualSimUI<SpecType extends Spec> extends SimUI {\r\n\treadonly player: Player<SpecType>;\r\n\treadonly individualConfig: IndividualSimUIConfig<SpecType>;\r\n\r\n\tprivate raidSimResultsManager: RaidSimResultsManager | null;\r\n\r\n\tprevEpIterations: number;\r\n\tprevEpSimResult: StatWeightsResult | null;\r\n\tdpsRefStat?: Stat;\r\n\thealRefStat?: Stat;\r\n\ttankRefStat?: Stat;\r\n\r\n\treadonly bt: BulkTab;\r\n\r\n\tconstructor(parentElem: HTMLElement, player: Player<SpecType>, config: IndividualSimUIConfig<SpecType>) {\r\n\t\tsuper(parentElem, player.sim, {\r\n\t\t\tcssClass: config.cssClass,\r\n\t\t\tcssScheme: config.cssScheme,\r\n\t\t\tspec: player.spec,\r\n\t\t\tknownIssues: config.knownIssues,\r\n\t\t\tlaunchStatus: simLaunchStatuses[player.spec],\r\n\t\t\tnoticeText: aplLaunchStatuses[player.spec] == LaunchStatus.Alpha ? 'Rotation settings have been moved to the \\'Rotation\\' tab, where experimental APL options are also available. Try them out!' : undefined,\r\n\t\t});\r\n\t\tthis.rootElem.classList.add('individual-sim-ui');\r\n\t\tthis.player = player;\r\n\t\tthis.individualConfig = config;\r\n\t\tthis.raidSimResultsManager = null;\r\n\t\tthis.prevEpIterations = 0;\r\n\t\tthis.prevEpSimResult = null;\r\n\r\n\t\tif (aplLaunchStatuses[player.spec] >= LaunchStatus.Beta) {\r\n\t\t\tif (!config.autoRotation) {\r\n\t\t\t\tthrow new Error('autoRotation is required for APL beta');\r\n\t\t\t}\r\n\t\t\tplayer.setAutoRotationGenerator(config.autoRotation);\r\n\t\t}\r\n\t\tif (aplLaunchStatuses[player.spec] == LaunchStatus.Launched && config.simpleRotation) {\r\n\t\t\tplayer.setSimpleRotationGenerator(config.simpleRotation);\r\n\t\t}\r\n\r\n\t\tthis.addWarning({\r\n\t\t\tupdateOn: this.player.gearChangeEmitter,\r\n\t\t\tgetContent: () => {\r\n\t\t\t\tif (!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing())) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst metaGem = this.player.getGear().getMetaGem()!;\r\n\t\t\t\treturn `Meta gem disabled (${metaGem.name}): ${getMetaGemConditionDescription(metaGem)}`;\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.addWarning({\r\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.professionChangeEmitter]),\r\n\t\t\tgetContent: () => {\r\n\t\t\t\tconst failedProfReqs = this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());\r\n\t\t\t\tif (failedProfReqs.length == 0) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn failedProfReqs.map(fpr => `${fpr.name} requires ${professionNames[fpr.requiredProfession]}, but it is not selected.`);\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.addWarning({\r\n\t\t\tupdateOn: this.player.gearChangeEmitter,\r\n\t\t\tgetContent: () => {\r\n\t\t\t\tconst jcGems = this.player.getGear().getJCGems(this.player.isBlacksmithing());\r\n\t\t\t\tif (jcGems.length <= 3) {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn `Only 3 Jewelcrafting Gems are allowed, but ${jcGems.length} are equipped.`;\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.addWarning({\r\n\t\t\tupdateOn: this.player.talentsChangeEmitter,\r\n\t\t\tgetContent: () => {\r\n\t\t\t\tconst talentPoints = getTalentPoints(this.player.getTalentsString());\r\n\r\n\t\t\t\tif (talentPoints == 0) {\r\n\t\t\t\t\t// Just return here, so we don't show a warning during page load.\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t} else if (talentPoints < Mechanics.MAX_TALENT_POINTS) {\r\n\t\t\t\t\treturn 'Unspent talent points.';\r\n\t\t\t\t} else if (talentPoints > Mechanics.MAX_TALENT_POINTS) {\r\n\t\t\t\t\treturn 'More than maximum talent points spent.';\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.addWarning({\r\n\t\t\tupdateOn: TypedEvent.onAny([this.player.gearChangeEmitter, this.player.talentsChangeEmitter]),\r\n\t\t\tgetContent: () => {\r\n\t\t\t\tif (!this.player.canDualWield2H() &&\r\n\t\t\t\t\t(this.player.getEquippedItem(ItemSlot.ItemSlotMainHand)?.item.handType == HandType.HandTypeTwoHand &&\r\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand) != null ||\r\n\t\t\t\t\t\tthis.player.getEquippedItem(ItemSlot.ItemSlotOffHand)?.item.handType == HandType.HandTypeTwoHand)) {\r\n\t\t\t\t\treturn \"Dual wielding two-handed weapon(s) without Titan's Grip spec.\"\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t\t(config.warnings || []).forEach(warning => this.addWarning(warning(this)));\r\n\r\n\t\tif (!this.isWithinRaidSim) {\r\n\t\t\t// This needs to go before all the UI components so that gear loading is the\r\n\t\t\t// first callback invoked from waitForInit().\r\n\t\t\tthis.sim.waitForInit().then(() => {\r\n\t\t\t\tthis.loadSettings();\r\n\r\n\t\t\t\tif (isHealingSpec(this.player.spec)) {\r\n\t\t\t\t\talert(Tooltips.HEALING_SIM_DISCLAIMER);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.addSidebarComponents();\r\n\t\tthis.addGearTab();\r\n\t\tthis.bt = this.addBulkTab();\r\n\t\tthis.addSettingsTab();\r\n\t\tthis.addTalentsTab();\r\n\t\tif (aplLaunchStatuses[this.player.spec] != LaunchStatus.Unlaunched) {\r\n\t\t\tthis.addRotationTab();\r\n\t\t}\r\n\r\n\t\tif (!this.isWithinRaidSim) {\r\n\t\t\tthis.addDetailedResultsTab();\r\n\t\t}\r\n\r\n\t\tthis.addTopbarComponents();\r\n\t}\r\n\r\n\tprivate loadSettings() {\r\n\t\tconst initEventID = TypedEvent.nextEventID();\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tlet loadedSettings = false;\r\n\r\n\t\t\tlet hash = window.location.hash;\r\n\t\t\tif (hash.length > 1) {\r\n\t\t\t\t// Remove leading '#'\r\n\t\t\t\thash = hash.substring(1);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst binary = atob(hash);\r\n\t\t\t\t\tconst bytes = new Uint8Array(binary.length);\r\n\t\t\t\t\tfor (let i = 0; i < bytes.length; i++) {\r\n\t\t\t\t\t\tbytes[i] = binary.charCodeAt(i);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst settingsBytes = pako.inflate(bytes);\r\n\t\t\t\t\tconst settings = IndividualSimSettings.fromBinary(settingsBytes);\r\n\t\t\t\t\tthis.fromProto(initEventID, settings);\r\n\t\t\t\t\tloadedSettings = true;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.warn('Failed to parse settings from window hash: ' + e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twindow.location.hash = '';\r\n\r\n\t\t\tconst savedSettings = window.localStorage.getItem(this.getSettingsStorageKey());\r\n\t\t\tif (!loadedSettings && savedSettings != null) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst settings = IndividualSimSettings.fromJsonString(savedSettings);\r\n\t\t\t\t\tthis.fromProto(initEventID, settings);\r\n\t\t\t\t\tloadedSettings = true;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.warn('Failed to parse saved settings: ' + e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!loadedSettings) {\r\n\t\t\t\tthis.applyDefaults(initEventID);\r\n\t\t\t}\r\n\t\t\tthis.player.setName(initEventID, 'Player');\r\n\r\n\t\t\t// This needs to go last so it doesn't re-store things as they are initialized.\r\n\t\t\tthis.changeEmitter.on(eventID => {\r\n\t\t\t\tconst jsonStr = IndividualSimSettings.toJsonString(this.toProto());\r\n\t\t\t\twindow.localStorage.setItem(this.getSettingsStorageKey(), jsonStr);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate addSidebarComponents() {\r\n\t\tthis.raidSimResultsManager = addRaidSimAction(this);\r\n\t\taddStatWeightsAction(this, this.individualConfig.epStats, this.individualConfig.epPseudoStats, this.individualConfig.epReferenceStat);\r\n\r\n\t\tconst characterStats = new CharacterStats(\r\n\t\t\tthis.rootElem.getElementsByClassName('sim-sidebar-footer')[0] as HTMLElement,\r\n\t\t\tthis.player,\r\n\t\t\tthis.individualConfig.displayStats,\r\n\t\t\tthis.individualConfig.modifyDisplayStats);\r\n\t}\r\n\r\n\tprivate addGearTab() {\r\n\t\tlet gearTab = new GearTab(this.simTabContentsContainer, this);\r\n\t\tgearTab.rootElem.classList.add('active', 'show');\r\n\t}\r\n\r\n\tprivate addBulkTab(): BulkTab {\r\n\t\tlet bulkTab = new BulkTab(this.simTabContentsContainer, this);\r\n\t\tbulkTab.navLink.hidden = !this.sim.getShowExperimental()\r\n\t\tthis.sim.showExperimentalChangeEmitter.on(() => {\r\n\t\t\tbulkTab.navLink.hidden = !this.sim.getShowExperimental();\r\n\t\t});\r\n\t\treturn bulkTab;\r\n\t}\r\n\r\n\tprivate addSettingsTab() {\r\n\t\tnew SettingsTab(this.simTabContentsContainer, this);\r\n\t}\r\n\r\n\tprivate addTalentsTab() {\r\n\t\tnew TalentsTab(this.simTabContentsContainer, this);\r\n\t}\r\n\r\n\tprivate addRotationTab() {\r\n\t\tnew RotationTab(this.simTabContentsContainer, this);\r\n\t}\r\n\r\n\tprivate addDetailedResultsTab() {\r\n\t\tthis.addTab('Results', 'detailed-results-tab', `\r\n\t\t\t<div class=\"detailed-results\">\r\n\t\t\t</div>\r\n\t\t`);\r\n\r\n\t\tconst detailedResults = new EmbeddedDetailedResults(this.rootElem.getElementsByClassName('detailed-results')[0] as HTMLElement, this, this.raidSimResultsManager!);\r\n\t}\r\n\r\n\tprivate addTopbarComponents() {\r\n\t\tthis.simHeader.addImportLink('JSON', _parent => new Importers.IndividualJsonImporter(this.rootElem, this), true);\r\n\t\tthis.simHeader.addImportLink('80U', _parent => new Importers.Individual80UImporter(this.rootElem, this), true);\r\n\t\tthis.simHeader.addImportLink('WoWHead', _parent => new Importers.IndividualWowheadGearPlannerImporter(this.rootElem, this), false);\r\n\t\tthis.simHeader.addImportLink('Addon', _parent => new Importers.IndividualAddonImporter(this.rootElem, this), true);\r\n\r\n\t\tthis.simHeader.addExportLink('Link', _parent => new Exporters.IndividualLinkExporter(this.rootElem, this), false);\r\n\t\tthis.simHeader.addExportLink('JSON', _parent => new Exporters.IndividualJsonExporter(this.rootElem, this), true);\r\n\t\tthis.simHeader.addExportLink('WoWHead', _parent => new Exporters.IndividualWowheadGearPlannerExporter(this.rootElem, this), false);\r\n\t\tthis.simHeader.addExportLink('80U EP', _parent => new Exporters.Individual80UEPExporter(this.rootElem, this), false);\r\n\t\tthis.simHeader.addExportLink('Pawn EP', _parent => new Exporters.IndividualPawnEPExporter(this.rootElem, this), false);\r\n\t\tthis.simHeader.addExportLink(\"CLI\", _parent => new Exporters.IndividualCLIExporter(this.rootElem, this), true);\r\n\t}\r\n\r\n\tapplyDefaults(eventID: EventID) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tconst tankSpec = isTankSpec(this.player.spec);\r\n\t\t\tconst healingSpec = isHealingSpec(this.player.spec);\r\n\r\n\t\t\t//Special case for Totem of Wrath keeps buff and debuff sync'd\r\n\t\t\tconst towEnabled = this.individualConfig.defaults.raidBuffs.totemOfWrath || this.individualConfig.defaults.debuffs.totemOfWrath\r\n\t\t\tthis.individualConfig.defaults.raidBuffs.totemOfWrath = towEnabled;\r\n\t\t\tthis.individualConfig.defaults.debuffs.totemOfWrath = towEnabled;\r\n\r\n\t\t\tthis.player.applySharedDefaults(eventID);\r\n\t\t\tthis.player.setRace(eventID, specToEligibleRaces[this.player.spec][0]);\r\n\t\t\tthis.player.setGear(eventID, this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear));\r\n\t\t\tthis.player.setConsumes(eventID, this.individualConfig.defaults.consumes);\r\n\t\t\tif (aplLaunchStatuses[this.player.spec] < LaunchStatus.Beta) {\r\n\t\t\t\tthis.player.setRotation(eventID, this.individualConfig.defaults.rotation);\r\n\t\t\t} else if (aplLaunchStatuses[this.player.spec] == LaunchStatus.Beta) {\r\n\t\t\t\tthis.player.setRotation(eventID, this.player.specTypeFunctions.rotationCreate());\r\n\t\t\t}\r\n\t\t\tthis.player.setTalentsString(eventID, this.individualConfig.defaults.talents.talentsString);\r\n\t\t\tthis.player.setGlyphs(eventID, this.individualConfig.defaults.talents.glyphs || Glyphs.create());\r\n\t\t\tthis.player.setSpecOptions(eventID, this.individualConfig.defaults.specOptions);\r\n\t\t\tthis.player.setBuffs(eventID, this.individualConfig.defaults.individualBuffs);\r\n\t\t\tthis.player.getParty()!.setBuffs(eventID, this.individualConfig.defaults.partyBuffs);\r\n\t\t\tthis.player.getRaid()!.setBuffs(eventID, this.individualConfig.defaults.raidBuffs);\r\n\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\r\n\t\t\tconst defaultRatios = this.player.getDefaultEpRatios(tankSpec, healingSpec)\r\n\t\t\tthis.player.setEpRatios(eventID, defaultRatios);\r\n\t\t\tthis.player.setProfession1(eventID, this.individualConfig.defaults.other?.profession1 || Profession.Engineering);\r\n\t\t\tthis.player.setProfession2(eventID, this.individualConfig.defaults.other?.profession2 || Profession.Jewelcrafting);\r\n\t\t\tthis.player.setDistanceFromTarget(eventID, this.individualConfig.defaults.other?.distanceFromTarget || 0);\r\n\r\n\t\t\tif (this.isWithinRaidSim) {\r\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, 0);\r\n\t\t\t} else {\r\n\t\t\t\tthis.sim.raid.setTargetDummies(eventID, healingSpec ? 9 : 0);\r\n\t\t\t\tthis.sim.encounter.applyDefaults(eventID);\r\n\t\t\t\tthis.sim.raid.setDebuffs(eventID, this.individualConfig.defaults.debuffs);\r\n\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\r\n\r\n\t\t\t\tif (tankSpec) {\r\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, [this.player.makeUnitReference()]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.sim.raid.setTanks(eventID, []);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetSavedGearStorageKey(): string {\r\n\t\treturn this.getStorageKey(SAVED_GEAR_STORAGE_KEY);\r\n\t}\r\n\r\n\tgetSavedRotationStorageKey(): string {\r\n\t\treturn this.getStorageKey(SAVED_ROTATION_STORAGE_KEY);\r\n\t}\r\n\r\n\tgetSavedSettingsStorageKey(): string {\r\n\t\treturn this.getStorageKey(SAVED_SETTINGS_STORAGE_KEY);\r\n\t}\r\n\r\n\tgetSavedTalentsStorageKey(): string {\r\n\t\treturn this.getStorageKey(SAVED_TALENTS_STORAGE_KEY);\r\n\t}\r\n\r\n\t// Returns the actual key to use for local storage, based on the given key part and the site context.\r\n\tgetStorageKey(keyPart: string): string {\r\n\t\t// Local storage is shared by all sites under the same domain, so we need to use\r\n\t\t// different keys for each spec site.\r\n\t\treturn specToLocalStorageKey[this.player.spec] + keyPart;\r\n\t}\r\n\r\n\ttoProto(): IndividualSimSettings {\r\n\t\treturn IndividualSimSettings.create({\r\n\t\t\tsettings: this.sim.toProto(),\r\n\t\t\tplayer: this.player.toProto(true),\r\n\t\t\traidBuffs: this.sim.raid.getBuffs(),\r\n\t\t\tdebuffs: this.sim.raid.getDebuffs(),\r\n\t\t\ttanks: this.sim.raid.getTanks(),\r\n\t\t\tpartyBuffs: this.player.getParty()?.getBuffs() || PartyBuffs.create(),\r\n\t\t\tencounter: this.sim.encounter.toProto(),\r\n\t\t\tepWeightsStats: this.player.getEpWeights().toProto(),\r\n\t\t\tepRatios: this.player.getEpRatios(),\r\n\t\t\tdpsRefStat: this.dpsRefStat,\r\n\t\t\thealRefStat: this.healRefStat,\r\n\t\t\ttankRefStat: this.tankRefStat,\r\n\t\t\ttargetDummies: this.sim.raid.getTargetDummies(),\r\n\t\t});\r\n\t}\r\n\r\n\ttoLink(): string {\r\n\t\tconst proto = this.toProto();\r\n\t\t// When sharing links, people generally don't intend to share settings/ep weights.\r\n\t\tproto.settings = undefined;\r\n\t\tproto.epWeights = [];\r\n\r\n\t\tconst protoBytes = IndividualSimSettings.toBinary(proto);\r\n\t\tconst deflated = pako.deflate(protoBytes, { to: 'string' });\r\n\t\tconst encoded = btoa(String.fromCharCode(...deflated));\r\n\r\n\t\tconst linkUrl = new URL(window.location.href);\r\n\t\tlinkUrl.hash = encoded;\r\n\t\treturn linkUrl.toString();\r\n\t}\r\n\r\n\tfromProto(eventID: EventID, settings: IndividualSimSettings) {\r\n\t\tTypedEvent.freezeAllAndDo(() => {\r\n\t\t\tif (!settings.player) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.player.fromProto(eventID, settings.player);\r\n\t\t\tif (settings.epWeights?.length > 0) {\r\n\t\t\t\tthis.player.setEpWeights(eventID, new Stats(settings.epWeights));\r\n\t\t\t} else if (settings.epWeightsStats) {\r\n\t\t\t\tthis.player.setEpWeights(eventID, Stats.fromProto(settings.epWeightsStats));\r\n\t\t\t} else {\r\n\t\t\t\tthis.player.setEpWeights(eventID, this.individualConfig.defaults.epWeights);\r\n\t\t\t}\r\n\r\n\t\t\tconst tankSpec = isTankSpec(this.player.spec);\r\n\t\t\tconst healingSpec = isHealingSpec(this.player.spec);\r\n\t\t\tconst defaultRatios = this.player.getDefaultEpRatios(tankSpec, healingSpec);\r\n\t\t\tif (settings.epRatios) {\r\n\t\t\t\tconst missingRatios = new Array<number>(defaultRatios.length - settings.epRatios.length).fill(0);\r\n\t\t\t\tthis.player.setEpRatios(eventID, settings.epRatios.concat(missingRatios));\r\n\t\t\t} else {\r\n\t\t\t\tthis.player.setEpRatios(eventID, defaultRatios);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.dpsRefStat) {\r\n\t\t\t\tthis.dpsRefStat = settings.dpsRefStat;\r\n\t\t\t}\r\n\t\t\tif (settings.healRefStat) {\r\n\t\t\t\tthis.healRefStat = settings.healRefStat;\r\n\t\t\t}\r\n\t\t\tif (settings.tankRefStat) {\r\n\t\t\t\tthis.tankRefStat = settings.tankRefStat;\r\n\t\t\t}\r\n\r\n\t\t\tthis.sim.raid.setBuffs(eventID, settings.raidBuffs || RaidBuffs.create());\r\n\t\t\tthis.sim.raid.setDebuffs(eventID, settings.debuffs || Debuffs.create());\r\n\t\t\tthis.sim.raid.setTanks(eventID, settings.tanks || []);\r\n\t\t\tthis.sim.raid.setTargetDummies(eventID, settings.targetDummies);\r\n\t\t\tconst party = this.player.getParty();\r\n\t\t\tif (party) {\r\n\t\t\t\tparty.setBuffs(eventID, settings.partyBuffs || PartyBuffs.create());\r\n\t\t\t}\r\n\r\n\t\t\tthis.sim.encounter.fromProto(eventID, settings.encounter || EncounterProto.create());\r\n\r\n\t\t\tif (settings.settings) {\r\n\t\t\t\tthis.sim.fromProto(eventID, settings.settings);\r\n\t\t\t} else {\r\n\t\t\t\tconst tankSpec = isTankSpec(this.player.spec);\r\n\t\t\t\tconst healingSpec = isHealingSpec(this.player.spec);\r\n\t\t\t\tthis.sim.applyDefaults(eventID, tankSpec, healingSpec);\r\n\t\t\t}\r\n\r\n\t\t\t// Needed because of new proto field addition. Can remove on 2022/11/14 (2 months).\r\n\t\t\tif (!isHealingSpec(this.player.spec)) {\r\n\t\t\t\tthis.sim.setShowDamageMetrics(eventID, true);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tsplitRelevantOptions<T>(options: Array<StatOption<T> | null>): Array<T> {\r\n\t\treturn options\r\n\t\t\t.filter(option => option != null)\r\n\t\t\t.filter(option =>\r\n\t\t\t\tthis.individualConfig.includeBuffDebuffInputs.includes(option!.item) ||\r\n\t\t\t\toption!.stats.length == 0 ||\r\n\t\t\t\toption!.stats.some(stat => this.individualConfig.epStats.includes(stat)))\r\n\t\t\t.filter(option =>\r\n\t\t\t\t!this.individualConfig.excludeBuffDebuffInputs.includes(option!.item))\r\n\t\t\t.map(option => option!.item);\r\n\t}\r\n}\r\n\r\nexport interface StatOption<T> {\r\n\tstats: Array<Stat>,\r\n\titem: T,\r\n}\r\n"],"names":["LaunchStatus","LaunchStatus2","raidSimStatus","simLaunchStatuses","Spec","SpecBalanceDruid","SpecFeralDruid","SpecFeralTankDruid","SpecRestorationDruid","SpecElementalShaman","SpecEnhancementShaman","SpecRestorationShaman","SpecHunter","SpecMage","SpecRogue","SpecHolyPaladin","SpecProtectionPaladin","SpecRetributionPaladin","SpecHealingPriest","SpecShadowPriest","SpecSmitePriest","SpecWarlock","SpecWarrior","SpecProtectionWarrior","SpecDeathknight","SpecTankDeathknight","aplLaunchStatuses","memeSpecs","getLaunchedSimsForClass","klass","Object","keys","specToClass","map","parseInt","specStr","filter","spec","TalentsPicker","Input","constructor","parent","modObject","config","super","inline","__publicField","this","pointsPerRow","maxPoints","numRows","Math","max","trees","treeConfig","talents","talentConfig","location","rowIdx","flat","numCols","colIdx","rootElem","appendChild","element","id","className","type","attributes","carouselContainer","querySelector","carouselPrevBtn","carouselNextBtn","i","carouselItem","document","createElement","classList","add","name","TalentTreePicker","forEach","tree","talent","setPoints","carouselitemIdx","addEventListener","style","transform","children","abs","remove","init","getInputElem","getInputValue","getTalentsString","join","replace","setInputValue","newValue","parts","split","idx","setTalentsString","updateTrees","isFull","update","numPoints","sum","setMaxPoints","newMaxPoints","isHunterPet","includes","Component","picker","specNumber","fragment","src","getSpecIcon","title","getElementsByClassName","pointsElem","backgroundImage","backgroundUrl","main","gridTemplateRows","gridTemplateColumns","iconSize","height","maxWidth","TalentPicker","prereqLocation","getTalent","childLocations","push","recurseCalcIdx","t","z","initChildReqs","zIndex","cl","c","parentReq","getChildReqArrow","length","resetBtn","Tooltip","event","inputChanged","TypedEvent","nextEventID","innerHTML","textContent","getMaxSpendablePoints","find","getRow","getCol","Error","String","getPoints","str","Number","charAt","getTalents","beastMastery","TalentReqArrow","parentLoc","childLoc","zIdx","gridRow","gridColumn","rowEnd","colEnd","dir","dataset","reqArrowColSize","reqArrowRowSize","gridRowEnd","gridColumnEnd","setReqFufilled","isFufilled","reqActive","childReqs","whtticon","pointsDisplay","preventDefault","longTouchTimer","clearTimeout","window","setTimeout","newPoints","isRightClick","parentElement","loc","pts","points","isNaN","canSetPoints","oldPoints","additionalPoints","removedPoints","pointTotalsByRow","Array","talentsInRow","cumulativeTotalsByRow","_","slice","every","checkValidity","min","spellId","getSpellIdForPoints","ActionId","fromSpellId","fill","then","actionId","setWowheadHref","iconUrl","rank","spellIds","fieldName","newTalentsConfig","prevTalent","curSpellId","pointIdx","druidTalentsConfig","druidGlyphsConfig","majorGlyphs","DruidMajorGlyph","GlyphOfBarkskin","description","GlyphOfBerserk","GlyphOfClaw","GlyphOfEntanglingRoots","GlyphOfFocus","GlyphOfFrenziedRegeneration","GlyphOfGrowling","GlyphOfHealingTouch","GlyphOfHurricane","GlyphOfInnervate","GlyphOfInsectSwarm","GlyphOfLifebloom","GlyphOfMangle","GlyphOfMaul","GlyphOfMonsoon","GlyphOfMoonfire","GlyphOfOmenOfClarity","GlyphOfNourish","GlyphOfRake","GlyphOfRapidRejuvenation","GlyphOfRebirth","GlyphOfRegrowth","GlyphOfRejuvenation","GlyphOfRip","GlyphOfSavageRoar","GlyphOfShred","GlyphOfStarfall","GlyphOfStarfire","GlyphOfSurvivalInstincts","GlyphOfSwiftmend","GlyphOfWildGrowth","GlyphOfWrath","minorGlyphs","DruidMinorGlyph","GlyphOfAquaticForm","GlyphOfChallengingRoar","GlyphOfDash","GlyphOfTheWild","GlyphOfThorns","GlyphOfTyphoon","GlyphOfUnburdenedRebirth","hunterTalentsConfig","hunterGlyphsConfig","HunterMajorGlyph","GlyphOfAimedShot","GlyphOfArcaneShot","GlyphOfAspectOfTheViper","GlyphOfBestialWrath","GlyphOfChimeraShot","GlyphOfDeterrence","GlyphOfDisengage","GlyphOfExplosiveShot","GlyphOfExplosiveTrap","GlyphOfFreezingTrap","GlyphOfFrostTrap","GlyphOfHuntersMark","GlyphOfImmolationTrap","GlyphOfMending","GlyphOfMultiShot","GlyphOfRapidFire","GlyphOfRaptorStrike","GlyphOfScatterShot","GlyphOfSerpentSting","GlyphOfSnakeTrap","GlyphOfSteadyShot","GlyphOfTheBeast","GlyphOfTheHawk","GlyphOfTrueshotAura","GlyphOfVolley","GlyphOfWyvernSting","HunterMinorGlyph","GlyphOfFeignDeath","GlyphOfMendPet","GlyphOfPossessedStrength","GlyphOfRevivePet","GlyphOfScareBeast","GlyphOfThePack","mageTalentsConfig","mageGlyphsConfig","MageMajorGlyph","GlyphOfArcaneBarrage","GlyphOfArcaneBlast","GlyphOfArcaneExplosion","GlyphOfArcaneMissiles","GlyphOfArcanePower","GlyphOfBlink","GlyphOfDeepFreeze","GlyphOfEternalWater","GlyphOfEvocation","GlyphOfFireBlast","GlyphOfFireball","GlyphOfFrostNova","GlyphOfFrostbolt","GlyphOfFrostfire","GlyphOfIceArmor","GlyphOfIceBarrier","GlyphOfIceBlock","GlyphOfIceLance","GlyphOfIcyVeins","GlyphOfInvisibility","GlyphOfLivingBomb","GlyphOfMageArmor","GlyphOfManaGem","GlyphOfMirrorImage","GlyphOfMoltenArmor","GlyphOfPolymorph","GlyphOfRemoveCurse","GlyphOfScorch","GlyphOfWaterElemental","MageMinorGlyph","GlyphOfArcaneIntellect","GlyphOfBlastWave","GlyphOfFireWard","GlyphOfFrostArmor","GlyphOfFrostWard","GlyphOfSlowFall","GlyphOfThePenguin","paladinTalentsConfig","paladinGlyphsConfig","PaladinMajorGlyph","GlyphOfAvengerSShield","GlyphOfAvengingWrath","GlyphOfBeaconOfLight","GlyphOfCleansing","GlyphOfConsecration","GlyphOfCrusaderStrike","GlyphOfDivineStorm","GlyphOfDivinity","GlyphOfExorcism","GlyphOfFlashOfLight","GlyphOfHammerOfJustice","GlyphOfHammerOfTheRighteous","GlyphOfHammerOfWrath","GlyphOfHolyLight","GlyphOfHolyShock","GlyphOfHolyWrath","GlyphOfJudgement","GlyphOfRighteousDefense","GlyphOfSalvation","GlyphOfSealOfCommand","GlyphOfSealOfLight","GlyphOfSealOfRighteousness","GlyphOfSealOfVengeance","GlyphOfSealOfWisdom","GlyphOfShieldOfRighteousness","GlyphOfSpiritualAttunement","GlyphOfTurnEvil","PaladinMinorGlyph","GlyphOfBlessingOfKings","GlyphOfBlessingOfMight","GlyphOfBlessingOfWisdom","GlyphOfLayOnHands","GlyphOfSenseUndead","GlyphOfTheWise","priestTalentsConfig","priestGlyphsConfig","PriestMajorGlyph","GlyphOfCircleOfHealing","GlyphOfDispelMagic","GlyphOfDispersion","GlyphOfFade","GlyphOfFearWard","GlyphOfFlashHeal","GlyphOfGuardianSpirit","GlyphOfHolyNova","GlyphOfInnerFire","GlyphOfLightwell","GlyphOfMassDispel","GlyphOfMindControl","GlyphOfMindFlay","GlyphOfPainSuppression","GlyphOfPenance","GlyphOfPowerWordShield","GlyphOfPrayerOfHealing","GlyphOfPsychicScream","GlyphOfRenew","GlyphOfScourgeImprisonment","GlyphOfShadow","GlyphOfShadowWordDeath","GlyphOfShadowWordPain","GlyphOfSmite","GlyphOfSpiritOfRedemption","PriestMinorGlyph","GlyphOfFading","GlyphOfFortitude","GlyphOfLevitate","GlyphOfShackleUndead","GlyphOfShadowProtection","GlyphOfShadowfiend","rogueTalentsConfig","rogueGlyphsConfig","RogueMajorGlyph","GlyphOfAdrenalineRush","GlyphOfAmbush","GlyphOfBackstab","GlyphOfBladeFlurry","GlyphOfCloakOfShadows","GlyphOfCripplingPoison","GlyphOfDeadlyThrow","GlyphOfEvasion","GlyphOfEviscerate","GlyphOfExposeArmor","GlyphOfFanOfKnives","GlyphOfFeint","GlyphOfGarrote","GlyphOfGhostlyStrike","GlyphOfGouge","GlyphOfHemorrhage","GlyphOfHungerForBlood","GlyphOfKillingSpree","GlyphOfMutilate","GlyphOfPreparation","GlyphOfRupture","GlyphOfSap","GlyphOfShadowDance","GlyphOfSinisterStrike","GlyphOfSliceAndDice","GlyphOfSprint","GlyphOfTricksOfTheTrade","GlyphOfVigor","RogueMinorGlyph","GlyphOfBlurredSpeed","GlyphOfDistract","GlyphOfPickLock","GlyphOfPickPocket","GlyphOfSafeFall","GlyphOfVanish","shamanTalentsConfig","shamanGlyphsConfig","ShamanMajorGlyph","GlyphOfChainHeal","GlyphOfChainLightning","GlyphOfEarthShield","GlyphOfEarthlivingWeapon","GlyphOfElementalMastery","GlyphOfFeralSpirit","GlyphOfFireElementalTotem","GlyphOfFireNova","GlyphOfFlameShock","GlyphOfFlametongueWeapon","GlyphOfFrostShock","GlyphOfHealingStreamTotem","GlyphOfHealingWave","GlyphOfHex","GlyphOfLava","GlyphOfLavaLash","GlyphOfLesserHealingWave","GlyphOfLightningBolt","GlyphOfLightningShield","GlyphOfManaTide","GlyphOfRiptide","GlyphOfShocking","GlyphOfStoneclawTotem","GlyphOfStormstrike","GlyphOfThunder","GlyphOfTotemOfWrath","GlyphOfWaterMastery","GlyphOfWindfuryWeapon","ShamanMinorGlyph","GlyphOfAstralRecall","GlyphOfGhostWolf","GlyphOfRenewedLife","GlyphOfThunderstorm","GlyphOfWaterBreathing","GlyphOfWaterShield","GlyphOfWaterWalking","warlockTalentsConfig","warlockGlyphsConfig","WarlockMajorGlyph","GlyphOfChaosBolt","GlyphOfConflagrate","GlyphOfCorruption","GlyphOfCurseOfAgony","GlyphOfDeathCoil","GlyphOfDemonicCircle","GlyphOfFear","GlyphOfFelguard","GlyphOfFelhunter","GlyphOfHaunt","GlyphOfHealthFunnel","GlyphOfHealthstone","GlyphOfHowlOfTerror","GlyphOfImmolate","GlyphOfImp","GlyphOfIncinerate","GlyphOfLifeTap","GlyphOfMetamorphosis","GlyphOfQuickDecay","GlyphOfSearingPain","GlyphOfShadowBolt","GlyphOfShadowburn","GlyphOfShadowflame","GlyphOfSiphonLife","GlyphOfSoulLink","GlyphOfSoulstone","GlyphOfSuccubus","GlyphOfUnstableAffliction","GlyphOfVoidwalker","WarlockMinorGlyph","GlyphOfCurseOfExhausion","GlyphOfDrainSoul","GlyphOfSubjugateDemon","GlyphOfKilrogg","GlyphOfSouls","GlyphOfUnendingBreath","warriorTalentsConfig","warriorGlyphsConfig","WarriorMajorGlyph","GlyphOfBarbaricInsults","GlyphOfBladestorm","GlyphOfBlocking","GlyphOfBloodthirst","GlyphOfCleaving","GlyphOfDevastate","GlyphOfEnragedRegeneration","GlyphOfExecution","GlyphOfHamstring","GlyphOfHeroicStrike","GlyphOfIntervene","GlyphOfLastStand","GlyphOfMortalStrike","GlyphOfOverpower","GlyphOfRapidCharge","GlyphOfRending","GlyphOfResonatingPower","GlyphOfRevenge","GlyphOfShieldWall","GlyphOfShockwave","GlyphOfSpellReflection","GlyphOfSunderArmor","GlyphOfSweepingStrikes","GlyphOfTaunt","GlyphOfVictoryRush","GlyphOfVigilance","GlyphOfWhirlwind","WarriorMinorGlyph","GlyphOfBattle","GlyphOfBloodrage","GlyphOfCharge","GlyphOfCommand","GlyphOfEnduringVictory","GlyphOfMockingBlow","GlyphOfThunderClap","GlyphOfShatteringThrow","deathknightTalentsConfig","deathknightGlyphsConfig","DeathknightMajorGlyph","GlyphOfAntiMagicShell","GlyphOfBloodStrike","GlyphOfBoneShield","GlyphOfChainsOfIce","GlyphOfDancingRuneWeapon","GlyphOfDarkCommand","GlyphOfDarkDeath","GlyphOfDeathAndDecay","GlyphOfDeathGrip","GlyphOfDeathStrike","GlyphOfDisease","GlyphOfFrostStrike","GlyphOfHeartStrike","GlyphOfHowlingBlast","GlyphOfHungeringCold","GlyphOfIceboundFortitude","GlyphOfIcyTouch","GlyphOfObliterate","GlyphOfPlagueStrike","GlyphOfRuneStrike","GlyphOfRuneTap","GlyphOfScourgeStrike","GlyphOfStrangulate","GlyphOfTheGhoul","GlyphOfUnbreakableArmor","GlyphOfUnholyBlight","GlyphOfVampiricBlood","DeathknightMinorGlyph","GlyphOfBloodTap","GlyphOfCorpseExplosion","GlyphOfDeathSEmbrace","GlyphOfHornOfWinter","GlyphOfPestilence","GlyphOfRaiseDead","classTalentsConfig","Class","ClassUnknown","ClassDeathknight","ClassDruid","ClassShaman","ClassHunter","ClassMage","ClassRogue","ClassPaladin","ClassPriest","ClassWarlock","ClassWarrior","classGlyphsConfig","talentStringToProto","proto","talentString","talentsConfig","treeString","treeIdx","protoToTalentString","MAX_PARTY_SIZE","Party","raid","sim","PartyBuffs","create","players","playerChangeListener","eventID","changeEmitter","emit","onAny","compChangeEmitter","buffsChangeEmitter","size","player","isEmpty","clear","setBuffs","setPlayer","getIndex","getParties","indexOf","getPlayers","getPlayer","playerIndex","newPlayer","freezeAllAndDo","oldPlayer","off","setParty","newPlayerOldParty","getParty","getPartyIndex","on","getBuffs","clone","buffs","newBuffs","equals","toProto","forExport","forSimming","PartyProto","PlayerProto","fromProto","class","playerProto","playerToSpec","currentPlayer","Player","UnitMetadata","auras","spells","getName","getAuras","getSpells","metadata","newSpells","spell","data","newAuras","aura","Promise","all","newSpell","newId","sort","a","b","stringComparator","anyUpdates","some","newAura","UnitMetadataList","metadatas","newMetadatas","oldLen","v","asList","_Player","IndividualBuffs","Consumes","Stats","Gear","ItemSwapGear","APLRotation","Glyphs","Cooldowns","HealingModel","Map","numEpRatios","PlayerStats","party","race","specToEligibleRaces","shattFaction","specTypeFunctions","rotation","rotationCreate","specOptions","optionsCreate","ItemSlot","ItemSlotRanged","itemEPCache","nameChangeEmitter","consumesChangeEmitter","bonusStatsChangeEmitter","gearChangeEmitter","professionChangeEmitter","raceChangeEmitter","rotationChangeEmitter","talentsChangeEmitter","glyphsChangeEmitter","specOptionsChangeEmitter","cooldownsChangeEmitter","miscOptionsChangeEmitter","inFrontOfTargetChangeEmitter","distanceFromTargetChangeEmitter","healingModelChangeEmitter","epWeightsChangeEmitter","epRatiosChangeEmitter","epRefStatChangeEmitter","getTalentTreeIcon","getClass","getClassColor","classColors","isSpec","isClass","clazz","getRaid","getRaidIndex","newParty","getOtherPartyMembers","getItems","slot","db","item","canEquipItem","getEnchants","enchant","canEquipEnchant","getGems","socketColor","getEpWeights","epWeights","setEpWeights","newEpWeights","gemEPCache","enchantEPCache","getShattFaction","setShattFaction","newFaction","getDefaultEpRatios","isTankSpec","isHealingSpec","defaultRatios","getEpRatios","epRatios","setEpRatios","newRatios","computeStatWeights","epStats","epPseudoStats","epReferenceStat","onProgress","statWeights","getCurrentStats","currentStats","setCurrentStats","newStats","currentStatsEmitter","getMetadata","getPetMetadatas","petMetadatas","updateMetadata","playerPromise","petsPromise","pets","p","playerUpdated","petsUpdated","setName","newName","getLabel","getRace","setRace","newRace","getProfession1","profession1","setProfession1","newProfession","getProfession2","profession2","setProfession2","getProfessions","Profession","ProfessionUnknown","setProfessions","newProfessions","hasProfession","prof","isBlacksmithing","getFaction","raceToFaction","getConsumes","consumes","setConsumes","newConsumes","getCooldowns","Launched","aplRotation","simple","cooldowns","setCooldowns","newCooldowns","SimpleRotation","canDualWield2H","titansGrip","equipItem","newItem","setGear","gear","withEquippedItem","getEquippedItem","getGear","getItemSwapGear","itemSwapGear","newGear","getMeleeCritCapInfo","meleeCrit","finalStats","stats","Stat","StatMeleeCrit","Mechanics.MELEE_CRIT_RATING_PER_CRIT_CHANCE","meleeHit","StatMeleeHit","Mechanics.MELEE_HIT_RATING_PER_HIT_CHANCE","expertise","StatExpertise","Mechanics.EXPERTISE_PER_QUARTER_PERCENT_REDUCTION","StatAgility","hasOffhandWeapon","ItemSlotOffHand","weaponSpeed","meleeHitCap","expertiseCap","getInFrontOfTarget","remainingMeleeHitCap","remainingExpertiseCap","specSpecificOffset","elementalDevastation","debuffCrit","debuffs","getDebuffs","totemOfWrath","heartOfTheCrusader","masterPoisoner","baseCritCap","suppression","glancing","playerCritCapDelta","getMeleeCritCap","getBonusStats","bonusStats","setBonusStats","newBonusStats","getRotation","rotationCopy","jsonStr","specRotationJson","json","JSON","parse","rotationFromJson","e","console","warn","setRotation","newRotation","rotationEquals","stringify","rotationToJson","setAplRotation","getRotationType","enabled","APLRotationType","TypeAPL","TypeUnknown","TypeLegacy","setAutoRotationGenerator","generator","autoRotationGenerator","setSimpleRotationGenerator","simpleRotationGenerator","hasSimpleRotationGenerator","getResolvedAplRotation","TypeAuto","TypeSimple","rot","talentsString","talentsCreate","newTalentsString","getTalentTree","getTalentTreePoints","getGlyphs","glyphs","setGlyphs","newGlyphs","getMajorGlyphs","major1","major2","major3","glyph","getMinorGlyphs","minor1","minor2","minor3","getAllGlyphs","concat","getSpecOptions","optionsCopy","setSpecOptions","newSpecOptions","optionsEquals","getReactionTime","reactionTime","setReactionTime","newReactionTime","getChannelClipDelay","setChannelClipDelay","newChannelClipDelay","channelClipDelay","inFrontOfTarget","setInFrontOfTarget","newInFrontOfTarget","getDistanceFromTarget","distanceFromTarget","setDistanceFromTarget","newDistanceFromTarget","setDefaultHealingParams","hm","boss","encounter","primaryTarget","dualWield","cadenceSeconds","swingSpeed","hps","minBaseDamage","enableHealing","healingEnabled","getHealingModel","setHealingModel","healingModel","newHealingModel","computeStatsEP","computeEP","computeGemEP","gem","has","get","epFromStats","epFromEffect","getMetaGemEffectEP","bonusEP","unique","ep","set","computeEnchantEP","effectId","computeItemEP","cached","itemStats","weaponDps","getWeaponDPS","ItemSlotMainHand","withPseudoStat","PseudoStat","PseudoStatMainHandDps","PseudoStatOffHandDps","PseudoStatRangedDps","epWeight","fromJson","toJson","armorType","ArmorType","ArmorTypeCloth","ArmorTypeLeather","withStat","StatArmor","getStat","bestGemEPNotMatchingSockets","gemSockets","gems","isUnrestrictedGem","getPhase","bestGemEPMatchingSockets","gemMatchesSocket","socketBonus","setWowheadData","equippedItem","elem","lang","getLanguageCode","langPrefix","Blacksmithing","curGems","asArray","ei","hasExtraSocket","wowhead","filterItemData","itemData","getItemFunc","filters","getFilters","filterItems","filterFunc","itemElem","factionRestriction","UIItem_FactionRestriction","UNSPECIFIED","sources","SourceFilterOption","SourceCrafting","itemSrc","source","oneofKind","SourceQuest","srcOptionStr","difficulty","entries","DIFFICULTY_SRCS","srcOption","drop","DungeonDifficulty","DifficultyRaid10H","DifficultyRaid25H","normalDifficulty","HEROIC_TO_NORMAL","category","AL_CATEGORY_HARD_MODE","raids","RaidFilterOption","RaidVanilla","expansion","Expansion","ExpansionVanilla","raidOptionStr","zoneId","RAID_IDS","raidOption","ARMOR_SLOTS","armorTypes","WEAPON_SLOTS","weaponTypes","weaponType","oneHandedWeapons","handType","HandType","HandTypeTwoHand","twoHandedWeapons","minSpeed","minMhWeaponSpeed","minOhWeaponSpeed","maxSpeed","maxMhWeaponSpeed","maxOhWeaponSpeed","rangedWeaponTypes","rangedWeaponType","minRangedWeaponSpeed","maxRangedWeaponSpeed","filterEnchantData","enchantData","getEnchantFunc","currentEquippedItem","enchantElem","enchantAppliesToItem","filterGemData","gemData","getGemFunc","gemElem","matchingGemsOnly","makeUnitReference","emptyUnitReference","newUnitReference","toDatabase","dbGear","dbItemSwapGear","SimDatabase","items","index","self","findIndex","enchants","aplIsLaunched","withSpecProto","equipment","asSpec","hpPercentForDefensives","reactionTimeMs","channelClipDelayMs","database","prepullActions","ppa","doAt","doAtValue","APLValue","value","const","val","rotationFromPlayer","lookupEquipmentSpec","UnitStats","optionsFromPlayer","options","key","targetIndex","UnitReference","UnitReference_Type","timeToTrapWeaveMs","latency","totems","applySharedDefaults","burstWindow","Beta","ItemSlotHead","ItemSlotShoulder","ItemSlotChest","ItemSlotWrist","ItemSlotHands","ItemSlotLegs","ItemSlotWaist","ItemSlotFeet","SourceDungeon","DifficultyNormal","SourceDungeonH","DifficultyHeroic","SourceRaid10","DifficultyRaid10","SourceRaid10H","SourceRaid25","DifficultyRaid25","SourceRaid25H","RaidKarazhan","RaidGruul","RaidMagtheridon","RaidSerpentshrineCavern","RaidTempestKeep","RaidMountHyjal","RaidBlackTemple","RaidZulAman","RaidSunwellPlateau","Encounter","targets","defaultTargetProto","targetsMetadata","targetsChangeEmitter","durationChangeEmitter","executeProportionChangeEmitter","emitter","TargetProto","getDurationVariation","durationVariation","setDurationVariation","newDuration","getDuration","duration","setDuration","getExecuteProportion20","executeProportion20","setExecuteProportion20","newExecuteProportion20","getExecuteProportion25","executeProportion25","setExecuteProportion25","newExecuteProportion25","getExecuteProportion35","executeProportion35","setExecuteProportion35","newExecuteProportion35","getUseHealth","useHealth","setUseHealth","newUseHealth","matchesPreset","preset","target","applyPreset","presetTarget","applyPresetTarget","EncounterProto","applyDefaults","level","Mechanics.BOSS_LEVEL","mobType","MobType","MobTypeGiant","tankIndex","dualWieldPenalty","suppressDodge","parryHaste","spellSchool","SpellSchool","SpellSchoolPhysical","fromMap","StatAttackPower","StatBlockValue","targetInputs","MAX_NUM_PARTIES","Raid","RaidBuffs","Debuffs","parties","activePlayers","numActivePartiesChangeEmitter","debuffsChangeEmitter","tanksChangeEmitter","targetDummiesChangeEmitter","floor","getPlayerFromUnitReference","raidTarget","contextPlayer","UnitType","Unknown","Self","getClassCount","playerClass","demonicPact","demonicPactSp","demonicPactOld","newDebuff","setDebuffs","newDebuffs","getTanks","tanks","tank","setTanks","newTanks","getTargetDummies","targetDummies","setTargetDummies","newTargetDummies","getNumActiveParties","numActiveParties","setNumActiveParties","newNumActiveParties","getActivePlayers","activeParties","RaidProto","SIM_WORKER_URL","REPO_NAME","WorkerPool","numWorkers","workers","SimWorker","getLeastBusyWorker","reduce","curMinWorker","nextWorker","numTasksRunning","makeApiCall","requestName","request","doApiCall","computeStats","result","ComputeStatsRequest","toBinary","ComputeStatsResult","fromBinary","statWeightsAsync","log","StatWeightsRequest","toJsonString","worker","makeTaskId","addPromiseFunc","newProgressHandler","err","resultData","ProgressMetrics","StatWeightsResult","finalWeightResult","bulkSimAsync","BulkSimRequest","enumAsInteger","resultJson","BulkSimResult","finalBulkResult","raidSimAsync","RaidSimRequest","RaidSimResult","finalRaidResult","progressData","progress","taskIdsToPromiseFuncs","Worker","resolveReady","onReady","_resolve","_reject","onmessage","msg","postMessage","promiseFuncs","outputData","callback","onError","characters","random","taskPromise","resolve","reject","inputData","_Sim","OtherConstants.CURRENT_PHASE","Faction","Alliance","defaultFilters","workerPool","_initPromise","Database","db_","settingsChangeEmitter","iterationsChangeEmitter","phaseChangeEmitter","fixedRngSeedChangeEmitter","filtersChangeEmitter","showDamageMetricsChangeEmitter","showThreatMetricsChangeEmitter","showHealingMetricsChangeEmitter","showExperimentalChangeEmitter","showEPValuesChangeEmitter","languageChangeEmitter","updateCharacterStats","waitForInit","setModifyRaidProto","newModFn","modifyRaidProto","getModifiedRaidProto","raidProto","gearChanged","isBlacksmith","hasInactiveMetaGem","withoutMetaGem","makeRaidSimRequest","debug","simOptions","SimOptions","iterations","getIterations","randomSeed","BigInt","nextRngSeed","debugFirstIteration","runBulkSim","bulkSettings","bulkItemsDb","baseSettings","playerDatabase","bulkSimStartEmitter","errorResult","SimError","bulkSimResultEmitter","runRaidSim","simResult","SimResult","makeNew","simResultEmitter","runRaidSimWithLogs","req","async","playerUpdatePromises","raidStats","partyStats","partyIndex","playerStats","targetUpdatePromise","encounterStats","unitMetadataEmitter","crashEmitter","raidBuffs","partyBuffs","statsToWeigh","pseudoStatsToWeigh","getUnitMetadata","ref","defaultRef","Target","Pet","owner","CurrentTarget","phase","setPhase","newPhase","faction","setFaction","factionChangeEmitter","getFixedRngSeed","fixedRngSeed","setFixedRngSeed","newFixedRngSeed","rngSeed","MAX_RNG_SEED","lastUsedRngSeed","lastUsedRngSeedChangeEmitter","getLastUsedRngSeed","DatabaseFilters","setFilters","newFilters","getShowDamageMetrics","showDamageMetrics","setShowDamageMetrics","newShowDamageMetrics","getShowThreatMetrics","showThreatMetrics","setShowThreatMetrics","newShowThreatMetrics","getShowHealingMetrics","showHealingMetrics","setShowHealingMetrics","newShowHealingMetrics","getShowExperimental","showExperimental","setShowExperimental","newShowExperimental","getShowEPValues","showEPValues","setShowEPValues","newShowEPValues","getLanguage","language","setLanguage","newLanguage","getBrowserLanguageCode","setLanguageCode","setIterations","newIterations","ALL_ARMOR_TYPES","ALL_WEAPON_TYPES","ALL_RANGED_WEAPON_TYPES","ALL_SOURCES","ALL_RAIDS","SimSettingsProto","showEpValues","isTankSim","isHealingSim","Sim","pow","getEnumValues","WeaponType","RangedWeaponType","errorStr","NumberPicker","float","positive","inputElem","onchange","parseFloat","toFixed","toString","updateSize","newSize","ResultsViewer","parentElem","pendingElem","contentElem","warningElem","warningsLink","addWarningsLink","updateWarnings","hideAll","addWarningLink","args","href","classes","icon","text","link","onclick","cfg","tooltip","html","placement","setAttribute","addWarning","warning","warnings","updateOn","activeWarnings","getContent","content","tooltipFragment","getAttribute","list","listItem","outerHTML","display","setPending","setContent","SimTitleDropdown","currentSpecIndex","rootLinkArgs","rootLink","buildRootSimLink","noDropdown","dropdownMenu","buildDropdown","closest","stopPropagation","Alpha","raidListItem","buildRaidLink","naturalClassOrder","classIndex","sims","buildClassLink","buildClassDropdown","dropdownFragment","classLink","specIndex","buildSpecLink","label","iconPath","getSimIconPath","textKlass","getContextualKlass","raidSimLabel","specNames","classNames","launchStatusLabel","raidSimSiteUrl","specIndexes","getSpecSiteUrl","specLabel","specLabels","raidSimIcon","toLowerCase","titleIcons","textCssClassForClass","textCssClassForSpec","BooleanPicker","Boolean","checked","EnumPicker","selectElem","values","option","DEFAULT_CONFIG","fixed","CloseButton","onClick","insertAdjacentHTML","closeButton","footer","header","scrollContents","BaseModal","cssClass","modalConfig","modalSizeKlass","dialog","container","body","addCloseButton","modal","Modal","open","dispose","close","onShow","stopImmediatePropagation","backdrop","_backdrop","_element","insertAdjacentElement","show","hide","SettingsMenu","simUI","restoreDefaultsButton","getOrCreateInstance","labelTooltip","extraCssClasses","changedEvent","getValue","setValue","langs","wowheadSupportedLanguages","defaultLang","reload","SimHeader","simTabsContainer","simToolbar","knownIssuesContent","knownIssuesLink","addKnownIssuesLink","addBugReportLink","addDownloadBinaryLink","addSimOptionsLink","addSocialLinks","IntersectionObserver","toggle","intersectionRatio","threshold","observe","activateTab","click","addTab","contentId","isFirstTab","tab","role","bsToggle","bsTarget","addSimTabLink","navLink","navItem","addImportLink","hideInRaidSim","addImportExportLink","addExportLink","menuElem","addToolbarLink","addKnownIssue","issue","getInstance","fetch","resp","versionInfo","outdated","catch","error","addGitHubLink","customRootElement","bsDisplay","globalKnownIssues","SimUI","cssScheme","isWithinRaidSim","noticeText","simContentContainer","simHeader","simMain","handleCrash","updateShowDamageMetrics","updateShowThreatMetrics","updateShowHealingMetrics","updateShowEpRatios","updateShowExperimental","addKnownIssues","titleElem","resultsViewerElem","resultsViewer","simActionsContainer","sim2","iterationsPicker","simTabContentsContainer","runSimOnce","addAction","actFn","button","tabContentFragment","addSimTab","statusStr","launchStatus","Unlaunched","knownIssues","getSettingsStorageKey","getStorageKey","getSavedEncounterStorageKey","isIndividualSim","contains","runSim","alert","startsWith","alertStr","substring","replaceAllInString","confirm","hash","hashCode","toLink","issues","total_count","html_url","base","maxBodyLength","issueBody","encodeURIComponent","truncated","lastIndexOf","CrashModal","fetchErr","len","charCodeAt","createTextNode","CharacterStats","modifyDisplayStats","statOrder","stat","table","valueElems","statName","getClassStatName","row","bonusStatsLink","valueElem","shouldShowMeleeCritCap","meleeCritCapValueElem","updateStats","statMods","baseStats","gearStats","talentsStats","buffsStats","consumesStats","debuffStats","getDebuffStats","baseDelta","gearDelta","subtract","talentsDelta","buffsDelta","consumesDelta","statDisplayString","prepend","bonusStatValue","tooltipContent","meleeCritCapInfo","meleeCritCapDisplayString","capDelta","deltaStats","rawValue","getPseudoStat","PseudoStatBlockValueMultiplier","displayStr","round","StatSpellHit","Mechanics.SPELL_HIT_RATING_PER_HIT_CHANCE","StatSpellCrit","Mechanics.SPELL_CRIT_RATING_PER_CRIT_CHANCE","StatMeleeHaste","Mechanics.SPECIAL_MELEE_HASTE_RATING_PER_HASTE_PERCENT","Mechanics.HASTE_RATING_PER_HASTE_PERCENT","StatSpellHaste","StatArmorPenetration","Mechanics.ARMOR_PEN_PER_PERCENT_ARMOR","StatDefense","Mechanics.CHARACTER_LEVEL","Mechanics.DEFENSE_RATING_PER_DEFENSE","StatBlock","Mechanics.BLOCK_RATING_PER_BLOCK_CHANCE","Mechanics.MISS_DODGE_PARRY_BLOCK_CRIT_CHANCE_PER_DEFENSE","StatDodge","PseudoStatDodge","StatParry","PseudoStatParry","StatResilience","Mechanics.RESILIENCE_RATING_PER_CRIT_REDUCTION_CHANCE","misery","faerieFire","TristateEffect","TristateEffectImproved","addStat","improvedScorch","wintersChill","shadowMastery","popover","Popover","customClass","fallbackPlacement","sanitize","popoverBody","_EpWeightsMenu","baseConfig","getModalConfig","statsType","tableBody","resultsElem","updateType","getNameFromStat","getStatFromName","updateEpRefStat","prevEpSimResult","calculateEp","getPrevSimResult","updateTable","querySelectorAll","epSelect","Option","dpsRefStat","getDpsEpRefStat","healRefStat","getHealEpRefStat","tankRefStat","getTankEpRefStat","optimizeGemsButton","previousContents","width","getBoundingClientRect","optimizeGems","calcButton","scrollTo","top","setSimProgress","prevEpIterations","colActionButtons","from","makeUpdateWeights","weightsFunc","epRefStat","previousElementSibling","refStatName","dps","weights","epValues","tps","dtps","tmi","pDeath","individualConfig","defaults","showAllStatsContainer","showAllStats","menu","makeEpRatioCell","cell","_eventID","updateButton","results","scaledDpsEp","scale","scaledHpsEp","scaledTpsEp","scaledDtpsEp","scaledTmiEp","scaledPDeathEp","newEp","scaledDpsWeights","scaledHpsWeights","scaledTpsWeights","scaledDtpsWeights","scaledTmiWeights","scaledPDeathWeights","newWeights","completedSims","totalSims","completedIterations","totalIterations","epUnitStats","isStat","isPseudoStat","makeTableRow","rowTotalEp","getProtoValue","scaledEpValue","makeTableRowCells","currentEpCell","getUnitStat","withUnitStat","epTotal","epRatio","weightCell","epCell","weightAvg","weightStdev","weightsStdev","makeTableCellContents","epAvg","epStdev","epValuesStdev","template","epDelta","epAvgElem","stdev","stDevToConf90","normaliseValue","refStat","refUnitStat","UnitStat","fromStat","refWeight","refStdev","setProtoValue","valueStdev","w","allGems","isJewelcrafting","Jewelcrafting","optimizedGear","optimizeGemsForWeights","unrestrictedGems","Gems.isUnrestrictedGem","bestGemForColor","bestGemForColorEP","bestGemForSocket","bestGemForSocketEP","bestGem","bestGemEP","findBestGems","asMap","socketBonusEPs","itemSlot","socketColors","curSocketColors","GemColor","GemColorMeta","withGem","allSockets","itemSlotStr","numSockets","socketIdx","threeSocketCombos","permutations","calculateGearGemsEP","statsFromGems","jcGems","requiredProfession","bestJcGemForColor","bestJcGemForColorEP","bestJcGemForSocket","bestJcGemForSocketEP","bestJcGem","bestJcGemEP","bestGear","bestGearEP","socketCombo","curItems","gemColor","color","curGear","hasActiveMetaGem","curGearEP","metaGem","getMetaGem","condition","Gems.getMetaGemCondition","isCompareColorCondition","getAllGems","colorCombos","getColorCombosToSatisfyCondition","colorCombo","isOneOfEach","Gems.PRIMARY_COLORS","GemColorPrismatic","Gems.SECONDARY_COLORS","secondaryColor","remainingColor","Gems.socketToMatchingColors","matchingColor","isTwoAndOne","oneColor","minRed","minYellow","minBlue","twoColor","Gems.gemColorMatchesSocket","partialCombo","isThreeOfAColor","threeColor","matchingColors","combinationsWithDups","gemList","Gems.GEM_COLORS","gemEP","GEM_COLORS","Gems.gemMatchesSocket","EpWeightsMenu","getAll","ContentBlock","headerElement","buildHeader","bodyElement","buildBody","bodyClasses","TitleTag","titleTag","bodyElem","Importer","includeFile","uploadInputId","replaceAll","textElem","descriptionElem","files","importButton","onImport","finishIndividualImport","charClass","equipmentSpec","talentsStr","professions","loadLeftoversIfNecessary","expectedEnchantIds","foundEnchantIds","missingEnchants","expectedId","expectedItemIds","foundItemIds","missingItems","IndividualJsonImporter","IndividualSimSettings","fromJsonString","ignoreUnknownFields","Individual80UImporter","importJson","nameToClass","character","gameClass","nameToRace","Race","RaceUnknown","talentIds","spellIdIndex","talentSpellIdsToTalentString","talentJson","EquipmentSpec","itemJson","itemSpec","ItemSpec","gemJson","_IndividualWowheadGearPlannerImporter","url","match","base64Data","Uint8Array","atob","numTalentBytes","talentBytes","subarray","buf2hex","cur","numGlyphBytes","glyphBytes","gearBytes","hasGlyphs","d","glyphStr","fromCharCode","glyphIds","glyphPosition","itemId","glyphSpellToItemId","slotId","isEnchanted","numGems","highid","enchantSpellId","enchantSpellIdToEffectId","gemIdx","gemPosition","highgemid","gemId","slotIDs","IndividualWowheadGearPlannerImporter","ItemSlotNeck","ItemSlotBack","ItemSlotFinger1","ItemSlotFinger2","ItemSlotTrinket1","ItemSlotTrinket2","IndividualAddonImporter","nameToProfession","profData","glyphsConfig","majorGlyphIDs","g","glyphToID","minorGlyphIDs","gearJson","glyphName","glyphIDStr","glyphNameToID","factionRestrictionsToLabels","ALLIANCE_ONLY","HORDE_ONLY","FiltersMenu","section","newSection","restriction","s","SourceUnknown","sourceNames","RaidUnknown","raidNames","maxArmorType","classToMaxArmorType","section2","at","ArmorTypeUnknown","armorTypeNames","weaponTypeSection","classToEligibleWeaponTypes","ewt","weaponTypeNames","weaponSpeedSection","isDualWieldSpec","classToEligibleRangedWeaponTypes","rangedWeaponTypeSection","rangedWeaponTypeNames","rangedWeaponSpeedSection","ReactionTime","ChannelClipDelay","InFrontOfTarget","DistanceFromTarget","TankAssignment","IncomingHps","enableWhen","HealingCadence","HealingCadenceVariation","cadenceVariation","BurstWindow","HpPercentForDefensives","InspirationUptime","inspirationUptime","itemQualityCssClasses","ItemQuality","ItemQualityJunk","ItemQualityCommon","ItemQualityUncommon","ItemQualityRare","ItemQualityEpic","ItemQualityLegendary","ItemQualityArtifact","ItemQualityHeirloom","setItemQualityCssClass","quality","descriptionsPromise","getEnchantDescription","response","descriptionsMap","idStr","getUniqueEnchantString","rows_in_block","blocks_in_cluster","tag","show_no_data_row","no_data_class","no_data_text","keep_parity","callbacks","getStyle","prop","getComputedStyle","Clusterize","ds","params","cluster_height","item_height","content_tag","block_height","scroll_top","rows_in_cluster","displayedRows","rows","scroll_elem","content_elem","hasAttribute","scrollTop","getRowsHeight","insertToDom","cache","scrollEv","bind","resizeEv","destroy","clean","removeEventListener","setContentElemRows","generateEmptyRow","refresh","force","getNumberOfRows","last_cluster","elementUpdate","cb","r","getScrollProgress","navigator","platform","pointer_events_set","pointerEvents","scroll_debounce","getClusterNum","scrollingProgress","resize_debounce","exploreEnvironment","generate","this_cluster_rows","this_cluster_content_changed","checkChanges","top_offset_changed","top_offset","only_bottom_offset_changed","bottom_offset","layout","parity","renderExtraTag","hidden","clusterWillChange","rows_above","counterIncrement","clusterChanged","lastChild","opts","tagName","append","prev_item_height","nodes","node","offsetHeight","marginTop","marginBottom","rows_len","generateRows","items_start","items_end","td","empty_row","no_data_content","colSpan","num_rows","cluster_divider","current_cluster","max_cluster","class_name","clusterize_prefix","changed","createHeroicLabel","createGemContainer","gemIconElem","gemContainer","getEmptyGemSocketIconUrl","fromItemId","filledId","GearPicker","leftSide","rightSide","leftItemPickers","ItemPicker","rightItemPickers","itemPickers","ItemRenderer","iconElem","nameElem","sce","socketsContainerElem","removeAttribute","innerText","heroic","asActionId","setBackgroundAndHref","makeSpellUrl","makeItemUrl","allSocketColors","_items","_enchants","gearData","changeEvent","openGearSelector","openSelectorModal","SelectorModalTabs","Items","Enchants","_equippedItem","slotNames","getEmptySlotIconUrl","SelectorModal","selectedTab","eligibleItems","eligibleEnchants","IconItemSwapPicker","iconAnchor","addItemSpecToGear","finally","itemSwap","getFieldNameFromItemSlot","lookupItemSpec","fillAndSet","ilists","tabsElem","setData","openTabName","openTab","fromItem","baseEP","ignoreEPFilter","onEquip","withItem","EquippedItem","GemColorUnknown","removeTabs","withEnchant","addGemTabs","sizeRefresh","socketBonusEP","tabAnchor","emptySocketUrl","updateGemIcon","addOnDisposeCallback","equippedToItemFn","onRemove","setTabContent","tabContentId","selected","ilist","ItemList","Item","is","invokeUpdate","updateSelected","applyFilter","applyFilters","hideOrShowEPValues","labelSubstring","tabElems","prototype","call","contentElems","tabElem","getElementById","emptySlotIcons","onItemClick","currentFilters","epButton","tabContent","placeholder","makeShow1hWeaponsSelector","makeShow2hWeaponsSelector","makeShowEPValuesSelector","makeShowMatchingGemsSelector","makePhaseSelector","listElem","itemsToDisplay","scroller","startIdx","endIdx","createItemElem","removeButton","searchInput","simAllButton","IndividualSimUI","itemSpecs","isRangedOrTrinket","curItem","curEP","idata","bt","addItems","newEquippedItem","newItemId","newEP","epDeltaElem","listItemEP","formatDeltaTextElem","itemIdxs","sortFn","listItemData","searchQuery","include","itemA","itemB","ilvl","diff","dataA","dataB","isItemFavorited","labels","itemEP","equipedItem","equipdItemId","anchorElem","listItemElem","getSourceInfo","favoriteElem","setFavorite","fav","isFavorite","favId","favoriteItems","favIdx","splice","favoriteEnchants","favoriteGems","makeAnchor","inner","crafted","professionNames","profession","zone","getZone","npc","getNpc","npcId","rtnEl","makeZoneUrl","difficultyNames","makeNpcUrl","otherName","quest","makeQuestUrl","soldBy","npcName","SimTab","identifier","childNodes","buildNavItem","contentContainer","tabFragment","buildColumn","customCssClass","column","BulkGearJsonImporter","bulkUI","BulkSimResultRenderer","baseResult","dpsDivParent","dpsDiv","dpsNumber","formatDps","unitMetrics","avg","dpsDelta","dpsDeltaSpan","formatDpsDelta","itemsContainer","itemsAdded","equipBtn","itemAdded","renderer","itemSlotName","delta","ItemSpecWithSlot","emitDefaultValues","BulkItemPicker","setItem","getEligibleItemSlots","openEnchantGemSelector","allItems","setItems","_gems","destroyItemButton","closeX","insertBefore","opacity","alignItems","BulkTab","leftPanel","column1","rightPanel","pendingDiv","pendingResults","doCombos","fastMode","autoGem","autoEnchant","defaultGems","UIGem","gemIconElements","buildTabContent","loadSettings","getSettingsKey","storedSettings","localStorage","getItem","settings","BulkSettings","combinations","SimGem","defaultRedGem","defaultYellowGem","defaultBlueGem","defaultMetaGem","storeSettings","createBulkSettings","setStr","iterationsPerCombo","createBulkItemsDatabase","itemsDb","SimItem","UIItem","SimEnchant","UIEnchant","itemsChangedEmitter","clearItems","setCombinations","setFastMode","itemsBlock","noticeWorkInProgress","itemTextIntro","itemList","resultsBlock","bulkSimResult","resultBlock","equippedGearResult","settingsBlock","bulkSimButton","disabled","simStart","Date","getTime","lastTotal","rounds","currentRound","progressMetrics","msSinceStart","iterPerSecond","ceil","importFavsButton","itemID","searchButton","searchText","searchResults","ev","toAdd","strID","searchString","pieces","displayCount","matched","lcName","lcSetName","piece","lcPiece","itemElement","htxt","ftxt","baseSearchHTML","getAllItems","focus","clearButton","defaultGemDiv","gemLabel","gemSocketsDiv","GemColorRed","GemColorYellow","GemColorBlue","socketIndex","gemFragment","selector","handleChoose","openGemSelector","GemSelectorModal","obj","secondsRemain","roundsText","onSelect","Gem1","SavedDataManager","userData","presets","frozen","contentBlock","savedDataDiv","presetsOnly","buildCreateContainer","saveInput","addSavedData","newData","makeSavedData","dataArr","isPreset","oldIdx","replaceChild","dataElemFragment","dataElem","deleteFragment","deleteButton","saveUserData","checkActive","getData","changeEmitters","savedData","storageKey","loadUserData","dataStr","jsonData","freeze","savedDataCreateFragment","GearTab","buildGearPickers","buildSavedGearsetPicker","savedGearManager","getSavedGearStorageKey","SavedGearSet","bonusStatsStats","newSavedGear","presetGear","actions","useIcon","curDragData","ListPicker","itemPickerPairs","hideUi","horizontalLayout","inlineMenuBar","titleTooltip","itemsDiv","actionEnabled","newItemButton","newButtonTooltip","makeActionElem","itemLabel","newList","pair","ipp","numToAdd","addNewPicker","action","allowedActions","itemContainer","itemHeader","itemPicker","newItemPicker","modObj","getSourceValue","moveButton","moveButtonTooltip","draggable","ondragstart","dataTransfer","dropEffect","effectAllowed","listPicker","dragEnterCounter","ondragenter","ondragleave","ondragover","ondrop","srcIdx","dstIdx","arrElem","copyButton","copyButtonTooltip","copyItem","deleteButtonTooltip","iconCssClass","actionElem","getItemHeaderElem","headerElem","nextElementSibling","EncounterPicker","modEncounter","addEncounterFieldPickers","showExecuteProportion","presetTargets","getAllPresetTargets","pe","path","equalTargetsIgnoreInputs","ti","makeTargetInputsPicker","advancedButton","AdvancedEncounterModal","addHeader","targetsElem","encounter2","oldItem","TargetPicker","presetEncounters","getAllPresetEncounters","section1","section3","getTarget","aiPicker","TargetInput","levelPicker","mobTypePicker","mobTypeEnumValues","tankIndexPicker","targetInputPickers","statPickers","ALL_TARGET_STATS","statData","statNames","swingSpeedPicker","minBaseDamagePicker","damageSpreadPicker","damageSpread","dualWieldPicker","dwMissPenaltyPicker","parryHastePicker","spellSchoolPicker","SpellSchoolArcane","SpellSchoolFire","SpellSchoolFrost","SpellSchoolHoly","SpellSchoolNature","SpellSchoolShadow","suppressDodgePicker","statValue","totalStats","curStats","TargetInputPicker","targetInputIndex","boolPicker","numberPicker","getTargetInput","boolValue","numberValue","inputType","InputType","Bool","durationGroup","newGroupContainer","executeGroup","target1","target2","modTarget2","StatHealth","StatArcaneResistance","StatFireResistance","StatFrostResistance","StatNatureResistance","StatShadowResistance","MobTypeUnknown","MobTypeBeast","MobTypeDemon","MobTypeDragonkin","MobTypeElemental","MobTypeHumanoid","MobTypeMechanical","MobTypeUndead","IconPicker","states","currentValue","active","rootAnchor","disableWowheadTouchTooltip","useImprovedIcons","improvedId","improvedId2","ia","ia2","ce","improvedAnchor","improvedAnchor2","counterElem","handleLeftClick","handleRightClick","getActionId","MultiIconPicker","dropdownRootElem","labelElem","buttonElem","hasOwnProperty","clearPicker","buildBlankOption","pickers","inputs","pickerConfig","optionContainer","updateButtonImage","getMaxValue","categoryId","IconEnumPicker","zeroValue","showWhen","bsPlacement","buttonText","numColumns","valueConfig","setImage","optionText","setActionImage","backgroundColor","setActive","backupIconUrl","backupId","CustomRotationPicker","modPlayer","CustomRotation","CustomSpell","itemConfig","CustomSpellPicker","spellIndex","crConfig","spellPicker","oldShowWhen","getSpell","setSpell","cpmPicker","showCastsPerMinute","castsPerMinute","customSpells","NumberListPicker","arrayEquals","CooldownsPicker","cooldownPickers","cooldown","makeActionPicker","makeTimingsPicker","deleteButtonFragment","addTrinketDesyncPicker","pickerInput","desyncProcTrinket1Seconds","desyncProcTrinket2Seconds","validator","reportValidity","cooldownIndex","availableCooldowns","isMajorCooldown","ActionIdProto","cooldownAction","Cooldown","timings","curCooldown","makeMultiIconInput","makeWrappedBooleanInput","getModObject","makeSpecOptionsBooleanInput","newVal","newMessage","makeRotationBooleanInput","makeWrappedNumberInput","makeSpecOptionsNumberInput","internalConfig","percent","makeRotationNumberInput","makeWrappedEnumInput","makeSpecOptionsEnumInput","makeRotationEnumInput","makeWrappedIconInput","makeBooleanIconInput","getFieldValue","setFieldValue","makeSpecOptionsBooleanIconInput","makeNumberIconInput","multiplier","sign","makeTristateIconInput","impId","input","makeMultistateIconInput","numStates","makeWrappedEnumIconInput","makeSpecOptionsEnumIconInput","makeRotationEnumIconInput","makeCustomRotationInput","MakeItemSwapInput","ItemSwap","itemSlots","buildIconInput","inputConfig","AllStatsBuff","InputHelpers.makeMultiIconInput","makeTristateRaidBuffInput","AllStatsPercentBuff","makeBooleanIndividualBuffInput","ArmorBuff","makeBooleanRaidBuffInput","StaminaBuff","StrengthAndAgilityBuff","IntellectBuff","SpiritBuff","AttackPowerBuff","makeTristateIndividualBuffInput","AttackPowerPercentBuff","DamagePercentBuff","DamageReductionPercentBuff","ResistanceBuff","HastePercentBuff","HealthBuff","MP5Buff","MeleeCritBuff","MeleeHasteBuff","ReplenishmentBuff","SpellCritBuff","SpellHasteBuff","withLabel","SpellPowerBuff","InputHelpers.makeMultistateIconInput","Bloodlust","DefensiveCooldownBuff","makeMultistateIndividualBuffInput","RetributionAura","BraidedEterniumChain","makeBooleanPartyBuffInput","ChainOfTheTwilightOwl","HeroicPresence","EyeOfTheNight","Thorns","ManaTideTotem","makeMultistatePartyBuffInput","Innervate","PowerInfusion","FocusMagic","RevitalizeRejuvination","makeMultistateMultiplierIndividualBuffInput","RevitalizeWildGrowth","MajorArmorDebuff","makeBooleanDebuffInput","MinorArmorDebuff","makeTristateDebuffInput","AttackPowerDebuff","BleedDebuff","CritDebuff","MeleeAttackSpeedDebuff","MeleeHitDebuff","PhysicalDamageDebuff","SpellCritDebuff","SpellHitDebuff","SpellDamageDebuff","HuntersMark","impId2","InputHelpers.makeQuadstateIconInput","makeQuadstateDebuffInput","JudgementOfWisdom","JudgementOfLight","GiftOfArthas","SuperSapper","makeBooleanConsumeInput","SpicedMammothTreats","PetFood","PetFoodKiblersBits","InputHelpers.makeBooleanIconInput","InputHelpers.makeTristateIconInput","makePotionInputFactory","consumesFieldName","makeConsumeInputFactory","allOptions","Potions","RunicHealingPotion","RunicHealingInjector","RunicManaPotion","RunicManaInjector","IndestructiblePotion","PotionOfSpeed","PotionOfWildMagic","DestructionPotion","HastePotion","MightyRagePotion","SuperManaPotion","FelManaPotion","InsaneStrengthPotion","IronshieldPotion","HeroicPotion","makePotionsInput","makePrepopPotionsInput","makeConjuredInput","Conjured","ConjuredDarkRune","ConjuredFlameCap","ConjuredHealthstone","ConjuredRogueThistleTea","makeWeaponImbueFactory","WeaponImbue","ImbueBrilliantWizardOil","ImbueBrilliantManaOil","ImbueSuperiorWizardOil","ImbueSuperiorManaOil","ImbueAdamantiteSharpeningStone","ImbueAdamantiteWeightStone","ImbueElementalSharpeningStone","ImbueSpellStone","ImbueFireStone","makeMainWeaponImbueInput","makeOffWeaponImbueInput","makeFlasksInput","Flask","FlaskOfTheFrostWyrm","FlaskOfEndlessRage","FlaskOfPureMojo","FlaskOfStoneblood","LesserFlaskOfToughness","LesserFlaskOfResistance","FlaskOfBlindingLight","FlaskOfMightyRestoration","FlaskOfPureDeath","FlaskOfRelentlessAssault","FlaskOfSupremePower","FlaskOfFortification","FlaskOfChromaticWonder","FlaskOfDistilledWisdom","onSet","battleElixir","BattleElixir","BattleElixirUnknown","guardianElixir","GuardianElixir","GuardianElixirUnknown","makeBattleElixirsInput","ElixirOfAccuracy","ElixirOfArmorPiercing","ElixirOfDeadlyStrikes","ElixirOfExpertise","ElixirOfLightningSpeed","ElixirOfMightyAgility","ElixirOfMightyStrength","GurusElixir","SpellpowerElixir","WrathElixir","AdeptsElixir","ElixirOfDemonslaying","ElixirOfMajorAgility","ElixirOfMajorFirePower","ElixirOfMajorFrostPower","ElixirOfMajorShadowPower","ElixirOfMajorStrength","ElixirOfMastery","ElixirOfTheMongoose","FelStrengthElixir","GreaterArcaneElixir","ElixirOfHealingPower","flask","FlaskUnknown","makeGuardianElixirsInput","ElixirOfMightyDefense","ElixirOfMightyFortitude","ElixirOfMightyMageblood","ElixirOfMightyThoughts","ElixirOfProtection","ElixirOfSpirit","ElixirOfDraenicWisdom","ElixirOfIronskin","ElixirOfMajorDefense","ElixirOfMajorFortitude","ElixirOfMajorMageblood","makeFoodInput","Food","FoodFishFeast","FoodGreatFeast","FoodBlackenedDragonfin","FoodHeartyRhino","FoodMegaMammothMeal","FoodSpicedWormBurger","FoodRhinoliciousWormsteak","FoodImperialMantaSteak","FoodSnapperExtreme","FoodMightyRhinoDogs","FoodFirecrackerSalmon","FoodCuttlesteak","FoodDragonfinFilet","FoodBlackenedBasilisk","FoodGrilledMudfish","FoodRavagerDog","FoodRoastedClefthoof","FoodSpicyHotTalbuk","FoodSkullfishSoup","FoodFishermansFeast","FillerExplosiveInput","Explosive","ExplosiveSaroniteBomb","ExplosiveCobaltFragBomb","ExplosiveBiggerOne","ExplosiveAdamantiteGrenade","ExplosiveFelIronBomb","factory","allOption","ConsumesPicker","settingsTab","buildPotionsPicker","buildElixirsPicker","buildFoodPicker","buildWeaponImbuePicker","buildEngPicker","buildPetPicker","prepopPotionOptions","splitRelevantOptions","StatSpellPower","StatStrength","IconInputs.makePrepopPotionsInput","potionOptions","StatIntellect","IconInputs.makePotionsInput","conjuredOptions","StatStamina","IconInputs.makeConjuredInput","flaskOptions","StatRangedAttackPower","StatMP5","StatSpirit","IconInputs.makeFlasksInput","battleElixirOptions","battleElixirsContainer","IconInputs.makeBattleElixirsInput","guardianElixirOptions","guardianElixirsContainer","IconInputs.makeGuardianElixirsInput","foodOptions","IconInputs.makeFoodInput","weaponOptions","offImbue","ImbueUnknown","IconInputs.makeMainWeaponImbueInput","offpicker","IconInputs.makeOffWeaponImbueInput","updateGear","hasSharpOHWeapon","hasBluntOHWeapon","removeChild","tradeConsumesElem","IconInputs.SuperSapper","IconInputs.FillerExplosiveInput","updateProfession","Engineering","petConsumeInputs","petConsumesElem","iconInput","COOLDOWNS_SECTION","BLESSINGS_SECTION","BASIC_BIS_DISCLAIMER","ItemSwapPicker","tippy","ignoreAttributes","itemSwapContainer","swapButtonFragment","swapButton","swapWithGear","gearMap","itemSwapMap","gearItem","swapItem","SettingsTab","column2","column3","column4","buildEncounterSettings","buildRotationSettings","buildPlayerSettings","buildCustomSettingsSections","buildConsumesSection","buildCooldownSettings","buildOtherSettings","buildBuffsSettings","buildDebuffsSettings","buildSavedDataPickers","encounterPicker","rotationIconGroup","rotationIconInputs","configureIconSection","IconInputs.buildIconInput","configureInputSection","rotationInputs","playerIconGroup","playerIconInputs","races","raceNames","playerInputs","professionGroup","nameToShattFaction","customSections","customSection","Tooltips.COOLDOWNS_SECTION","otherInputs","buffOptions","IconInputs.AllStatsBuff","IconInputs.AllStatsPercentBuff","IconInputs.HealthBuff","IconInputs.ArmorBuff","IconInputs.StaminaBuff","IconInputs.StrengthAndAgilityBuff","IconInputs.IntellectBuff","IconInputs.SpiritBuff","IconInputs.AttackPowerBuff","IconInputs.AttackPowerPercentBuff","IconInputs.MeleeCritBuff","IconInputs.MeleeHasteBuff","IconInputs.SpellPowerBuff","IconInputs.SpellCritBuff","IconInputs.HastePercentBuff","IconInputs.DamagePercentBuff","IconInputs.DamageReductionPercentBuff","IconInputs.ResistanceBuff","IconInputs.DefensiveCooldownBuff","IconInputs.MP5Buff","IconInputs.ReplenishmentBuff","multiIconInput","IconInputs.Bloodlust","IconInputs.SpellHasteBuff","revitalizeBuffOptions","IconInputs.RevitalizeRejuvination","IconInputs.RevitalizeWildGrowth","miscBuffOptions","IconInputs.HeroicPresence","IconInputs.BraidedEterniumChain","IconInputs.ChainOfTheTwilightOwl","IconInputs.FocusMagic","IconInputs.EyeOfTheNight","IconInputs.Thorns","IconInputs.RetributionAura","IconInputs.ManaTideTotem","IconInputs.Innervate","IconInputs.PowerInfusion","debuffOptions","IconInputs.MajorArmorDebuff","IconInputs.MinorArmorDebuff","IconInputs.PhysicalDamageDebuff","IconInputs.BleedDebuff","IconInputs.SpellDamageDebuff","IconInputs.SpellHitDebuff","IconInputs.SpellCritDebuff","IconInputs.CritDebuff","IconInputs.AttackPowerDebuff","IconInputs.MeleeAttackSpeedDebuff","IconInputs.MeleeHitDebuff","IconInputs.JudgementOfWisdom","IconInputs.HuntersMark","miscDebuffOptions","IconInputs.JudgementOfLight","IconInputs.GiftOfArthas","savedEncounterManager","SavedEncounter","newEncounter","savedSettingsManager","getSavedSettingsStorageKey","SavedSettings","playerBuffs","rotationJson","newSettings","sectionElem","sectionConfig","iconPickers","adjustColumns","AdaptiveStringPicker","actionIdSets","defaultLabel","getActionIDs","stackable_auras","maxStacks","icd_auras","hasIcd","exclusive_effect_auras","hasExclusiveEffect","castable_spells","castableSpells","isCastable","bucket","placeholders","fromOtherId","OtherAction","OtherActionPotion","fromEmpty","headerText","prepullOnly","channel_spells","isChanneled","dot_spells","hasDot","shield_spells","hasShield","APLActionIDPicker","DropdownPicker","actionIdSet","sourceToValue","valueToSource","setOptionContent","createMissingValue","getUnitRef","defaultUnitRef","updateValues","unitRef","setOptions","unitSets","aura_sources","getUnits","petMetadata","targetMetadata","aura_sources_targets_first","targetUI","APLUnitPicker","UnitPicker","unitSet","refToValue","hideLabelWhenDefaultSelected","thisPlayer","defaultTargetIcon","petName","rmIdx","getPetIconFromName","submenu","APLPickerBuilder","fieldPickers","fields","makeFieldPicker","fieldConfig","builder","field","pickerData","actionIdFieldConfig","unitRefField","ActionID","getParentValue","unitFieldConfig","numberFieldConfig","stringFieldConfig","runeTypeFieldConfig","includeDeath","APLValueRuneType","RuneBlood","RuneFrost","RuneUnholy","RuneDeath","TextDropdownPicker","runeSlotFieldConfig","APLValueRuneSlot","SlotLeftBlood","SlotRightBlood","SlotLeftFrost","SlotRightFrost","SlotLeftUnholy","SlotRightUnholy","aplInputBuilder","APLValuePicker","isPrepull","allValueKinds","valueKindFactories","valueKind","includeIf","kindPicker","kind","fullDescription","shortDescription","_player","newKind","sourceValue","oldKind","newSourceValue","makeAPLValue","valuePicker","not","and","vals","or","cmp","lhs","setSourceValue","player2","currentKind","updateValuePicker","implVal","sourceVal","valueFieldConfig","valueListFieldConfig","oldValue","inputBuilder","AplHelpers.aplInputBuilder","APLValueConst","AplHelpers.stringFieldConfig","APLValueCompare","ComparisonOperator","OpEq","OpNe","OpGe","OpGt","OpLe","OpLt","math","APLValueMath","MathOperator","OpAdd","OpSub","OpMul","OpDiv","mathOperatorFieldConfig","APLValueMax","APLValueMin","APLValueAnd","APLValueOr","APLValueNot","currentTime","APLValueCurrentTime","currentTimePercent","APLValueCurrentTimePercent","remainingTime","APLValueRemainingTime","remainingTimePercent","APLValueRemainingTimePercent","isExecutePhase","APLValueIsExecutePhase","ExecutePhaseThreshold","E20","E25","E35","executePhaseThresholdFieldConfig","numberTargets","APLValueNumberTargets","currentHealth","APLValueCurrentHealth","AplHelpers.unitFieldConfig","currentHealthPercent","APLValueCurrentHealthPercent","currentMana","APLValueCurrentMana","currentManaPercent","APLValueCurrentManaPercent","currentRage","APLValueCurrentRage","currentEnergy","APLValueCurrentEnergy","currentComboPoints","APLValueCurrentComboPoints","currentRunicPower","APLValueCurrentRunicPower","currentRuneCount","APLValueCurrentRuneCount","AplHelpers.runeTypeFieldConfig","currentNonDeathRuneCount","APLValueCurrentNonDeathRuneCount","currentRuneActive","APLValueCurrentRuneActive","AplHelpers.runeSlotFieldConfig","currentRuneDeath","APLValueCurrentRuneDeath","runeCooldown","APLValueRuneCooldown","nextRuneCooldown","APLValueNextRuneCooldown","runeSlotCooldown","APLValueRuneSlotCooldown","runeGrace","APLValueRuneGrace","runeSlotGrace","APLValueRuneSlotGrace","gcdIsReady","APLValueGCDIsReady","gcdTimeToReady","APLValueGCDTimeToReady","autoTimeToNext","APLValueAutoTimeToNext","spellCanCast","APLValueSpellCanCast","AplHelpers.actionIdFieldConfig","spellIsReady","APLValueSpellIsReady","spellTimeToReady","APLValueSpellTimeToReady","spellCastTime","APLValueSpellCastTime","spellTravelTime","APLValueSpellTravelTime","spellCpm","APLValueSpellCPM","spellChannelTime","APLValueSpellChannelTime","spellIsChanneling","APLValueSpellIsChanneling","spellChanneledTicks","APLValueSpellChanneledTicks","auraIsActive","APLValueAuraIsActive","auraIsActiveWithReactionTime","APLValueAuraIsActiveWithReactionTime","auraRemainingTime","APLValueAuraRemainingTime","auraNumStacks","APLValueAuraNumStacks","auraInternalCooldown","APLValueAuraInternalCooldown","auraIcdIsReadyWithReactionTime","APLValueAuraICDIsReadyWithReactionTime","auraShouldRefresh","APLValueAuraShouldRefresh","maxOverlap","dotIsActive","APLValueDotIsActive","dotRemainingTime","APLValueDotRemainingTime","sequenceIsComplete","APLValueSequenceIsComplete","sequenceIsReady","APLValueSequenceIsReady","sequenceTimeToReady","APLValueSequenceTimeToReady","totemRemainingTime","APLValueTotemRemainingTime","TotemType","Water","Earth","Air","Fire","totemTypeFieldConfig","catExcessEnergy","APLValueCatExcessEnergy","APLActionPicker","conditionPicker","AplValues.APLValuePicker","srcVal","APLAction","actionDiv","allActionKinds","actionKindFactories","actionKind","makeAPLAction","actionPicker","sequence","strictSequence","newActionKind","updateActionPicker","actionListFieldConfig","castSpell","APLActionCastSpell","multidot","APLActionMultidot","maxDots","AplHelpers.numberFieldConfig","AplValues.valueFieldConfig","multishield","APLActionMultishield","maxShields","channelSpell","APLActionChannelSpell","interruptIf","autocastOtherCooldowns","APLActionAutocastOtherCooldowns","wait","APLActionWait","waitUntil","APLActionWaitUntil","schedule","APLActionSchedule","innerAction","actionFieldConfig","APLActionSequence","resetSequence","APLActionResetSequence","APLActionStrictSequence","changeTarget","APLActionChangeTarget","activateAura","APLActionActivateAura","cancelAura","APLActionCancelAura","triggerIcd","APLActionTriggerICD","APLRotationPicker","APLPrepullAction","APLPrepullActionPicker","priorityList","APLListItem","APLListItemPicker","itemHeaderElem","makeListItemWarnings","rotationStats","hidePicker","HidePicker","doAtPicker","getWarnings","warningsElem","warningsTooltip","visibility","formattedWarnings","RotationTab","updateSections","buildAutoContent","buildAplContent","buildSimpleOrLegacyContent","rotType","aplLaunchStatus","isSimple","cooldownsContentBlock","savedRotationsManager","getSavedRotationStorageKey","SavedRotation","specRotationOptionsJson","specRot","rotations","presetRotation","rotData","emptyGlyphData","GlyphsPicker","majorGlyphsData","getGlyphData","minorGlyphsData","majorGlyphsBlock","minorGlyphsBlock","majorGlyphPickers","glyphField","GlyphPicker","minorGlyphPickers","glyphConfig","glyphOptions","isMajor","selectedGlyph","GlyphSelectorModal","glyphData","glyphPicker","listItemElems","glyphIdx","selectedGlyphId","listItemIdx","validItemElems","ele","makePetTypeInputConfig","includeLabel","InputHelpers.makeSpecOptionsEnumIconInput","PetType","PetNone","fromPetName","Bat","Bear","BirdOfPrey","Boar","CarrionBird","Cat","Chimaera","CoreHound","Crab","Crocolisk","Devilsaur","Dragonhawk","Gorilla","Hyena","Moth","NetherRay","Raptor","Ravager","Rhino","Scorpid","Serpent","Silithid","Spider","SpiritBeast","SporeBat","Tallstrider","Turtle","WarpStalker","Wasp","WindSerpent","Wolf","Worm","petCategories","categoryOrder","categoryClasses","HunterPetTalentsPicker","curCategory","getCategoryFromPlayer","curTalents","getPetTalentsFromPlayer","savedSets","defaultTalents","talentsContainer","petTalentsConfig","pickerContainer","petTalents","HunterPetTalents","savedTalentsManager","defaultBMTalents","petCategory","categoryIdx","updateIsBM","petType","getPetTalentsConfig","cunningDefault","cobraReflexes","dive","boarsSpeed","mobility","spikedCollar","cornered","feedingFrenzy","ferocityDefault","cullingTheHerd","spidersBite","charge","greatStamina","bloodOfTheRhino","guardDog","thunderstomp","graceOfTheMantis","cunningBMDefault","wolverineBite","bullheaded","ferocityBMDefault","bloodthirsty","rabid","callOfTheWild","sharkAttack","roarOfSacrifice","TalentsTab","buildHunterPickers","buildTalentsPicker","buildGlyphsPicker","buildSavedTalentsPicker","Mechanics.MAX_TALENT_POINTS","playerTab","petTab","buildHunterPetPicker","getSavedTalentsStorageKey","SavedTalents","newTalents","Exporter","allowDownload","clipboardButton","clipboard","writeText","originalContent","downloadString","IndividualLinkExporter","IndividualJsonExporter","jsonStringifyWithFlattenedPaths","IndividualWowheadGearPlannerExporter","bytes","addGlyph","glyphItemId","glyphItemToSpellId","to2Bytes","getItemSlots","slot1","slot2","binaryString","btoa","_Individual80UEPExporter","allUnitStats","namesToWeights","weight","pseudoStatNames","Individual80UEPExporter","StatSpellPenetration","StatMana","StatEnergy","StatRage","StatBonusArmor","StatRunicPower","StatBloodRune","StatFrostRune","StatUnholyRune","StatDeathRune","_IndividualPawnEPExporter","IndividualPawnEPExporter","IndividualCLIExporter","raidSimJson","raidSimResultsManager","autoRotation","simpleRotation","getMetaGemConditionDescription","failedProfReqs","getFailedProfessionRequirements","fpr","getJCGems","talentPoints","getTalentPoints","addSidebarComponents","addGearTab","addBulkTab","addSettingsTab","addTalentsTab","addRotationTab","addDetailedResultsTab","addTopbarComponents","initEventID","loadedSettings","binary","settingsBytes","pako","inflate","savedSettings","addRaidSimAction","displayStats","bulkTab","EmbeddedDetailedResults","_parent","Importers.IndividualJsonImporter","Importers.Individual80UImporter","Importers.IndividualWowheadGearPlannerImporter","Importers.IndividualAddonImporter","Exporters.IndividualLinkExporter","Exporters.IndividualJsonExporter","Exporters.IndividualWowheadGearPlannerExporter","Exporters.Individual80UEPExporter","Exporters.IndividualPawnEPExporter","Exporters.IndividualCLIExporter","tankSpec","healingSpec","towEnabled","individualBuffs","other","keyPart","specToLocalStorageKey","epWeightsStats","protoBytes","deflated","deflate","to","encoded","linkUrl","URL","missingRatios","includeBuffDebuffInputs","excludeBuffDebuffInputs"],"mappings":"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"}